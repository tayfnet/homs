<!DOCTYPE html><html lang="ar" dir="rtl"><head>
  
<script id="version-guard-toast">
(function() {
  var CURRENT_VERSION = "2.0.0.0-stable-plus";
  var KEY = "taif:app_version";
  try {
    var saved = localStorage.getItem(KEY);
    if (!saved) {
      localStorage.setItem(KEY, CURRENT_VERSION);
    } else if (saved !== CURRENT_VERSION) {
      // Clear taif:* except session
      try {
        var toDel = [];
        for (var i=0;i<localStorage.length;i++) toDel.push(localStorage.key(i));
        var PRESERVE = new Set([KEY, 'taif:session', 'taif:session_token']);
        toDel.forEach(function(k){
          if (k && k.indexOf("taif:")===0 && !PRESERVE.has(k) && !k.startsWith('taif:session/')) {
            localStorage.removeItem(k);
          }
        });
      } catch(_) {}
      try { localStorage.setItem(KEY, CURRENT_VERSION); } catch(_){}
      var showToast = function() {
        var wrap = document.createElement('div');
        wrap.setAttribute('dir','rtl');
        wrap.style.cssText = "position:fixed;top:14px;left:50%;transform:translateX(-50%);z-index:2147483647";
        var bubble = document.createElement('div');
        bubble.textContent = "üîÑ ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÜÿ∏ÿßŸÖ ÿ•ŸÑŸâ ÿ•ÿµÿØÿßÿ± ÿ¨ÿØŸäÿØ ‚Äî ÿ™ŸÖ ŸÖÿ≥ÿ≠ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÇÿØŸäŸÖÿ©";
        bubble.style.cssText = [
          "background: rgba(17,24,39,.95)",
          "color:#fff",
          "border-radius:14px",
          "padding:10px 16px",
          "font:600 14px/1.3 system-ui,Segoe UI,Roboto,Tahoma",
          "box-shadow:0 8px 24px rgba(0,0,0,.25)",
          "border:1px solid rgba(255,255,255,.08)",
          "max-width:92vw",
          "text-align:center",
          "white-space:nowrap"
        ].join(";");
        wrap.appendChild(bubble);
        document.body.appendChild(wrap);
        setTimeout(function(){ bubble.style.opacity="0.0"; bubble.style.transition="opacity .45s ease"; }, 1400);
      };
      if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', showToast);
      else showToast();
    }
  } catch(_) {}
})();
</script>
<link rel="preconnect" href="https://unpkg.com" crossorigin><link rel="dns-prefetch" href="https://unpkg.com"><link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin><link rel="dns-prefetch" href="https://cdn.tailwindcss.com"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/><title>ŸÑŸàÿ≠ÿ© ÿ£ÿ≥ÿπÿßÿ± ÿµÿ±ŸÅ ÿßŸÑÿπŸÖŸÑÿßÿ™</title><script>
  window.tailwind=window.tailwind||{};
  tailwind.config={safelist:[
    'bg-gradient-to-tr','bg-gradient-to-r','text-white','text-gray-100','text-gray-900',
    'from-cyan-200','via-white','to-blue-200','to-cyan-200',
    'from-rose-200','via-amber-100','to-orange-200',
    'from-emerald-200','to-teal-200',
    'from-gray-900','via-gray-800','to-slate-900',
    'from-indigo-200','to-purple-200',
    'from-yellow-100','via-yellow-200','to-yellow-300',
    'from-sky-600','via-cyan-600','to-blue-600',
    'from-orange-500','via-pink-500','to-red-500',
    'from-emerald-600','via-teal-600','to-green-500',
    'from-gray-700','via-gray-600','to-gray-800',
    'from-indigo-600','via-purple-600','to-fuchsia-600',
    'from-yellow-600','via-amber-600','to-yellow-700',
    'from-purple-700','via-indigo-600','to-blue-600',
    'from-sky-100','via-cyan-100','to-blue-100',
    'from-orange-100','via-amber-200','to-rose-200',
    'from-teal-100','via-green-100','to-emerald-100',
    'from-blue-100','via-gray-200','to-teal-100',
    'from-gray-800','via-gray-700','to-gray-600',
    'from-indigo-100','via-purple-100','to-violet-100',
    'from-yellow-100','via-amber-100','to-yellow-200'
  ]};
</script><script defer src="https://cdn.tailwindcss.com"></script><script defer src="https://cdn.jsdelivr.net/npm/twemoji@14.0.2/dist/twemoji.min.js" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/bcryptjs@2.4.3/dist/bcrypt.min.js"></script><style>:root{

color-scheme:light;--firstcol-pr:32px}*{box-sizing:border-box}html,body{height:100%}.glass{background:rgba(255,255,255,.4);backdrop-filter:blur(10px)}.glass-strong{background:rgba(255,255,255,.65);backdrop-filter:blur(12px)}.toast{position:fixed;top:1rem;left:50%;transform:translateX(-50%);z-index:1100}.backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);display:flex;align-items:center;justify-content:center;z-index:1050}.table-numbers,.table-numbers *{direction:ltr!important;unicode-bidi:bidi-override!important;text-align:center;font-family:Inter,Roboto,Arial,Tahoma,sans-serif}.table-currencies{table-layout:fixed;width:100%;border-collapse:collapse}.flag-slot img,.flag-slot svg{display:inline-block;vertical-align:-2px;border-radius:4px}@media(max-width:640px){.flag-slot img,.flag-slot svg{width:28px!important;height:18px!important}}@media(min-width:641px)and(max-width:1023px){.flag-slot img,.flag-slot svg{width:56px!important;height:36px!important}}@media(min-width:1024px){.flag-slot img,.flag-slot svg{width:72px!important;height:45px!important}}.cell-fixed{min-width:110px;display:inline-flex;justify-content:center;align-items:center;text-align:center}@media(max-width:640px){.cell-fixed{min-width:70px!important}}@media(min-width:768px){.cell-fixed{min-width:130px}}@media(min-width:1024px){.cell-fixed{min-width:150px}}.cell-change-mobile{padding:0 2px!important}.ad-wrap{position:relative;overflow:hidden;height:100%}.ad-item{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);white-space:nowrap;font-weight:600;transition:transform var(--ad-move,1.5s) ease-in-out}.no-trans{transition:none!important}.fld{height:38px;padding:.45rem .7rem;border:1px solid #d1d5db;border-radius:.75rem;background:#fff}.fld:focus{outline:2px solid rgba(59,130,246,.55)}.seg{display:inline-flex;border:1px solid #d1d5db;border-radius:.75rem;overflow:hidden}.seg>button{padding:.28rem .6rem;font-size:.75rem;line-height:1;border:0;background:#fff;color:#1f2937}.seg>button.mul.on{background:#16a34a;color:#fff}.seg>button.div.on{background:#dc2626;color:#fff}.code-badge{font-weight:800;font-size:.75rem;padding:.15rem .5rem;border-radius:.6rem;background:#0f172a;color:#fff}.name-inline{display:flex;align-items:center;gap:.45rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.buy-bg{background:#ecfdf5;border-color:#a7f3d0;color:#065f46}.sell-bg{background:#fef2f2;border-color:#fecaca;color:#991b1b}.bulk-grid{display:grid;grid-template-columns:200px 90px .9fr .9fr .9fr .9fr;gap:.5rem}.bulk-head{position:sticky;top:0;background:rgba(255,255,255,.9);backdrop-filter:blur(8px);z-index:10;border-bottom:1px solid #e5e7eb;padding:.5rem .25rem}.bulk-head>div{text-align:center}.bulk-head>div:first-child{text-align:right}.bulk-row{padding:.55rem .25rem;border-bottom:1px solid #eef2f7}.bulk-foot{position:sticky;bottom:0;background:transparent;padding:0;margin-top:.5rem}.m-label{display:none}@media(max-width:640px){.bulk-head{display:none}.bulk-row{grid-template-columns:1fr 1fr;grid-template-areas:"name name" "method method" "rb rs" "buy sell";gap:.45rem;padding:.6rem;border-bottom:1px solid #eaeef5;border-radius:.75rem}.m-label{display:block;font-size:12px;color:#6b7280;margin:0 0 .2rem}.cell-name{grid-area:name}.cell-method{grid-area:method}.cell-rb{grid-area:rb}.cell-rs{grid-area:rs}.cell-buy{grid-area:buy}.cell-sell{grid-area:sell}}.view-card{border:1px solid #e5e7eb;border-radius:1rem;padding:.75rem;background:#fff}.view-card.sel{outline:3px solid rgba(59,130,246,.5)}.board-row:hover{background:linear-gradient(90deg,rgba(229,231,235,.7),rgba(191,219,254,.9));box-shadow:0 2px 8px rgba(0,0,0,.12)}.hdr{display:grid;grid-template-columns:1fr;gap:.5rem}@media (min-width:640px){.hdr{grid-template-columns:35% 30% 35%}}@media (max-width:640px){.hdr > *{min-height:72px}}@media (max-width:640px){.footer-grid{grid-template-columns:75% 25% !important;}}@media (max-width:640px){.cell-change-mobile{font-size:12px!important;min-width:5.75ch!important;padding:0 .3rem!important;white-space:nowrap!important}}.name-box{flex:1 1 auto;min-width:0;max-width:100%;overflow:hidden}.name-track{display:inline-block;white-space:nowrap;padding-inline:2px}.name-box.is-scroll .name-track{animation:name-marquee 9s linear infinite}100%{transform:translateX(-100%)}@media(max-width:640px){.currency-name{font-size:13px !important;line-height:1.1 !important;}.currency-icon-mobile{display:none !important;}}@media(max-width:640px){.currency-cell-mobile{gap:0.25rem !important;}.name-box{overflow:hidden;max-width:100%;flex:1;}.name-box .name-track{display:inline-block;white-space:nowrap;animation:name-marquee 8s linear infinite;}100%{transform:translateX(-100%)}}@media(max-width:640px){.currency-cell-mobile{gap:0.25rem !important;}.name-box{overflow:visible !important;white-space:normal !important;flex:1;}.name-box .name-track{white-space:normal !important;word-break:break-word;font-size:13px !important;line-height:1.1 !important;}}@media(max-width:640px){.name-box{overflow:visible !important;white-space:normal !important;flex:1;}.name-box .name-track{white-space:normal !important;word-break:break-word;font-size:13px !important;line-height:1.2 !important;}.table-currencies{table-layout:fixed !important;width:100% !important;}.cell-change-mobile{min-width:58px !important;max-width:58px !important;height:32px !important;font-size:12px !important;line-height:32px !important;padding:0 !important;display:inline-flex !important;align-items:center !important;justify-content:center !important;white-space:nowrap !important;}}@media(max-width:640px){.name-box{overflow:visible !important;white-space:normal !important;flex:1;}.name-box .name-track{white-space:normal !important;word-break:break-word;font-size:13px !important;line-height:1.2 !important;}}@media(max-width:640px){.name-box{overflow:hidden !important;flex:1;display:-webkit-box !important;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.name-box .name-track{white-space:normal !important;word-break:break-word;font-size:13px !important;line-height:1.2 !important;}}@media(max-width:640px){.currency-cell-mobile{gap:0.15rem !important;}.name-box{overflow:hidden !important;flex:1;display:-webkit-box !important;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.name-box .name-track{white-space:normal !important;word-break:break-word;font-size:13px !important;line-height:1.2 !important;}}.name-track{animation:none !important;transform:none !important;}.name-box.is-scroll .name-track{animation:none !important;transform:none !important;}@media(max-width:640px){.card-label{font-size:12px !important;color:#111827 !important;margin-bottom:4px !important;line-height:1 !important;}.pill-card{height:40px !important;min-height:40px !important;display:inline-flex !important;align-items:center !important;justify-content:center !important;padding:0 12px !important;border-radius:14px !important;}.card-grid-mobile{gap:.5rem !important;}}@media(max-width:640px){.pill-card{height:38px !important;min-height:38px !important;padding:0 12px !important;width:92% !important;margin-inline:auto !important;}}@media(min-width:641px){.pill-card{width:94% !important;margin-inline:auto !important;}}@media(min-width:641px){.card-grid-mobile{gap:0.75rem !important;}}@media(min-width:1024px){.card-grid-mobile{gap:1rem !important;}}@media(max-width:640px){.board-row .table-numbers{min-width:7ch !important;height:38px !important;display:inline-flex !important;align-items:center !important;justify-content:center !important;padding:0 12px !important;font-size:14px !important;}.board-row .name-box{max-width:100% !important;}.board-row .name-track{white-space:normal !important;word-break:break-word;line-height:1.2 !important;display:-webkit-box !important;-webkit-box-orient:vertical;-webkit-line-clamp:2;font-size:13px !important;}}@media(max-width:640px){.board-row{grid-template-columns:2fr 0.9fr 0.9fr 0.8fr !important;}.board-row .name-track{font-size:14px !important;line-height:1.3 !important;-webkit-line-clamp:2;}.board-row .cell-change-mobile,.board-row .table-numbers span{min-width:60px !important;max-width:60px !important;height:34px !important;font-size:12px !important;line-height:34px !important;}}@media(max-width:640px){.board-row .cell-change-mobile,.board-row .table-numbers span{min-width:52px !important;max-width:52px !important;height:34px !important;font-size:12px !important;line-height:34px !important;}}@media(max-width:640px){.board-row .pill-buy,.board-row .pill-sell{height:40px !important;min-height:40px !important;line-height:40px !important;padding:0 14px !important;font-size:14px !important;display:inline-flex !important;align-items:center !important;justify-content:center !important;}.board-row .cell-change-mobile{min-width:52px !important;max-width:52px !important;height:30px !important;line-height:30px !important;font-size:11px !important;padding:0 6px !important;display:inline-flex !important;align-items:center !important;justify-content:center !important;white-space:nowrap !important;}}@media(max-width:640px){.board-row .pill-buy,.board-row .pill-sell{height:40px !important;min-height:40px !important;min-width:92px !important;max-width:92px !important;padding:0 8px !important;font-size:14px !important;line-height:40px !important;white-space:nowrap !important;overflow:hidden !important;text-overflow:clip !important;display:inline-flex !important;align-items:center !important;justify-content:center !important;}.board-row .cell-change-mobile{min-width:52px !important;max-width:52px !important;height:30px !important;line-height:30px !important;font-size:11px !important;white-space:nowrap !important;}}@media(max-width:640px){.board-row{grid-template-columns:1fr 100px 100px 60px !important;}.board-row .name-box{max-width:100% !important;}.board-row .name-track{white-space:normal !important;word-break:normal !important;overflow-wrap:anywhere !important;font-size:14px !important;line-height:1.3 !important;display:-webkit-box !important;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.board-row .currency-cell-mobile{gap:0.25rem !important;}}@media(max-width:640px){.backdrop .glass-strong{max-height:86vh !important;overflow:auto !important;}.form-currency .grid{gap:.6rem !important;}.form-currency .fld{height:34px !important;min-height:34px !important;padding:.28rem .6rem !important;font-size:14px !important;}.form-currency .btn-row{position:sticky !important;bottom:0 !important;background:transparent;padding-top:.5rem !important;}.form-currency .btn-row .w-32,.form-currency .btn-row .w-36{height:44px !important;}}@media(max-width:640px){.form-currency .fld{height:28px !important;min-height:28px !important;padding:.18rem .5rem !important;font-size:13px !important;}}@media(max-width:640px){.form-currency .grid{gap:.45rem !important;}.form-currency label.grid{gap:.25rem !important;}.form-currency .fld{height:30px !important;min-height:30px !important;padding:.22rem .5rem !important;font-size:13.5px !important;}}@media(max-width:640px){.backdrop{align-items:flex-start !important;padding-top:8px !important;}.backdrop .glass-strong{margin-top:0 !important;}}@media(max-width:640px){.toast .glass{font-size:14px !important;line-height:1.1 !important;white-space:nowrap !important;max-width:92vw !important;overflow:hidden !important;text-overflow:ellipsis !important;padding:.55rem .8rem !important;}}@media(max-width:640px){.themes-grid .view-card{padding:.55rem !important;border-radius:.9rem !important;}.themes-grid .view-card.sel{outline-width:2px !important;}.themes-grid .view-card .h-16{height:48px !important;}.themes-grid .view-card .mb-2{margin-bottom:.35rem !important;}.themes-grid .view-card .font-bold{font-size:13.5px !important;}.themes-grid .view-card .text-xs{font-size:10.5px !important;}}@media(max-width:640px){.themes-grid .view-card{padding:.45rem !important;border-radius:.8rem !important;}.themes-grid .view-card .h-16{height:44px !important;}.themes-grid .view-card .mb-2{margin-bottom:.3rem !important;}.themes-grid .view-card .font-bold{font-size:13px !important;}.themes-grid .view-card .text-xs{font-size:10px !important;}.themes-grid + .flex.justify-end.gap-2.pt-4 > button{height:38px !important;padding-inline:.75rem !important;font-size:14px !important;border-radius:.7rem !important;}}@media(max-width:640px){.backdrop .glass-strong{padding:10px !important;max-width:94vw !important;overflow:auto !important;}.themes-grid{padding-inline:2px !important;gap:.45rem !important;}.themes-grid .view-card{margin:0 !important;}.themes-grid + .flex.justify-end.gap-2.pt-4{padding-top:.35rem !important;gap:.35rem !important;}.themes-grid + .flex.justify-end.gap-2.pt-4 > button{margin:0 !important;}}@media(max-width:640px){.bottom-fixed{--footer-h:48px;}@media (max-width:640px){.bottom-fixed{--footer-h:40px;}}}.bg-cover-layer{position:fixed;inset:-15vh 0 -15vh 0;z-index:-1;pointer-events:none;}@media(max-width:640px){#body{min-height:100dvh;}}@media(max-width:640px){.backdrop{padding-top:16px !important;align-items:flex-start !important;}}@media(max-width:640px){.backdrop{padding-top:48px !important;align-items:flex-start !important;}}.fab{transition:background .2s ease,transform .15s ease;}.menu-panel{margin-top:6px;}.fab{transition:background .2s ease,transform .15s ease;}.menu-panel{position:absolute;left: 0;top:calc(100% + 4px);margin-top:0;}.menu-backdrop{position:fixed;inset:0;z-index:100000;}.menu-panel > .glass{max-height:80vh;overflow:auto;}.drawer-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.35);z-index:100000;}.drawer{position:fixed;top:0;left: 0;height:100dvh;width:60vw;background: var(--panel-bg) !important;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border-right: 1px solid var(--panel-border) !important;box-shadow:12px 0 28px rgba(0,0,0,.15);transform:translateX(-100%);transition:transform .28s ease;z-index:100001;display:flex;flex-direction:column;border-top-left-radius:14px;border-bottom-left-radius:14px;}.drawer.open{transform:translateX(0);}.drawer header{position:sticky;top:0;height:56px;display:flex;align-items:center;justify-content:space-between;padding:0 12px;font-weight:800;background: color-mix(in oklab, var(--panel-bg) 92%, #ffffff) !important;border-bottom: 1px solid var(--panel-border) !important;border-top-left-radius:14px;}.drawer .content{padding:10px;overflow:auto;}.btn-drawer{display:flex;align-items:center;gap:.6rem;padding:.55rem .8rem;border:1px solid #e5e7eb;border-radius:.9rem;background:#fff;font-weight:700;box-shadow:0 1px 3px rgba(0,0,0,.06);}.btn-drawer:active{transform:scale(.98)}.section-title{margin:.5rem .25rem .35rem;font-size:.9rem;color:#374151;font-weight:800}.sep{height:1px;background:#eef2f7;margin:.5rem 0}.fab{transition:background .2s ease,transform .15s ease;}@media (min-width:641px){.drawer{width:360px !important;}}@media (min-width:1024px){.drawer{width:380px !important;}}@media (min-width:1280px){.drawer{width:420px !important;}}@media (min-width:641px){.drawer{width:320px !important;}}@media (min-width:1024px){.drawer{width:340px !important;}}@media (min-width:1280px){.drawer{width:360px !important;}}.pick-list .font-extrabold{font-weight:800}@media (max-width:640px){.pick-list{gap:.8rem !important;}.pick-list button{padding:.85rem .75rem !important;}.pick-list .font-extrabold{font-size:16px}}@media(max-width:640px){.cell-change-mobile{font-size:10px !important;}}@media (min-width:641px){
  .ad-wrap .ad-item{
    font-size:clamp(24px,2.1vw,46px) !important;
    font-weight:800 !important;
    letter-spacing:.3px !important;
    line-height:1.15 !important;
  }
  .ad-wrap .ad-item span{padding-inline:1rem !important;}
}@media (min-width:1280px){
  .ad-wrap .ad-item{
    font-size:clamp(28px,1.9vw,46px) !important;
  }
}.bg-fixed-gradient{position:fixed;inset:-25vh 0 -25vh 0;z-index:-1;pointer-events:none;}@media (min-width:641px){.change-pill{height:38px !important;min-width:118px !important;padding:0 14px !important;font-size:15px !important;gap:.35rem !important;display:inline-flex !important;align-items:center !important;justify-content:center !important;}}@media (min-width:1024px){.change-pill{height:40px !important;min-width:130px !important;font-size:16px !important;}}@media (min-width:641px){.card-grid-mobile{align-items:center !important;}.card-grid-mobile > div{display:flex;flex-direction:column;align-items:center;gap:.35rem;}.card-grid-mobile .pill-card{height:38px !important;min-height:38px !important;}}@media (min-width:641px){.card-grid-mobile .pill-card{height:42px !important;min-height:42px !important;}.card-grid-mobile .change-pill{height:42px !important;min-height:42px !important;}}@media (min-width:1024px){.card-grid-mobile .pill-card{height:44px !important;min-height:44px !important;}.card-grid-mobile .change-pill{height:44px !important;min-height:44px !important;}}@media (min-width:641px){.card-grid-mobile{gap:1rem !important;}.card-grid-mobile > div{gap:.5rem !important;}}@media (min-width:1024px){.card-grid-mobile{gap:1.25rem !important;}}@media (min-width:641px){.icon-pill-after{background:#cfd8e3 !important;color:#111827 !important;border:1px solid rgba(17,24,39,.08) !important;display:inline-flex !important;align-items:center;}}@media (min-width:641px){.board-head >:first-child,.board-row >:first-child{padding-right:28px !important;}}@media (min-width:1024px){.board-head >:first-child,.board-row >:first-child{padding-right:32px !important;}}@media (min-width:1536px){.board-head >:first-child,.board-row >:first-child{padding-right:36px !important;}}@media (min-width:641px){.hdr{padding-right:0px !important;}}@media (min-width:641px){.title-box{transform:none !important;}}@media (min-width:641px){.hdr{height:136px !important;}.logo-box,.banner-box,.title-box{min-height:136px !important;height:136px !important;}.title-box{transform:none;}}@media (min-width:768px){.hdr{height:136px !important;}.logo-box,.banner-box,.title-box{min-height:136px !important;height:136px !important;}.title-box{transform:none;}}.title-plain{background:transparent !important;border:none !important;box-shadow:none !important;}@media (min-width:641px){.hdr{grid-template-columns:calc(35% - 1px) calc(30% - 1px) calc(35% - 1px);gap:0 !important;}}.logo-box img,.banner-box img{width:100% !important;height:100% !important;object-fit:fill !important;}.logo-modal .section{border:1px solid #e5e7eb;border-radius:12px;background:#ffffffcc;backdrop-filter:blur(6px);padding:12px}.logo-modal .section-title{font-weight:800;color:#334155;font-size:.95rem;margin-bottom:.35rem;display:flex;align-items:center;gap:.4rem}.logo-modal .hint{font-size:.78rem;color:#64748b}.logo-modal .row{display:grid;grid-template-columns:1fr;gap:.6rem}@media(min-width:640px){.logo-modal .row{grid-template-columns:220px 1fr}}.logo-modal .preview{display:flex;align-items:center;justify-content:center;width:220px;height:130px;border:1px dashed #cbd5e1;border-radius:10px;background:#fff}.logo-modal .actions{display:flex;gap:.5rem;flex-wrap:wrap}.logo-modal .sticky-actions{position:sticky;bottom:0;background:transparent;padding-top:.5rem}@media (max-width:640px){.logo-box,.banner-box{height:116px !important;min-height:116px !important;}.logo-box img,.banner-box img{width:100% !important;height:100% !important;object-fit:fill !important;}.hdr{gap:6px !important;}.title-plain{padding-block:6px !important;}header + .rounded-3xl{margin-top:6px !important;}.hdr > *{min-height:116px !important;}}@media (max-width:640px){.hdr{gap:3px !important;}.title-plain{padding-block:2px !important;}}@media (max-width:640px){.title-plain{min-height:40px !important;height:auto !important;padding-block:2px !important;display:flex !important;align-items:center !important;justify-content:center !important;}}@media (max-width:640px){.hdr{grid-template-columns:1fr 1fr !important;grid-template-areas:"logo banner" "title title" !important;gap:6px !important;align-items:stretch !important;}.logo-box{grid-area:logo !important;aspect-ratio:1 / 1 !important;height:auto !important;min-height:0 !important;}.banner-box{grid-area:banner !important;aspect-ratio:1 / 1 !important;height:auto !important;min-height:0 !important;}.title-plain{grid-area:title !important;min-height:0 !important;padding-block:6px !important;}.hdr > *{min-height:0 !important;}.logo-box img,.banner-box img{width:100% !important;height:100% !important;object-fit:fill !important;}}@media (max-width:640px){.hdr{grid-template-columns:1fr 1fr !important;grid-template-areas:"logo banner" "title title" !important;gap:6px !important;}.logo-box,.banner-box{height:96px !important;min-height:96px !important;aspect-ratio:auto !important;}.logo-box img,.banner-box img{width:100% !important;height:100% !important;object-fit:fill !important;}.title-plain{padding-block:6px !important;}}.btn-drawer{background:linear-gradient(135deg,#f8fafc 0%,#eef2f7 55%,#e8f0ff 100%) !important;border-color:rgba(148,163,184,.35) !important;color:#0f172a !important;box-shadow:inset 0 2px 8px rgba(15,23,42,.06),0 1px 3px rgba(0,0,0,.06) !important;}.btn-drawer:hover{background:linear-gradient(135deg,#eef2f7 0%,#e2e8f0 50%,#dde7ff 100%) !important;}.btn-drawer:active{transform:scale(.985) !important;}.section-title{color:#1f2937 !important;}.fab{width:56px !important;height:56px !important;border-radius:16px !important;background:radial-gradient(120% 120% at 30% 20%,#ffffffcc 0%,#eef2ffcc 45%,#e0e7ffcc 100%) !important;border:1px solid rgba(99,102,241,.35) !important;box-shadow:0 8px 24px rgba(30,58,138,.18),inset 0 1px 0 rgba(255,255,255,.7),inset 0 -1px 0 rgba(99,102,241,.25) !important;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);color:#111827 !important;display:flex;align-items:center;justify-content:center;transition:transform .18s ease,box-shadow .25s ease,background .25s ease;}@keyframes fab-glow{0%,100%{box-shadow:0 8px 22px rgba(30,58,138,.16),0 0 0 0 rgba(99,102,241,.0),inset 0 1px 0 rgba(255,255,255,.7),inset 0 -1px 0 rgba(99,102,241,.25);}50%{box-shadow:0 10px 26px rgba(30,58,138,.20),0 0 0 8px rgba(99,102,241,.06),inset 0 1px 0 rgba(255,255,255,.8),inset 0 -1px 0 rgba(99,102,241,.28);}}@media (max-width:640px){header{position:relative !important;}.fab{width:44px !important;height:44px !important;border-radius:12px !important;font-size:20px !important;}}@media (max-width:640px){.logo-box,.banner-box{height:84px !important;min-height:84px !important;}}@media (max-width:640px){.logo-box,.banner-box{height:80px !important;min-height:80px !important;}}@media (max-width:640px){.backdrop{align-items:center !important;justify-content:center !important;padding-top:0 !important;}.backdrop .glass-strong{margin-top:0 !important;max-height:86vh !important;}}.th-vipPearl .rounded-3xl{background:linear-gradient(135deg,#f0f9ff,#ecfeff) !important;border-color:#bae6fd !important;}.th-vipPearl .btn-drawer{background:linear-gradient(135deg,#f0f9ff,#e6fffb) !important;border-color:#bae6fd !important;color:#0f172a !important;}.th-vipPearl .glass-strong{background:rgba(255,255,255,.92) !important;border-color:#bae6fd !important;}.th-vipPearl .pill-buy{background:linear-gradient(90deg,#22c55e,#16a34a) !important;color:#fff !important;}.th-vipPearl .pill-sell{background:linear-gradient(90deg,#ef4444,#b91c1c) !important;color:#fff !important;}.th-vipPearl .change-pill{background:rgba(14,165,233,.15) !important;color:#0369a1 !important;}body{--th-text:#111827;--th-muted:#6b7280;--th-input-bg:#ffffff;--th-input-text:#111827;--th-input-border:#e5e7eb;--th-placeholder:#9ca3af;}.th-vipPearl{--th-text:#0f172a;--th-muted:#475569;--th-input-bg:#ffffff;--th-input-text:#0f172a;--th-input-border:#bae6fd;--th-placeholder:#64748b;}body[class*="th-"],body[class*="th-"] .glass-strong .fld,.backdrop .glass-strong .fld{background:var(--th-input-bg) !important;color:var(--th-input-text) !important;border-color:var(--th-input-border) !important;}.glass-strong .fld::placeholder,.backdrop .glass-strong .fld::placeholder{color:var(--th-placeholder) !important;opacity:1 !important;}.bulk-head>div,.pick-list .text-sm,.section-title,.card-label{color:var(--th-muted) !important;}.table-numbers{color:var(--th-text) !important;}.change-pill{font-weight:800 !important;}:root{

--th-text:#111827;--th-muted:#475569;--panel-bg:rgba(255,255,255,.96);--panel-text:#111827;--panel-border:#e5e7eb;--chip-bg:#e2e8f0;--chip-text:#111827;--chip-border:rgba(17,24,39,.08);--focus:#60a5fa88;}.th-vipPearl{--th-text:#0f172a;--th-muted:#475569;--panel-bg:rgba(255,255,255,.96);--panel-text:#0f172a;--panel-border:#bae6fd;--chip-bg:#dbeafe;--chip-text:#0f172a;--chip-border:#93c5fd;--focus:#06b6d488;}body[class*="th-"],body[class*="th-"] .btn-drawer,.view-card,.glass-strong{border-color:var(--panel-border) !important;}.glass-strong{background:var(--panel-bg) !important;color:var(--panel-text) !important;}.view-card{background:color-mix(in oklab,var(--panel-bg) 90%,#ffffff) !important;}.btn-drawer{background:linear-gradient(135deg,color-mix(in oklab,var(--panel-bg) 96%,#ffffff),color-mix(in oklab,var(--panel-bg) 86%,#ffffff)) !important;color:var(--panel-text) !important;}.fld{background:var(--panel-bg) !important;color:var(--panel-text) !important;border-color:var(--panel-border) !important;}.fld::placeholder{color:color-mix(in oklab,var(--panel-text) 45%,#9ca3af) !important;opacity:1 !important;}.fld:focus{outline:2px solid var(--focus) !important;}.icon-pill-after{background:var(--chip-bg) !important;color:var(--chip-text) !important;border:1px solid var(--chip-border) !important;}.table-numbers{color:var(--th-text) !important;}.change-pill{font-weight:800 !important;}.themes-grid .view-card .font-bold,.themes-grid .view-card .text-xs{color:#111827 !important;opacity:.95 !important;}
/* === Cards-only extra slim (scoped) === */
@media (min-width: 641px){
  .cards-view .view-card{ padding: .10rem !important; }
  /* both price pills and change badges carry 'pill-card' in CardsView */
  .cards-view .view-card .pill-card{
    padding-top: 0 !important;
    padding-bottom: 0 !important;
    padding-inline: .75rem !important; /* ‚âà px-3 sm:px-4 */
  }
}
/* === Cards-only ultra slim inner spacing === */
@media (min-width: 641px){
  .cards-view .card-grid-mobile{
    margin-top: 0 !important; /* mt-0 */
    gap: 0 !important;        /* gap-0 */
  }
}
/* === Unified header box heights === */
@media (min-width:641px){
  .logo-box, .banner-box, .title-box {
    min-height:136px !important;
    height:136px !important;
  }
}
/* Typography fix for title: allow wrapping and normalize spacing */
@keyframes name-marquee {
  0% { transform: translateX(0); }
  100% { transform: translateX(-100%); }
}

/* === Clean outline for BUY/SELL pills === */
.pill-buy, .pill-sell {
  color: #F9FAFB !important;
  font-weight: 900 !important;
  text-shadow:
    -1px 0 1px rgba(0,0,0,.55),
     1px 0 1px rgba(0,0,0,.55),
     0 1px 1px rgba(0,0,0,.55),
     0 -1px 1px rgba(0,0,0,.55);
}
.cards-view .pill-card.from-green-500,
.cards-view .pill-card.from-red-500 {
  color: #F9FAFB !important;
  font-weight: 900 !important;
  text-shadow:
    -1px 0 1px rgba(0,0,0,.55),
     1px 0 1px rgba(0,0,0,.55),
     0 1px 1px rgba(0,0,0,.55),
     0 -1px 1px rgba(0,0,0,.55);
}

</style><style id="fab-fix">.bottom-fixed{--footer-h:48px;}@media (max-width:640px){.bottom-fixed{--footer-h:40px;}}.drawer{z-index:100001;}.drawer-backdrop{z-index:100000;}</style>
<style id="title-unified">
/* === Title unified style === */
.title-plain h1 {
  background: linear-gradient(to right, #6B21A8, #DB2777, #2563EB);
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  -webkit-text-fill-color: transparent;
  filter: drop-shadow(0 1px 1px rgba(0,0,0,.18));
  white-space: normal;
  word-break: break-word;
  word-spacing: normal;
  letter-spacing: normal;
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 4;
  overflow: hidden;
  font-size: clamp(1.5rem, 4vw, 2.7rem);
  line-height: 1.2;
  text-align: center;
  margin: 0;
  padding-inline: 2px;
}
@media (max-width:640px) {
  .title-plain h1 {
    font-size: clamp(16px, 5vw, 20px);
    line-height: 1.15;
    -webkit-line-clamp: 4;
  }
}
</style>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style id="fs-no-select">
/* Disable text selection briefly when toggling fullscreen to avoid highlight */
.no-select {
  -webkit-user-select: none !important;
  -moz-user-select: none !important;
  -ms-user-select: none !important;
  user-select: none !important;
}
</style>

</head><body id="body" class="min-h-screen text-gray-900"><div id="bgfix" class="bg-fixed-gradient bg-gradient-to-tr from-cyan-200 via-white to-cyan-200"></div><div id="root"></div><script defer crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script><script defer crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script>
(function(){
  const SUPABASE_URL = "https://ibbtgjheqdgcacmcbpaq.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImliYnRnamhlcWRnY2FjbWNicGFxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAwNjkwMDQsImV4cCI6MjA3NTY0NTAwNH0.ymJHT9Qt7hFCPxTKHLexfoQ4mqo4igbCTu5mHjMgEHY";
  // Reduce realtime events per second for better performance
  const client = window.supabase ? window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
    // The original config requested up to 10 events per second from Supabase's realtime service.
    // Lowering this to 3 reduces the number of realtime messages and can help improve perceived responsiveness,
    // especially on low‚Äëpower devices or slow network connections.
    realtime: { params: { eventsPerSecond: 3 } }
  }) : null;

  const channels = new Map();
  const pollers = new Map();
  // Increase polling intervals to reduce CPU/network overhead.
  // When the page/tab is visible we poll every 7 seconds instead of 2.5.
  const POLL_MS_VISIBLE = 7000;
  // When the page/tab is hidden we poll every 30 seconds instead of 8.
  const POLL_MS_HIDDEN  = 30000;
  function __clearPoller(key){ try{ const t = pollers.get(key); if(t){ clearInterval(t); pollers.delete(key); } }catch(_){ } }

  function snap(val){ return { val: () => val }; }

  async function getKV(key){
    const { data, error } = await client.from('app_state').select('value').eq('key', key).maybeSingle();
    if (error) return null;
    return (data && 'value' in data) ? data.value : null;
  }
  async function setKV(key, value){
    await client.from('app_state').upsert([{ key, value }], { onConflict: 'key' });
  }
  async function getUsersMap(){
    const { data } = await client.from('users').select('*');
    const map = {}; (data||[]).forEach(u=>{ map[u.username] = u; }); return map;
  }
  async function getLogsMap(){
    const { data } = await client
      .from('adminactionslog')
      .select('*')
      // Exclude anonymous and system actors
      .neq('actor','anon')
      .neq('actor','system')
      // Retrieve the most recent records first and limit the number of rows
      // to avoid downloading the entire history on every refresh.
      .order('at',{ascending:false})
      .limit(200);
    const map = {};
    (data || [])
      .filter(row => !['addUser','updateUser','deleteUser'].includes(String(row.action || '')))
      .forEach(row => {
        const id = (row.at || Date.now()) + '_' + Math.random().toString(36).slice(2);
        map[id] = row;
      });
    return map;
  }

  
function subscribe(table, filter, onTick, nameKey){
  const name = `realtime_${table}_${nameKey||'all'}`;
  const ch = client.channel(name)
    .on('postgres_changes', { event:'*', schema:'public', table, filter }, async () => {
      try { await onTick(); } catch(_) {}
    });
  ch.subscribe();
  try { onTick && onTick(); } catch(_) {}
  return ch;
}


  const $db = {
    ref: (path) => ({ key: path }),
    async set(refOrPath, value){
      const key = typeof refOrPath === 'string' ? refOrPath : (refOrPath && refOrPath.key);
      if (!key) return;

      if (key.startsWith('taif/users/')){
        const username = key.split('/')[2];
        if (value === null || value === undefined){
          await client.from('users').delete().eq('username', username);
          return;
        }
        const rec = Object.assign({ username }, value||{});
        await client.from('users').upsert([rec], { onConflict: 'username' });
        return;
      }
      if (key === 'taif/users'){ return; }

      if (key === 'taif/adminactionslog' && (value===null || value===undefined)){
        await client.from('adminactionslog').delete().gt('id',0);
        return;
      }
      if (key.startsWith('taif/adminactionslog/')){
        await client.from('adminactionslog').insert([ value || {} ]);
        return;
      }

      if (key === 'taif/base' && value && typeof value === 'object' && value.date && value.base){
        await setKV('taif/base', value);
        return;
      }
      await setKV(key, value);
    },
    
onValue(refOrPath, cb){
      const key = typeof refOrPath === 'string' ? refOrPath : (refOrPath && refOrPath.key);
      if (!key) return null;

      let __lastJSON = null;
      const __update = async () => {
        try {
          let val;
          if (key === 'taif/users'){ val = await getUsersMap(); }
          else if (key.startsWith('taif/adminactionslog')){ val = await getLogsMap(); }
          else { val = await getKV(key); }
          const j = JSON.stringify(val);
          if (j !== __lastJSON) {
            __lastJSON = j;
            cb(snap(val));
          }
        } catch(_){}
      };

      (async () => { await __update(); })();

      let ch;
      if (key === 'taif/users'){
        ch = subscribe('users', undefined, __update, 'users');
      } else if (key.startsWith('taif/adminactionslog')){
        ch = subscribe('adminactionslog', undefined, __update, 'logs');
      } else {
        ch = subscribe('app_state', `key=eq.${key}`, __update, key);
      }
      channels.set(key, ch);

      try {
        const __startPoll = () => {
          const ms = (typeof document !== 'undefined' && document.visibilityState === 'hidden') ? POLL_MS_HIDDEN : POLL_MS_VISIBLE;
          __clearPoller(key);
          const t = setInterval(() => { __update(); }, ms);
          pollers.set(key, t);
        };
        __startPoll();
        const __visHandler = () => { __startPoll(); };
        if (typeof document !== 'undefined') {
          document.addEventListener('visibilitychange', __visHandler);
        }
        if (ch) ch.__visHandler = __visHandler;
      } catch(_){}

      return ch;
    },

    
off(refOrPath){
      const key = typeof refOrPath === 'string' ? refOrPath : (refOrPath && refOrPath.key);
      const ch = channels.get(key);
      if (ch){
        try{ client.removeChannel(ch); }catch(_){ }
        try{
          if (ch.__visHandler && typeof document !== 'undefined'){
            document.removeEventListener('visibilitychange', ch.__visHandler);
            ch.__visHandler = null;
          }
        }catch(_){}
        channels.delete(key);
      }
      __clearPoller(key);
    }

  };

  window.$db = $db;
  window.dispatchEvent(new Event('db-ready'));
})();
</script>


<script>(function(){ "use strict"; function readJSON(k, d){ try{ return JSON.parse(localStorage.getItem(k)||"null") ?? d; }catch(_){ return d; } } function getActor(){ var s = readJSON('taif:session', null); var name = (s && (s.name || s.displayName)) || null; var user = (s && s.username) || null; return name || user || 'anon'; } function fmt(n){ try{ if(n === undefined || n === null || n === '') return ''; var num = Number(n); if (!isFinite(num)) return String(n); return num.toLocaleString('ar-EG'); }catch(_){ return String(n); } } function insertRow(row){ if (!window.$db) return; try{ var id = Date.now() + '_' + Math.random().toString(36).slice(2); window.$db.set(window.$db.ref('taif/adminactionslog/' + id), row); }catch(_){} } window.Log = Object.assign(window.Log||{}, { logEvent: function(actionAr, detailsAr, actor){ insertRow({ actor: (actionAr==='resetBase' ? 'system' : (actor || getActor())), action: actionAr, target: detailsAr || '' }); }, loginSuccess: function(username){ insertRow({ actor: username || getActor(), action: 'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ (ŸÜÿ¨ÿßÿ≠)', target: '' }); }, loginFail: function(username){ insertRow({ actor: username || getActor(), action: 'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ (ŸÅÿ¥ŸÑ)', target: '' }); }, logout: function(username){ insertRow({ actor: username || getActor(), action: 'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿÆÿ±Ÿàÿ¨', target: '' }); } }); var __lastData = null; var __lastUsers = {}; var __lastBanner = null; function ensureSnapshots(){ try{ if (window.$db && !window.__log_snapshots_bound){ window.__log_snapshots_bound = true; try { window.$db.onValue(window.$db.ref('taif/data'), function(s){ __lastData = s && s.val && s.val(); }); } catch(_){} try { window.$db.onValue(window.$db.ref('taif/users'), function(s){ __lastUsers = (s && s.val && s.val()) || {}; }); } catch(_){} } }catch(_){} } function diffCurrencies(oldArr, newArr){ var res = { changed: [], usd: null }; try{ var byCodeOld = Object.create(null), byCodeNew = Object.create(null); (Array.isArray(oldArr)?oldArr:[]).forEach(function(o){ if(o && o.code) byCodeOld[o.code]=o; }); (Array.isArray(newArr)?newArr:[]).forEach(function(o){ if(o && o.code) byCodeNew[o.code]=o; }); var oU = byCodeOld['USD']||{}, nU = byCodeNew['USD']||{}; if ((oU.buy !== nU.buy) || (oU.sell !== nU.sell)){ res.usd = { oldBuy:oU.buy, newBuy:nU.buy, oldSell:oU.sell, newSell:nU.sell }; } Object.keys(byCodeNew).forEach(function(code){ if (code === 'USD') return; var o = byCodeOld[code]||{}, n = byCodeNew[code]||{}; var changed = false; ['ratioBuy','ratioSell','method','buy','sell'].forEach(function(k){ if (o[k] !== n[k]) changed = true; }); if (changed){ res.changed.push({ code: code, name: n.name || o.name || code, oldBuy: o.buy, newBuy: n.buy, oldSell: o.sell, newSell: n.sell, oldRB: o.ratioBuy, newRB: n.ratioBuy, oldRS: o.ratioSell, newRS: n.ratioSell, oldMethod:(o.method||''), newMethod:(n.method||'') }); } }); }catch(_){} return res; } function install(){ if(!window.$db || window.$db.__logWrappedV2) return; ensureSnapshots(); var origSet = window.$db.set.bind(window.$db); window.$db.set = async function(refOrPath, value){ var key = (typeof refOrPath === 'string') ? refOrPath : (refOrPath && refOrPath.key); var actor = getActor(); var res = await origSet(refOrPath, value); try{ if(!key) return res; if (key === 'taif/data' && Array.isArray(value)){ var d = diffCurrencies(__lastData, value); if (d && d.usd){ var m = []; if (d.usd.oldBuy !== d.usd.newBuy) m.push('ÿ¥ÿ±ÿßÿ° ' + fmt(d.usd.oldBuy) + ' ‚Üê ' + fmt(d.usd.newBuy)); if (d.usd.oldSell !== d.usd.newSell) m.push('ŸÖÿ®Ÿäÿπ ' + fmt(d.usd.oldSell) + ' ‚Üê ' + fmt(d.usd.newSell)); insertRow({ actor: actor, action: 'ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿØŸàŸÑÿßÿ±', target: m.join(' | ') }); } if (d && d.changed && d.changed.length){ if (d.changed.length === 1){ var c = d.changed[0]; var msg = ''; if (c.newBuy !== undefined && c.oldBuy !== undefined && (c.oldBuy !== c.newBuy)){ msg += 'ÿ¥ÿ±ÿßÿ° ' + fmt(c.oldBuy) + ' ‚Üê ' + fmt(c.newBuy); } if (c.newSell !== undefined && c.oldSell !== undefined && (c.oldSell !== c.newSell)){ if (msg) msg += ' | '; msg += 'ŸÖÿ®Ÿäÿπ ' + fmt(c.oldSell) + ' ‚Üê ' + fmt(c.newSell); } if (!msg){ msg = 'ŸÜŸêÿ≥Ÿéÿ® ÿ¥ÿ±ÿßÿ° ' + fmt(c.oldRB) + ' ‚Üê ' + fmt(c.newRB) + ' | ŸÜŸêÿ≥Ÿéÿ® ŸÖÿ®Ÿäÿπ ' + fmt(c.oldRS) + ' ‚Üê ' + fmt(c.newRS); } if (c.oldMethod !== c.newMethod){ if(msg) msg += ' | '; var nameOld=(c.oldMethod==='divide'?'ŸÇÿ≥ŸÖÿ©':(c.oldMethod==='multiply'?'ÿ∂ÿ±ÿ®':String(c.oldMethod||''))); var nameNew=(c.newMethod==='divide'?'ŸÇÿ≥ŸÖÿ©':(c.newMethod==='multiply'?'ÿ∂ÿ±ÿ®':String(c.newMethod||''))); msg += 'ÿßŸÑÿ∑ÿ±ŸäŸÇÿ© ' + (nameOld||'‚Äî') + ' ‚Üê ' + (nameNew||'‚Äî'); }
insertRow({ actor: actor, action: 'ÿ™ÿπÿØŸäŸÑ ÿπŸÖŸÑÿ©', target: c.name + ' (' + c.code + ') ‚Äî ' + msg }); } else { insertRow({ actor: actor, action: 'ÿ™ÿπÿØŸäŸÑ ÿ¨ŸÖŸäÿπ ÿßŸÑÿπŸÖŸÑÿßÿ™', target: '(' + d.changed.length + ' ÿπŸÖŸÑÿßÿ™)' });
d.changed.forEach(function(c){
  var msg = '';
  if (c.oldRB !== undefined && c.newRB !== undefined) msg += 'ŸÜŸêÿ≥Ÿéÿ® ÿ¥ÿ±ÿßÿ° ' + fmt(c.oldRB) + ' ‚Üê ' + fmt(c.newRB);
  if (c.oldRS !== undefined && c.newRS !== undefined){ if(msg) msg += ' | '; msg += 'ŸÜŸêÿ≥Ÿéÿ® ŸÖÿ®Ÿäÿπ ' + fmt(c.oldRS) + ' ‚Üê ' + fmt(c.newRS); }
  if (c.oldBuy !== undefined && c.newBuy !== undefined){ if(msg) msg += ' | '; msg += 'ÿ¥ÿ±ÿßÿ° ' + fmt(c.oldBuy) + ' ‚Üê ' + fmt(c.newBuy); }
  if (c.oldSell !== undefined && c.newSell !== undefined){ if(msg) msg += ' | '; msg += 'ŸÖÿ®Ÿäÿπ ' + fmt(c.oldSell) + ' ‚Üê ' + fmt(c.newSell); }
  if (c.oldMethod !== c.newMethod){ if(msg) msg += ' | '; var nameOld=(c.oldMethod==='divide'?'ŸÇÿ≥ŸÖÿ©':(c.oldMethod==='multiply'?'ÿ∂ÿ±ÿ®':String(c.oldMethod||''))); var nameNew=(c.newMethod==='divide'?'ŸÇÿ≥ŸÖÿ©':(c.newMethod==='multiply'?'ÿ∂ÿ±ÿ®':String(c.newMethod||''))); msg += 'ÿßŸÑÿ∑ÿ±ŸäŸÇÿ© ' + (nameOld||'‚Äî') + ' ‚Üê ' + (nameNew||'‚Äî'); }
insertRow({ actor: actor, action: 'ÿ™ÿπÿØŸäŸÑ ÿπŸÖŸÑÿ©', target: c.name + ' (' + (c.code||'') + ') ‚Äî ' + msg });
}); } } } else if (key === 'taif/banner' || key === 'taif:banner:v2'){
  try{
    var oldB = (__lastBanner && Array.isArray(__lastBanner.texts)) ? __lastBanner.texts.slice() : [];
    var newB = (value && Array.isArray(value.texts)) ? value.texts.slice() : [];
    var diffs = [];
    var max = Math.max(oldB.length, newB.length);
    for (var i=0;i<max;i++){
      var o = (oldB[i]||"").trim(), n = (newB[i]||"").trim();
      if (o && !n) diffs.push("‚ùå ÿ≠ÿ∞ŸÅ: " + o);
      else if (!o && n) diffs.push("‚ûï ÿ•ÿ∂ÿßŸÅÿ©: " + n);
      else if (o !== n) diffs.push("‚úèÔ∏è ÿ™ÿπÿØŸäŸÑ: " + o + " ‚Üê " + n);
    }
    var msg = diffs.length ? diffs.join(" | ") : "ŸÑŸÖ Ÿäÿ™ŸÖ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÜÿµŸàÿµ ("+newB.length+" ÿπŸÜÿµÿ±)";
    insertRow({ actor: actor, action: 'ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™', target: msg });
    __lastBanner = value;
  }catch(_){
    var count = (value && Array.isArray(value.texts)) ? value.texts.length : 0;
    insertRow({ actor: actor, action: 'ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™', target: '(' + count + ' ÿπŸÜÿµÿ±)' });
  }
}
 else if (key === 'taif/base'){
   try{
     var dte = (value && value.date) ? String(value.date) : '';
     var cnt = 0;
     try { cnt = value && value.base ? Object.keys(value.base).length : 0; } catch(_){}
     insertRow({ actor: 'system', action: 'resetBase', target: (dte ? ('ÿ®ÿ™ÿßÿ±ŸäÿÆ ' + dte + ' ‚Äî ') : '') + '(' + cnt + ' ÿπŸÖŸÑÿßÿ™)' });
   }catch(_){}
 }
 else if (key === 'taif/title'){ insertRow({ actor: actor, action: 'ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸáŸàŸäÿ©', target: 'ÿ™ŸÖ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿπŸÜŸàÿßŸÜ ÿ•ŸÑŸâ ‚Äú' + String(value||'') + '‚Äù' }); } else if (key === 'taif/logo'){ insertRow({ actor: actor, action: 'ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸáŸàŸäÿ©', target: 'ÿ™ŸÖ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÑŸàÿ∫Ÿà' }); } else if (key === 'taif/bannerImg'){ insertRow({ actor: actor, action: 'ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸáŸàŸäÿ©', target: 'ÿ™ŸÖ ÿ™ÿ∫ŸäŸäÿ± ÿµŸàÿ±ÿ© ÿßŸÑŸàÿßÿ¨Ÿáÿ©' }); } else if (key === 'taif/datetime' && value && typeof value === 'object'){ var t = (value.time ? String(value.time) : ''); var dte = (value.date ? String(value.date) : ''); insertRow({ actor: actor, action: 'ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸàŸÇÿ™', target: 'ÿ•ŸÑŸâ ' + t + ' ÿ®ÿ™ÿßÿ±ŸäÿÆ ' + dte }); } else if (key === 'taif/adminactionslog' && (value === null || value === undefined)){ insertRow({ actor: actor, action: 'ŸÖÿ≥ÿ≠ ÿßŸÑÿ≥ÿ¨ŸÑ', target: '' }); } else if (String(key).startsWith('taif/users/')){ var uname = String(key).split('/')[2] || ''; var before = __lastUsers && __lastUsers[uname]; if (value === null || value === undefined){ insertRow({ actor: actor, action: 'ÿ≠ÿ∞ŸÅ ŸÖÿ≥ÿ™ÿÆÿØŸÖ', target: '(' + uname + ')' }); } else if (!before){ var nm = (value && (value.name || value.username)) || uname; insertRow({ actor: actor, action: 'ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿ™ÿÆÿØŸÖ', target: '(' + nm + ')' }); } else { var nm2 = (value && (value.name || value.username)) || uname; insertRow({ actor: actor, action: 'ÿ™ÿπÿØŸäŸÑ ŸÖÿ≥ÿ™ÿÆÿØŸÖ', target: '(' + nm2 + ')' }); } } }catch(_){} return res; }; window.$db.__logWrappedV2 = true; } if (document.readyState === 'complete' || document.readyState === 'interactive'){ install(); } else { document.addEventListener('DOMContentLoaded', install); } window.addEventListener('db-ready', install); })();</script></script>


<script>
// === Robust double-click fullscreen toggle (global, debounced, selection-safe) ===
(function(){
  // Safeguard: ignore dblclicks inside inputs or editable controls
  function isEditableTarget(t){
    if (!t) return false;
    if (t.closest('input, textarea, select, [contenteditable="true"], .fld')) return true;
    return false;
  }

  function enterFS(el){
    const fn = el.requestFullscreen || el.webkitRequestFullscreen || el.mozRequestFullScreen || el.msRequestFullscreen;
    if (fn) try { fn.call(el); } catch(_){}
  }
  function exitFS(doc){
    const fn = doc.exitFullscreen || doc.webkitExitFullscreen || doc.mozCancelFullScreen || doc.msExitFullscreen;
    if (fn) try { fn.call(doc); } catch(_){}
  }
  function isFS(doc){
    return !!(doc.fullscreenElement || doc.webkitFullscreenElement || doc.mozFullScreenElement || doc.msFullscreenElement);
  }

  // Prevent text selection on quick double click
  document.addEventListener('mousedown', function(e){
    if (e.detail > 1 && !isEditableTarget(e.target)) {
      e.preventDefault();
    }
  }, { capture:true });

  // Main dblclick handler
  const onDbl = function(e){
    if (isEditableTarget(e.target)) return; // do nothing on inputs/text areas
    e.preventDefault();
    e.stopPropagation();

    // brief no-select to avoid highlighting artifacts
    document.body.classList.add('no-select');
    setTimeout(()=>document.body.classList.remove('no-select'), 350);

    if (isFS(document)) exitFS(document);
    else enterFS(document.documentElement);
  };

  // Capture early to beat component handlers that might select text
  document.addEventListener('dblclick', onDbl, { capture:true });
})();
</script>

<script>
// PhaseB: Smart Guard v5 ‚Äî client-only daily base snapshot (no RPC), lock then toast
const origSetB = window.$db && window.$db.set ? window.$db.set.bind(window.$db) : null;
if (origSetB) {
  window.$db.set = async function(refOrPath, value) {
    try {
      const key = typeof refOrPath === "string" ? refOrPath : (refOrPath && refOrPath.key);
      if (key === "taif/base") {
        console.info("üß≠ SmartGuard v5: preparing daily base snapshot...");
        // 1) Compute today's date (local) ‚Äî no RPC dependency
        const d = new Date();
        const today = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;

        // 2) If lock exists, block
        const supa = window.supabase.createClient(
          "https://ibbtgjheqdgcacmcbpaq.supabase.co",
          "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImliYnRnamhlcWRnY2FjbWNicGFxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAwNjkwMDQsImV4cCI6MjA3NTY0NTAwNH0.ymJHT9Qt7hFCPxTKHLexfoQ4mqo4igbCTu5mHjMgEHY"
        );
        const lockKey = `locks/base-${today}`;
        try {
          const { data:lockRow } = await supa.from("app_state").select("key").eq("key", lockKey).maybeSingle();
          if (lockRow && lockRow.key) {
            console.warn(`‚õî SmartGuard v5: lock exists for ${today} ‚Äî skip`);
            try { window.Log && window.Log.logEvent && window.Log.logEvent('resetBase', `ŸÖÿ±ŸÅŸàÿ∂ ‚Äî ÿ™ŸÖ ÿßŸÑŸÇŸÅŸÑ ÿ®ÿ™ÿßÿ±ŸäÿÆ ${today}`, 'system'); } catch (_) {}
            return;
          }
        } catch (e) { /* ignore and continue */ }

        // 3) Build base snapshot from taif/data stored in app_state
        let list = [];
        try {
          const { data } = await supa.from("app_state").select("value").eq("key","taif/data").maybeSingle();
          if (data && data.value) list = data.value;
        } catch (e) { /* ignore */ }

        // Fallback: if still empty, try pulling from localStorage cache if present
        if (!Array.isArray(list) || list.length === 0) {
          try {
            const snap = JSON.parse(localStorage.getItem("taif:cache")||"null");
            if (snap && Array.isArray(snap.data)) list = snap.data;
          } catch(_) {}
        }

        if (!Array.isArray(list) || list.length === 0) {
          console.error("‚ùå SmartGuard v5: cannot read taif/data to make a snapshot ‚Äî abort");
          return;
        }

        const toNum = (v)=> +v || 0;
        const usd = list.find(r=>r && r.code==="USD") || { buy:0, sell:0 };
        const usdSell = toNum(usd.sell);
        if (!(usdSell > 0)) {
          console.error("‚ùå SmartGuard v5: USD sell is not valid ‚Äî abort");
          return;
        }
        const base = {};
        for (const r of list) {
          if (!r || !r.code) continue;
          if (r.code === "USD") { base[r.code] = Math.round(usdSell); continue; }
          const rs = toNum(r.ratioSell) > 0 ? toNum(r.ratioSell) : 1;
          const method = (r.method === "divide") ? "divide" : "multiply";
          let sell=0;
          if (method === "divide") sell = Math.round(usdSell / rs);
          else sell = Math.round(usdSell * rs);
          base[r.code] = sell;
        }
        const outVal = { date: today, base };

        // 4) Write taif/base ourselves with the computed snapshot
        await origSetB(refOrPath, outVal);
        try { window.Log && window.Log.logEvent && window.Log.logEvent('resetBase', `ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ•ÿ∫ŸÑÿßŸÇ ŸÑŸäŸàŸÖ ${today}`, 'system'); } catch (_) {}

        // 5) Create lock
        try {
          await supa.from("app_state").upsert([{ key: lockKey, value: { at: Date.now() } }], { onConflict: "key" });
          console.info(`üîí SmartGuard v5: lock ${lockKey} created.`);
        } catch (e) { console.warn("‚ö†Ô∏è SmartGuard v5: lock upsert failed:", e); }

        // 6) Visual toast feedback (vanilla)
        try {
          const wrap = document.createElement('div');
          wrap.setAttribute('dir','rtl');
          wrap.style.cssText = "position:fixed;top:14px;left:50%;transform:translateX(-50%);z-index:2147483647";
          const bubble = document.createElement('div');
          bubble.textContent = `üîí ÿ™ŸÖ ŸÇŸÅŸÑ ÿ≥ÿπÿ± ÿßŸÑÿ•ÿ∫ŸÑÿßŸÇ Ÿàÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ£ÿ≥ÿßÿ≥ ŸÑŸÑŸäŸàŸÖ (${today})`;
          bubble.style.cssText = "background:#0f172acc;color:#fff;border-radius:14px;padding:10px 16px;font:600 14px/1.3 system-ui,Segoe UI,Roboto,Tahoma;box-shadow:0 8px 24px rgba(0,0,0,.25);border:1px solid rgba(255,255,255,.08);";
          wrap.appendChild(bubble); document.body.appendChild(wrap);
          setTimeout(()=>{ bubble.style.opacity="0"; bubble.style.transition="opacity .45s ease"; }, 1400);
        } catch(_) {}

        return; // important: we already wrote the snapshot
      }
    } catch (err) {
      console.error("‚ùå SmartGuard v5 error:", err);
    }
    return origSetB(refOrPath, value);
  };
}
</script>

<script>
(function(){
  function __start__(){
function _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }
const {
  useState,
  useEffect,
  useMemo,
  useRef,
  useCallback
} = React;
const ACTION_ICONS = {
  'ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿØŸàŸÑÿßÿ±': 'üíµ',
  'ÿ™ÿπÿØŸäŸÑ ÿπŸÖŸÑÿ©': '‚úèÔ∏è',
  'ÿ™ÿπÿØŸäŸÑ ÿ¨ŸÖŸäÿπ ÿßŸÑÿπŸÖŸÑÿßÿ™': 'üõ†Ô∏è',
  'ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™': '‚ö°',
  'ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸáŸàŸäÿ©': 'üñºÔ∏è',
  'ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸàŸÇÿ™': 'üïí',
  'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ (ŸÜÿ¨ÿßÿ≠)': '‚úÖ',
  'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ (ŸÅÿ¥ŸÑ)': '‚ùå',
  'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿÆÿ±Ÿàÿ¨': 'üö™',
  'ŸÖÿ≥ÿ≠ ÿßŸÑÿ≥ÿ¨ŸÑ': '‚ö†Ô∏è',
  'ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿ™ÿÆÿØŸÖ': 'üë§',
  'ÿ≠ÿ∞ŸÅ ŸÖÿ≥ÿ™ÿÆÿØŸÖ': 'üë§',
  'ÿ™ÿπÿØŸäŸÑ ŸÖÿ≥ÿ™ÿÆÿØŸÖ': 'üë§'
};
const humanizeLog = (lg = {}) => {
  const a = lg.action || '';
  const t = lg.target || '';
  if (a === 'ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿØŸàŸÑÿßÿ±') return `ÿ™ŸÖ ÿ™ÿπÿØŸäŸÑ ÿ≥ÿπÿ± ÿßŸÑÿØŸàŸÑÿßÿ± ${t ? '‚Äî ' + t : ''}`;
  if (a === 'ÿ™ÿπÿØŸäŸÑ ÿπŸÖŸÑÿ©') return `ÿ™ŸÖ ÿ™ÿπÿØŸäŸÑ ÿπŸÖŸÑÿ© ${t}`;
  if (a === 'ÿ™ÿπÿØŸäŸÑ ÿ¨ŸÖŸäÿπ ÿßŸÑÿπŸÖŸÑÿßÿ™') return `ÿ™ŸÖ ÿ™ÿπÿØŸäŸÑ ÿ¨ŸÖŸäÿπ ÿßŸÑÿπŸÖŸÑÿßÿ™ ${t}`;
  if (a === 'ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™') return `ÿ™ŸÖ ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™ ${t}`;
  if (a === 'ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸáŸàŸäÿ©') return `${t || 'ÿ™ŸÖ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸáŸàŸäÿ©'}`;
  if (a === 'ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸàŸÇÿ™') return `ÿ™ŸÖ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸàŸÇÿ™ ${t}`;
  if (a === 'ŸÖÿ≥ÿ≠ ÿßŸÑÿ≥ÿ¨ŸÑ') return `ÿ™ŸÖ ŸÖÿ≥ÿ≠ ÿ≥ÿ¨ŸÑ ÿßŸÑÿ•ÿØÿßÿ±ÿ© ÿ®ÿßŸÑŸÉÿßŸÖŸÑ`;
  if (a === 'ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿ™ÿÆÿØŸÖ') return `ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ${t}`;
  if (a === 'ÿ≠ÿ∞ŸÅ ŸÖÿ≥ÿ™ÿÆÿØŸÖ') return `ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ${t}`;
  if (a === 'ÿ™ÿπÿØŸäŸÑ ŸÖÿ≥ÿ™ÿÆÿØŸÖ') return `ÿ™ŸÖ ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ${t}`;
  if (a === 'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ (ŸÜÿ¨ÿßÿ≠)') return `ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ`;
  if (a === 'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ (ŸÅÿ¥ŸÑ)') return `ŸÅÿ¥ŸÑ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ`;
  if (a === 'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿÆÿ±Ÿàÿ¨') return `ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨`;
  return `${a} ${t}`.trim();
};
const fmtDT = iso => {
  try {
    return new Date(iso).toLocaleString();
  } catch (_) {
    return String(iso || '');
  }
};
const mapAction = a => {
  const dict = {
    addUser: 'ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿ™ÿÆÿØŸÖ',
    updateUser: 'ÿ™ÿπÿØŸäŸÑ ŸÖÿ≥ÿ™ÿÆÿØŸÖ',
    deleteUser: 'ÿ≠ÿ∞ŸÅ ŸÖÿ≥ÿ™ÿÆÿØŸÖ',
    'ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿ™ÿÆÿØŸÖ': 'ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿ™ÿÆÿØŸÖ',
    'ÿ™ÿπÿØŸäŸÑ ŸÖÿ≥ÿ™ÿÆÿØŸÖ': 'ÿ™ÿπÿØŸäŸÑ ŸÖÿ≥ÿ™ÿÆÿØŸÖ',
    'ÿ≠ÿ∞ŸÅ ŸÖÿ≥ÿ™ÿÆÿØŸÖ': 'ÿ≠ÿ∞ŸÅ ŸÖÿ≥ÿ™ÿÆÿØŸÖ',
    editUSD: 'ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿØŸàŸÑÿßÿ±',
    bulkEdit: 'ÿ™ÿπÿØŸäŸÑ ŸÉŸÑ ÿßŸÑÿπŸÖŸÑÿßÿ™',
    editData: 'ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ£ÿ≥ÿπÿßÿ±',
    clearLogs: 'ŸÖÿ≥ÿ≠ ÿßŸÑÿ≥ÿ¨ŸÑ',
    editBanner: 'ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™',
    changeView: 'ÿ™ÿ∫ŸäŸäÿ± ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿπÿ±ÿ∂',
    changeTheme: 'ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ´ŸäŸÖ',
    editLogo: 'ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÑŸàÿ∫Ÿà/ÿßŸÑÿπŸÜŸàÿßŸÜ',
    adjustDatetime: 'ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸàŸÇÿ™',
    resetBase: 'ÿ™ÿ≠ÿØŸäÿ´ ÿÆÿ∑ ÿßŸÑÿ£ÿ≥ÿßÿ≥ ÿßŸÑŸäŸàŸÖŸä'
  };
  return dict[a] || a || '';
};
const prettyTarget = (t = '') => {
  try {
    if (!t) return '';
    const s = String(t);
    if (s === 'taif/data') return 'ÿßŸÑÿ£ÿ≥ÿπÿßÿ±';
    if (s === 'taif/base') return 'ÿÆÿ∑ ÿßŸÑÿ£ÿ≥ÿßÿ≥ ÿßŸÑŸäŸàŸÖŸä';
    if (s === 'adminactionslog') return 'ÿ≥ÿ¨ŸÑÿßÿ™ ÿßŸÑÿ•ÿØÿßÿ±ÿ©';
    if (s === 'taif/banner') return 'ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™';
    if (s === 'taif/title') return 'ÿπŸÜŸàÿßŸÜ ÿßŸÑÿµŸÅÿ≠ÿ©';
    if (s === 'taif/logo') return 'ÿßŸÑÿ¥ÿπÿßÿ±';
    if (s === 'taif/bannerImg') return 'ÿµŸàÿ±ÿ© ÿßŸÑŸáŸäÿØÿ±';
    if (s === 'taif/datetime') return 'ÿßŸÑŸàŸÇÿ™ ŸàÿßŸÑÿ™ÿßÿ±ŸäÿÆ';
    if (s.startsWith('taif/users/')) return 'ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ: ' + s.split('/')[2];
    return s;
  } catch (_) {
    return t || '';
  }
};
const DEVICE_KEY = 'taif:device_id';
function ensureDeviceId() {
  try {
    let id = localStorage.getItem(DEVICE_KEY);
    if (!id) {
      const rnd = crypto && crypto.getRandomValues ? crypto.getRandomValues(new Uint32Array(4)) : new Uint32Array([Date.now() & 0xffffffff, Math.random() * 1e9 | 0, Math.random() * 1e9 | 0, Math.random() * 1e9 | 0]);
      id = 'dev_' + Array.from(rnd).map(n => n.toString(16)).join('');
      localStorage.setItem(DEVICE_KEY, id);
    }
    return id;
  } catch (_) {
    return 'dev_fallback';
  }
}
const arrEq = (a, b) => {
  if (!Array.isArray(a) || !Array.isArray(b)) return false;
  if (a.length !== b.length) return false;
  const A = [...a].sort(),
    B = [...b].sort();
  for (let i = 0; i < A.length; i++) if (A[i] !== B[i]) return false;
  return true;
};
const toPermArray = objOrArr => {
  if (Array.isArray(objOrArr)) return objOrArr;
  if (objOrArr && typeof objOrArr === 'object') return Object.keys(objOrArr).filter(k => objOrArr[k]);
  return [];
};
const __IMG_TYPES = new Set(['image/png', 'image/jpeg', 'image/webp', 'image/svg+xml', 'image/gif']);
const __MAX_IMG_BYTES = 5 * 1024 * 1024;
const validateImage = (file, setToast) => {
  if (!file) return false;
  if (!__IMG_TYPES.has(file.type)) {
    setToast?.({
      text: "‚ö†Ô∏è ÿßŸÑÿµŸäÿ∫ ÿßŸÑŸÖÿ≥ŸÖŸàÿ≠ÿ©: PNG, JPEG, WebP ŸÅŸÇÿ∑",
      type: "error"
    });
    return false;
  }
  if (file.size > __MAX_IMG_BYTES) {
    setToast?.({
      text: "‚ö†Ô∏è ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ŸÇÿµŸâ ŸÑŸÑÿµŸàÿ±ÿ© 1MB",
      type: "error"
    });
    return false;
  }
  return true;
};
const useFocusTrap = (enabled, containerRef) => {
  useEffect(() => {
    if (!enabled) return;
    const root = containerRef && containerRef.current || document;
    const q = 'a[href],button,textarea,input,select,[tabindex]:not([tabindex="-1"])';
    const getList = () => {
      const base = containerRef?.current || document;
      return Array.from(base.querySelectorAll(q)).filter(el => !el.hasAttribute('disabled'));
    };
    const listInit = getList();
    if (listInit[0]) {
      try {
        listInit[0].focus();
      } catch (_) {}
    }
    const onKey = e => {
      if (e.key !== 'Tab') return;
      const list = getList();
      if (!list.length) return;
      const first = list[0],
        last = list[list.length - 1];
      const active = document.activeElement;
      if (e.shiftKey) {
        if (active === first || !containerRef?.current?.contains(active)) {
          e.preventDefault();
          last.focus();
        }
      } else {
        if (active === last || !containerRef?.current?.contains(active)) {
          e.preventDefault();
          first.focus();
        }
      }
    };
    document.addEventListener('keydown', onKey);
    return () => document.removeEventListener('keydown', onKey);
  }, [enabled, containerRef]);
};
const APP_VERSION = function () {
  const fallback = "2.0.0.0-stable-plus";
  try {
    return localStorage.getItem("taif:app_version") || fallback;
  } catch (_) {
    return fallback;
  }
}();
const K = Object.freeze({
  DATA: "taif:data",
  BANNER: "taif:banner:v2",
  DT: "taif:datetime",
  THEME: "taif:customTheme",
  BASE: "taif:dailyBase",
  VIEW: "taif:viewMode",
  LOGO: "taif:logo",
  TITLE: "taif:title",
  BANNERIMG: "taif:bannerImage"
});
const SESSION_TTL_MS = 1000 * 60 * 60 * 24 * 365;
const CACHE_KEY = "taif:cache";
const loadCache = () => {
  try {
    return JSON.parse(localStorage.getItem(CACHE_KEY)) || null;
  } catch {
    return null;
  }
};
const saveCache = obj => {
  try {
    localStorage.setItem(CACHE_KEY, JSON.stringify(obj));
  } catch {}
};
const __memKV = new Map();
const StorageManager = (() => {
  let _mem = null;
  return {
    load: () => _mem,
    save: obj => {
      _mem = obj;
    },
    clear: () => {
      _mem = null;
    }
  };
})();
const clamp = (n, min, max) => Math.min(Math.max(+n || 0, min), max);
const toNum = v => +v || 0;
const two = n => String(n).padStart(2, '0');
const readJSON = (k, fb) => {
  try {
    return __memKV.has(k) ? __memKV.get(k) : fb;
  } catch {
    return fb;
  }
};
const saveJSON = (k, v) => {
  try {
    __memKV.set(k, v);
  } catch {}
};
const fmt = n => new Intl.NumberFormat('en-US').format(toNum(n));
const isValidTime = s => /^([01]\d|2[0-3]):[0-5]\d$/.test((s || "").trim());
const isValidDateDMY = s => {
  const m = (s || "").trim().match(/^(\d{2})-(\d{2})-(\d{4})$/);
  if (!m) return false;
  const d = +m[1],
    mo = +m[2] - 1,
    y = +m[3],
    dt = new Date(y, mo, d);
  return dt.getFullYear() === y && dt.getMonth() === mo && dt.getDate() === d;
};
const dmyToIso = s => {
  if (!isValidDateDMY(s)) return "";
  const [d, mo, y] = s.split("-");
  return `${y}-${mo}-${d}`;
};
const isoToDmy = s => {
  if (!s || !/^\d{4}-\d{2}-\d{2}$/.test(s)) return "";
  const [y, mo, d] = s.split("-");
  return `${d}-${mo}-${y}`;
};
const THEMES = [{
  id: "sunset",
  name: "ÿ∫ÿ±Ÿàÿ®",
  cls: "bg-gradient-to-tr from-rose-200 via-amber-100 to-orange-200 text-gray-900",
  head: "bg-gradient-to-r from-orange-500 via-pink-500 to-red-500 text-white",
  banner: "from-orange-100 via-amber-200 to-rose-200"
}, {
  id: "mint",
  name: "ŸÜÿπŸÜÿßÿπŸä",
  cls: "bg-gradient-to-tr from-emerald-200 via-white to-teal-200 text-gray-900",
  head: "bg-gradient-to-r from-emerald-600 via-teal-600 to-green-500 text-white",
  banner: "from-teal-100 via-green-100 to-emerald-100"
}, {
  id: "lav",
  name: "ŸÑÿßŸÅŸÜÿØÿ±",
  cls: "bg-gradient-to-tr from-indigo-200 via-white to-purple-200 text-gray-900",
  head: "bg-gradient-to-r from-indigo-600 via-purple-600 to-fuchsia-600 text-white",
  banner: "from-indigo-100 via-purple-100 to-violet-100"
}, {
  id: "gold",
  name: "ÿ∞Ÿáÿ®Ÿä ŸÅÿßÿÆÿ±",
  cls: "bg-gradient-to-tr from-yellow-100 via-yellow-200 to-yellow-300 text-gray-900",
  head: "bg-gradient-to-r from-yellow-600 via-amber-600 to-yellow-700 text-white",
  banner: "from-yellow-100 via-amber-100 to-yellow-200"
}, {
  id: "vipPearl",
  name: "VIP ‚Äî Pearl Glass",
  cls: "bg-gradient-to-tr from-blue-100 via-gray-200 to-teal-100 text-gray-900",
  head: "bg-gradient-to-r from-sky-600 via-cyan-600 to-blue-600 text-white",
  banner: "from-sky-100 via-cyan-100 to-blue-100"
}, {
  id: "vipTaif",
  name: "VIP ‚Äî Taif Brand",
  cls: "bg-gradient-to-tr from-indigo-100 via-amber-100 to-violet-100 text-gray-900",
  head: "bg-gradient-to-r from-yellow-600 via-amber-600 to-yellow-700 text-white",
  banner: "from-indigo-100 via-amber-100 to-violet-100"
}];
const THEME_MAP = Object.fromEntries(THEMES.map(t => [t.cls, t]));
const DEF_HEAD = "bg-gradient-to-r from-purple-700 via-indigo-600 to-blue-600 text-white";
const DEF_BANNER = "from-blue-100 via-gray-200 to-teal-100";
const headCls = theme => THEME_MAP[theme]?.head || DEF_HEAD;
const bannerCls = theme => THEME_MAP[theme]?.banner || DEF_BANNER;
const THEME_WHITELIST = new Set(THEMES.map(t => t.cls));
const DEFAULT_DATA = [{
  flag: "üá∫üá∏",
  icon: "USD",
  code: "USD",
  name: "ÿßŸÑÿØŸàŸÑÿßÿ± ÿßŸÑÿ£ŸÖÿ±ŸäŸÉŸä",
  buy: 11300,
  sell: 11400,
  ratioBuy: 1,
  ratioSell: 1,
  method: "multiply"
}, {
  flag: "üá™üá∫",
  icon: "EUR",
  code: "EUR",
  name: "ÿßŸÑŸäŸàÿ±Ÿà",
  ratioBuy: 1.1700,
  ratioSell: 1.1625,
  method: "multiply"
}, {
  flag: "üáπüá∑",
  icon: "TRY",
  code: "TRY",
  name: "ÿßŸÑŸÑŸäÿ±ÿ© ÿßŸÑÿ™ÿ±ŸÉŸäÿ©",
  ratioBuy: 42.4,
  ratioSell: 41.8,
  method: "divide"
}, {
  flag: "üá∏üá¶",
  icon: "SAR",
  code: "SAR",
  name: "ÿßŸÑÿ±ŸäÿßŸÑ ÿßŸÑÿ≥ÿπŸàÿØŸä",
  ratioBuy: 3.8,
  ratioSell: 3.77,
  method: "divide"
}, {
  flag: "üá¶üá™",
  icon: "AED",
  code: "AED",
  name: "ÿßŸÑÿØÿ±ŸáŸÖ ÿßŸÑÿ•ŸÖÿßÿ±ÿßÿ™Ÿä",
  ratioBuy: 3.75,
  ratioSell: 3.70,
  method: "divide"
}, {
  flag: "üá∂üá¶",
  icon: "QAR",
  code: "QAR",
  name: "ÿßŸÑÿ±ŸäÿßŸÑ ÿßŸÑŸÇÿ∑ÿ±Ÿä",
  ratioBuy: 3.75,
  ratioSell: 3.69,
  method: "divide"
}, {
  flag: "üáØüá¥",
  icon: "JOD",
  code: "JOD",
  name: "ÿßŸÑÿØŸäŸÜÿßÿ± ÿßŸÑÿ£ÿ±ÿØŸÜŸä",
  ratioBuy: 1.38,
  ratioSell: 1.3975,
  method: "multiply"
}, {
  flag: "üá¨üáß",
  icon: "GBP",
  code: "GBP",
  name: "ÿßŸÑÿ¨ŸÜŸäŸá ÿßŸÑÿ•ÿ≥ÿ™ÿ±ŸÑŸäŸÜŸä",
  ratioBuy: 1.30,
  ratioSell: 1.32,
  method: "multiply"
}];
const Toast = ({
  toast,
  onClose
}) => {
  useEffect(() => {
    if (!toast) return;
    const timer = setTimeout(onClose, 3000);
    return () => clearTimeout(timer);
  }, [toast]);
  if (!toast) return null;
  let style = "bg-green-100 border-green-400 text-green-800";
  if (toast.type === "error") style = "bg-red-100 border-red-400 text-red-800";
  if (toast.type === "info") style = "bg-blue-100 border-blue-400 text-blue-800";
  return ReactDOM.createPortal(React.createElement("div", {
    className: "toast cursor-pointer",
    role: "status",
    "aria-live": "polite",
    onClick: onClose
  }, React.createElement("div", {
    className: `glass rounded-xl px-5 py-3 border shadow font-semibold ${style}`,
    "aria-live": "polite"
  }, toast.text)), document.body);
};
const Btn = ({
  className = "",
  ...p
}) => React.createElement("button", _extends({
  type: "button",
  className: `px-3 py-2 rounded-lg font-semibold transition active:scale-[.98] ${className}`
}, p));
const Modal = ({
  open,
  onClose,
  title,
  children
}) => {
  useEffect(() => {
    if (!open) return;
    const esc = e => e.key === "Escape" && onClose();
    document.addEventListener("keydown", esc);
    return () => document.removeEventListener("keydown", esc);
  }, [open, onClose]);
  const dlgRef = useRef(null);
  useFocusTrap(open, dlgRef);
  if (!open) return null;
  return ReactDOM.createPortal(React.createElement("div", {
    className: "backdrop",
    onClick: e => e.currentTarget === e.target && onClose()
  }, React.createElement("div", {
    ref: dlgRef,
    tabIndex: -1,
    className: "glass-strong w-full max-w-[92vw] sm:max-w-3xl md:max-w-4xl rounded-2xl border border-gray-200 shadow-2xl p-4 sm:p-6 relative",
    role: "dialog",
    "aria-modal": "true",
    "aria-labelledby": "modal-title"
  }, React.createElement("button", {
    type: "button",
    onClick: onClose,
    className: "absolute top-3 left-3",
    "aria-label": "\u0625\u063A\u0644\u0627\u0642"
  }, "\u274C"), title && React.createElement("div", {
    className: "text-lg font-bold mb-2 sm:mb-3",
    id: "modal-title"
  }, title), React.createElement("div", {
    className: "grid gap-3"
  }, children))), document.body);
};
const isFlagEmoji = (s = "") => /^[\uD83C][\uDDE6-\uDDFF][\uD83C][\uDDE6-\uDDFF]$/.test(s);
const FLAG_OVERRIDES = {
  USD: "üá∫üá∏",
  EUR: "üá™üá∫",
  GBP: "üá¨üáß",
  JPY: "üáØüáµ",
  CAD: "üá®üá¶",
  AUD: "üá¶üá∫",
  CHF: "üá®üá≠",
  SAR: "üá∏üá¶",
  AED: "üá¶üá™",
  QAR: "üá∂üá¶",
  TRY: "üáπüá∑",
  EGP: "üá™üá¨",
  INR: "üáÆüá≥",
  CNY: "üá®üá≥"
};
const computeFlag = (code = "") => {
  if (FLAG_OVERRIDES[code]) return FLAG_OVERRIDES[code];
  const cc = (code || "").slice(0, 2).toUpperCase();
  if (cc.length === 2 && cc[0] >= 'A' && cc[0] <= 'Z' && cc[1] >= 'A' && cc[1] <= 'Z') {
    const a = 0x1F1E6 + (cc.charCodeAt(0) - 65);
    const b = 0x1F1E6 + (cc.charCodeAt(1) - 65);
    return String.fromCodePoint(a, b);
  }
  return "üè≥Ô∏è";
};
const normalizeFlags = (list = []) => list.map(r => ({
  ...r,
  flag: isFlagEmoji(r.flag || "") ? r.flag : computeFlag(r.code)
}));
const Flag = ({
  emoji
}) => {
  const ref = useRef(null);
  const online = typeof navigator !== "undefined" ? navigator.onLine : true;
  useEffect(() => {
    if (!ref.current) return;
    let display = "üè≥Ô∏è";
    if (isFlagEmoji(emoji)) display = emoji;
    ref.current.textContent = display;
    if (display !== "üè≥Ô∏è" && online && window.twemoji) {
      try {
        window.twemoji.parse(ref.current, {
          folder: "svg",
          ext: ".svg",
          base: "https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/",
          attributes: () => ({
            loading: "lazy",
            decoding: "async",
            referrerpolicy: "no-referrer"
          })
        });
      } catch (_) {}
    }
  }, [emoji, online]);
  return React.createElement("span", {
    ref: ref,
    className: "flag-slot",
    "aria-hidden": "true"
  }, emoji || "üè≥Ô∏è");
};
const NumIn = ({
  value,
  onChange,
  allowDecimal = false,
  min,
  max,
  className = "",
  ...rest
}) => {
  const formatForDisplay = useCallback(val => {
    if (val === null || val === undefined) return "";
    if (typeof val === 'number') {
      if (val !== 0 && Math.abs(val) < 1) {
        const s = val.toString();
        if (/e[-+]/i.test(s)) {
          const [base, exp] = s.split('e');
          const exponent = parseInt(exp, 10);
          if (exponent < 0) {
            let baseStr = base.replace('.', '');
            const sign = baseStr.startsWith('-') ? '-' : '';
            if (sign) baseStr = baseStr.slice(1);
            const zeros = '0'.repeat(Math.abs(exponent) - 1);
            return sign + '0.' + zeros + baseStr;
          }
        }
      }
    }
    return String(val);
  }, []);
  const [text, setText] = useState(value === 0 || value ? formatForDisplay(value) : "");
  useEffect(() => {
    setText(value === 0 || value ? formatForDisplay(value) : "");
  }, [value, formatForDisplay]);
  const norm = (s, d) => {
    if (s == null) return "";
    let o = String(s).replace(/[\u0660-\u0669]/g, a => "0123456789"[a.charCodeAt(0) - 0x0660]).replace(/[\u06F0-\u06F9]/g, a => "0123456789"[a.charCodeAt(0) - 0x06F0]).replace(/\u066B/g, ".").replace(/\u066C/g, "").replace(/,|\s/g, "");
    o = o.replace(d ? /[^0-9.]/g : /[^0-9]/g, "");
    if (d) {
      const i = o.indexOf(".");
      if (i !== -1) o = o.slice(0, i + 1) + o.slice(i + 1).replace(/\./g, "");
    }
    return o;
  };
  const onCh = e => {
    let raw = e.target.value;
    let v = norm(raw, allowDecimal);
    if (allowDecimal && v === ".") {
      setText("0.");
      return;
    }
    setText(v);
    if (!v) {
      onChange?.(null);
      return;
    }
    let n = allowDecimal ? parseFloat(v) : parseInt(v, 10);
    if (!isNaN(n)) {
      if (min != null && n < min) n = min;
      if (max != null && n > max) n = max;
      onChange?.(n);
    }
  };
  const onBl = () => {
    if (text === "" || text === ".") {
      setText("");
      onChange?.(null);
      return;
    }
    let v = norm(text, allowDecimal);
    let n = allowDecimal ? parseFloat(v) : parseInt(v, 10);
    if (!isFinite(n)) {
      setText("");
      onChange?.(null);
      return;
    }
    if (min != null && n < min) n = min;
    if (max != null && n > max) n = max;
    onChange?.(n);
    setText(formatForDisplay(n));
  };
  return React.createElement("input", _extends({
    lang: "en",
    type: "text",
    inputMode: allowDecimal ? "decimal" : "numeric",
    pattern: allowDecimal ? "[0-9.]*" : "[0-9]*",
    className: `table-numbers text-center ${className}`,
    value: text,
    onChange: onCh,
    onBlur: onBl
  }, rest));
};
const Arrow = ({
  dir = "flat"
}) => {
  const c = dir === "up" ? "text-green-600" : dir === "down" ? "text-red-600" : "text-blue-600";
  const d = dir === "up" ? "M12 4l6 8H6l6-8z" : dir === "down" ? "M12 20l-6-8h12l-6 8z" : "M5 12h14v2H5z";
  return React.createElement("svg", {
    className: `${c} w-4 h-4 sm:w-5 sm:h-5`,
    viewBox: "0 0 24 24",
    fill: "currentColor",
    "aria-hidden": "true"
  }, React.createElement("path", {
    d: d
  }));
};
const ChangeBadge = ({
  pct,
  className = ""
}) => {
  const n = +pct,
    pos = n > 0,
    neg = n < 0,
    dir = pos ? "up" : neg ? "down" : "flat";
  const badge = pos ? "text-green-700 bg-green-100" : neg ? "text-red-700 bg-red-100" : "text-blue-700 bg-blue-100";
  return React.createElement("span", {
    className: `table-numbers inline-flex items-center gap-1.5 px-2 sm:px-3 py-1.5 rounded-xl font-bold shadow ${badge} ${className}`
  }, React.createElement(Arrow, {
    dir: dir
  }), `${pos ? "+" : neg ? "‚àí" : ""}${Math.abs(n).toFixed(2)}%`);
};
const CurrencyInfo = ({
  row,
  showName = true
}) => {
  const isMobile = typeof window !== "undefined" && window.matchMedia && window.matchMedia("(max-width: 640px)").matches;
  const renderName = showName && !isMobile;
  return React.createElement("div", {
    className: "flex items-center currency-cell-mobile gap-2 sm:gap-3 min-w-0"
  }, React.createElement(Flag, {
    emoji: row.flag
  }), React.createElement("div", {
    className: "flex items-center gap-2 min-w-0 flex-1"
  }, React.createElement("span", {
    className: "font-extrabold text-sm sm:text-base md:text-lg"
  }, row.code), renderName && React.createElement("div", {
    className: "name-box"
  }, React.createElement("span", {
    className: "name-track currency-name"
  }, row.name)), row.icon && React.createElement("span", {
    className: "icon-pill-after hidden sm:inline px-2 py-0.5 rounded bg-gray-300 text-gray-800 text-[10px] sm:text-xs align-middle"
  }, row.icon)));
};
const PricePill = ({
  value,
  type = "buy",
  className = ""
}) => {
  const g = type === "buy" ? "from-green-500 to-green-700" : "from-red-500 to-red-700";
  return React.createElement("span", {
    className: `table-numbers inline-flex items-center justify-center min-w-[8ch] sm:min-w-[10ch] px-3 sm:px-5 py-1.5 rounded-xl font-black shadow bg-gradient-to-r ${g} text-white text-sm sm:text-lg md:text-xl ${className}`
  }, fmt(value));
};
const calcPrice = (row, usd) => {
  if (row.code === "USD") {
    return {
      buy: usd.buy,
      sell: usd.sell
    };
  }
  const rawBuy = toNum(row.ratioBuy);
  const rawSell = toNum(row.ratioSell);
  const buyRatio = rawBuy > 0 ? rawBuy : 1;
  const sellRatio = rawSell > 0 ? rawSell : 1;
  if (row.method === "divide") {
    return {
      buy: Math.round(usd.buy / buyRatio),
      sell: Math.round(usd.sell / sellRatio)
    };
  }
  return {
    buy: Math.round(usd.buy * buyRatio),
    sell: Math.round(usd.sell * sellRatio)
  };
};
const composeRows = (data, base) => {
  const usd = data.find(d => d.code === "USD") || {
    buy: 5000,
    sell: 5050
  };
  return data.map(r => {
    const {
      buy,
      sell
    } = calcPrice(r, usd);
    const baseEntry = base[r.code];
    let baseSell = 0;
    if (typeof baseEntry === "object" && baseEntry !== null) {
      baseSell = toNum(baseEntry.sell);
    } else if (baseEntry != null) {
      baseSell = toNum(baseEntry);
    }
    let changePct = 0;
    if (baseSell > 0) {
      changePct = (sell - baseSell) / baseSell * 100;
    }
    return {
      ...r,
      buy,
      sell,
      changePct
    };
  });
};
const sanitizeData = list => list.map(r => ({
  ...r,
  ratioBuy: r.ratioBuy > 0 ? r.ratioBuy : 1,
  ratioSell: r.ratioSell > 0 ? r.ratioSell : 1
}));
const CardsView = ({
  rows,
  onEditUSD,
  canEditUSD
}) => {
  const isMobile = typeof window !== "undefined" && window.matchMedia && window.matchMedia("(max-width: 640px)").matches;
  return React.createElement("div", {
    className: "p-1 sm:p-0 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-1 sm:gap-2 md:gap-2"
  }, rows.map(r => React.createElement("div", {
    key: r.code,
    className: `view-card hover:shadow-md transition ${r.code === "USD" && canEditUSD ? "cursor-pointer" : ""}`,
    onClick: () => r.code === "USD" && canEditUSD && onEditUSD(r)
  }, React.createElement(CurrencyInfo, {
    row: r,
    showName: !isMobile
  }), React.createElement("div", {
    className: "mt-2 grid grid-cols-3 items-end card-grid-mobile gap-1",
    dir: "rtl"
  }, React.createElement("div", {
    className: "text-center"
  }, React.createElement("div", {
    className: "card-label"
  }, "\u0634\u0631\u0627\u0621"), React.createElement(PricePill, {
    value: r.buy,
    type: "buy",
    className: "pill-card w-full text-sm"
  })), React.createElement("div", {
    className: "text-center"
  }, React.createElement("div", {
    className: "card-label"
  }, "\u0645\u0628\u064A\u0639"), React.createElement(PricePill, {
    value: r.sell,
    type: "sell",
    className: "pill-card w-full text-sm"
  })), React.createElement("div", {
    className: "text-center"
  }, React.createElement("div", {
    className: "card-label"
  }, "\u0627\u0644\u062A\u063A\u064A\u0651\u0631"), React.createElement(ChangeBadge, {
    pct: r.changePct,
    className: "w-full justify-center text-xs pill-card"
  }))))));
};
const BoardView = ({
  rows,
  head,
  onEditUSD,
  canEditUSD
}) => {
  const isMobile = typeof window !== "undefined" && window.matchMedia && window.matchMedia("(max-width: 640px)").matches;
  return React.createElement("div", {
    className: "w-full"
  }, React.createElement("div", {
    className: `board-head grid grid-cols-[1fr_0.9fr_0.9fr_0.8fr] sm:grid-cols-[1.2fr_1fr_1fr_0.8fr] items-center h-12 sm:h-14 px-3 sm:px-6 ${head}`
  }, React.createElement("div", {
    className: "font-bold text-sm sm:text-xl text-right"
  }, "\uD83C\uDF10 \u0627\u0644\u0639\u0645\u0644\u0629"), React.createElement("div", {
    className: "font-bold text-sm sm:text-xl text-center sm:pl-20"
  }, "\uD83D\uDCB5 \u0634\u0631\u0627\u0621"), React.createElement("div", {
    className: "font-bold text-sm sm:text-xl text-center"
  }, "\uD83D\uDCB0 \u0645\u0628\u064A\u0639"), React.createElement("div", {
    className: "font-bold text-sm sm:text-xl text-center"
  }, "\uD83D\uDCC8 \u0627\u0644\u062A\u063A\u064A\u0651\u0631")), React.createElement("div", {
    className: "divide-y divide-gray-200"
  }, rows.map(r => React.createElement("div", {
    key: r.code,
    className: `board-row grid grid-cols-[1fr_0.9fr_0.9fr_0.8fr] sm:grid-cols-[1.2fr_1fr_1fr_0.8fr] items-center gap-2 px-2 sm:px-4 py-2.5 sm:py-1.5 ${r.code === "USD" && canEditUSD ? "cursor-pointer" : ""}`,
    onClick: () => r.code === "USD" && canEditUSD && onEditUSD(r)
  }, React.createElement("div", {
    className: "flex items-center gap-2 sm:gap-3"
  }, React.createElement(CurrencyInfo, {
    row: r,
    showName: !isMobile
  })), React.createElement("div", {
    className: "flex justify-center sm:pl-20"
  }, React.createElement(PricePill, {
    value: r.buy,
    type: "buy",
    className: "pill-buy"
  })), React.createElement("div", {
    className: "flex justify-center"
  }, React.createElement(PricePill, {
    value: r.sell,
    type: "sell",
    className: "pill-sell"
  })), React.createElement("div", {
    className: "flex justify-center"
  }, React.createElement(ChangeBadge, {
    pct: r.changePct,
    className: "cell-change-mobile change-pill"
  }))))));
};
const MobilePickList = ({
  rows,
  action = "edit",
  onChoose
}) => {
  const label = action === "delete" ? "ÿ≠ÿ∞ŸÅ" : "ÿ™ÿ≠ÿ±Ÿäÿ±";
  const labelCls = action === "delete" ? "text-red-600" : "text-slate-500";
  return React.createElement("div", {
    className: "grid gap-2 pick-list"
  }, rows.map(r => React.createElement("button", {
    key: r.code,
    type: "button",
    onClick: () => onChoose(r),
    className: "w-full text-right rounded-2xl border border-white/50 bg-white/30 hover:bg-white/50 backdrop-blur-md shadow-inner px-3 py-3 transition"
  }, React.createElement("div", {
    className: "flex items-center justify-between gap-3"
  }, React.createElement("span", {
    className: `text-sm font-semibold ${labelCls}`
  }, label), React.createElement("div", {
    className: "flex items-center gap-2"
  }, React.createElement("span", {
    className: "flex items-center gap-2"
  }, React.createElement("span", {
    className: "font-extrabold text-slate-700"
  }, r.name), React.createElement("span", {
    className: "mx-1"
  }, "\u2014"), React.createElement("span", {
    className: "inline-flex font-black text-slate-900"
  }, r.code)), React.createElement(Flag, {
    emoji: r.flag
  }))))));
};
function DatetimeModal({
  open,
  onClose,
  dt,
  autoTime,
  setDT,
  setAuto,
  setToast
}) {
  const [tmpDt, setTmpDt] = useState({
    ...dt
  });
  const [tmpAuto, setTmpAuto] = useState(autoTime);
  const [isoDate, setIsoDate] = useState(dt.date ? dmyToIso(dt.date) : "");
  useEffect(() => {
    if (open) {
      setTmpDt({
        ...dt
      });
      setTmpAuto(autoTime);
      setIsoDate(dt.date ? dmyToIso(dt.date) : "");
    }
  }, [open, dt, autoTime]);
  const save = () => {
    if (!tmpAuto) {
      if (!isValidTime(tmpDt.time || "")) {
        setToast({
          text: "ÿµŸäÿ∫ÿ© ÿßŸÑŸàŸÇÿ™ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ© (HH:MM)",
          type: "error"
        });
        return;
      }
      if (!isoDate) {
        setToast({
          text: "ÿßÿÆÿ™ÿ± ÿ™ÿßÿ±ŸäÿÆŸãÿß ÿµÿ≠Ÿäÿ≠Ÿãÿß",
          type: "error"
        });
        return;
      }
      const dmy = isoToDmy(isoDate);
      if (!isValidDateDMY(dmy)) {
        setToast({
          text: "ÿµŸäÿ∫ÿ© ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ©",
          type: "error"
        });
        return;
      }
      setDT(v => ({
        ...v,
        time: tmpDt.time,
        date: dmy,
        is12: !!tmpDt.is12
      }));
    } else {
      setDT(v => ({
        ...v,
        is12: !!tmpDt.is12
      }));
    }
    setAuto(!!tmpAuto);
    setToast({
      text: "ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑŸàŸÇÿ™",
      type: "success"
    });
    onClose();
  };
  return React.createElement(Modal, {
    open: open,
    onClose: onClose,
    title: "\u0636\u0628\u0637 \u0627\u0644\u0648\u0642\u062A \u0648\u0627\u0644\u062A\u0627\u0631\u064A\u062E"
  }, React.createElement("div", {
    className: "flex flex-wrap items-center gap-4"
  }, React.createElement("label", {
    className: "inline-flex items-center gap-2"
  }, React.createElement("input", {
    type: "checkbox",
    checked: tmpAuto,
    onChange: e => setTmpAuto(e.target.checked)
  }), React.createElement("span", null, "\u062A\u062D\u062F\u064A\u062B \u062A\u0644\u0642\u0627\u0626\u064A")), React.createElement("label", {
    className: "inline-flex items-center gap-2"
  }, React.createElement("input", {
    type: "checkbox",
    checked: !!tmpDt.is12,
    onChange: e => setTmpDt(v => ({
      ...v,
      is12: e.target.checked
    }))
  }), React.createElement("span", null, "\u062A\u0646\u0633\u064A\u0642 12 \u0633\u0627\u0639\u0629"))), !tmpAuto && React.createElement("div", {
    className: "grid sm:grid-cols-2 gap-3"
  }, React.createElement("label", {
    className: "grid gap-1"
  }, React.createElement("span", {
    className: "text-sm text-gray-600"
  }, "\u0627\u0644\u0648\u0642\u062A"), React.createElement("input", {
    type: "time",
    className: "fld table-numbers",
    value: (tmpDt.time || "").slice(0, 5),
    onChange: e => setTmpDt(v => ({
      ...v,
      time: e.target.value
    }))
  })), React.createElement("label", {
    className: "grid gap-1"
  }, React.createElement("span", {
    className: "text-sm text-gray-600"
  }, "\u0627\u0644\u062A\u0627\u0631\u064A\u062E"), React.createElement("input", {
    type: "date",
    className: "fld table-numbers",
    value: isoDate,
    onChange: e => setIsoDate(e.target.value)
  }))), React.createElement("div", {
    className: "btn-row flex justify-end gap-2 pt-2"
  }, React.createElement(Btn, {
    className: "text-white bg-red-600 w-32 h-11",
    onClick: () => {
      onClose();
      setToast({
        text: "‚ùå ÿ™ŸÖ ÿßŸÑÿ•ŸÑÿ∫ÿßÿ°",
        type: "error"
      });
    }
  }, "\u0625\u0644\u063A\u0627\u0621"), React.createElement(Btn, {
    className: "text-white bg-green-600 w-32 h-11",
    onClick: save
  }, "\u062D\u0641\u0638")));
}
function App() {
  const cachedApp = loadCache();
  const [lastSync, setLastSync] = useState(cachedApp?.lastSync || null);
  const [online, setOnline] = useState(navigator.onLine);
  const prevOnline = useRef(navigator.onLine);
  useEffect(() => {
    if (prevOnline.current === online) {
      return;
    }
    if (prevOnline.current === false && online === true) {
      setToast({
        text: "üîÑ ÿ™ŸÖÿ™ ÿ•ÿπÿßÿØÿ© ÿßŸÑÿßÿ™ÿµÿßŸÑ ‚Äî ÿ¨ÿßÿ±Ÿä ÿßŸÑŸÖÿ≤ÿßŸÖŸÜÿ©",
        type: "info"
      });
    }
    prevOnline.current = online;
  }, [online]);
  useEffect(() => {
    const goOnline = () => {
      setOnline(true);
    };
    const goOffline = () => setOnline(false);
    window.addEventListener("online", goOnline);
    window.addEventListener("offline", goOffline);
    return () => {
      window.removeEventListener("online", goOnline);
      window.removeEventListener("offline", goOffline);
    };
  }, []);
  const [connType, setConnType] = useState(() => {
    try {
      const c = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
      return c && (c.effectiveType || c.type) || "";
    } catch (_) {
      return "";
    }
  });
  const prevConnType = useRef(connType);
  useEffect(() => {
    const c = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
    if (!c) return;
    const updateConn = () => {
      const t = c.effectiveType || c.type || "";
      setConnType(t);
    };
    updateConn();
    try {
      c.addEventListener('change', updateConn);
    } catch (_) {
      c.onchange = updateConn;
    }
    return () => {
      try {
        c.removeEventListener('change', updateConn);
      } catch (_) {
        c.onchange = null;
      }
    };
  }, []);
  useEffect(() => {
    if (prevConnType.current === connType) return;
    const type = connType ? connType.toLowerCase() : "";
    const isCellular = type.includes('cell') || /(2g|3g|4g|5g)/.test(type);
    if (isCellular) {
      
    }
    prevConnType.current = connType;
  }, [connType]);
  useEffect(() => {
    try {
      const stored = StorageManager.load();
      if (!stored) {
        StorageManager.save({
          version: APP_VERSION
        });
      } else if (stored.version !== APP_VERSION) {
        StorageManager.save({
          version: APP_VERSION
        });
        setToast({
          text: "‚ÑπÔ∏è ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ¨ÿØŸäÿØÿ©...",
          type: "info"
        });
        const unsub = window.$db?.onValue(window.$db.ref('taif/data'), snap => {
          if (snap.val()) {
            setToast({
              text: "‚úÖ ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™",
              type: "success"
            });
            if (unsub) window.$db.off(window.$db.ref('taif/data'));
          }
        });
      }
    } catch (e) {
      console.error("Version check error", e);
    }
  }, []);
  const p = readJSON(K.DATA, null),
    pBanner = readJSON(K.BANNER, null),
    pDT = readJSON(K.DT, null);
  const initStored = StorageManager.load() || {};
  const [logo, setLogo] = useState(cachedApp?.logo || "");
  const [title, setTitle] = useState(cachedApp?.title || "ŸÑŸàÿ≠ÿ© ÿ£ÿ≥ÿπÿßÿ± ÿµÿ±ŸÅ ÿßŸÑÿπŸÖŸÑÿßÿ™");
  const [bannerImg, setBannerImg] = useState(cachedApp?.bannerImg || "");
  let pTheme;
  try {
    pTheme = localStorage.getItem(K.THEME);
  } catch (_) {
    pTheme = null;
  }
  const [theme, setTheme] = useState(pTheme || "");
  useEffect(() => {
    const body = document.getElementById("body");
    const t = THEME_MAP[theme];
    const cls = theme && THEME_WHITELIST.has(theme) ? theme : "bg-gradient-to-tr from-cyan-200 via-white to-cyan-200 text-gray-900";
    const idClass = t ? `th-${t.id}` : "th-default";
    body.className = `min-h-screen transition-colors duration-500 ${cls} ${idClass}`;
    try {
      const bg = document.getElementById("bgfix");
      if (bg) {
        bg.className = `bg-fixed-gradient bg-gradient-to-tr ${bannerCls(theme)}`;
      }
    } catch (_) {}
    ;
  }, [theme]);
  useEffect(() => {
    try {
      localStorage.setItem(K.THEME, theme);
    } catch (_) {}
  }, [theme]);
  const cached = readJSON(K.DATA, null);
  const cachedData = initStored && initStored.data || cached && cached.data || null;
  const [data, setData] = useState(cachedApp?.data || []);
  const defB = {
    texts: ["üì¢ ÿ£ŸáŸÑÿßŸã ÿ®ŸÉŸÖ", "üíµ ÿ£ÿ≥ÿπÿßÿ±ŸÜÿß ÿ™ŸÜÿßŸÅÿ≥Ÿäÿ© ŸäŸàŸÖŸäŸãÿß", "üåê ÿ™ŸàÿßÿµŸÑ ŸÖÿπŸÜÿß"],
    color: "#000000",
    moveDur: 1.5,
    stayDur: 3
  };
  const initB = {
    ...defB,
    ...(pBanner || {})
  };
  const [banner, setBanner] = useState(cachedApp?.banner || defB);
  const [bTmp, setBTmp] = useState({
    ...banner
  });
  useEffect(() => {
    saveJSON(K.BANNER, banner);
  }, [banner]);
  const [dt, setDT] = useState(cachedApp?.datetime || {
    date: "",
    time: "",
    is12: false
  });
  const [autoTime, setAuto] = useState(true);
  useEffect(() => {
    saveJSON(K.DT, dt);
  }, [dt]);
  const [currentUser, setCurrentUser] = useState(() => {
    try {
      const s = localStorage.getItem('taif:session');
      if (s) {
        const sess = JSON.parse(s);
        if (sess) {
          return sess;
        }
      }
    } catch (_) {}
    return null;
  });
  const [loginUser, setLoginUser] = useState('');

  // üïì Session keep-alive: refresh lock every 10 minutes
  React.useEffect(() => {
    if (!currentUser) return;
    const me = currentUser.username;
    const deviceId = localStorage.getItem('taif:device_id');
    const token = localStorage.getItem('taif:session_token');
    const refresh = async () => {
      try {
        await window.$db.set(window.$db.ref(`taif/session/${me}`), {
          deviceId,
          token,
          ua: navigator.userAgent,
          lockedAt: Date.now(),
          lastSeen: Date.now()
        });
        console.info('üîÅ Session refreshed for', me);
      } catch (err) {
        console.warn('‚ö†Ô∏è Failed to refresh session:', err);
      }
    };
    refresh(); // immediately on load
    const interval = setInterval(refresh, 1000 * 60 * 10); // every 10 min
    return () => clearInterval(interval);
  }, [currentUser]);

  const [loginPass, setLoginPass] = useState('');
  const [loginErr, setLoginErr] = useState('');
  const [loginModalOpen, setLoginModalOpen] = useState(false);
  const [adminModalOpen, setAdminModalOpen] = useState(false);
  const [addingUser, setAddingUser] = useState(false);
  const [usersList, setUsersList] = useState({});
  const [editUserName, setEditUserName] = useState(null);
  const [logsModalOpen, setLogsModalOpen] = useState(false);
  const [logsList, setLogsList] = useState([]);
  const openLogs = () => {
    const fb = dbRef.current;
    if (!fb) {
      setToast({
        text: '‚ö†Ô∏è ŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑŸàÿµŸàŸÑ ŸÑŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™',
        type: 'error'
      });
      return;
    }
    const r = window.$db.ref('taif/adminactionslog');
    const unsub = window.$db.onValue(r, snap => {
      const obj = snap.val() || {};
      const list = Object.values(obj).sort((a, b) => {
        const atA = a && a.at ? a.at : 0;
        const atB = b && b.at ? b.at : 0;
        return atB - atA;
      });
      setLogsList(list);
      setLogsModalOpen(true);
      if (unsub) window.$db.off(r);
    });
  };
  const clearLogs = () => {
    if (!window.confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ŸÖÿ≥ÿ≠ ÿ≥ÿ¨ŸÑ ÿßŸÑÿ•ÿØÿßÿ±ÿ© ÿ®ÿßŸÑŸÉÿßŸÖŸÑÿü')) return;
    const fb = dbRef.current;
    if (!fb) {
      setToast({
        text: '‚ö†Ô∏è ŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑŸàÿµŸàŸÑ ŸÑŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™',
        type: 'error'
      });
      return;
    }
    try {
      window.$db.set(window.$db.ref('taif/adminactionslog'), null);
      setLogsList([]);
      setToast({
        text: '‚úÖ ÿ™ŸÖ ŸÖÿ≥ÿ≠ ÿßŸÑÿ≥ÿ¨ŸÑ ÿ®ŸÜÿ¨ÿßÿ≠',
        type: 'success'
      });
    } catch (_) {
      setToast({
        text: '‚ö†Ô∏è ÿ™ÿπÿ∞ÿ± ŸÖÿ≥ÿ≠ ÿßŸÑÿ≥ÿ¨ŸÑ',
        type: 'error'
      });
    }
  };
  const PERMISSIONS = [{
    key: 'editUSD',
    label: 'üíµ ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿØŸàŸÑÿßÿ±'
  }, {
    key: 'bulkEdit',
    label: 'üõ†Ô∏è ÿ™ÿπÿØŸäŸÑ ŸÉŸÑ ÿßŸÑÿπŸÖŸÑÿßÿ™'
  }, {
    key: 'addCurrency',
    label: '‚ûï ÿ•ÿ∂ÿßŸÅÿ© ÿπŸÖŸÑÿ©'
  }, {
    key: 'editCurrency',
    label: '‚úèÔ∏è ÿ™ÿπÿØŸäŸÑ ÿπŸÖŸÑÿ©'
  }, {
    key: 'deleteCurrency',
    label: 'üóëÔ∏è ÿ≠ÿ∞ŸÅ ÿπŸÖŸÑÿ©'
  }, {
    key: 'editBanner',
    label: '‚ö° ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™'
  }, {
    key: 'changeView',
    label: 'üéõÔ∏è ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿπÿ±ÿ∂'
  }, {
    key: 'changeTheme',
    label: 'üé® ÿßŸÑÿ´ŸäŸÖ'
  }, {
    key: 'editLogo',
    label: 'üñºÔ∏è ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÑŸàÿ∫Ÿà/ÿßŸÑÿπŸÜŸàÿßŸÜ'
  }, {
    key: 'adjustDatetime',
    label: 'üïí ÿ∂ÿ®ÿ∑ ÿßŸÑŸàŸÇÿ™'
  }, {
    key: 'manageUsers',
    label: 'üë§ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ'
  }, {
    key: 'viewAdminLogs',
    label: 'üìú ÿ≥ÿ¨ŸÑÿßÿ™ ÿßŸÑÿ•ÿØÿßÿ±ÿ©'
  }, {
    key: 'logout',
    label: 'üö™ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿÆÿ±Ÿàÿ¨'
  }];
  const permLabelMap = PERMISSIONS.reduce((acc, p) => {
    acc[p.key] = p.label;
    return acc;
  }, {});
  const [userForm, setUserForm] = useState({
    username: '',
    password: '',
    name: '',
    role: '',
    perms: {}
  });
  const [adminErr, setAdminErr] = useState('');
  const handleLogin = async e => {
    if (e) e.preventDefault();
    setLoginErr('');
    if (!loginUser || !loginPass) {
      setLoginErr('‚ö†Ô∏è ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ•ÿØÿÆÿßŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸàŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±');
      return;
    }
    try {
      if (!window.$db) {
        setLoginErr('‚è≥ Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±ÿå ÿ¨ÿßÿ±Ÿä ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™...');
        return;
      }
      const fb = dbRef.current;
      if (!fb) {
        setLoginErr('‚ö†Ô∏è ŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑŸàÿµŸàŸÑ ŸÑŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™');
        return;
      }
      const uRef = window.$db.ref('taif/users');
      const unsub = window.$db.onValue(uRef, snap => {
        const users = snap.val() || {};
        const obj = users[loginUser];
        if (unsub) window.$db.off(uRef);
        if (!obj) {
          setLoginErr('‚ö†Ô∏è ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ');
          try {
            window.Log && window.Log.loginFail && window.Log.loginFail(loginUser);
          } catch (_) {}
          return;
        }
        const hash = obj.password || obj.passwordHash || '';
        try {
          const bcryptObj = window.bcrypt || window.dcodeIO && window.dcodeIO.bcrypt;
          if (!bcryptObj) {
            setLoginErr('‚ö†Ô∏è ÿ™ÿπÿ∞ÿ± ÿ™ÿ≠ŸÖŸäŸÑ ŸÖŸÉÿ™ÿ®ÿ© ÿßŸÑÿ™ÿ≠ŸÇŸÇ');
            return;
          }
          bcryptObj.compare(loginPass, hash, function (err, same) {
            if (err || !same) {
              setLoginErr('‚ö†Ô∏è ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ©');
              try {
                window.Log && window.Log.loginFail && window.Log.loginFail(loginUser);
              } catch (_) {}
              return;
            }
            let perms = [];
            if (Array.isArray(obj.permissions)) perms = obj.permissions;else if (obj.permissions && typeof obj.permissions === 'object') {
              perms = Object.keys(obj.permissions).filter(k => obj.permissions[k]);
            }
            const deviceId = ensureDeviceId();
            const lockKey = `taif/session/${loginUser}`;
            const lockRef = window.$db.ref(lockKey);
            const once = window.$db.onValue(lockRef, async snap2 => {
              if (once) window.$db.off(lockRef);
              const lock = snap2 && snap2.val ? snap2.val() : null;
              if (lock && lock.deviceId && lock.deviceId !== deviceId) {
                setLoginErr('‚õî Ÿáÿ∞ÿß ÿßŸÑÿ≠ÿ≥ÿßÿ® ŸÖŸÇŸÅŸàŸÑ ÿπŸÑŸâ ÿ¨Ÿáÿßÿ≤ ÿ¢ÿÆÿ±. ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨ ŸÖŸÜ ÿßŸÑÿ¨Ÿáÿßÿ≤ ÿßŸÑÿ£ŸàŸÑ ÿ£ŸàŸÑÿßŸã.');
                try {
                  window.Log && window.Log.loginFail && window.Log.loginFail(loginUser);
                } catch (_) {}
                return;
              }
              const token = crypto.randomUUID && crypto.randomUUID() || Date.now() + '_' + Math.random().toString(36).slice(2);
              try {
                localStorage.setItem('taif:session_token', token);
              } catch (_) {}
              await window.$db.set(lockRef, {
                deviceId,
                token,
                ua: navigator.userAgent,
                lockedAt: Date.now(),
                lastSeen: Date.now()
              });
              const sess = {
                username: loginUser,
                role: obj.role || '',
                permissions: perms
              };
              try {
                localStorage.setItem('taif:session', JSON.stringify(sess));
              } catch (_) {}
              setCurrentUser(sess);
              setLoginModalOpen(false);
              setLoginUser('');
              setLoginPass('');
              setLoginErr('');
              setToast({
                text: '‚úÖ ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ®ŸÜÿ¨ÿßÿ≠',
                type: 'success'
              });
              try {
                window.Log && window.Log.loginSuccess && window.Log.loginSuccess(loginUser);
              } catch (_) {}
            });
          });
        } catch (err) {
          console.error(err);
          setLoginErr('‚ö†Ô∏è ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±');
        }
      });
    } catch (err) {
      console.error(err);
      setLoginErr('‚ö†Ô∏è ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ');
      try {
        window.Log && window.Log.loginFail && window.Log.loginFail(loginUser);
      } catch (_) {}
    }
  };
  const handleLogout = async () => {
    try {
      const me = currentUser && currentUser.username;
      if (me) {
        await window.$db.set(window.$db.ref(`taif/session/${me}`), null);
      }
      try {
        localStorage.removeItem('taif:session_token');
      } catch (_) {}
    } catch (_) {}
    try {
      localStorage.removeItem('taif:session');
    } catch (_) {}
    setCurrentUser(null);
    setLoginModalOpen(true);
    try {
      window.Log && window.Log.logout && window.Log.logout(currentUser && currentUser.username || '');
    } catch (_) {}
  };
  const hasPermission = useCallback(perm => {
    if (!currentUser) return false;
    if (currentUser.role === 'superadmin' || currentUser.role === 'emergency') return true;
    return Array.isArray(currentUser.permissions) && currentUser.permissions.includes(perm);
  }, [currentUser]);
  useEffect(() => {
    if (!currentUser) return;
    const r = window.$db.ref('taif/users');
    const unsub = window.$db.onValue(r, snap => {
      try {
        const users = snap.val() || {};
        const me = users[currentUser.username];
        if (!me) {
          setToast({
            text: "üö™ ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿ≠ÿ≥ÿßÿ®ŸÉ ‚Äî ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨",
            type: "error"
          });
          handleLogout();
          return;
        }
        if (me.banned) {
          setToast({
            text: "‚õî ÿ≠ÿ≥ÿßÿ®ŸÉ ŸÖŸàŸÇŸëŸÅ ‚Äî ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨",
            type: "error"
          });
          handleLogout();
          return;
        }
        const newRole = me.role || '';
        const newPerms = toPermArray(me.permissions);
        const oldPerms = Array.isArray(currentUser.permissions) ? currentUser.permissions : [];
        const roleChanged = (currentUser.role || '') !== newRole;
        const permsChanged = !arrEq(oldPerms, newPerms);
        if (roleChanged || permsChanged) {
          const updated = {
            ...currentUser,
            role: newRole,
            permissions: newPerms
          };
          setCurrentUser(updated);
          try {
            localStorage.setItem('taif:session', JSON.stringify(updated));
          } catch (_) {}
          setToast({
            text: "üîÑ ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿµŸÑÿßÿ≠Ÿäÿßÿ™ŸÉ ŸÑÿ≠ÿ∏ŸäŸãÿß",
            type: "info"
          });
        }
      } catch (_) {}
    });
    return () => {
      if (unsub) window.$db.off(r);
    };
  }, [currentUser?.username]);
  useEffect(() => {
    if (!adminModalOpen) return;
    const fb = dbRef.current;
    if (!fb) return;
    const r = window.$db.ref('taif/users');
    const unsub = window.$db.onValue(r, snap => {
      const obj = snap.val() || {};
      setUsersList(obj);
    });
    return () => {
      if (unsub) window.$db.off(r);
    };
  }, [adminModalOpen]);
  const handleSaveUser = async () => {
    setAdminErr('');
    const {
      username,
      password,
      name,
      role,
      perms
    } = userForm;
    if (!username || !editUserName && !password) {
      setAdminErr('‚ö†Ô∏è Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©');
      return;
    }
    try {
      const fb = dbRef.current;
      if (!fb) {
        setAdminErr('‚ö†Ô∏è ŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑŸàÿµŸàŸÑ ŸÑŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™');
        return;
      }
      const bcryptObj = window.bcrypt || window.dcodeIO && window.dcodeIO.bcrypt;
      if (!bcryptObj) {
        setAdminErr('‚ö†Ô∏è ÿ™ÿπÿ∞ÿ± ÿ™ÿ≠ŸÖŸäŸÑ ŸÖŸÉÿ™ÿ®ÿ© ÿßŸÑÿ™ÿ¥ŸÅŸäÿ±');
        return;
      }
      const oldUser = editUserName ? usersList[editUserName] : null;
      if (!editUserName && currentUser && currentUser.role === 'admin') {
        setAdminErr('‚ö†Ô∏è ŸÑŸäÿ≥ ŸÑÿØŸäŸÉ ÿµŸÑÿßÿ≠Ÿäÿ© ŸÑÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ¨ÿØŸäÿØ');
        return;
      }
      if (editUserName) {
        if (currentUser) {
          if (currentUser.role === 'admin' && editUserName !== currentUser.username) {
            setAdminErr('‚ö†Ô∏è ŸÑŸäÿ≥ ŸÑÿØŸäŸÉ ÿµŸÑÿßÿ≠Ÿäÿ© ŸÑÿ™ÿπÿØŸäŸÑ Ÿáÿ∞ÿß ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ');
            return;
          }
          if (currentUser.role === 'superadmin') {
            if (oldUser && (oldUser.role === 'superadmin' || oldUser.role === 'emergency')) {
              setAdminErr('‚ö†Ô∏è ŸÑÿß ŸäŸÖŸÉŸÜ ÿ™ÿπÿØŸäŸÑ Ÿáÿ∞ÿß ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ®Ÿáÿ∞Ÿá ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿßÿ™');
              return;
            }
          }
        }
      }
      if (oldUser && oldUser.role === 'emergency' && (!currentUser || currentUser.role !== 'emergency')) {
        setAdminErr('‚ö†Ô∏è ŸÑÿß ŸäŸÖŸÉŸÜ ÿ™ÿπÿØŸäŸÑ ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶ ÿ•ŸÑÿß ÿ®Ÿàÿßÿ≥ÿ∑ÿ© ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶');
        return;
      }
      if (!editUserName && role === 'emergency' && (!currentUser || currentUser.role !== 'emergency')) {
        setAdminErr('‚ö†Ô∏è ŸÑÿß ŸäŸÖŸÉŸÜ ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶ ÿ•ŸÑÿß ÿ®Ÿàÿßÿ≥ÿ∑ÿ© ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶');
        return;
      }
      if (editUserName && role === 'emergency' && (!currentUser || currentUser.role !== 'emergency')) {
        setAdminErr('‚ö†Ô∏è ŸÑÿß ŸäŸÖŸÉŸÜ ÿ™ÿ∫ŸäŸäÿ± ÿØŸàÿ± ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ•ŸÑŸâ ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶ ÿ•ŸÑÿß ÿ®Ÿàÿßÿ≥ÿ∑ÿ© ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶');
        return;
      }
      const hashExisting = oldUser ? oldUser.password : null;
      const getHashed = (plain, callback) => {
        if (!plain) {
          callback(null, hashExisting);
          return;
        }
        bcryptObj.hash(plain, 10, function (err, hash) {
          callback(err, hash);
        });
      };
      getHashed(password, (err, hash) => {
        if (err) {
          setAdminErr('‚ö†Ô∏è ÿ™ÿπÿ∞ÿ± ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ®ÿµŸÖÿ©');
          return;
        }
        let newRole = role;
        if (!newRole) {
          newRole = editUserName && oldUser && oldUser.role ? oldUser.role : 'admin';
        }
        let permsArray = [];
        if (perms && typeof perms === 'object') {
          permsArray = Object.keys(perms).filter(k => perms[k]);
        }
        if (editUserName && currentUser && currentUser.role === 'admin' && editUserName === currentUser.username) {
          if (oldUser) {
            newRole = oldUser.role;
            if (Array.isArray(oldUser.permissions)) {
              permsArray = oldUser.permissions;
            } else if (oldUser.permissions && typeof oldUser.permissions === 'object') {
              permsArray = Object.keys(oldUser.permissions).filter(k => oldUser.permissions[k]);
            }
          }
        }
        const newUserData = {
          role: newRole,
          permissions: permsArray,
          password: hash,
          name: name || ''
        };
        const key = editUserName || username;
        window.$db.set(window.$db.ref(`taif/users/${key}`), newUserData);
        try {
          const log = {
            actor: currentUser ? currentUser.username : 'unknown',
            action: editUserName ? 'updateUser' : 'addUser',
            target: key
          };
          window.$db.set(window.$db.ref(`taif/adminactionslog/${Date.now()}_${Math.random().toString(36).slice(2)}`), log);
        } catch (_) {}
        setAdminModalOpen(false);
        setEditUserName(null);
        setAddingUser(false);
        setUserForm({
          username: '',
          password: '',
          name: '',
          role: '',
          perms: {}
        });
        setAdminErr('');
      });
    } catch (err) {
      console.error(err);
      setAdminErr('‚ö†Ô∏è ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿßŸÑÿ≠ŸÅÿ∏');
    }
  };
  const handleEditUser = uname => {
    const u = usersList[uname];
    if (!u) return;
    let allowedEdit = false;
    const role = currentUser ? currentUser.role : '';
    if (role === 'emergency') {
      allowedEdit = true;
    } else if (role === 'superadmin') {
      if (u.role !== 'superadmin' && u.role !== 'emergency') allowedEdit = true;
    } else if (role === 'admin') {
      if (uname === currentUser.username) allowedEdit = true;
    }
    if (!allowedEdit) {
      setToast({
        text: '‚ö†Ô∏è ŸÑÿß ÿ™ŸÖŸÑŸÉ ÿµŸÑÿßÿ≠Ÿäÿ© ŸÑÿ™ÿπÿØŸäŸÑ Ÿáÿ∞ÿß ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ',
        type: 'error'
      });
      return;
    }
    setEditUserName(uname);
    const permsObj = {};
    if (Array.isArray(u.permissions)) {
      u.permissions.forEach(p => {
        permsObj[p] = true;
      });
    } else if (u.permissions && typeof u.permissions === 'object') {
      Object.keys(u.permissions).forEach(p => {
        if (u.permissions[p]) permsObj[p] = true;
      });
    }
    setUserForm({
      username: uname,
      password: '',
      name: u.name || '',
      role: u.role || '',
      perms: permsObj
    });
    setAdminModalOpen(true);
  };
  const handleDeleteUser = uname => {
    const targetUser = usersList[uname];
    if (!targetUser) return;
    const myRole = currentUser ? currentUser.role : '';
    const targetRole = targetUser.role || '';
    let allowedDelete = false;
    if (myRole === 'emergency') {
      allowedDelete = true;
    } else if (myRole === 'superadmin') {
      if (targetRole !== 'superadmin' && targetRole !== 'emergency') {
        allowedDelete = true;
      }
    } else {
      allowedDelete = false;
    }
    if (!allowedDelete) {
      setToast({
        text: '‚ö†Ô∏è ŸÑÿß ÿ™ŸÖŸÑŸÉ ÿµŸÑÿßÿ≠Ÿäÿ© ÿ≠ÿ∞ŸÅ Ÿáÿ∞ÿß ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ',
        type: 'error'
      });
      return;
    }
    if (!window.confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖÿü')) return;
    try {
      const fb = dbRef.current;
      if (!fb) return;
      window.$db.set(window.$db.ref(`taif/users/${uname}`), null);
      try {
        const log = {
          actor: currentUser ? currentUser.username : 'unknown',
          action: 'deleteUser',
          target: uname
        };
        window.$db.set(window.$db.ref(`taif/adminactionslog/${Date.now()}_${Math.random().toString(36).slice(2)}`), log);
      } catch (_) {}
    } catch (err) {
      console.error(err);
    }
  };
  const openAddUser = () => {
    setEditUserName(null);
    setAddingUser(true);
    setUserForm({
      username: '',
      password: '',
      name: '',
      role: '',
      perms: {}
    });
    setAdminModalOpen(true);
  };
  const nowStr = useCallback(() => {
    const d = new Date(),
      mm = two(d.getMinutes()),
      hh24 = two(d.getHours()),
      h12 = d.getHours() % 12 || 12,
      amp = d.getHours() >= 12 ? "PM" : "AM";
    const t = dt.is12 ? `${h12}:${mm} ${amp}` : `${hh24}:${mm}`;
    const dd = `${two(d.getDate())}-${two(d.getMonth() + 1)}-${d.getFullYear()}`;
    return {
      time: autoTime || !dt.time ? t : dt.time,
      date: dt.date || dd
    };
  }, [dt, autoTime]);
  const [clock, setClock] = useState(nowStr());
  useEffect(() => {
    const id = setInterval(() => setClock(nowStr()), 1000);
    return () => clearInterval(id);
  }, [nowStr]);
  const today = () => {
    const d = new Date();
    return `${d.getFullYear()}-${two(d.getMonth() + 1)}-${two(d.getDate())}`;
  };
  const [base, setBase] = useState(cachedApp?.base || {});
  const [baseDate, setBaseDate] = useState(cachedApp?.baseDate || "");
  const baseRef = useRef(base);
  useEffect(() => {
    baseRef.current = base;
  }, [base]);
  const baseDateRef = useRef(baseDate);
  useEffect(() => {
    baseDateRef.current = baseDate;
  }, [baseDate]);
  const dataRef = useRef(data);
  useEffect(() => {
    dataRef.current = data;
  }, [data]);
  const hasRemoteBase = useRef(false);
  useEffect(() => {
    try {
      if (!base || Object.keys(base).length === 0) {
        const b = {};
        const tmpRows = composeRows(data, {});
        tmpRows.forEach(r => {
          b[r.code] = r.sell;
        });
        const todayStr = today();
        setBase(b);
        setBaseDate(todayStr);
        saveSnapshot({
          base: b,
          baseDate: todayStr
        });
        _synced.current.base = true;
      }
    } catch (_err) {}
  }, [data]);
  useEffect(() => {
    let timer;
    const schedule = () => {
      const now = new Date();
      const mid = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1, 0, 0, 0).getTime();
      const t = Math.max(0, mid - Date.now());
      timer = setTimeout(() => {
        const b = {};
        try {
          const tmpRows = composeRows(dataRef.current, {});
          tmpRows.forEach(r => {
            b[r.code] = r.sell;
          });
        } catch (_) {}
        setBase(b);
        const d = today();
        setBaseDate(d);
        saveSnapshot({
          base: b,
          baseDate: d
        });
        _synced.current.base = true;
        schedule();
      }, t);
    };
    schedule();
    return () => clearTimeout(timer);
  }, []);
  const rows = useMemo(() => composeRows(data, base), [data, base]);
  const lastGoodRowsRef = useRef([]);
  useEffect(() => {
    if (rows && rows.length) lastGoodRowsRef.current = rows;
  }, [rows]);
  const rowsDisplay = useMemo(() => {
    return online ? rows : lastGoodRowsRef.current.length ? lastGoodRowsRef.current : rows;
  }, [rows, online]);
  const contRef = useRef(null),
    itemRef = useRef(null);
  const [ad, setAd] = useState({
    i: 0,
    snap: true,
    x: 0
  });
  const timer = useRef(null);
  const clearT = () => {
    if (timer.current) {
      clearTimeout(timer.current);
      timer.current = null;
    }
  };
  const centerShift = () => {
    try {
      const cw = contRef.current?.clientWidth || 0,
        W = document.body?.clientWidth || window.innerWidth || 0;
      return Math.max(0, (W - cw) / 2);
    } catch (_) {
      return 0;
    }
  };
  const measure = w => {
    const cw = contRef.current?.clientWidth || 0,
      iw = itemRef.current?.clientWidth || 0,
      p = 8;
    return !cw || !iw ? 0 : w === 'right' ? cw / 2 + iw / 2 + p : w === 'left' ? -(cw / 2 + iw / 2) - p : 0;
  };
  const startAd = useCallback(() => {
    if (!banner.texts.length) return;
    clearT();
    setAd(v => ({
      ...v,
      snap: true,
      x: measure('right')
    }));
    requestAnimationFrame(() => requestAnimationFrame(() => {
      setAd(v => ({
        ...v,
        snap: false,
        x: centerShift()
      }));
      timer.current = setTimeout(() => {
        timer.current = setTimeout(() => {
          setAd(v => ({
            ...v,
            x: measure('left')
          }));
          timer.current = setTimeout(() => {
            setAd(v => ({
              i: (v.i + 1) % banner.texts.length,
              snap: true,
              x: centerShift()
            }));
            startAd();
          }, banner.moveDur * 1000);
        }, banner.stayDur * 1000);
      }, banner.moveDur * 1000);
    }));
  }, [banner.texts, banner.moveDur, banner.stayDur]);
  useEffect(() => {
    startAd();
    return () => clearT();
  }, [startAd]);
  const [menu, setMenu] = useState(false),
    gearRef = useRef(null);
  useEffect(() => {
    if (!menu) return;
    const onKey = e => {
      if (e.key === 'Escape') setMenu(false);
    };
    document.addEventListener('keydown', onKey);
    return () => document.removeEventListener('keydown', onKey);
  }, [menu]);
  const [modal, setModal] = useState(null),
    [toast, setToast] = useState(null);
  useEffect(() => {
    if (!online) {
      try {
        setMenu(false);
      } catch (_) {}
      try {
        setModal(null);
      } catch (_) {}
    }
  }, [online]);
  const [editIdx, setEditIdx] = useState(null);
  const usd = data.find(d => d.code === "USD") || {
    buy: 5000,
    sell: 5050
  };
  const [usdTmp, setUsdTmp] = useState({
    buy: usd.buy,
    sell: usd.sell
  });
  const onEditUSD = row => {
    if (!online) {
      setToast({
        text: "‚ö†Ô∏è ÿ∫Ÿäÿ± ŸÖÿ™ÿµŸÑ ‚Äî ÿßŸÑÿ™ÿπÿØŸäŸÑ ŸÖÿ™ÿßÿ≠ ŸÅŸÇÿ∑ ÿπŸÜÿØ ÿßŸÑÿßÿ™ÿµÿßŸÑ",
        type: "error"
      });
      return;
    }
    setUsdTmp({
      buy: row.buy,
      sell: row.sell
    });
    setModal("usd");
  };
  let pView;
  try {
    pView = localStorage.getItem(K.VIEW);
  } catch (_) {
    pView = null;
  }
  const [view, setView] = useState(pView || "cards");
  const [vTmp, setVTmp] = useState(view);
  useEffect(() => {
    try {
      localStorage.setItem(K.VIEW, view);
    } catch (_) {}
  }, [view]);
  const [tTmp, setTTmp] = useState(theme);
  useEffect(() => {
    if (modal === "themes") setTTmp(theme);
  }, [modal, theme]);
  const [bulk, setBulk] = useState([]),
    [q, setQ] = useState("");
  const openBulk = () => {
    setBulk(data.map(d => ({
      ...d
    })));
    setQ("");
    setModal("bulk");
  };
  const [logoTmp, setLogoTmp] = useState(logo);
  const [titleTmp, setTitleTmp] = useState(title);
  const [bannerImgTmp, setBannerImgTmp] = useState(bannerImg);
  useEffect(() => {
    if (modal === "logo") {
      setLogoTmp(logo);
      setTitleTmp(title);
      setBannerImgTmp(bannerImg);
    }
  }, [modal, logo, title, bannerImg]);
  const onLogo = file => {
    if (!file) return;
    const r = new FileReader();
    r.onload = e => {
      const b64 = e.target.result;
      setLogo(b64);
      setToast({
        text: "‚úÖ ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÑŸàÿ∫Ÿà",
        type: "success"
      });
    };
    r.readAsDataURL(file);
  };
  const removeLogo = () => {
    setLogo("");
    setToast({
      text: "‚ùå ÿ™ŸÖ ŸÖÿ≥ÿ≠ ÿßŸÑŸÑŸàÿ∫Ÿà",
      type: "error"
    });
  };
  const toggleMenu = () => setMenu(m => !m);
  const headerClass = headCls(theme),
    banClass = bannerCls(theme);
  const saveSnapshot = (partial = {}) => {
    const current = StorageManager.load() || {};
    const snapshot = {
      version: APP_VERSION,
      lastSync: new Date().toISOString(),
      data,
      banner,
      title,
      logo,
      bannerImg,
      datetime: {
        ...dt,
        autoTime
      },
      base,
      baseDate,
      theme,
      view,
      ...current,
      ...partial
    };
    setLastSync(snapshot.lastSync);
    StorageManager.save(snapshot);
    try {
      saveCache(snapshot);
    } catch (_) {}
  };
  const dbRef = React.useRef(null);
  const _remote = React.useRef({
    data: false,
    banner: false,
    theme: false,
    title: false,
    logo: false,
    bannerImg: false,
    view: false,
    base: false,
    datetime: false
  });
  const syncSetup = React.useRef(() => {});
  const detachAll = () => {
    try {
      if (!dbRef.current) return;
      const fb = dbRef.current;
      const paths = ['taif/data', 'taif/banner', 'taif/title', 'taif/logo', 'taif/bannerImg', 'taif/datetime', 'taif/base', 'taif/theme', 'taif/view'];
      paths.forEach(p => window.$db.off(window.$db.ref(p)));
    } catch (_) {}
  };
  const _synced = React.useRef({
    data: false,
    banner: false,
    theme: false,
    title: false,
    logo: false,
    bannerImg: false,
    view: false,
    base: false,
    datetime: false
  });
  React.useEffect(() => {
    if (!dbRef.current) return;
    if (!_synced.current.datetime) return;
    if (_remote.current.datetime) {
      _remote.current.datetime = false;
      return;
    }
    dbRef.current.set(dbRef.current.ref('taif/datetime'), {
      time: dt.time,
      date: dt.date,
      is12: dt.is12,
      autoTime
    });
  }, [dt, autoTime]);
  React.useEffect(() => {
    const setup = () => {
      syncSetup.current = setup;
      const fb = window.$db;
      if (!fb) return;
      dbRef.current = fb;
      window.$db.onValue(window.$db.ref('taif/data'), snap => {
        _synced.current.data = true;
        const v = snap.val();
        if (v && Array.isArray(v)) {
          _remote.current.data = true;
          setData(v);
          saveSnapshot({
            data: v
          });
          saveJSON(K.DATA, {
            data: v
          });
        } else {
          window.$db.set(window.$db.ref('taif/data'), DEFAULT_DATA);
          setData(DEFAULT_DATA);
          saveSnapshot({
            data: DEFAULT_DATA
          });
          saveJSON(K.DATA, {
            data: DEFAULT_DATA
          });
        }
      });
      window.$db.onValue(window.$db.ref('taif/banner'), snap => {
        _synced.current.banner = true;
        const v = snap.val();
        if (v && typeof v === 'object') {
          _remote.current.banner = true;
          setBanner(v);
          setBTmp(v);
          saveSnapshot({
            banner: v
          });
        }
      });
      window.$db.onValue(window.$db.ref('taif/title'), snap => {
        _synced.current.title = true;
        const v = snap.val();
        if (typeof v === 'string' && v !== title) {
          _remote.current.title = true;
          setTitle(v);
          saveSnapshot({
            title: v
          });
        }
      });
      window.$db.onValue(window.$db.ref('taif/logo'), snap => {
        _synced.current.logo = true;
        const v = snap.val();
        if (typeof v === 'string' && v !== logo) {
          _remote.current.logo = true;
          setLogo(v);
          saveSnapshot({
            logo: v
          });
        }
      });
      window.$db.onValue(window.$db.ref('taif/bannerImg'), snap => {
        _synced.current.bannerImg = true;
        const v = snap.val();
        if (typeof v === 'string' && v !== bannerImg) {
          _remote.current.bannerImg = true;
          setBannerImg(v);
          saveSnapshot({
            bannerImg: v
          });
        }
      });
      window.$db.onValue(window.$db.ref('taif/datetime'), snap => {
        _synced.current.datetime = true;
        const v = snap.val();
        if (v && typeof v === 'object') {
          _remote.current.datetime = true;
          setDT({
            time: v.time || "",
            date: v.date || "",
            is12: !!v.is12
          });
          setAuto(!!v.autoTime);
          saveSnapshot({
            datetime: {
              time: v.time || '',
              date: v.date || '',
              is12: !!v.is12,
              autoTime: !!v.autoTime
            }
          });
        }
      });
      window.$db.onValue(window.$db.ref('taif/base'), snap => {
        _synced.current.base = true;
        const v = snap.val();
        if (!v || !v.date || !v.base) {
          hasRemoteBase.current = false;
          let newBase;
          let newDate;
          const localBase = baseRef.current;
          const localDate = baseDateRef.current;
          if (localBase && Object.keys(localBase).length > 0 && localDate) {
            newBase = {
              ...localBase
            };
            newDate = localDate;
          } else {
            newBase = {};
            composeRows(dataRef.current || data, {}).forEach(row => {
              newBase[row.code] = row.sell;
            });
            newDate = today();
          }
          _remote.current.base = true;
          setBase(newBase);
          setBaseDate(newDate);
          saveSnapshot({
            base: newBase,
            baseDate: newDate
          });
          return;
        }
        const cleaned = {};
        try {
          Object.entries(v.base).forEach(([code, entry]) => {
            if (entry && typeof entry === 'object' && 'sell' in entry) {
              cleaned[code] = toNum(entry.sell);
            } else {
              cleaned[code] = toNum(entry);
            }
          });
        } catch (_) {}
        const remoteDate = v.date;
        const localDate = baseDateRef.current;
        hasRemoteBase.current = true;
        if (!localDate || localDate !== remoteDate) {
          _remote.current.base = true;
          setBase(cleaned);
          setBaseDate(remoteDate);
          saveSnapshot({
            base: cleaned,
            baseDate: remoteDate
          });
          return;
        }
        const currentBase = baseRef.current;
        if (!currentBase || Object.keys(currentBase).length === 0) {
          _remote.current.base = true;
          setBase(cleaned);
          setBaseDate(remoteDate);
          saveSnapshot({
            base: cleaned,
            baseDate: remoteDate
          });
        }
        return;
      });
      try {
        const b = baseRef.current;
        const d = baseDateRef.current;
        if (!hasRemoteBase.current && b && Object.keys(b).length > 0 && d) {
          hasRemoteBase.current = true;
          _remote.current.base = true;
          window.$db.set(window.$db.ref('taif/base'), {
            date: d,
            base: b
          });
        }
      } catch (_) {}
    };
    if (window.$db) setup();else {
      const onReady = () => {
        setup();
        window.removeEventListener('db-ready', onReady);
      };
      window.addEventListener('db-ready', onReady);
    }
  }, []);
  React.useEffect(() => {
    if (!window.$db) return;
    if (!online) {
      detachAll();
      return;
    }
    try {
      detachAll();
      if (typeof syncSetup.current === 'function') syncSetup.current();
      if (prevOnline.current === false && online === true) {
        setToast({
          text: "üîÑ ÿ™ŸÖÿ™ ÿ•ÿπÿßÿØÿ© ÿßŸÑÿßÿ™ÿµÿßŸÑ ‚Äî ÿ¨ÿßÿ±Ÿä ÿßŸÑŸÖÿ≤ÿßŸÖŸÜÿ©",
          type: "info"
        });
      }
    } catch (_) {}
  }, [online]);
  React.useEffect(() => {
    if (!dbRef.current) return;
    if (!_synced.current.data) return;
    if (_remote.current.data) {
      _remote.current.data = false;
      return;
    }
    dbRef.current.set(dbRef.current.ref('taif/data'), data);
  }, [data]);
  React.useEffect(() => {
    if (!dbRef.current) return;
    if (!_synced.current.banner) return;
    if (_remote.current.banner) {
      _remote.current.banner = false;
      return;
    }
    dbRef.current.set(dbRef.current.ref('taif/banner'), banner);
  }, [banner]);
  React.useEffect(() => {
    if (!dbRef.current) return;
    if (!_synced.current.title) return;
    if (_remote.current.title) {
      _remote.current.title = false;
      return;
    }
    dbRef.current.set(dbRef.current.ref('taif/title'), title);
  }, [title]);
  React.useEffect(() => {
    if (!dbRef.current) return;
    if (!_synced.current.logo) return;
    if (_remote.current.logo) {
      _remote.current.logo = false;
      return;
    }
    dbRef.current.set(dbRef.current.ref('taif/logo'), logo || '');
  }, [logo]);
  React.useEffect(() => {
    if (!dbRef.current) return;
    if (!_synced.current.bannerImg) return;
    if (_remote.current.bannerImg) {
      _remote.current.bannerImg = false;
      return;
    }
    dbRef.current.set(dbRef.current.ref('taif/bannerImg'), bannerImg || '');
  }, [bannerImg]);
  React.useEffect(() => {
    if (!dbRef.current) return;
    if (!_synced.current.base) return;
    if (_remote.current.base) {
      _remote.current.base = false;
      return;
    }
    if (hasRemoteBase.current) return;
    try {
      hasRemoteBase.current = true;
      _remote.current.base = true;
      dbRef.current.set(dbRef.current.ref('taif/base'), {
        date: baseDate,
        base
      });
    } catch (_) {}
  }, [base, baseDate]);
  if (!currentUser) {
    return React.createElement("div", {
      className: "min-h-screen w-full flex items-center justify-center bg-gradient-to-br from-indigo-700 via-purple-600 to-pink-600 p-4"
    }, React.createElement("div", {
      className: "bg-white/90 backdrop-blur-md rounded-xl shadow-xl w-full max-w-sm p-6 sm:p-8"
    }, React.createElement("h2", {
      className: "text-2xl font-bold mb-4 text-center text-gray-800"
    }, "\u062A\u0633\u062C\u064A\u0644 \u0627\u0644\u062F\u062E\u0648\u0644"), React.createElement("form", {
      onSubmit: handleLogin,
      className: "grid gap-4"
    }, !window.$db && React.createElement("div", {
      className: "text-center text-sm text-gray-600"
    }, "\u23F3 \u062C\u0627\u0631\u064A \u0627\u0644\u0627\u062A\u0635\u0627\u0644 \u0628\u0642\u0627\u0639\u062F\u0629 \u0627\u0644\u0628\u064A\u0627\u0646\u0627\u062A..."), React.createElement("label", {
      className: "grid gap-1"
    }, React.createElement("span", {
      className: "text-sm text-gray-600"
    }, "\u0627\u0633\u0645 \u0627\u0644\u0645\u0633\u062A\u062E\u062F\u0645"), React.createElement("input", {
      className: "fld w-full",
      value: loginUser,
      onChange: e => setLoginUser(e.target.value.trim()),
      placeholder: "\u0627\u0633\u0645 \u0627\u0644\u0645\u0633\u062A\u062E\u062F\u0645"
    })), React.createElement("label", {
      className: "grid gap-1"
    }, React.createElement("span", {
      className: "text-sm text-gray-600"
    }, "\u0643\u0644\u0645\u0629 \u0627\u0644\u0645\u0631\u0648\u0631"), React.createElement("input", {
      type: "password",
      className: "fld w-full",
      value: loginPass,
      onChange: e => setLoginPass(e.target.value),
      placeholder: "\u2022\u2022\u2022\u2022\u2022\u2022"
    })), loginErr && React.createElement("div", {
      className: "text-red-600 text-sm text-center"
    }, loginErr), React.createElement("button", {
      type: "submit",
      className: "w-full h-11 rounded-lg bg-blue-600 hover:bg-blue-700 transition text-white font-semibold"
    }, "\u062F\u062E\u0648\u0644"))));
  }
  return React.createElement("div", {
    className: "w-full px-2 sm:px-0 lg:px-2 xl:px-2 pb-24"
  }, !online && React.createElement("div", {
    className: "fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm pointer-events-auto"
  }, React.createElement("div", {
    className: "bg-yellow-200 text-yellow-900 px-6 py-4 rounded-xl shadow-lg text-center font-semibold"
  }, "\u26A0\uFE0F \u063A\u064A\u0631 \u0645\u062A\u0635\u0644 \u0628\u0627\u0644\u0625\u0646\u062A\u0631\u0646\u062A", React.createElement("div", {
    className: "text-sm font-normal"
  }, "\u0627\u0644\u0631\u062C\u0627\u0621 \u0627\u0644\u062A\u062D\u0642\u0642 \u0645\u0646 \u0627\u0644\u0627\u062A\u0635\u0627\u0644"))), React.createElement("header", {
    className: "mt-1 mb-1"
  }, React.createElement("div", {
    className: "hdr grid items-center gap-3 sm:gap-4 h-auto sm:h-40 md:h-44"
  }, React.createElement("div", {
    className: "glass rounded-2xl border-2 border-gray-300 h-full w-full overflow-hidden bg-white/60 logo-box"
  }, logo ? React.createElement("img", {
    src: logo,
    alt: "\u0627\u0644\u0634\u0639\u0627\u0631",
    className: "w-full h-full object-fill"
  }) : React.createElement("span", {
    className: "flex items-center justify-center h-full text-gray-400 text-sm"
  }, "\u0627\u0644\u0634\u0639\u0627\u0631")), React.createElement("div", {
    className: "h-full flex items-center justify-center px-3 overflow-hidden title-plain"
  }, React.createElement("h1", {
    className: "font-black leading-tight text-center whitespace-normal break-words text-[clamp(1.5rem,4vw,2.7rem)]"
  }, title)), React.createElement("div", {
    className: "glass rounded-2xl border-2 border-gray-300 h-full w-full overflow-hidden bg-white/60 banner-box"
  }, bannerImg ? React.createElement("img", {
    src: bannerImg,
    alt: "\u0627\u0644\u0635\u0648\u0631\u0629",
    className: "w-full h-full object-fill"
  }) : React.createElement("span", {
    className: "flex items-center justify-center h-full text-gray-400 text-sm"
  }, "\u0635\u0648\u0631\u0629")))), menu && ReactDOM.createPortal(React.createElement(React.Fragment, null, React.createElement("div", {
    className: "drawer-backdrop",
    onClick: () => setMenu(false)
  }), React.createElement("div", {
    className: `drawer ${menu ? "open" : ""}`,
    role: "dialog",
    "aria-modal": "true",
    "aria-label": "\u0642\u0627\u0626\u0645\u0629 \u0627\u0644\u0625\u0639\u062F\u0627\u062F\u0627\u062A",
    dir: "ltr"
  }, React.createElement("header", null, React.createElement("span", null, "\u0627\u0644\u0625\u0639\u062F\u0627\u062F\u0627\u062A"), React.createElement("button", {
    className: "px-2 py-1 rounded-lg border",
    onClick: () => setMenu(false),
    "aria-label": "\u0625\u063A\u0644\u0627\u0642"
  }, "\u2716")), React.createElement("div", {
    className: "content",
    dir: "ltr"
  }, currentUser && React.createElement("div", {
    className: "p-2 border-b text-center text-gray-700"
  }, React.createElement("div", {
    className: "font-semibold text-base"
  }, currentUser.username), React.createElement("div", {
    className: "text-xs text-gray-500"
  }, currentUser.role === 'emergency' ? 'ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶' : currentUser.role === 'superadmin' ? 'ÿ≥Ÿàÿ®ÿ±ÿ£ÿØŸÖŸÜ' : currentUser.role === 'admin' ? 'ŸÖÿØŸäÿ±' : currentUser.role || '')), React.createElement("div", {
    className: "grid gap-2"
  }, hasPermission('editUSD') && React.createElement("button", {
    type: "button",
    className: "btn-drawer",
    onClick: () => {
      setMenu(false);
      setModal('usd');
    }
  }, "\uD83D\uDCB5 \u062A\u0639\u062F\u064A\u0644 \u0627\u0644\u062F\u0648\u0644\u0627\u0631"), hasPermission('bulkEdit') && React.createElement("button", {
    type: "button",
    className: "btn-drawer",
    onClick: () => {
      setMenu(false);
      openBulk();
    }
  }, "\uD83D\uDEE0\uFE0F \u062A\u0639\u062F\u064A\u0644 \u0643\u0644 \u0627\u0644\u0639\u0645\u0644\u0627\u062A"), hasPermission('addCurrency') && React.createElement("button", {
    type: "button",
    className: "btn-drawer",
    onClick: () => {
      setMenu(false);
      setEditIdx(null);
      setModal('form');
    }
  }, "\u2795 \u0625\u0636\u0627\u0641\u0629 \u0639\u0645\u0644\u0629"), hasPermission('editCurrency') && React.createElement("button", {
    type: "button",
    className: "btn-drawer",
    onClick: () => {
      setMenu(false);
      setModal('pick');
    }
  }, "\u270F\uFE0F \u062A\u0639\u062F\u064A\u0644 \u0639\u0645\u0644\u0629"), hasPermission('deleteCurrency') && React.createElement("button", {
    type: "button",
    className: "btn-drawer",
    onClick: () => {
      setMenu(false);
      setModal('pickDelete');
    }
  }, "\uD83D\uDDD1\uFE0F \u062D\u0630\u0641 \u0639\u0645\u0644\u0629"), hasPermission('editBanner') && React.createElement("button", {
    type: "button",
    className: "btn-drawer",
    onClick: () => {
      setMenu(false);
      setBTmp({
        ...banner
      });
      setModal('banner');
    }
  }, "\u26A1 \u0625\u0639\u062F\u0627\u062F\u0627\u062A \u0627\u0644\u0625\u0639\u0644\u0627\u0646\u0627\u062A"), hasPermission('changeView') && React.createElement("button", {
    type: "button",
    className: "btn-drawer",
    onClick: () => {
      setMenu(false);
      setVTmp(view);
      setModal('view');
    }
  }, "\uD83C\uDF9B\uFE0F \u0637\u0631\u064A\u0642\u0629 \u0627\u0644\u0639\u0631\u0636"), hasPermission('changeTheme') && React.createElement("button", {
    type: "button",
    className: "btn-drawer",
    onClick: () => {
      setMenu(false);
      setModal('themes');
    }
  }, "\uD83C\uDFA8 \u0627\u0644\u062B\u064A\u0645"), hasPermission('editLogo') && React.createElement("button", {
    type: "button",
    className: "btn-drawer",
    onClick: () => {
      setMenu(false);
      setModal('logo');
    }
  }, "\uD83D\uDDBC\uFE0F \u062A\u063A\u064A\u064A\u0631 \u0627\u0644\u0644\u0648\u063A\u0648/\u0627\u0644\u0639\u0646\u0648\u0627\u0646"), hasPermission('adjustDatetime') && React.createElement("button", {
    type: "button",
    className: "btn-drawer",
    onClick: () => {
      setMenu(false);
      setModal('datetime');
    }
  }, "\uD83D\uDD52 \u0636\u0628\u0637 \u0627\u0644\u0648\u0642\u062A"), hasPermission('manageUsers') && React.createElement("button", {
    type: "button",
    className: "btn-drawer",
    onClick: () => {
      setMenu(false);
      setEditUserName(null);
      setAddingUser(false);
      setUserForm({
        username: '',
        password: '',
        name: '',
        role: '',
        perms: {}
      });
      setAdminModalOpen(true);
    }
  }, "\uD83D\uDC64 \u0625\u062F\u0627\u0631\u0629 \u0627\u0644\u0645\u0633\u062A\u062E\u062F\u0645\u064A\u0646"), hasPermission('viewAdminLogs') && React.createElement("button", {
    type: "button",
    className: "btn-drawer",
    onClick: () => {
      setMenu(false);
      openLogs();
    }
  }, "\uD83D\uDCDC \u0633\u062C\u0644\u0627\u062A \u0627\u0644\u0625\u062F\u0627\u0631\u0629"), hasPermission('logout') && React.createElement("button", {
    type: "button",
    className: "btn-drawer",
    onClick: () => {
      setMenu(false);
      handleLogout();
    }
  }, "\uD83D\uDEAA \u062A\u0633\u062C\u064A\u0644 \u062E\u0631\u0648\u062C"))), React.createElement("div", {
    className: "px-3 py-2 text-xs text-gray-500 text-center border-t"
  }, "\u0627\u0644\u0625\u0635\u062F\u0627\u0631 \u0627\u0644\u062D\u0627\u0644\u064A: ", APP_VERSION, lastSync && React.createElement("div", {
    className: "mt-1 opacity-70"
  }, "\u0622\u062E\u0631 \u0645\u0632\u0627\u0645\u0646\u0629: ", new Date(lastSync).toLocaleTimeString([], {
    hour: "2-digit",
    minute: "2-digit"
  }))))), document.body), online && !(menu || !!modal) && React.createElement("div", {
    className: "fixed left-3 bottom-1 z-[100] translate-y-1"
  }, React.createElement("button", {
    type: "button",
    onClick: () => setMenu(m => !m),
    "aria-label": "\u0641\u062A\u062D \u0627\u0644\u0625\u0639\u062F\u0627\u062F\u0627\u062A",
    className: "text-gray-800 hover:scale-110 transition-transform text-[22px] sm:text-[26px] lg:text-[30px]",
    style: {
      background: "transparent",
      border: "none"
    }
  }, "\u2699\uFE0F")), React.createElement("div", {
    className: `mt-1 rounded-3xl border-2 border-gray-300 shadow overflow-hidden bg-gradient-to-tr ${banClass}`
  }, view === "cards" && React.createElement("div", {
    className: "cards-view p-2 sm:p-3"
  }, React.createElement(CardsView, {
    rows: rowsDisplay,
    onEditUSD: onEditUSD,
    canEditUSD: hasPermission('editUSD')
  })), view === "board" && React.createElement(BoardView, {
    rows: rowsDisplay,
    head: headerClass,
    onEditUSD: onEditUSD,
    canEditUSD: hasPermission('editUSD')
  })), React.createElement(Modal, {
    open: modal === "usd",
    onClose: () => setModal(null),
    title: "\u062A\u0639\u062F\u064A\u0644 \u0633\u0639\u0631 \u0627\u0644\u062F\u0648\u0644\u0627\u0631"
  }, React.createElement("div", {
    className: "grid sm:grid-cols-2 gap-3"
  }, React.createElement("label", {
    className: "grid gap-1"
  }, React.createElement("span", {
    className: "text-sm text-gray-600"
  }, "\u0634\u0631\u0627\u0621 (USD)"), React.createElement(NumIn, {
    allowDecimal: true,
    value: usdTmp.buy,
    onChange: n => setUsdTmp(v => ({
      ...v,
      buy: n
    })),
    className: "fld w-full buy-bg"
  })), React.createElement("label", {
    className: "grid gap-1"
  }, React.createElement("span", {
    className: "text-sm text-gray-600"
  }, "\u0645\u0628\u064A\u0639 (USD)"), React.createElement(NumIn, {
    allowDecimal: true,
    value: usdTmp.sell,
    onChange: n => setUsdTmp(v => ({
      ...v,
      sell: n
    })),
    className: "fld w-full sell-bg"
  }))), React.createElement("div", {
    className: "btn-row flex justify-end gap-2 pt-2"
  }, React.createElement(Btn, {
    className: "text-white bg-red-600 w-36 h-11",
    onClick: () => {
      setModal(null);
      setToast({
        text: "‚ùå ÿ™ŸÖ ÿßŸÑÿ•ŸÑÿ∫ÿßÿ°",
        type: "error"
      });
    }
  }, "\u0625\u0644\u063A\u0627\u0621"), React.createElement(Btn, {
    className: "text-white bg-green-600 w-36 h-11",
    onClick: () => {
      if (!(usdTmp.buy > 0 && usdTmp.sell > 0)) return setToast({
        text: "‚ö†Ô∏è ŸÇŸäŸÖ USD Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ŸÉŸàŸÜ ÿ£ŸÉÿ®ÿ± ŸÖŸÜ 0",
        type: "error"
      });
      setData(p => sanitizeData(p.map(rr => rr.code === "USD" ? {
        ...rr,
        buy: toNum(usdTmp.buy),
        sell: toNum(usdTmp.sell)
      } : rr)));
      setModal(null);
      setToast({
        text: "‚úÖ ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿØŸàŸÑÿßÿ±",
        type: "success"
      });
    }
  }, "\u062D\u0641\u0638"))), React.createElement(Modal, {
    open: logsModalOpen,
    onClose: () => {
      setLogsModalOpen(false);
    },
    title: "\u0633\u062C\u0644\u0627\u062A \u0627\u0644\u0625\u062F\u0627\u0631\u0629"
  }, React.createElement("div", {
    className: "grid gap-3"
  }, React.createElement("div", {
    className: "flex justify-end"
  }, React.createElement(Btn, {
    className: "text-white bg-red-600 w-36 h-10",
    onClick: clearLogs
  }, "\uD83D\uDDD1\uFE0F \u0645\u0633\u062D \u0627\u0644\u0633\u062C\u0644")), React.createElement("div", {
    className: "max-h-[60vh] overflow-auto text-sm"
  }, logsList.length === 0 ? React.createElement("div", {
    className: "text-center py-4"
  }, "\u0644\u0627 \u062A\u0648\u062C\u062F \u0633\u062C\u0644\u0627\u062A") : React.createElement("div", {
    className: "space-y-1 max-h-[60vh] overflow-y-auto pr-1"
  }, logsList.map((lg, idx) => React.createElement("div", {
    key: idx,
    className: "flex items-start justify-between gap-3 border-b border-gray-600/20 py-1"
  }, React.createElement("div", {
    className: "text-xs opacity-70 whitespace-nowrap"
  }, fmtDT(lg.at)), React.createElement("div", {
    className: "text-sm flex-1 text-right"
  }, React.createElement("span", {
    className: "mr-1"
  }, ACTION_ICONS[lg.action] || 'üìå'), React.createElement("span", null, humanizeLog(lg), " \u2014 ", React.createElement("span", {
    className: "opacity-70"
  }, "\u0628\u0648\u0627\u0633\u0637\u0629 ", lg.actor || '‚Äî'))))))))), React.createElement(Modal, {
    open: modal === "bulk",
    onClose: () => setModal(null),
    title: "\u062A\u0639\u062F\u064A\u0644 \u0643\u0644 \u0627\u0644\u0639\u0645\u0644\u0627\u062A"
  }, React.createElement("div", {
    className: "flex flex-wrap items-center gap-2"
  }, React.createElement("input", {
    className: "fld flex-1 min-w-[220px]",
    placeholder: "\uD83D\uDD0E \u0628\u062D\u062B \u0643\u0648\u062F/\u0627\u0633\u0645",
    value: q,
    onChange: e => setQ(e.target.value.trim())
  })), React.createElement("div", {
    className: "bulk-grid bulk-head text-xs opacity-70 select-none"
  }, React.createElement("div", null, "\u0627\u0644\u0639\u0645\u0644\u0629"), React.createElement("div", null, "\u0627\u0644\u0637\u0631\u064A\u0642\u0629"), React.createElement("div", null, "\u0646\u0633\u0628\u0629 \u0634\u0631\u0627\u0621"), React.createElement("div", null, "\u0646\u0633\u0628\u0629 \u0645\u0628\u064A\u0639"), React.createElement("div", null, "\u0634\u0631\u0627\u0621"), React.createElement("div", null, "\u0645\u0628\u064A\u0639")), React.createElement("div", {
    className: "max-h-[56vh] sm:max-h-[62vh] overflow-auto"
  }, (bulk.length ? bulk : data).filter(r => !q || r.code.toLowerCase().includes(q.toLowerCase()) || r.name.includes(q)).map((r, i) => {
    const list = bulk.length ? bulk : data,
      usd = list.find(x => x.code === "USD") || {
        buy: 5000,
        sell: 5050
      };
    const pv = r.code === "USD" ? {
      buy: r.buy,
      sell: r.sell
    } : calcPrice(r, usd);
    const upd = patch => setBulk(v => (v.length ? v : list).map((x, ii) => ii === i ? {
      ...r,
      ...patch
    } : x));
    return React.createElement("div", {
      key: r.code,
      className: "bulk-grid bulk-row items-center hover:bg-slate-50"
    }, React.createElement("div", {
      className: "cell-name name-inline"
    }, React.createElement("span", {
      className: "truncate"
    }, r.name), React.createElement("span", {
      className: "code-badge"
    }, r.code)), React.createElement("div", {
      className: "cell-method"
    }, React.createElement("span", {
      className: "m-label"
    }, "\u0627\u0644\u0637\u0631\u064A\u0642\u0629"), r.code === "USD" ? React.createElement("div", null) : React.createElement("div", {
      className: "seg"
    }, React.createElement("button", {
      className: `mul ${r.method === "multiply" ? "on" : ""}`,
      onClick: () => upd({
        method: "multiply"
      })
    }, "\u0636\u0631\u0628"), React.createElement("button", {
      className: `div ${r.method === "divide" ? "on" : ""}`,
      onClick: () => upd({
        method: "divide"
      })
    }, "\u0642\u0633\u0645\u0629"))), React.createElement("div", {
      className: "cell-rb"
    }, React.createElement("span", {
      className: "m-label"
    }, "\u0646\u0633\u0628\u0629 \u0634\u0631\u0627\u0621"), r.code === "USD" ? React.createElement("div", null) : React.createElement(NumIn, {
      allowDecimal: true,
      className: "fld w-full",
      value: r.ratioBuy,
      onChange: n => upd({
        ratioBuy: n
      })
    })), React.createElement("div", {
      className: "cell-rs"
    }, React.createElement("span", {
      className: "m-label"
    }, "\u0646\u0633\u0628\u0629 \u0645\u0628\u064A\u0639"), r.code === "USD" ? React.createElement("div", null) : React.createElement(NumIn, {
      allowDecimal: true,
      className: "fld w-full",
      value: r.ratioSell,
      onChange: n => upd({
        ratioSell: n
      })
    })), React.createElement("div", {
      className: "cell-buy"
    }, React.createElement("span", {
      className: "m-label"
    }, "\u0634\u0631\u0627\u0621"), r.code === "USD" ? React.createElement(NumIn, {
      allowDecimal: true,
      className: "fld w-full buy-bg",
      value: r.buy,
      onChange: n => upd({
        buy: toNum(n)
      })
    }) : React.createElement("div", {
      className: "fld table-numbers w-full buy-bg select-none"
    }, fmt(pv.buy))), React.createElement("div", {
      className: "cell-sell"
    }, React.createElement("span", {
      className: "m-label"
    }, "\u0645\u0628\u064A\u0639"), r.code === "USD" ? React.createElement(NumIn, {
      allowDecimal: true,
      className: "fld w-full sell-bg",
      value: r.sell,
      onChange: n => upd({
        sell: toNum(n)
      })
    }) : React.createElement("div", {
      className: "fld table-numbers w-full sell-bg select-none"
    }, fmt(pv.sell))));
  })), React.createElement("div", {
    className: "bulk-foot flex justify-end gap-2"
  }, React.createElement(Btn, {
    className: "text-white bg-red-600 w-36 h-11",
    onClick: () => {
      setModal(null);
      setToast({
        text: "‚ùå ÿ™ŸÖ ÿßŸÑÿ•ŸÑÿ∫ÿßÿ°",
        type: "error"
      });
    }
  }, "\u0625\u0644\u063A\u0627\u0621"), React.createElement(Btn, {
    className: "text-white bg-green-600 w-36 h-11",
    onClick: () => {
      const src = bulk.length ? bulk : data;
      for (const r of src) {
        if (r.code === "USD") {
          if (!(r.buy > 0 && r.sell > 0)) return setToast({
            text: "‚ö†Ô∏è ŸÇŸäŸÖ USD Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ŸÉŸàŸÜ ÿ£ŸÉÿ®ÿ± ŸÖŸÜ 0",
            type: "error"
          });
        } else {
          if (!(r.ratioBuy > 0 && r.ratioSell > 0)) return setToast({
            text: `‚ö†Ô∏è ÿßŸÑŸÜÿ≥ÿ® Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ŸÉŸàŸÜ ÿ£ŸÉÿ®ÿ± ŸÖŸÜ 0 ‚Äî ${r.code}`,
            type: "error"
          });
        }
      }
      setData(sanitizeData(src));
      setModal(null);
      setToast({
        text: "‚úÖ ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ŸÉÿßŸÅÿ© ÿßŸÑÿπŸÖŸÑÿßÿ™",
        type: "success"
      });
    }
  }, "\u062D\u0641\u0638 \u0627\u0644\u0643\u0644"))), React.createElement(Modal, {
    open: modal === "pickDelete",
    onClose: () => setModal(null),
    title: "\u0627\u062E\u062A\u0631 \u0627\u0644\u0639\u0645\u0644\u0629 \u0644\u062D\u0630\u0641\u0647\u0627"
  }, React.createElement(MobilePickList, {
    rows: rows.filter(r => r.code !== "USD"),
    action: "delete",
    onChoose: r => {
      const idx = data.findIndex(x => x.code === r.code);
      if (idx > -1) {
        setEditIdx(idx);
        setModal("confirmDelete");
      }
    }
  }), React.createElement("div", {
    className: "flex justify-end pt-2"
  }, React.createElement(Btn, {
    className: "text-white bg-red-600 w-28 h-11",
    onClick: () => {
      setModal(null);
      setToast({
        text: "‚ùå ÿ™ŸÖ ÿßŸÑÿ•ŸÑÿ∫ÿßÿ°",
        type: "error"
      });
    }
  }, "\u0625\u063A\u0644\u0627\u0642"))), React.createElement(Modal, {
    open: modal === 'confirmDelete',
    onClose: () => setModal(null),
    title: "\u062A\u0623\u0643\u064A\u062F \u0627\u0644\u062D\u0630\u0641"
  }, React.createElement("div", {
    className: "text-sm sm:text-base"
  }, "\u0647\u0644 \u0623\u0646\u062A \u0645\u062A\u0623\u0643\u062F \u0645\u0646 \u0627\u0644\u062D\u0630\u0641\u061F"), React.createElement("div", {
    className: "flex justify-end gap-2 pt-4"
  }, React.createElement(Btn, {
    className: "text-white bg-red-600 w-28 h-11",
    onClick: () => {
      setModal(null);
      setToast({
        text: "‚ùå ÿ™ŸÖ ÿßŸÑÿ•ŸÑÿ∫ÿßÿ°",
        type: "error"
      });
    }
  }, "\u0625\u0644\u063A\u0627\u0621"), React.createElement(Btn, {
    className: "text-white bg-green-600 w-28 h-11",
    onClick: () => {
      if (editIdx != null) {
        try {
          var it = Array.isArray(data) && data[editIdx] || null;
          if (it && it.code) {
            window.Log && window.Log.logEvent && window.Log.logEvent('ÿ≠ÿ∞ŸÅ ÿπŸÖŸÑÿ©', (it.name || it.code) + ' (' + it.code + ')');
          }
        } catch (_) {}
        setData(prev => prev.filter((_, i) => i !== editIdx));
      }
      setModal(null);
      setToast({
        text: "‚úÖ ÿ™ŸÖ ÿßŸÑÿ≠ÿ∞ŸÅ",
        type: "success"
      });
    }
  }, "\u062A\u0623\u0643\u064A\u062F"))), React.createElement(Modal, {
    open: modal === "pick",
    onClose: () => setModal(null),
    title: "\u0627\u062E\u062A\u0631 \u0627\u0644\u0639\u0645\u0644\u0629 \u0644\u062A\u0639\u062F\u064A\u0644\u0647\u0627"
  }, React.createElement(MobilePickList, {
    rows: rowsDisplay,
    action: "edit",
    onChoose: r => {
      const idx = data.findIndex(x => x.code === r.code);
      if (idx > -1) {
        setEditIdx(idx);
        setModal("form");
      }
    }
  }), React.createElement("div", {
    className: "flex justify-end pt-2"
  }, React.createElement(Btn, {
    className: "text-white bg-slate-600 w-28 h-11",
    onClick: () => {
      setModal(null);
      setToast({
        text: "‚ùå ÿ™ŸÖ ÿßŸÑÿ•ŸÑÿ∫ÿßÿ°",
        type: "error"
      });
    }
  }, "\u0625\u063A\u0644\u0627\u0642"))), React.createElement(Modal, {
    open: modal === "banner",
    onClose: () => setModal(null),
    title: "\u0625\u0639\u062F\u0627\u062F\u0627\u062A \u0627\u0644\u0634\u0631\u064A\u0637 \u0627\u0644\u0625\u0639\u0644\u0627\u0646\u064A \u0627\u0644\u0633\u0641\u0644\u064A"
  }, React.createElement("div", {
    className: "grid gap-3"
  }, (bTmp.texts || []).length > 0 ? bTmp.texts.map((txt, i) => React.createElement("div", {
    key: i,
    className: "flex gap-2 items-center"
  }, React.createElement("input", {
    className: "fld flex-1",
    value: txt,
    onChange: e => {
      const newTexts = [...bTmp.texts];
      newTexts[i] = e.target.value;
      setBTmp(v => ({
        ...v,
        texts: newTexts
      }));
    },
    placeholder: `ÿ•ÿπŸÑÿßŸÜ ${i + 1}`
  }), React.createElement("button", {
    type: "button",
    className: "px-3 py-2 bg-red-600 text-white rounded-lg",
    onClick: () => {
      const newTexts = bTmp.texts.filter((_, idx) => idx !== i);
      setBTmp(v => ({
        ...v,
        texts: newTexts
      }));
    }
  }, "\u274C"))) : React.createElement("div", {
    className: "text-sm text-gray-500"
  }, "\u0644\u0627 \u062A\u0648\u062C\u062F \u0625\u0639\u0644\u0627\u0646\u0627\u062A \u062D\u0627\u0644\u064A\u0627\u064B."), React.createElement("button", {
    type: "button",
    className: "px-3 py-2 bg-blue-600 text-white rounded-lg w-fit",
    onClick: () => {
      const newTexts = [...(bTmp.texts || []), ""];
      setBTmp(v => ({
        ...v,
        texts: newTexts
      }));
    }
  }, "\u2795 \u0625\u0636\u0627\u0641\u0629 \u0625\u0639\u0644\u0627\u0646")), React.createElement("div", {
    className: "grid sm:grid-cols-3 gap-3 mt-4"
  }, React.createElement("label", {
    className: "grid gap-1"
  }, React.createElement("span", {
    className: "text-sm text-gray-600"
  }, "\u0644\u0648\u0646 \u0627\u0644\u0646\u0635"), React.createElement("input", {
    type: "color",
    className: "fld h-11 p-1",
    value: bTmp.color,
    onChange: e => setBTmp(v => ({
      ...v,
      color: e.target.value
    }))
  })), React.createElement("label", {
    className: "grid gap-1"
  }, React.createElement("span", {
    className: "text-sm text-gray-600"
  }, "\u0645\u062F\u0629 \u0627\u0644\u062D\u0631\u0643\u0629 (\u062B)"), React.createElement(NumIn, {
    allowDecimal: true,
    className: "fld",
    value: bTmp.moveDur,
    onChange: n => setBTmp(v => ({
      ...v,
      moveDur: clamp(n, .3, 20)
    }))
  })), React.createElement("label", {
    className: "grid gap-1"
  }, React.createElement("span", {
    className: "text-sm text-gray-600"
  }, "\u0645\u062F\u0629 \u0627\u0644\u062A\u0648\u0642\u0641 (\u062B)"), React.createElement(NumIn, {
    allowDecimal: true,
    className: "fld",
    value: bTmp.stayDur,
    onChange: n => setBTmp(v => ({
      ...v,
      stayDur: clamp(n, .3, 60)
    }))
  }))), React.createElement("div", {
    className: "btn-row flex justify-end gap-2 pt-2"
  }, React.createElement(Btn, {
    className: "text-white bg-red-600 w-32 h-11",
    onClick: () => {
      setModal(null);
      setToast({
        text: "‚ùå ÿ™ŸÖ ÿßŸÑÿ•ŸÑÿ∫ÿßÿ°",
        type: "error"
      });
    }
  }, "\u0625\u0644\u063A\u0627\u0621"), React.createElement(Btn, {
    className: "text-white bg-green-600 w-32 h-11",
    onClick: () => {
      const safeTexts = bTmp.texts && Array.isArray(bTmp.texts) && bTmp.texts.length > 0 ? bTmp.texts.filter(t => (t || "").trim() !== "") : ["üì¢ ÿ£ŸáŸÑÿßŸã ÿ®ŸÉŸÖ"];
      setBanner({
        ...bTmp,
        texts: safeTexts.map(t => String(t).slice(0, 140))
      });
      setModal(null);
      setToast({
        text: "‚úÖ ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™",
        type: "success"
      });
    }
  }, "\u062D\u0641\u0638"))), React.createElement(DatetimeModal, {
    open: modal === "datetime",
    onClose: () => setModal(null),
    dt: dt,
    autoTime: autoTime,
    setDT: setDT,
    setAuto: setAuto,
    setToast: setToast
  }), React.createElement(Modal, {
    open: modal === "view",
    onClose: () => setModal(null),
    title: "\u0637\u0631\u064A\u0642\u0629 \u0639\u0631\u0636 \u0627\u0644\u0623\u0633\u0639\u0627\u0631"
  }, React.createElement("div", {
    className: "grid themes-grid grid-cols-2 sm:grid-cols-2 gap-2 sm:gap-3"
  }, React.createElement("button", {
    type: "button",
    className: `view-card ${vTmp === 'cards' ? 'sel' : ''}`,
    onClick: () => setVTmp('cards')
  }, React.createElement("div", {
    className: "font-bold mb-1"
  }, "\u0628\u0637\u0627\u0642\u0627\u062A"), React.createElement("div", {
    className: "text-sm text-gray-600"
  }, "\u0634\u0628\u0643\u0629 \u0645\u0631\u0646\u0629 \u0648\u0633\u0631\u064A\u0639\u0629 \u0627\u0644\u0642\u0631\u0627\u0621\u0629.")), React.createElement("button", {
    type: "button",
    className: `view-card ${vTmp === 'board' ? 'sel' : ''}`,
    onClick: () => setVTmp('board')
  }, React.createElement("div", {
    className: "font-bold mb-1"
  }, "\u0644\u0648\u062D\u0629 \u0643\u0628\u064A\u0631\u0629"), React.createElement("div", {
    className: "text-sm text-gray-600"
  }, "\u0645\u0646\u0627\u0633\u0628\u0629 \u0644\u0644\u0634\u0627\u0634\u0627\u062A \u0627\u0644\u0643\u0628\u064A\u0631\u0629."))), React.createElement("div", {
    className: "btn-row flex justify-end gap-2 pt-2"
  }, React.createElement(Btn, {
    className: "text-white bg-red-600 w-32 h-11",
    onClick: () => {
      setModal(null);
      setToast({
        text: "‚ùå ÿ™ŸÖ ÿßŸÑÿ•ŸÑÿ∫ÿßÿ°",
        type: "error"
      });
    }
  }, "\u0625\u0644\u063A\u0627\u0621"), React.createElement(Btn, {
    className: "text-white bg-green-600 w-32 h-11",
    onClick: () => {
      setView(vTmp);
      setModal(null);
      setToast({
        text: "‚úÖ ÿ™ŸÖ ÿ™ÿ∫ŸäŸäÿ± ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿπÿ±ÿ∂",
        type: "success"
      });
    }
  }, "\u062D\u0641\u0638"))), React.createElement(Modal, {
    open: modal === "themes",
    onClose: () => setModal(null),
    title: "\u0627\u062E\u062A\u064A\u0627\u0631 \u0627\u0644\u062B\u064A\u0645"
  }, React.createElement("div", {
    className: "grid themes-grid grid-cols-2 sm:grid-cols-2 gap-2 sm:gap-3"
  }, THEMES.map(t => React.createElement("button", {
    type: "button",
    key: t.id,
    onClick: () => setTTmp(t.cls),
    className: `view-card ${tTmp === t.cls ? 'sel' : ''}`
  }, React.createElement("div", {
    className: `h-16 rounded-xl mb-2 bg-gradient-to-tr ${t.cls.replace('bg-gradient-to-tr ', '').replace('text-gray-900', '').replace('text-gray-100', '')}`
  }), React.createElement("div", {
    className: "font-bold"
  }, t.name), React.createElement("div", {
    className: "text-xs text-gray-600 ltr:tracking-wider"
  }, t.id)))), React.createElement("div", {
    className: "flex justify-end gap-2 pt-4"
  }, React.createElement(Btn, {
    className: "text-white bg-red-600 w-28 h-11",
    onClick: () => {
      setModal(null);
      setToast({
        text: "‚ùå ÿ™ŸÖ ÿßŸÑÿ•ŸÑÿ∫ÿßÿ°",
        type: "error"
      });
    }
  }, "\u0625\u0644\u063A\u0627\u0621"), React.createElement(Btn, {
    className: "text-white bg-slate-700 w-28 h-11",
    onClick: () => {
      setTheme("");
      setModal(null);
      setToast({
        text: "‚ÑπÔ∏è ÿ™ŸÖ ÿßŸÑÿ±ÿ¨Ÿàÿπ ÿ•ŸÑŸâ ÿßŸÑÿ´ŸäŸÖ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä",
        type: "info"
      });
    }
  }, "\u0627\u0641\u062A\u0631\u0627\u0636\u064A"), React.createElement(Btn, {
    className: "text-white bg-green-600 w-28 h-11",
    onClick: () => {
      setTheme(tTmp);
      setModal(null);
      setToast({
        text: "‚úÖ ÿ™ŸÖ ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ",
        type: "success"
      });
    }
  }, "\u062D\u0641\u0638"))), React.createElement(Modal, {
    open: modal === "logo",
    onClose: () => setModal(null),
    title: "\u062A\u063A\u064A\u064A\u0631 \u0644\u0648\u063A\u0648 \u0627\u0644\u0634\u0631\u0643\u0629 / \u0627\u0644\u0639\u0646\u0648\u0627\u0646"
  }, React.createElement("div", {
    className: "grid gap-3 logo-modal"
  }, React.createElement("div", {
    className: "section"
  }, React.createElement("div", {
    className: "section-title"
  }, "\u0627\u0644\u0644\u0648\u063A\u0648"), React.createElement("div", {
    className: "row"
  }, React.createElement("div", {
    className: "preview"
  }, logoTmp ? React.createElement("img", {
    src: logoTmp,
    alt: "\u0627\u0644\u0634\u0639\u0627\u0631",
    className: "object-contain w-full h-full"
  }) : React.createElement("span", {
    className: "text-gray-400 text-xs"
  }, "\u0645\u0639\u0627\u064A\u0646\u0629 \u0627\u0644\u0634\u0639\u0627\u0631")), React.createElement("div", {
    className: "grid gap-2"
  }, React.createElement("div", {
    className: "hint"
  }, "\u064A\u064F\u0633\u062A\u062D\u0633\u0646 \u0623\u0628\u0639\u0627\u062F \u0639\u0631\u064A\u0636\u0629 \u0645\u062B\u0644 1000\xD7400. \u0633\u064A\u062A\u0645 \u062A\u0645\u062F\u064A\u062F \u0627\u0644\u0635\u0648\u0631\u0629 \u0644\u0645\u0644\u0621 \u0627\u0644\u0635\u0646\u062F\u0648\u0642."), React.createElement("input", {
    type: "file",
    accept: "image/png,image/jpeg,image/webp",
    className: "fld w-full",
    onChange: e => {
      const f = e.target.files && e.target.files[0];
      if (!f) return;
      if (!validateImage(f, setToast)) return;
      const r = new FileReader();
      r.onload = ev => setLogoTmp(ev.target.result);
      r.readAsDataURL(f);
    }
  }), React.createElement("div", {
    className: "actions"
  }, logoTmp && React.createElement(Btn, {
    className: "text-white bg-red-600",
    onClick: () => setLogoTmp("")
  }, "\u0645\u0633\u062D \u0627\u0644\u0644\u0648\u063A\u0648"))))), React.createElement("div", {
    className: "section"
  }, React.createElement("div", {
    className: "section-title"
  }, "\u0627\u0644\u0639\u0646\u0648\u0627\u0646"), React.createElement("div", {
    className: "grid gap-2"
  }, React.createElement("input", {
    className: "fld w-full",
    value: titleTmp,
    onChange: e => setTitleTmp(e.target.value),
    placeholder: "\u0623\u062F\u062E\u0644 \u0639\u0646\u0648\u0627\u0646 \u0627\u0644\u0635\u0641\u062D\u0629"
  }), React.createElement("div", {
    className: "hint"
  }, "\u064A\u062F\u0639\u0645 \u0627\u0644\u0639\u0646\u0627\u0648\u064A\u0646 \u0627\u0644\u0637\u0648\u064A\u0644\u0629"))), React.createElement("div", {
    className: "section"
  }, React.createElement("div", {
    className: "section-title"
  }, "\u0635\u0648\u0631\u0629 (\u064A\u0633\u0627\u0631 \u0627\u0644\u0639\u0646\u0648\u0627\u0646)"), React.createElement("div", {
    className: "row"
  }, React.createElement("div", {
    className: "preview"
  }, bannerImgTmp ? React.createElement("img", {
    src: bannerImgTmp,
    alt: "\u0627\u0644\u0635\u0648\u0631\u0629",
    className: "object-contain w-full h-full"
  }) : React.createElement("span", {
    className: "text-gray-400 text-xs"
  }, "\u0644\u0627 \u062A\u0648\u062C\u062F \u0635\u0648\u0631\u0629")), React.createElement("div", {
    className: "grid gap-2"
  }, React.createElement("div", {
    className: "hint"
  }, "\u064A\u064F\u0633\u062A\u062D\u0633\u0646 \u0623\u0628\u0639\u0627\u062F \u0639\u0631\u064A\u0636\u0629 \u0645\u062B\u0644 1000\xD7400. \u0633\u064A\u062A\u0645 \u062A\u0645\u062F\u064A\u062F \u0627\u0644\u0635\u0648\u0631\u0629 \u0644\u0645\u0644\u0621 \u0627\u0644\u0635\u0646\u062F\u0648\u0642."), React.createElement("input", {
    type: "file",
    accept: "image/png,image/jpeg,image/webp",
    className: "fld w-full",
    onChange: e => {
      const f = e.target.files && e.target.files[0];
      if (!f) return;
      if (!validateImage(f, setToast)) return;
      const r = new FileReader();
      r.onload = ev => setBannerImgTmp(ev.target.result);
      r.readAsDataURL(f);
    }
  }), React.createElement("div", {
    className: "actions"
  }, bannerImgTmp && React.createElement(Btn, {
    className: "text-white bg-red-600",
    onClick: () => setBannerImgTmp("")
  }, "\u0645\u0633\u062D \u0627\u0644\u0635\u0648\u0631\u0629"))))), React.createElement("div", {
    className: "sticky-actions flex justify-end gap-2 pt-2"
  }, React.createElement(Btn, {
    className: "text-white bg-red-600 w-32 h-11",
    onClick: () => {
      setModal(null);
      setToast({
        text: "‚ùå ÿ™ŸÖ ÿßŸÑÿ•ŸÑÿ∫ÿßÿ°",
        type: "error"
      });
    }
  }, "\u0625\u0644\u063A\u0627\u0621"), React.createElement(Btn, {
    className: "text-white bg-green-600 w-32 h-11",
    onClick: () => {
      const safeTitle = titleTmp || "ŸÑŸàÿ≠ÿ© ÿ£ÿ≥ÿπÿßÿ± ÿµÿ±ŸÅ ÿßŸÑÿπŸÖŸÑÿßÿ™";
      setTitle(safeTitle);
      setLogo(logoTmp);
      if (logoTmp) {} else {}
      setBannerImg(bannerImgTmp);
      if (bannerImgTmp) {} else {}
      setModal(null);
      setToast({
        text: "‚úÖ ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™",
        type: "success"
      });
    }
  }, "\u062D\u0641\u0638")))), React.createElement(Modal, {
    open: modal === "form",
    onClose: () => setModal(null),
    title: editIdx != null ? "ÿ™ÿπÿØŸäŸÑ ÿπŸÖŸÑÿ©" : "ÿ•ÿ∂ÿßŸÅÿ© ÿπŸÖŸÑÿ©"
  }, React.createElement(FormCurrency, {
    data: data,
    editIdx: editIdx,
    onCancel: () => setModal(null),
    onSaved: list => {
      setData(list);
      setModal(null);
    },
    setToast: setToast
  })), React.createElement(Modal, {
    open: adminModalOpen,
    onClose: () => {
      setAdminModalOpen(false);
      setEditUserName(null);
      setAddingUser(false);
      setUserForm({
        username: '',
        password: '',
        name: '',
        role: '',
        perms: {}
      });
      setAdminErr('');
    },
    title: editUserName ? 'ÿ™ÿπÿØŸäŸÑ ŸÖÿ≥ÿ™ÿÆÿØŸÖ' : addingUser ? 'ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿ™ÿÆÿØŸÖ' : 'ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ'
  }, addingUser || editUserName != null ? React.createElement("div", {
    className: "grid gap-3"
  }, editUserName == null && React.createElement("label", {
    className: "grid gap-1"
  }, React.createElement("span", {
    className: "text-sm text-gray-600"
  }, "\u0627\u0633\u0645 \u0627\u0644\u0645\u0633\u062A\u062E\u062F\u0645"), React.createElement("input", {
    className: "fld w-full",
    value: userForm.username,
    onChange: e => setUserForm(v => ({
      ...v,
      username: e.target.value.trim()
    })),
    placeholder: "\u0627\u0633\u0645 \u0627\u0644\u0645\u0633\u062A\u062E\u062F\u0645"
  })), React.createElement("label", {
    className: "grid gap-1"
  }, React.createElement("span", {
    className: "text-sm text-gray-600"
  }, "\u0627\u0633\u0645 \u0627\u0644\u0634\u062E\u0635"), React.createElement("input", {
    className: "fld w-full",
    value: userForm.name || '',
    onChange: e => setUserForm(v => ({
      ...v,
      name: e.target.value
    })),
    placeholder: "\u0627\u0633\u0645 \u0627\u0644\u0634\u062E\u0635"
  })), React.createElement("label", {
    className: "grid gap-1"
  }, React.createElement("span", {
    className: "text-sm text-gray-600"
  }, "\u0643\u0644\u0645\u0629 \u0627\u0644\u0645\u0631\u0648\u0631 ", editUserName ? '(ÿßÿ™ÿ±ŸÉŸáÿß ŸÅÿßÿ±ÿ∫ÿ© ŸÑÿπÿØŸÖ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±)' : ''), React.createElement("input", {
    type: "password",
    className: "fld w-full",
    value: userForm.password,
    onChange: e => setUserForm(v => ({
      ...v,
      password: e.target.value
    })),
    placeholder: "\u2022\u2022\u2022\u2022\u2022\u2022"
  })), currentUser && (currentUser.role === 'superadmin' || currentUser.role === 'emergency') && React.createElement("label", {
    className: "grid gap-1"
  }, React.createElement("span", {
    className: "text-sm text-gray-600"
  }, "\u0627\u0644\u062F\u0648\u0631"), React.createElement("select", {
    className: "fld w-full",
    value: userForm.role || '',
    onChange: e => {
      const val = e.target.value;
      setUserForm(v => ({
        ...v,
        role: val
      }));
    },
    disabled: editUserName && currentUser && currentUser.role === 'admin' && editUserName === currentUser.username
  }, React.createElement("option", {
    value: ""
  }, "\u0627\u062E\u062A\u0631 \u0627\u0644\u062F\u0648\u0631"), React.createElement("option", {
    value: "admin"
  }, "\u0645\u062F\u064A\u0631"), currentUser.role === 'superadmin' && React.createElement("option", {
    value: "superadmin"
  }, "\u0633\u0648\u0628\u0631\u0623\u062F\u0645\u0646"), currentUser.role === 'emergency' && React.createElement(React.Fragment, null, React.createElement("option", {
    value: "superadmin"
  }, "\u0633\u0648\u0628\u0631\u0623\u062F\u0645\u0646"), React.createElement("option", {
    value: "emergency"
  }, "\u062D\u0633\u0627\u0628 \u0627\u0644\u0637\u0648\u0627\u0631\u0626")))), React.createElement("div", {
    className: "grid gap-1"
  }, React.createElement("span", {
    className: "text-sm text-gray-600"
  }, "\u0627\u0644\u0635\u0644\u0627\u062D\u064A\u0627\u062A"), React.createElement("div", {
    className: "grid gap-1"
  }, PERMISSIONS.map(perm => React.createElement("label", {
    key: perm.key,
    className: "inline-flex items-center gap-2"
  }, React.createElement("input", {
    type: "checkbox",
    checked: !!userForm.perms[perm.key],
    disabled: editUserName && currentUser && currentUser.role === 'admin' && editUserName === currentUser.username,
    onChange: e => {
      const checked = e.target.checked;
      setUserForm(v => ({
        ...v,
        perms: {
          ...v.perms,
          [perm.key]: checked
        }
      }));
    }
  }), React.createElement("span", null, perm.label))))), adminErr && React.createElement("div", {
    className: "text-red-600 text-sm"
  }, adminErr), React.createElement("div", {
    className: "flex justify-end gap-2 pt-2"
  }, React.createElement(Btn, {
    className: "text-white bg-red-600 w-28 h-10",
    onClick: () => {
      setAdminModalOpen(false);
      setEditUserName(null);
      setAddingUser(false);
      setUserForm({
        username: '',
        password: '',
        name: '',
        role: '',
        perms: {}
      });
      setAdminErr('');
    }
  }, "\u0625\u0644\u063A\u0627\u0621"), React.createElement(Btn, {
    className: "text-white bg-green-600 w-28 h-10",
    onClick: handleSaveUser
  }, "\u062D\u0641\u0638"))) : React.createElement("div", {
    className: "grid gap-3"
  }, React.createElement("div", {
    className: "flex justify-between"
  }, React.createElement(Btn, {
    className: "text-white bg-gray-600 w-36 h-10",
    onClick: openLogs
  }, "\uD83D\uDCDC \u0633\u062C\u0644\u0627\u062A \u0627\u0644\u0625\u062F\u0627\u0631\u0629"), currentUser && (currentUser.role === 'superadmin' || currentUser.role === 'emergency') && React.createElement(Btn, {
    className: "text-white bg-blue-600 w-36 h-10",
    onClick: openAddUser
  }, "\u2795 \u0625\u0636\u0627\u0641\u0629 \u0645\u0633\u062A\u062E\u062F\u0645")), React.createElement("div", {
    className: "max-h-[60vh] overflow-auto"
  }, Object.entries(usersList || {}).filter(([un, us]) => {
    if (!us) return false;
    if (us.role === 'emergency' && (!currentUser || currentUser.role !== 'emergency')) return false;
    return true;
  }).map(([uname, u]) => {
    let canEdit = false;
    let canDelete = false;
    const myRole = currentUser ? currentUser.role : '';
    const targetRole = u.role || '';
    if (myRole === 'emergency') {
      canEdit = true;
      canDelete = true;
    } else if (myRole === 'superadmin') {
      if (targetRole !== 'superadmin' && targetRole !== 'emergency') {
        canEdit = true;
        canDelete = true;
      }
    } else if (myRole === 'admin') {
      if (uname === (currentUser ? currentUser.username : '')) {
        canEdit = true;
      }
    }
    return React.createElement("div", {
      key: uname,
      className: "flex items-center justify-between border-b py-2"
    }, React.createElement("div", {
      className: "flex flex-col"
    }, React.createElement("span", {
      className: "font-bold"
    }, uname), u.name && React.createElement("span", {
      className: "text-sm text-gray-700"
    }, u.name), React.createElement("span", {
      className: "text-xs text-gray-600"
    }, "\u0627\u0644\u0635\u0644\u0627\u062D\u064A\u0627\u062A: ", (Array.isArray(u?.permissions) ? u.permissions.map(permKey => permLabelMap[permKey] || permKey) : []).join(', '))), React.createElement("div", {
      className: "flex gap-2"
    }, canEdit && React.createElement(Btn, {
      className: "text-white bg-blue-500 w-20 h-8 text-xs",
      onClick: () => handleEditUser(uname)
    }, "\u062A\u0639\u062F\u064A\u0644"), canDelete && React.createElement(Btn, {
      className: "text-white bg-red-600 w-20 h-8 text-xs",
      onClick: () => handleDeleteUser(uname)
    }, "\u062D\u0630\u0641")));
  })))), React.createElement(Toast, {
    toast: toast,
    onClose: () => setToast(null)
  }), React.createElement("div", {
    className: "fixed left-0 right-0 bottom-0 z-[60] bottom-fixed",
    dir: "ltr"
  }, React.createElement("div", {
    className: "grid w-full h-10 sm:h-12 footer-grid grid-cols-[1fr_minmax(200px,22%)]"
  }, React.createElement("div", {
    ref: contRef,
    className: `ad-wrap bg-gradient-to-r ${banClass}`,
    dir: "rtl"
  }, React.createElement("div", {
    ref: itemRef,
    className: `ad-item ${ad.snap ? 'no-trans' : ''}`,
    style: {
      '--ad-move': `${banner.moveDur}s`,
      color: banner.color,
      transform: `translate(calc(-50% + ${ad.x}px), -50%)`
    }
  }, React.createElement("span", {
    className: "px-4 sm:px-6"
  }, banner.texts[ad.i] || ""))), React.createElement("div", {
    className: `border-l border-slate-200 flex items-center justify-center gap-3 px-2 sm:px-4 bg-gradient-to-r ${banClass}`
  }, React.createElement("div", {
    className: `w-3 h-3 sm:w-4 sm:h-4 rounded-full shadow ${online ? "bg-green-500" : "bg-red-500"}`,
    title: online ? "ŸÖÿ™ÿµŸÑ ÿ®ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™" : "ÿ∫Ÿäÿ± ŸÖÿ™ÿµŸÑ"
  }), React.createElement("div", {
    className: "flex flex-col items-center sm:flex-row sm:items- sm:gap-2 text-slate-900 whitespace-nowrap",
    dir: "ltr"
  }, React.createElement("span", {
    className: "table-numbers text-base sm:text-xl md:text-2xl font-black"
  }, clock.time), React.createElement("span", {
    className: "hidden sm:inline opacity-50 select-none"
  }, "|"), React.createElement("span", {
    className: "table-numbers text-xs sm:text-base md:text-lg"
  }, clock.date))))));
}
const FormCurrency = ({
  data,
  editIdx,
  onCancel,
  onSaved,
  setToast
}) => {
  const init = editIdx != null ? data[editIdx] : {
    flag: "",
    icon: "",
    code: "",
    name: "",
    ratioBuy: 1,
    ratioSell: 1,
    method: "multiply"
  };
  if (init && init.code === "USD") {
    setToast?.({
      text: "‚ö†Ô∏è ÿ™ÿπÿØŸäŸÑ USD Ÿäÿ™ŸÖ ŸÖŸÜ ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿØŸàŸÑÿßÿ± ŸÅŸÇÿ∑",
      type: "error"
    });
    onCancel?.();
    return null;
  }
  const [f, setF] = useState({
    ...init
  });
  return React.createElement("div", {
    className: "form-currency"
  }, React.createElement("div", {
    className: "grid sm:grid-cols-2 gap-3"
  }, React.createElement("label", {
    className: "grid gap-1"
  }, React.createElement("span", {
    className: "text-sm text-gray-600"
  }, "\u0627\u0644\u0631\u0645\u0632 (\u0643\u0648\u062F)"), React.createElement("input", {
    lang: "en",
    className: "fld table-numbers",
    value: f.code || "",
    onChange: e => setF(v => ({
      ...v,
      code: e.target.value.toUpperCase()
    })),
    placeholder: "USD / EUR / SAR ..."
  })), React.createElement("label", {
    className: "grid gap-1"
  }, React.createElement("span", {
    className: "text-sm text-gray-600"
  }, "\u0627\u0644\u0627\u0633\u0645"), React.createElement("input", {
    className: "fld",
    value: f.name || "",
    onChange: e => setF(v => ({
      ...v,
      name: e.target.value
    })),
    placeholder: "\u0627\u0633\u0645 \u0627\u0644\u0639\u0645\u0644\u0629"
  })), React.createElement("label", {
    className: "grid gap-1"
  }, React.createElement("span", {
    className: "text-sm text-gray-600"
  }, "\u0639\u0644\u0645 (Emoji)"), React.createElement("input", {
    className: "fld",
    value: f.flag || "",
    onChange: e => setF(v => ({
      ...v,
      flag: e.target.value
    })),
    placeholder: "\uD83C\uDDFA\uD83C\uDDF8 \u0645\u062B\u0644\u0627"
  })), React.createElement("label", {
    className: "grid gap-1"
  }, React.createElement("span", {
    className: "text-sm text-gray-600"
  }, "\u0623\u064A\u0642\u0648\u0646\u0629 \u0642\u0635\u064A\u0631\u0629"), React.createElement("input", {
    lang: "en",
    className: "fld table-numbers",
    value: f.icon || "",
    onChange: e => setF(v => ({
      ...v,
      icon: e.target.value
    })),
    placeholder: "USD, EUR..."
  })), React.createElement("label", {
    className: "grid gap-1"
  }, React.createElement("span", {
    className: "text-sm text-gray-600"
  }, "\u0646\u0633\u0628\u0629 \u0627\u0644\u0634\u0631\u0627\u0621"), React.createElement(NumIn, {
    allowDecimal: true,
    value: f.ratioBuy ?? 1,
    onChange: n => setF(v => ({
      ...v,
      ratioBuy: n
    })),
    className: "fld"
  })), React.createElement("label", {
    className: "grid gap-1"
  }, React.createElement("span", {
    className: "text-sm text-gray-600"
  }, "\u0646\u0633\u0628\u0629 \u0627\u0644\u0645\u0628\u064A\u0639"), React.createElement(NumIn, {
    allowDecimal: true,
    value: f.ratioSell ?? 1,
    onChange: n => setF(v => ({
      ...v,
      ratioSell: n
    })),
    className: "fld"
  })), React.createElement("label", {
    className: "grid gap-1"
  }, React.createElement("span", {
    className: "text-sm text-gray-600"
  }, "\u0637\u0631\u064A\u0642\u0629 \u0627\u0644\u062D\u0633\u0627\u0628"), React.createElement("select", {
    className: "fld",
    value: f.method || "multiply",
    onChange: e => setF(v => ({
      ...v,
      method: e.target.value
    }))
  }, React.createElement("option", {
    value: "multiply"
  }, "\u0636\u0631\u0628"), React.createElement("option", {
    value: "divide"
  }, "\u0642\u0633\u0645\u0629")))), React.createElement("div", {
    className: "btn-row flex justify-end gap-2 pt-2"
  }, React.createElement(Btn, {
    className: "text-white bg-red-600 w-32 h-11",
    onClick: () => {
      onCancel();
      setToast({
        text: "‚ùå ÿ™ŸÖ ÿßŸÑÿ•ŸÑÿ∫ÿßÿ°",
        type: "error"
      });
    }
  }, "\u0625\u0644\u063A\u0627\u0621"), React.createElement(Btn, {
    className: "text-white bg-green-600 w-32 h-11",
    onClick: () => {
      const code = (f.code || "").trim().toUpperCase().slice(0, 5),
        name = (f.name || "").trim();
      const rB = toNum(f.ratioBuy),
        rS = toNum(f.ratioSell),
        m = f.method || "multiply";
      if (!code || !name) return setToast({
        text: "‚ö†Ô∏è ÿ£ŸÉŸÖŸÑ ÿßŸÑÿ≠ŸÇŸàŸÑ",
        type: "error"
      });
      if (!/^[A-Z]{2,5}$/.test(code)) return setToast({
        text: "‚ö†Ô∏è ÿßŸÑŸÉŸàÿØ Ÿäÿ¨ÿ® ÿ£ŸÜ ŸäŸÉŸàŸÜ 2‚Äì5 ÿ£ÿ≠ÿ±ŸÅ ŸÑÿßÿ™ŸäŸÜŸäÿ© ŸÉÿ®Ÿäÿ±ÿ©",
        type: "error"
      });
      if (code === "USD") return setToast({
        text: "‚ö†Ô∏è ÿ™ÿπÿØŸäŸÑ/ÿ•ÿ∂ÿßŸÅÿ© USD ŸÖŸÜ Ÿáÿ∞ÿß ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨ ÿ∫Ÿäÿ± ŸÖÿ≥ŸÖŸàÿ≠ ‚Äî ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿØŸàŸÑÿßÿ±",
        type: "error"
      });
      const exists = i => data.some((d, idx) => d.code === code && idx !== i);
      if (exists(editIdx != null ? editIdx : -1)) return setToast({
        text: "‚ö†Ô∏è ÿßŸÑŸÉŸàÿØ ŸÖÿ≥ÿ™ÿÆÿØŸÖ",
        type: "error"
      });
      if (!(rB > 0 && rS > 0)) return setToast({
        text: "‚ö†Ô∏è ÿßŸÑŸÜŸëŸêÿ≥ÿ® Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ŸÉŸàŸÜ ÿ£ŸÉÿ®ÿ± ŸÖŸÜ 0",
        type: "error"
      });
      if (!isFlagEmoji(f.flag || "")) {
        return setToast({
          text: "‚ö†Ô∏è ÿ£ÿØÿÆŸÑ ÿπŸÑŸÖ ÿµÿ≠Ÿäÿ≠ (Emoji)",
          type: "error"
        });
      }
      const item = {
        ...f,
        code,
        name,
        ratioBuy: rB,
        ratioSell: rS,
        method: m,
        flag: f.flag || "üè≥Ô∏è"
      };
      const list = [...data];
      if (editIdx != null) list[editIdx] = item;else list.push(item);
      onSaved(list);
      try {
        if (editIdx == null) {
          window.Log && window.Log.logEvent && window.Log.logEvent('ÿ•ÿ∂ÿßŸÅÿ© ÿπŸÖŸÑÿ©', (f.name || code) + ' (' + code + ')');
        }
      } catch (_) {}
      setToast({
        text: "‚úÖ ÿ™ŸÖ ÿßŸÑÿ≠ŸÅÿ∏",
        type: "success"
      });
    }
  }, "\u062D\u0641\u0638")));
};
ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App, null));
  }
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', __start__);
  } else {
    __start__();
  }
})();
</script>

</body></html>
