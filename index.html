<!DOCTYPE html>
<html dir="rtl" lang="ar"><head><script id="version-guard-toast">
(function() {
 var CURRENT_VERSION = "2.0.0.0-stable-plus";
 var KEY = "taif:app_version";
 try {
  var saved = localStorage.getItem(KEY);
  if (!saved) {
   localStorage.setItem(KEY, CURRENT_VERSION);
  } else if (saved !== CURRENT_VERSION) {

   try {
    var toDel = [];
    for (var i=0;i<localStorage.length;i++) toDel.push(localStorage.key(i));
    var PRESERVE = new Set([KEY, 'taif:session', 'taif:session_token', 'taif:device_id']);
    toDel.forEach(function(k){
     if (k && k.indexOf("taif:")===0 && !PRESERVE.has(k) && !k.startsWith('taif:session/')) {
      localStorage.removeItem(k);
     }
    });
   } catch(_) {}
   try { localStorage.setItem(KEY, CURRENT_VERSION); } catch(_){}
   var showToast = function() {
    var wrap = document.createElement('div');
    wrap.setAttribute('dir','rtl');
    wrap.style.cssText = "position:fixed;top:14px;left:50%;transform:translateX(-50%);z-index:2147483647";
    var bubble = document.createElement('div');
    bubble.textContent = "ğŸ”„ ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø¸Ø§Ù… Ø¥Ù„Ù‰ Ø¥ØµØ¯Ø§Ø± Ø¬Ø¯ÙŠØ¯ â€” ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©";
    bubble.style.cssText = [
     "background: rgba(17,24,39,.95)",
     "color:#fff",
     "border-radius:14px",
     "padding:10px 16px",
     "font:600 14px/1.3 system-ui,Segoe UI,Roboto,Tahoma",
     "box-shadow:0 8px 24px rgba(0,0,0,.25)",
     "border:1px solid rgba(255,255,255,.08)",
     "max-width:92vw",
     "text-align:center",
     "white-space:nowrap"
    ].join(";");
    wrap.appendChild(bubble);
    document.body.appendChild(wrap);
    setTimeout(function(){ bubble.style.opacity="0.0"; bubble.style.transition="opacity .45s ease"; }, 1400);
   };
   if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', showToast);
   else showToast();
  }
 } catch(_) {}
})();
</script><script id="runtime-error-shield">
(function(){
  function show(msg){
    try{
      var wrap=document.createElement('div');
      wrap.setAttribute('dir','rtl');
      wrap.style.cssText="position:fixed;top:14px;left:50%;transform:translateX(-50%);z-index:2147483647";
      var b=document.createElement('div');
      b.textContent=msg;
      b.style.cssText="background:rgba(17,24,39,.95);color:#fff;border-radius:14px;padding:10px 16px;font:800 14px/1.3 system-ui,Segoe UI,Roboto,Tahoma;box-shadow:0 8px 24px rgba(0,0,0,.25);border:1px solid rgba(255,255,255,.08);max-width:92vw;text-align:center";
      wrap.appendChild(b);
      document.body.appendChild(wrap);
      setTimeout(function(){ b.style.opacity="0"; b.style.transition="opacity .45s ease"; }, 1600);
      setTimeout(function(){ try{wrap.remove()}catch(_){} }, 2400);
    }catch(_){}
  }
  window.addEventListener('error', function(ev){
    try{
      var msg = "âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹";
      if(ev && ev.message) msg = "âš ï¸ " + String(ev.message).slice(0,120);
      show(msg);
      try{ console.error(ev.error || ev.message || ev); }catch(_){}
    }catch(_){}
  });
  window.addEventListener('unhandledrejection', function(ev){
    try{
      var r = ev && ev.reason;
      var msg = "âš ï¸ Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹";
      if(r && (r.message||r.toString)) msg = "âš ï¸ " + String(r.message||r).slice(0,120);
      show(msg);
      try{ console.error(r); }catch(_){}
    }catch(_){}
  });
})();
</script><script id="console-warn-filter">
(function(){
  try{
    var _warn = console.warn;
    console.warn = function(){
      try{
        var msg = String(arguments && arguments[0] || "");
        // Hide noisy dev warnings (doesn't affect real errors)
        if (msg.includes("cdn.tailwindcss.com should not be used in production")) return;
        if (msg.includes("Multiple GoTrueClient instances detected")) return;
      }catch(_){}
      return _warn.apply(console, arguments);
    };
  }catch(_){}
})();
</script>
<link crossorigin="" href="https://unpkg.com" rel="preconnect"/><link href="https://unpkg.com" rel="dns-prefetch"/><link crossorigin="" href="https://cdn.tailwindcss.com" rel="preconnect"/><link href="https://cdn.tailwindcss.com" rel="dns-prefetch"/><link crossorigin="" href="https://cdn.jsdelivr.net" rel="preconnect"/><link href="https://cdn.jsdelivr.net" rel="dns-prefetch"/><meta charset="utf-8"/><meta content="width=device-width, initial-scale=1, viewport-fit=cover" name="viewport"/><title>Ù„ÙˆØ­Ø© Ø£Ø³Ø¹Ø§Ø± ØµØ±Ù Ø§Ù„Ø¹Ù…Ù„Ø§Øª</title><script>
 window.tailwind=window.tailwind||{};
 tailwind.config={safelist:[
  'bg-gradient-to-tr','bg-gradient-to-r','text-white','text-gray-100','text-gray-900',
  'from-cyan-200','via-white','to-blue-200','to-cyan-200',
  'from-rose-200','via-amber-100','to-orange-200',
  'from-emerald-200','to-teal-200',
  'from-gray-900','via-gray-800','to-slate-900',
  'from-indigo-200','to-purple-200',
  'from-yellow-100','via-yellow-200','to-yellow-300',
  'from-sky-600','via-cyan-600','to-blue-600',
  'from-orange-500','via-pink-500','to-red-500',
  'from-emerald-600','via-teal-600','to-green-500',
  'from-gray-700','via-gray-600','to-gray-800',
  'from-indigo-600','via-purple-600','to-fuchsia-600',
  'from-yellow-600','via-amber-600','to-yellow-700',
  'from-purple-700','via-indigo-600','to-blue-600',
  'from-sky-100','via-cyan-100','to-blue-100',
  'from-orange-100','via-amber-200','to-rose-200',
  'from-teal-100','via-green-100','to-emerald-100',
  'from-blue-100','via-gray-200','to-teal-100',
  'from-gray-800','via-gray-700','to-gray-600',
  'from-indigo-100','via-purple-100','to-violet-100',
  'from-yellow-100','via-amber-100','to-yellow-200'
 ]};
</script><script defer="" src="https://cdn.tailwindcss.com"></script><script crossorigin="anonymous" defer="" src="https://cdn.jsdelivr.net/npm/twemoji@14.0.2/dist/twemoji.min.js"></script><script defer="" src="https://cdn.jsdelivr.net/npm/bcryptjs@2.4.3/dist/bcrypt.min.js"></script><style>:root{color-scheme:light;--firstcol-pr:32px}*{box-sizing:border-box}body,html{height:100%}.glass{background:rgba(255,255,255,.4);backdrop-filter:blur(10px)}.glass-strong{background:rgba(255,255,255,.65);backdrop-filter:blur(12px)}.toast{position:fixed;top:1rem;left:50%;transform:translateX(-50%);z-index:1100}.backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);display:flex;align-items:center;justify-content:center;z-index:1050}.table-numbers,.table-numbers *{direction:ltr!important;unicode-bidi:bidi-override!important;text-align:center;font-family:Inter,Roboto,Arial,Tahoma,sans-serif}.table-currencies{table-layout:fixed;width:100%;border-collapse:collapse}.flag-slot img,.flag-slot svg{display:inline-block;vertical-align:-2px;border-radius:4px}@media(max-width:640px){.flag-slot img,.flag-slot svg{width:28px!important;height:18px!important}}@media(min-width:641px)and(max-width:1023px){.flag-slot img,.flag-slot svg{width:56px!important;height:36px!important}}@media(min-width:1024px){.flag-slot img,.flag-slot svg{width:72px!important;height:45px!important}}.cell-fixed{min-width:110px;display:inline-flex;justify-content:center;align-items:center;text-align:center}@media(max-width:640px){.cell-fixed{min-width:70px!important}}@media(min-width:768px){.cell-fixed{min-width:130px}}@media(min-width:1024px){.cell-fixed{min-width:150px}}.cell-change-mobile{padding:0 2px!important}.ad-wrap{position:relative;overflow:hidden;height:100%}.ad-item{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);white-space:nowrap;font-weight:600;transition:transform var(--ad-move,1.5s) ease-in-out}.no-trans{transition:none!important}.fld{height:38px;padding:.45rem .7rem;border:1px solid #d1d5db;border-radius:.75rem;background:#fff}.fld:focus{outline:2px solid rgba(59,130,246,.55)}.seg{display:inline-flex;border:1px solid #d1d5db;border-radius:.75rem;overflow:hidden}.seg>button{padding:.28rem .6rem;font-size:.75rem;line-height:1;border:0;background:#fff;color:#1f2937}.seg>button.mul.on{background:#16a34a;color:#fff}.seg>button.div.on{background:#dc2626;color:#fff}.code-badge{font-weight:800;font-size:.75rem;padding:.15rem .5rem;border-radius:.6rem;background:#0f172a;color:#fff}.name-inline{display:flex;align-items:center;gap:.45rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.buy-bg{background:#ecfdf5;border-color:#a7f3d0;color:#065f46}.sell-bg{background:#fef2f2;border-color:#fecaca;color:#991b1b}.bulk-grid{display:grid;grid-template-columns:200px 90px .9fr .9fr .9fr .9fr;gap:.5rem}.bulk-head{position:sticky;top:0;background:rgba(255,255,255,.9);backdrop-filter:blur(8px);z-index:10;border-bottom:1px solid #e5e7eb;padding:.5rem .25rem}.bulk-head>div{text-align:center}.bulk-head>div:first-child{text-align:right}.bulk-row{padding:.55rem .25rem;border-bottom:1px solid #eef2f7}.bulk-foot{position:sticky;bottom:0;background:0 0;padding:0;margin-top:.5rem}.m-label{display:none}@media(max-width:640px){.bulk-head{display:none}.bulk-row{grid-template-columns:1fr 1fr;grid-template-areas:"name name" "method method" "rb rs" "buy sell";gap:.45rem;padding:.6rem;border-bottom:1px solid #eaeef5;border-radius:.75rem}.m-label{display:block;font-size:12px;color:#6b7280;margin:0 0 .2rem}.cell-name{grid-area:name}.cell-method{grid-area:method}.cell-rb{grid-area:rb}.cell-rs{grid-area:rs}.cell-buy{grid-area:buy}.cell-sell{grid-area:sell}}.view-card{border:1px solid #e5e7eb;border-radius:1rem;padding:.75rem;background:#fff}.view-card.sel{outline:3px solid rgba(59,130,246,.5)}.board-row:hover{background:linear-gradient(90deg,rgba(229,231,235,.7),rgba(191,219,254,.9));box-shadow:0 2px 8px rgba(0,0,0,.12)}.hdr{display:grid;grid-template-columns:1fr;gap:.5rem}@media (min-width:640px){.hdr{grid-template-columns:35% 30% 35%}}@media (max-width:640px){.hdr>*{min-height:72px}}@media (max-width:640px){.footer-grid{grid-template-columns:75% 25%!important}}@media (max-width:640px){.cell-change-mobile{font-size:12px!important;min-width:5.75ch!important;padding:0 .3rem!important;white-space:nowrap!important}}.name-box{flex:1 1 auto;min-width:0;max-width:100%;overflow:hidden}.name-track{display:inline-block;white-space:nowrap;padding-inline:2px}.name-box.is-scroll .name-track{animation:name-marquee 9s linear infinite}@media(max-width:640px){.currency-name{font-size:13px!important;line-height:1.1!important}.currency-icon-mobile{display:none!important}}@media(max-width:640px){.currency-cell-mobile{gap:.25rem!important}.name-box{overflow:hidden;max-width:100%;flex:1}.name-box .name-track{display:inline-block;white-space:nowrap;animation:name-marquee 8s linear infinite}}@media(max-width:640px){.currency-cell-mobile{gap:.25rem!important}.name-box{overflow:visible!important;white-space:normal!important;flex:1}.name-box .name-track{white-space:normal!important;word-break:break-word;font-size:13px!important;line-height:1.1!important}}@media(max-width:640px){.name-box{overflow:visible!important;white-space:normal!important;flex:1}.name-box .name-track{white-space:normal!important;word-break:break-word;font-size:13px!important;line-height:1.2!important}.table-currencies{table-layout:fixed!important;width:100%!important}.cell-change-mobile{min-width:58px!important;max-width:58px!important;height:32px!important;font-size:12px!important;line-height:32px!important;padding:0!important;display:inline-flex!important;align-items:center!important;justify-content:center!important;white-space:nowrap!important}}@media(max-width:640px){.name-box{overflow:visible!important;white-space:normal!important;flex:1}.name-box .name-track{white-space:normal!important;word-break:break-word;font-size:13px!important;line-height:1.2!important}}@media(max-width:640px){.name-box{overflow:hidden!important;flex:1;display:-webkit-box!important;-webkit-box-orient:vertical;-webkit-line-clamp:2}.name-box .name-track{white-space:normal!important;word-break:break-word;font-size:13px!important;line-height:1.2!important}}@media(max-width:640px){.currency-cell-mobile{gap:.15rem!important}.name-box{overflow:hidden!important;flex:1;display:-webkit-box!important;-webkit-box-orient:vertical;-webkit-line-clamp:2}.name-box .name-track{white-space:normal!important;word-break:break-word;font-size:13px!important;line-height:1.2!important}}.name-track{animation:none!important;transform:none!important}.name-box.is-scroll .name-track{animation:none!important;transform:none!important}@media(max-width:640px){.card-label{font-size:12px!important;color:#111827!important;margin-bottom:4px!important;line-height:1!important}.pill-card{height:40px!important;min-height:40px!important;display:inline-flex!important;align-items:center!important;justify-content:center!important;padding:0 12px!important;border-radius:14px!important}.card-grid-mobile{gap:.5rem!important}}@media(max-width:640px){.pill-card{height:38px!important;min-height:38px!important;padding:0 12px!important;width:92%!important;margin-inline:auto!important}}@media(min-width:641px){.pill-card{width:94%!important;margin-inline:auto!important}}@media(min-width:641px){.card-grid-mobile{gap:.75rem!important}}@media(min-width:1024px){.card-grid-mobile{gap:1rem!important}}@media(max-width:640px){.board-row .table-numbers{min-width:7ch!important;height:38px!important;display:inline-flex!important;align-items:center!important;justify-content:center!important;padding:0 12px!important;font-size:14px!important}.board-row .name-box{max-width:100%!important}.board-row .name-track{white-space:normal!important;word-break:break-word;line-height:1.2!important;display:-webkit-box!important;-webkit-box-orient:vertical;-webkit-line-clamp:2;font-size:13px!important}}@media(max-width:640px){.board-row{grid-template-columns:2fr 0.9fr 0.9fr 0.8fr!important}.board-row .name-track{font-size:14px!important;line-height:1.3!important;-webkit-line-clamp:2}.board-row .cell-change-mobile,.board-row .table-numbers span{min-width:60px!important;max-width:60px!important;height:34px!important;font-size:12px!important;line-height:34px!important}}@media(max-width:640px){.board-row .cell-change-mobile,.board-row .table-numbers span{min-width:52px!important;max-width:52px!important;height:34px!important;font-size:12px!important;line-height:34px!important}}@media(max-width:640px){.board-row .pill-buy,.board-row .pill-sell{height:40px!important;min-height:40px!important;line-height:40px!important;padding:0 14px!important;font-size:14px!important;display:inline-flex!important;align-items:center!important;justify-content:center!important}.board-row .cell-change-mobile{min-width:52px!important;max-width:52px!important;height:30px!important;line-height:30px!important;font-size:11px!important;padding:0 6px!important;display:inline-flex!important;align-items:center!important;justify-content:center!important;white-space:nowrap!important}}@media(max-width:640px){.board-row .pill-buy,.board-row .pill-sell{height:40px!important;min-height:40px!important;min-width:92px!important;max-width:92px!important;padding:0 8px!important;font-size:14px!important;line-height:40px!important;white-space:nowrap!important;overflow:hidden!important;text-overflow:clip!important;display:inline-flex!important;align-items:center!important;justify-content:center!important}.board-row .cell-change-mobile{min-width:52px!important;max-width:52px!important;height:30px!important;line-height:30px!important;font-size:11px!important;white-space:nowrap!important}}@media(max-width:640px){.board-row{grid-template-columns:1fr 100px 100px 60px!important}.board-row .name-box{max-width:100%!important}.board-row .name-track{white-space:normal!important;word-break:normal!important;overflow-wrap:anywhere!important;font-size:14px!important;line-height:1.3!important;display:-webkit-box!important;-webkit-box-orient:vertical;-webkit-line-clamp:2}.board-row .currency-cell-mobile{gap:.25rem!important}}@media(max-width:640px){.backdrop .glass-strong{max-height:86vh!important;overflow:auto!important}.form-currency .grid{gap:.6rem!important}.form-currency .fld{height:34px!important;min-height:34px!important;padding:.28rem .6rem!important;font-size:14px!important}.form-currency .btn-row{position:sticky!important;bottom:0!important;background:0 0;padding-top:.5rem!important}.form-currency .btn-row .w-32,.form-currency .btn-row .w-36{height:44px!important}}@media(max-width:640px){.form-currency .fld{height:28px!important;min-height:28px!important;padding:.18rem .5rem!important;font-size:13px!important}}@media(max-width:640px){.form-currency .grid{gap:.45rem!important}.form-currency label.grid{gap:.25rem!important}.form-currency .fld{height:30px!important;min-height:30px!important;padding:.22rem .5rem!important;font-size:13.5px!important}}@media(max-width:640px){.backdrop{align-items:flex-start!important;padding-top:8px!important}.backdrop .glass-strong{margin-top:0!important}}@media(max-width:640px){.toast .glass{font-size:14px!important;line-height:1.1!important;white-space:nowrap!important;max-width:92vw!important;overflow:hidden!important;text-overflow:ellipsis!important;padding:.55rem .8rem!important}}@media(max-width:640px){.themes-grid .view-card{padding:.55rem!important;border-radius:.9rem!important}.themes-grid .view-card.sel{outline-width:2px!important}.themes-grid .view-card .h-16{height:48px!important}.themes-grid .view-card .mb-2{margin-bottom:.35rem!important}.themes-grid .view-card .font-bold{font-size:13.5px!important}.themes-grid .view-card .text-xs{font-size:10.5px!important}}@media(max-width:640px){.themes-grid .view-card{padding:.45rem!important;border-radius:.8rem!important}.themes-grid .view-card .h-16{height:44px!important}.themes-grid .view-card .mb-2{margin-bottom:.3rem!important}.themes-grid .view-card .font-bold{font-size:13px!important}.themes-grid .view-card .text-xs{font-size:10px!important}.themes-grid+.flex.justify-end.gap-2.pt-4>button{height:38px!important;padding-inline:.75rem!important;font-size:14px!important;border-radius:.7rem!important}}@media(max-width:640px){.backdrop .glass-strong{padding:10px!important;max-width:94vw!important;overflow:auto!important}.themes-grid{padding-inline:2px!important;gap:.45rem!important}.themes-grid .view-card{margin:0!important}.themes-grid+.flex.justify-end.gap-2.pt-4{padding-top:.35rem!important;gap:.35rem!important}.themes-grid+.flex.justify-end.gap-2.pt-4>button{margin:0!important}}.bottom-fixed{--footer-h:48px}@media (max-width:640px){.bottom-fixed{--footer-h:40px}}.bg-cover-layer{position:fixed;inset:-15vh 0 -15vh 0;z-index:-1;pointer-events:none}@media(max-width:640px){#body{min-height:100dvh}}@media(max-width:640px){.backdrop{padding-top:16px!important;align-items:flex-start!important}}@media(max-width:640px){.backdrop{padding-top:48px!important;align-items:flex-start!important}}.fab{transition:background .2s ease,transform .15s ease}.menu-panel{margin-top:6px;position:absolute;left:0;top:calc(100% + 4px);margin-top:0}.menu-backdrop{position:fixed;inset:0;z-index:100000}.menu-panel>.glass{max-height:80vh;overflow:auto}.drawer-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.35);z-index:100000}.drawer{position:fixed;top:0;left:0;height:100dvh;width:60vw;background:var(--panel-bg)!important;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border-right:1px solid var(--panel-border)!important;box-shadow:12px 0 28px rgba(0,0,0,.15);transform:translateX(-100%);transition:transform .28s ease;z-index:100001;display:flex;flex-direction:column;border-top-left-radius:14px;border-bottom-left-radius:14px}.drawer.open{transform:translateX(0)}.drawer header{position:sticky;top:0;height:56px;display:flex;align-items:center;justify-content:space-between;flex-direction:row-reverse;padding:0 12px;font-weight:800;background:color-mix(in oklab,var(--panel-bg) 92%,#fff)!important;border-bottom:1px solid var(--panel-border)!important;border-top-left-radius:14px}.drawer header span{flex:1;text-align:right}.drawer header button{flex:0 0 auto}.drawer .content{padding:10px;overflow:auto}.btn-drawer{display:flex;align-items:center;gap:.6rem;padding:.55rem .8rem;border:1px solid #e5e7eb;border-radius:.9rem;background:#fff;font-weight:700;box-shadow:0 1px 3px rgba(0,0,0,.06)}.btn-drawer:active{transform:scale(.98)}.section-title{margin:.5rem .25rem .35rem;font-size:.9rem;color:#374151;font-weight:800}.sep{height:1px;background:#eef2f7;margin:.5rem 0}.fab{transition:background .2s ease,transform .15s ease}@media (min-width:641px){.drawer{width:360px!important}}@media (min-width:1024px){.drawer{width:380px!important}}@media (min-width:1280px){.drawer{width:420px!important}}@media (min-width:641px){.drawer{width:320px!important}}@media (min-width:1024px){.drawer{width:340px!important}}@media (min-width:1280px){.drawer{width:360px!important}}.pick-list .font-extrabold{font-weight:800}@media (max-width:640px){.pick-list{gap:.8rem!important}.pick-list button{padding:.85rem .75rem!important}.pick-list .font-extrabold{font-size:16px}}@media(max-width:640px){.cell-change-mobile{font-size:10px!important}}@media (min-width:641px){.ad-wrap .ad-item{font-size:clamp(24px,2.1vw,46px)!important;font-weight:800!important;letter-spacing:.3px!important;line-height:1.15!important}.ad-wrap .ad-item span{padding-inline:1rem!important}}@media (min-width:1280px){.ad-wrap .ad-item{font-size:clamp(28px,1.9vw,46px)!important}}.bg-fixed-gradient{position:fixed;inset:-25vh 0 -25vh 0;z-index:-1;pointer-events:none}@media (min-width:641px){.change-pill{height:38px!important;min-width:118px!important;padding:0 14px!important;font-size:15px!important;gap:.35rem!important;display:inline-flex!important;align-items:center!important;justify-content:center!important}}@media (min-width:1024px){.change-pill{height:40px!important;min-width:130px!important;font-size:16px!important}}@media (min-width:641px){.card-grid-mobile{align-items:center!important}.card-grid-mobile>div{display:flex;flex-direction:column;align-items:center;gap:.35rem}.card-grid-mobile .pill-card{height:38px!important;min-height:38px!important}}@media (min-width:641px){.card-grid-mobile .pill-card{height:42px!important;min-height:42px!important}.card-grid-mobile .change-pill{height:42px!important;min-height:42px!important}}@media (min-width:1024px){.card-grid-mobile .pill-card{height:44px!important;min-height:44px!important}.card-grid-mobile .change-pill{height:44px!important;min-height:44px!important}}@media (min-width:641px){.card-grid-mobile{gap:1rem!important}.card-grid-mobile>div{gap:.5rem!important}}@media (min-width:1024px){.card-grid-mobile{gap:1.25rem!important}}@media (min-width:641px){.icon-pill-after{background:#cfd8e3!important;color:#111827!important;border:1px solid rgba(17,24,39,.08)!important;display:inline-flex!important;align-items:center}}@media (min-width:641px){.board-head>:first-child,.board-row>:first-child{padding-right:28px!important}}@media (min-width:1024px){.board-head>:first-child,.board-row>:first-child{padding-right:32px!important}}@media (min-width:1536px){.board-head>:first-child,.board-row>:first-child{padding-right:36px!important}}@media (min-width:641px){.hdr{padding-right:0!important}}@media (min-width:641px){.title-box{transform:none!important}}@media (min-width:641px){.hdr{height:102px!important}.banner-box,.logo-box,.title-box{min-height:102px!important;height:102px!important}.title-box{transform:none}}@media (min-width:768px){.hdr{height:102px!important}.banner-box,.logo-box,.title-box{min-height:102px!important;height:102px!important}.title-box{transform:none}}.title-plain{background:0 0!important;border:none!important;box-shadow:none!important}@media (min-width:641px){.hdr{grid-template-columns:calc(35% - 1px) calc(30% - 1px) calc(35% - 1px);gap:0!important}}.banner-box img,.logo-box img{width:100%!important;height:100%!important;object-fit:fill!important}.logo-modal .section{border:1px solid #e5e7eb;border-radius:12px;background:#ffffffcc;backdrop-filter:blur(6px);padding:12px}.logo-modal .section-title{font-weight:800;color:#334155;font-size:.95rem;margin-bottom:.35rem;display:flex;align-items:center;gap:.4rem}.logo-modal .hint{font-size:.78rem;color:#64748b}.logo-modal .row{display:grid;grid-template-columns:1fr;gap:.6rem}@media(min-width:640px){.logo-modal .row{grid-template-columns:220px 1fr}}.logo-modal .preview{display:flex;align-items:center;justify-content:center;width:220px;height:130px;border:1px dashed #cbd5e1;border-radius:10px;background:#fff}.logo-modal .actions{display:flex;gap:.5rem;flex-wrap:wrap}.logo-modal .sticky-actions{position:sticky;bottom:0;background:0 0;padding-top:.5rem}@media (max-width:640px){.banner-box,.logo-box{height:87px!important;min-height:87px!important}.banner-box img,.logo-box img{width:100%!important;height:100%!important;object-fit:fill!important}.hdr{gap:6px!important}.title-plain{padding-block:6px!important}header+.rounded-3xl{margin-top:6px!important}.hdr>*{min-height:87px!important}}@media (max-width:640px){.hdr{gap:3px!important}.title-plain{padding-block:2px!important}}@media (max-width:640px){.title-plain{min-height:40px!important;height:auto!important;padding-block:2px!important;display:flex!important;align-items:center!important;justify-content:center!important}}@media (max-width:640px){.hdr{grid-template-columns:1fr 1fr!important;grid-template-areas:"logo banner" "title title"!important;gap:6px!important;align-items:stretch!important}.logo-box{grid-area:logo!important;aspect-ratio:1/1!important;height:auto!important;min-height:0!important}.banner-box{grid-area:banner!important;aspect-ratio:1/1!important;height:auto!important;min-height:0!important}.title-plain{grid-area:title!important;min-height:0!important;padding-block:6px!important}.hdr>*{min-height:0!important}.banner-box img,.logo-box img{width:100%!important;height:100%!important;object-fit:fill!important}}@media (max-width:640px){.hdr{grid-template-columns:1fr 1fr!important;grid-template-areas:"logo banner" "title title"!important;gap:6px!important}.banner-box,.logo-box{height:72px!important;min-height:72px!important;aspect-ratio:auto!important}.banner-box img,.logo-box img{width:100%!important;height:100%!important;object-fit:fill!important}.title-plain{padding-block:6px!important}}.btn-drawer{background:linear-gradient(135deg,#f8fafc 0,#eef2f7 55%,#e8f0ff 100%)!important;border-color:rgba(148,163,184,.35)!important;color:#0f172a!important;box-shadow:inset 0 2px 8px rgba(15,23,42,.06),0 1px 3px rgba(0,0,0,.06)!important}.btn-drawer:hover{background:linear-gradient(135deg,#eef2f7 0,#e2e8f0 50%,#dde7ff 100%)!important}.btn-drawer:active{transform:scale(.985)!important}.section-title{color:#1f2937!important}.fab{width:56px!important;height:56px!important;border-radius:16px!important;background:radial-gradient(120% 120% at 30% 20%,#ffffffcc 0,#eef2ffcc 45%,#e0e7ffcc 100%)!important;border:1px solid rgba(99,102,241,.35)!important;box-shadow:0 8px 24px rgba(30,58,138,.18),inset 0 1px 0 rgba(255,255,255,.7),inset 0 -1px 0 rgba(99,102,241,.25)!important;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);color:#111827!important;display:flex;align-items:center;justify-content:center;transition:transform .18s ease,box-shadow .25s ease,background .25s ease}@keyframes fab-glow{0%,100%{box-shadow:0 8px 22px rgba(30,58,138,.16),0 0 0 0 rgba(99,102,241,0),inset 0 1px 0 rgba(255,255,255,.7),inset 0 -1px 0 rgba(99,102,241,.25)}50%{box-shadow:0 10px 26px rgba(30,58,138,.2),0 0 0 8px rgba(99,102,241,.06),inset 0 1px 0 rgba(255,255,255,.8),inset 0 -1px 0 rgba(99,102,241,.28)}}@media (max-width:640px){header{position:relative!important}.fab{width:44px!important;height:44px!important;border-radius:12px!important;font-size:20px!important}}@media (max-width:640px){.banner-box,.logo-box{height:63px!important;min-height:63px!important}}@media (max-width:640px){.banner-box,.logo-box{height:60px!important;min-height:60px!important}}@media (max-width:640px){.backdrop{align-items:center!important;justify-content:center!important;padding-top:0!important}.backdrop .glass-strong{margin-top:0!important;max-height:86vh!important}}.th-vipPearl .rounded-3xl{background:linear-gradient(135deg,#f0f9ff,#ecfeff)!important;border-color:#bae6fd!important}.th-vipPearl .btn-drawer{background:linear-gradient(135deg,#f0f9ff,#e6fffb)!important;border-color:#bae6fd!important;color:#0f172a!important}.th-vipPearl .glass-strong{background:rgba(255,255,255,.92)!important;border-color:#bae6fd!important}.th-vipPearl .pill-buy{background:linear-gradient(90deg,#22c55e,#16a34a)!important;color:#fff!important}.th-vipPearl .pill-sell{background:linear-gradient(90deg,#ef4444,#b91c1c)!important;color:#fff!important}.th-vipPearl .change-pill{background:rgba(14,165,233,.15)!important;color:#0369a1!important}body{--th-text:#111827;--th-muted:#6b7280;--th-input-bg:#ffffff;--th-input-text:#111827;--th-input-border:#e5e7eb;--th-placeholder:#9ca3af}.th-vipPearl{--th-text:#0f172a;--th-muted:#475569;--th-input-bg:#ffffff;--th-input-text:#0f172a;--th-input-border:#bae6fd;--th-placeholder:#64748b}.backdrop .glass-strong .fld,body[class*=th-],body[class*=th-] .glass-strong .fld{background:var(--th-input-bg)!important;color:var(--th-input-text)!important;border-color:var(--th-input-border)!important}.backdrop .glass-strong .fld::placeholder,.glass-strong .fld::placeholder{color:var(--th-placeholder)!important;opacity:1!important}.bulk-head>div,.card-label,.pick-list .text-sm,.section-title{color:var(--th-muted)!important}.table-numbers{color:var(--th-text)!important}.change-pill{font-weight:800!important}:root{--th-text:#111827;--th-muted:#475569;--panel-bg:rgba(255,255,255,.96);--panel-text:#111827;--panel-border:#e5e7eb;--chip-bg:#e2e8f0;--chip-text:#111827;--chip-border:rgba(17,24,39,.08);--focus:#60a5fa88}.th-vipPearl{--th-text:#0f172a;--th-muted:#475569;--panel-bg:rgba(255,255,255,.96);--panel-text:#0f172a;--panel-border:#bae6fd;--chip-bg:#dbeafe;--chip-text:#0f172a;--chip-border:#93c5fd;--focus:#06b6d488}.glass-strong,.view-card,body[class*=th-],body[class*=th-] .btn-drawer{border-color:var(--panel-border)!important}.glass-strong{background:var(--panel-bg)!important;color:var(--panel-text)!important}.view-card{background:color-mix(in oklab,var(--panel-bg) 90%,#fff)!important}.btn-drawer{background:linear-gradient(135deg,color-mix(in oklab,var(--panel-bg) 96%,#fff),color-mix(in oklab,var(--panel-bg) 86%,#fff))!important;color:var(--panel-text)!important}.fld{background:var(--panel-bg)!important;color:var(--panel-text)!important;border-color:var(--panel-border)!important}.fld::placeholder{color:color-mix(in oklab,var(--panel-text) 45%,#9ca3af)!important;opacity:1!important}.fld:focus{outline:2px solid var(--focus)!important}.icon-pill-after{background:var(--chip-bg)!important;color:var(--chip-text)!important;border:1px solid var(--chip-border)!important}.table-numbers{color:var(--th-text)!important}.change-pill{font-weight:800!important}.themes-grid .view-card .font-bold,.themes-grid .view-card .text-xs{color:#111827!important;opacity:.95!important}@media (min-width:641px){.cards-view .view-card{padding:.1rem!important}.cards-view .view-card .pill-card{padding-top:0!important;padding-bottom:0!important;padding-inline:.75rem!important}}@media (min-width:641px){.cards-view .card-grid-mobile{margin-top:0!important;gap:0!important}}@media (min-width:641px){.banner-box,.logo-box,.title-box{min-height:102px!important;height:102px!important}}@keyframes name-marquee{0%{transform:translateX(0)}100%{transform:translateX(-100%)}}.pill-buy,.pill-sell{color:#f9fafb!important;font-weight:900!important;text-shadow:-1px 0 1px rgba(0,0,0,.55),1px 0 1px rgba(0,0,0,.55),0 1px 1px rgba(0,0,0,.55),0 -1px 1px rgba(0,0,0,.55)}.cards-view .pill-card.from-green-500,.cards-view .pill-card.from-red-500{color:#f9fafb!important;font-weight:900!important;text-shadow:-1px 0 1px rgba(0,0,0,.55),1px 0 1px rgba(0,0,0,.55),0 1px 1px rgba(0,0,0,.55),0 -1px 1px rgba(0,0,0,.55)}.trade-card .tr-head{display:flex!important;flex-direction:row-reverse!important;justify-content:flex-start!important;align-items:center!important;gap:10px!important;width:100%!important;direction:rtl!important;text-align:right!important;unicode-bidi:plaintext}.trade-card .tr-head *{direction:rtl!important;text-align:right!important}</style><style id="fab-fix">.bottom-fixed{--footer-h:48px}@media (max-width:640px){.bottom-fixed{--footer-h:40px}}.drawer{z-index:100001}.drawer-backdrop{z-index:100000}</style><style id="title-unified">.title-plain h1{background:linear-gradient(to right,#6B21A8,#DB2777,#2563EB);-webkit-background-clip:text;background-clip:text;color:transparent;-webkit-text-fill-color:transparent;filter:drop-shadow(0 1px 1px rgba(0,0,0,.18));white-space:normal;word-break:break-word;word-spacing:normal;letter-spacing:normal;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;overflow:hidden;font-size:clamp(1.5rem,4vw,2.7rem);line-height:1.2;text-align:center;margin:0;padding-inline:2px}@media (max-width:640px){.title-plain h1{font-size:clamp(16px,5vw,20px);line-height:1.15;-webkit-line-clamp:3}}</style><script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script><style id="fs-no-select">.no-select{-webkit-user-select:none !important;-moz-user-select:none !important;-ms-user-select:none !important;user-select:none !important}</style><style id="trade-flag-css">.trade-selwrap{position:relative;width:100%}.trade-selwrap .trade-sel{width:100% !important}.trade-flag{position:absolute;left:14px;top:50%;transform:translateY(-50%);width:32px;height:22px;display:flex;align-items:center;justify-content:center;pointer-events:none}.trade-flag img{width:32px !important;height:22px !important;border-radius:4px;display:block}@media(max-width:640px){.trade-flag{left:12px;width:28px;height:20px}.trade-flag img{width:28px !important;height:20px !important}}.trade-sel{padding-left:54px !important}@media(max-width:640px){.trade-sel{padding-left:48px !important}}</style><style>.tr-card{direction:rtl !important;unicode-bidi:isolate!important}.tr-client,.tr-name,.tr-phone{direction:rtl !important;unicode-bidi:isolate!important;text-align:right}.tr-mid{direction:rtl !important;unicode-bidi:isolate!important}.tr-mid{position:relative;z-index:1}.tr-mid .num{direction:ltr !important;unicode-bidi:isolate !important;font-family:Inter,Roboto,Arial,Tahoma,sans-serif}.tr-mid .act,.tr-mid .who{unicode-bidi:isolate!important}.tr-head{direction:rtl !important;text-align:right}.tr-left{direction:ltr !important}.tr-left .tr-seq,.tr-left .tr-dt{direction:ltr !important;unicode-bidi:isolate !important}.tr-meta-bottom{position:static;margin-top:8px;display:flex;flex-direction:row;align-items:center;gap:10px;direction:ltr;justify-content:flex-start;opacity:.9;font-size:12px;line-height:1;white-space:nowrap}.tr-card.open .tr-meta-bottom{display:none}</style><style id="hdr-order-v21">.tr-card .tr-head{width:100% !important;direction:rtl !important;text-align:right !important}.tr-card .tr-head .tr-client{width:100% !important;display:flex !important;flex-direction:row !important;justify-content:flex-start !important;align-items:center !important;gap:10px !important;flex-wrap:wrap !important;direction:rtl !important;text-align:right !important}.tr-card .tr-head .tr-name{order:1 !important}.tr-card .tr-head .tr-phone{order:2 !important;direction:ltr !important;unicode-bidi:isolate !important;text-align:left !important}.tr-card .tr-head .tr-extras{order:3 !important}</style>
<style id="trade-close-position-fix-v4">.trade-modal{position:relative !important;padding-top:18px !important;padding-left:18px !important}.trade-head .trade-backbtn{position:absolute !important;top:-12px !important;left:-12px !important;right:auto !important;z-index:2000 !important;background:#ef4444 !important;color:#ffffff !important;border:2px solid #dc2626 !important;box-shadow:0 4px 10px rgba(0,0,0,.15)}.trade-head .trade-backbtn:hover{background:#dc2626 !important}</style>
<style id="trade-center-align-v1">.trade-modal .trade-form,.trade-modal .trade-row2,.trade-modal .trade-row3,.trade-modal .trade-field{text-align:center !important}.trade-modal .trade-label{text-align:center !important;justify-content:center !important;align-items:center !important;width:100% !important}.trade-modal .trade-in,.trade-modal .trade-sel,.trade-modal .trade-ratein,.trade-modal .trade-rate-mini-input{text-align:center !important}.trade-modal .trade-selwrap{justify-content:center !important}.trade-modal select.trade-sel{text-align-last:center !important}.trade-modal option{direction:rtl}.trade-modal .trade-field .trade-label{margin-inline:auto !important}.trade-modal .trade-addbox,.trade-modal .trade-muted{text-align:center !important}</style>
<style id="rate-align-adjust">
.trade-rate-mini-input{
    text-align: center !important;
    padding-right: 18px !important; /* slight push to the right */
}
</style>
<script id="sy-flag-override-v1">
(function(){
  // "New" Syria flag override image (green/white/black with 3 red stars).
  // This ONLY replaces the Twemoji-rendered ğŸ‡¸ğŸ‡¾ image, without touching other flags.
  var NEW_SY_SVG = "<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"36\" height=\"24\" viewBox=\"0 0 36 24\" preserveAspectRatio=\"xMidYMid meet\"><rect width=\"36\" height=\"8\" y=\"0\" fill=\"#1FA24A\"/><rect width=\"36\" height=\"8\" y=\"8\" fill=\"#FFFFFF\"/><rect width=\"36\" height=\"8\" y=\"16\" fill=\"#111111\"/><g fill=\"#D62828\"><polygon points=\"12.000,9.600 12.617,11.151 14.283,11.258 12.999,12.324 13.411,13.942 12.000,13.050 10.589,13.942 11.001,12.324 9.717,11.258 11.383,11.151\"/><polygon points=\"18.000,9.600 18.617,11.151 20.283,11.258 18.999,12.324 19.411,13.942 18.000,13.050 16.589,13.942 17.001,12.324 15.717,11.258 17.383,11.151\"/><polygon points=\"24.000,9.600 24.617,11.151 26.283,11.258 24.999,12.324 25.411,13.942 24.000,13.050 22.589,13.942 23.001,12.324 21.717,11.258 23.383,11.151\"/></g></svg>";

  var NEW_SY_SRC = "data:image/svg+xml;utf8," + encodeURIComponent(NEW_SY_SVG);

  function replaceIn(node){
    try{
      if(!node || !node.querySelectorAll) return;
      var imgs = node.querySelectorAll('img[alt="ğŸ‡¸ğŸ‡¾"], img[alt="\\uD83C\\uDDF8\\uD83C\\uDDFE"]');
      imgs.forEach(function(img){
        try{
          img.src = NEW_SY_SRC;
          img.removeAttribute("srcset");
          img.style.borderRadius = "4px";
          img.style.objectFit = "cover";
          // Match the same slot size as other flags, but scale down slightly
          img.style.width = "";
          img.style.height = "";
          img.style.transform = "scale(0.68)";
          img.style.transformOrigin = "center";

        }catch(_){}
      });
    }catch(_){}
  }

  function patch(){
    if(!window.twemoji || window.twemoji.__sy_patched) return;

    var orig = window.twemoji.parse.bind(window.twemoji);
    window.twemoji.parse = function(node, opts){
      var out = orig(node, opts);
      // Replace just after parse
      replaceIn(node);
      return out;
    };

    // also run once for already-rendered DOM
    setTimeout(function(){ replaceIn(document); }, 0);

    window.twemoji.__sy_patched = true;
  }

  if(document.readyState === "loading") document.addEventListener("DOMContentLoaded", patch);
  else patch();
})();
</script>

<style id="modal-compact-v17">
/* Make all modals shorter with internal scroll; keep action buttons reachable */
.backdrop .glass-strong{max-height:78vh; overflow:auto}
.backdrop .glass-strong .btn-row{
  position: sticky;
  bottom: 0;
  background: rgba(255,255,255,.92);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  padding-top: 10px;
  margin-top: 10px;
  border-top: 1px solid rgba(15,23,42,.10);
  z-index: 5;
}
@media(max-width:640px){
  .backdrop .glass-strong{max-height:82vh;}
  .backdrop .glass-strong .btn-row{padding-top:8px;margin-top:8px;}
}
</style>

</head><body class="min-h-screen text-gray-900" id="body"><script id="force-invoice-brand-title">
(function(){
 try {
  var T = "Ø´Ø±ÙƒØ© Ø·ÙŠÙ Ù„Ù„ØµØ±Ø§ÙØ© ÙˆØ§Ù„Ø­ÙˆØ§Ù„Ø§Øª";
  var k = 'taif:title';
  var v = (localStorage.getItem(k)||'').trim();
  if(!v) localStorage.setItem(k, T);
  localStorage.setItem('taif:invoice_brand_title', T);
 } catch(_) {}
})();
</script>

<script id="branch-seed-data-v10">
(function(){
  function safeParse(s){ try{return JSON.parse(s)}catch(_){return null} }
  function isValidList(v){ return Array.isArray(v) && v.length>0 && v.some(x=>x && x.code); }
  function defaultList(){
    return [
      {code:"USD",name:"Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠ",flag:"ğŸ‡ºğŸ‡¸",icon:"USD",ratioBuy:1,ratioSell:1,method:"multiply",buy:15000,sell:15200,decimals:0},
      {code:"EUR",name:"Ø§Ù„ÙŠÙˆØ±Ùˆ",flag:"ğŸ‡ªğŸ‡º",icon:"EUR",ratioBuy:1.08,ratioSell:1.08,method:"multiply",decimals:2},
      {code:"SAR",name:"Ø§Ù„Ø±ÙŠØ§Ù„ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ",flag:"ğŸ‡¸ğŸ‡¦",icon:"SAR",ratioBuy:0.266,ratioSell:0.266,method:"multiply",decimals:2},
      {code:"TRY",name:"Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„ØªØ±ÙƒÙŠØ©",flag:"ğŸ‡¹ğŸ‡·",icon:"TRY",ratioBuy:0.032,ratioSell:0.032,method:"multiply",decimals:2},
      {code:"AED",name:"Ø§Ù„Ø¯Ø±Ù‡Ù… Ø§Ù„Ø¥Ù…Ø§Ø±Ø§ØªÙŠ",flag:"ğŸ‡¦ğŸ‡ª",icon:"AED",ratioBuy:0.272,ratioSell:0.272,method:"multiply",decimals:2},
      {code:"JOD",name:"Ø§Ù„Ø¯ÙŠÙ†Ø§Ø± Ø§Ù„Ø£Ø±Ø¯Ù†ÙŠ",flag:"ğŸ‡¯ğŸ‡´",icon:"JOD",ratioBuy:1.41,ratioSell:1.41,method:"multiply",decimals:2}
    ];
  }
  function seed(){
    try{
      var cur = safeParse(localStorage.getItem("taif:data"));
      if(isValidList(cur)) return;

      var legacy = null;
      try{
        var c = safeParse(localStorage.getItem("taif:cache"));
        if(c && isValidList(c.data)) legacy = c.data;
      }catch(_){}

      var list = legacy || defaultList();
      localStorage.setItem("taif:data", JSON.stringify(list));

      try{
        var cache = safeParse(localStorage.getItem("taif:cache")) || {};
        cache.data = list;
        localStorage.setItem("taif:cache", JSON.stringify(cache));
      }catch(_){}

      try{
        if(window.$db && window.$db.set && window.$db.ref){
          window.$db.set(window.$db.ref("taif/data"), list);
        }
      }catch(_){}

      try{
        var wrap=document.createElement('div');
        wrap.setAttribute('dir','rtl');
        wrap.style.cssText="position:fixed;top:14px;left:50%;transform:translateX(-50%);z-index:2147483647";
        var b=document.createElement('div');
        b.textContent="âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ù„Ù„ÙØ±Ø¹ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹";
        b.style.cssText="background:rgba(17,24,39,.95);color:#fff;border-radius:14px;padding:10px 16px;font:800 14px/1.3 system-ui,Segoe UI,Roboto,Tahoma;box-shadow:0 8px 24px rgba(0,0,0,.25);border:1px solid rgba(255,255,255,.08);max-width:92vw;text-align:center";
        wrap.appendChild(b); document.body.appendChild(wrap);
        setTimeout(function(){ b.style.opacity="0"; b.style.transition="opacity .45s ease"; }, 1200);
        setTimeout(function(){ try{wrap.remove()}catch(_){} }, 2000);
      }catch(_){}
    }catch(_){}
  }
  try{ seed(); }catch(_){}
  window.addEventListener("db-ready", function(){ try{ seed(); }catch(_){} });
})();
</script>

<script id="branch-default-seed-v1">
(function(){
  // Ensure app always has starter data even if DB is empty (especially with branches).
  var DEFAULT_DATA = [
    {code:"USD",name:"Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠ",flag:"ğŸ‡ºğŸ‡¸",icon:"USD",ratioBuy:1,ratioSell:1,method:"multiply",buy:5000,sell:5050,decimals:0},
    {code:"EUR",name:"Ø§Ù„ÙŠÙˆØ±Ùˆ",flag:"ğŸ‡ªğŸ‡º",icon:"EUR",ratioBuy:1.1,ratioSell:1.12,method:"multiply",buy:0,sell:0,decimals:0},
    {code:"SAR",name:"Ø§Ù„Ø±ÙŠØ§Ù„ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ",flag:"ğŸ‡¸ğŸ‡¦",icon:"SAR",ratioBuy:0.27,ratioSell:0.275,method:"multiply",buy:0,sell:0,decimals:0},
    {code:"AED",name:"Ø§Ù„Ø¯Ø±Ù‡Ù… Ø§Ù„Ø¥Ù…Ø§Ø±Ø§ØªÙŠ",flag:"ğŸ‡¦ğŸ‡ª",icon:"AED",ratioBuy:0.272,ratioSell:0.273,method:"multiply",buy:0,sell:0,decimals:0},
    {code:"TRY",name:"Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„ØªØ±ÙƒÙŠØ©",flag:"ğŸ‡¹ğŸ‡·",icon:"TRY",ratioBuy:0.03,ratioSell:0.031,method:"multiply",buy:0,sell:0,decimals:0},
    {code:"JOD",name:"Ø§Ù„Ø¯ÙŠÙ†Ø§Ø± Ø§Ù„Ø£Ø±Ø¯Ù†ÙŠ",flag:"ğŸ‡¯ğŸ‡´",icon:"JOD",ratioBuy:1.41,ratioSell:1.42,method:"multiply",buy:0,sell:0,decimals:0}
  ];

  // expose a default seed map for branch DB fallback seeding
  try{
  window.__TAIF_DEFAULT_SEED__ = window.__TAIF_DEFAULT_SEED__ || {
    data: DEFAULT_DATA,
    banner: {"color":"#000","texts":["ğŸ“¢ Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒÙ…","ğŸ’µ Ø£Ø³Ø¹Ø§Ø±Ù†Ø§ ØªÙ†Ø§ÙØ³ÙŠØ© ÙŠÙˆÙ…ÙŠÙ‹Ø§","ğŸŒ ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§"],"moveDur":1.5,"stayDur":3},
    title: "Ù„ÙˆØ­Ø© Ø£Ø³Ø¹Ø§Ø± ØµØ±Ù Ø§Ù„Ø¹Ù…Ù„Ø§Øª",
    logo: "",
    bannerImg: "",
    datetime: {"is12":false,"autoTime":true,"time":"","date":""},
    tradeSettings: {"fields": []},
    viewMode: "cards",
    customTheme: "",
    base: {"date":"2026-01-01","base":5000}
  };
  }catch(_){}

  function safeJSONParse(s, fb){ try { return JSON.parse(s); } catch(_) { return fb; } }
  function ensureCache(){
    try{
      var KEY = "taif:cache";
      var cur = safeJSONParse(localStorage.getItem(KEY)||"null", null) || {};
      var data = cur && cur.data;
      if(!Array.isArray(data) || data.length===0){
        cur = (cur && typeof cur==="object") ? cur : {};
        cur.data = DEFAULT_DATA;
        if(!cur.version){
          try{ cur.version = localStorage.getItem("taif:app_version") || "seed"; }catch(_){}
        }
        localStorage.setItem(KEY, JSON.stringify(cur));
      }
      // also keep a quick local fallback for branch-scoped data
      try{
        var b = localStorage.getItem("taif:branch") || "main";
        var bkey = "taif:cache:branch:" + b;
        var bcur = safeJSONParse(localStorage.getItem(bkey)||"null", null) || {};
        if(!Array.isArray(bcur.data) || bcur.data.length===0){
          bcur.data = (Array.isArray(cur.data) && cur.data.length) ? cur.data : DEFAULT_DATA;
          bcur.version = cur.version || "seed";
          localStorage.setItem(bkey, JSON.stringify(bcur));
        }
      }catch(_){}
    }catch(_){}
  }
  ensureCache();
})();
</script>

<div class="bg-fixed-gradient bg-gradient-to-tr from-cyan-200 via-white to-cyan-200" id="bgfix"></div><div id="root"></div><script crossorigin="" defer="" src="https://unpkg.com/react@18/umd/react.production.min.js"></script><script crossorigin="" defer="" src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script><script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script><script>!function(){const t=window.supabase?(window.__TAIF_SUPA__||(window.__TAIF_SUPA__=window.supabase.createClient("https://rzabluqawcyhedcvmyut.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ6YWJsdXFhd2N5aGVkY3ZteXV0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExODMxMTQsImV4cCI6MjA4Njc1OTExNH0.EWbcZ4jliSKtlY3rk303EkcUfNDqJhOKDRAP2kxPCxE",{realtime:{params:{eventsPerSecond:3}}}))):null,e=new Map,n=new Map;function a(t){try{const e=n.get(t);e&&(clearInterval(e),n.delete(t))}catch(t){}}async function i(e,n){await t.from("app_state").upsert([{key:e,value:n}],{onConflict:"key"})}function s(e,n,a,i){const s=`realtime_${e}_${i||"all"}`,c=t.channel(s).on("postgres_changes",{event:"*",schema:"public",table:e,filter:n},async()=>{try{await a()}catch(t){}});c.subscribe();try{a&&a()}catch(t){}return c}const c={ref:t=>({key:t}),async set(e,n){const a="string"==typeof e?e:e&&e.key;if(a){if(a.startsWith("taif/users/")){const e=a.split("/")[2];if(null==n)return void await t.from("users").delete().eq("username",e);const i=Object.assign({username:e},n||{});return void await t.from("users").upsert([i],{onConflict:"username"})}if(null==n){if("taif/adminactionslog"===a)return;try{await t.from("app_state").delete().eq("key",a)}catch(_){ }return}"taif/users"!==a&&("taif/adminactionslog"!==a||null!=n?a.startsWith("taif/adminactionslog/")?await i(a,n||{}):"taif/base"===a&&n&&"object"==typeof n&&n.date&&n.base?await i("taif/base",n):await i(a,n):null)}},onValue(i,c){const o="string"==typeof i?i:i&&i.key;if(!o)return null;let r=null;const l=async()=>{try{let e;e="taif/users"===o?await async function(){const{data:e}=await t.from("users").select("*"),n={};return(e||[]).forEach(t=>{n[t.username]=t}),n}():o.startsWith("taif/adminactionslog")?await async function(){return {}}():await async function(e){const{data:n,error:a}=await t.from("app_state").select("value").eq("key",e).maybeSingle();return a?null:n&&"value"in n?n.value:null}(o);const n=JSON.stringify(e);n!==r&&(r=n,c(function(t){return{val:()=>t}}(e)))}catch(t){}};let u;(async()=>{await l()})(),u="taif/users"===o?s("users",void 0,l,"users"):o.startsWith("taif/adminactionslog")?null:s("app_state",`key=eq.${o}`,l,o),e.set(o,u);try{const t=()=>{const t="undefined"!=typeof document&&"hidden"===document.visibilityState?3e4:7e3;a(o);const e=setInterval(()=>{l()},t);n.set(o,e)};t();const e=()=>{t()};"undefined"!=typeof document&&document.addEventListener("visibilitychange",e),u&&(u.__visHandler=e)}catch(t){}return u},off(n){const i="string"==typeof n?n:n&&n.key,s=e.get(i);if(s){try{t.removeChannel(s)}catch(t){}try{s.__visHandler&&"undefined"!=typeof document&&(document.removeEventListener("visibilitychange",s.__visHandler),s.__visHandler=null)}catch(t){}e.delete(i)}a(i)}};window.$db=c,window.dispatchEvent(new Event("db-ready"))}();</script>
<script id="branch-multi-tenant-v1">
(function(){
  // ===== Branch (multi-tenant) layer =====
  var BR_KEY = "taif:branch_id";
  var BR_NAME_KEY = "taif:branch_name";
  var BR_LIST_KEY = "taif:branches_cache"; // local cache for login dropdown
  var DEFAULT_BRANCH = "main";

  function getBranchId(){
    try{ return (localStorage.getItem(BR_KEY)||"").trim() || DEFAULT_BRANCH; }catch(_){ return DEFAULT_BRANCH; }
  }
  function setBranchId(id, name){
    id = String(id||"").trim() || DEFAULT_BRANCH;
    try{ localStorage.setItem(BR_KEY, id); }catch(_){}
    if(name!=null){
      try{ localStorage.setItem(BR_NAME_KEY, String(name||"").trim()); }catch(_){}
    }
  }
  function getBranches(){
    try{
      var raw = localStorage.getItem(BR_LIST_KEY);
      var arr = raw ? JSON.parse(raw) : null;
      if(Array.isArray(arr) && arr.length) return arr;
    }catch(_){}
    return [{id:DEFAULT_BRANCH, name:"Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ"}];
  }
  function setBranches(arr){
    try{
      if(!Array.isArray(arr)) return;
      // normalize
      var out = arr
        .map(function(b){
          if(!b) return null;
          var id = String(b.id||"").trim();
          var name = String(b.name||"").trim();
          if(!id) return null;
          if(!name) name = id===DEFAULT_BRANCH ? "Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ" : ("ÙØ±Ø¹ " + id);
          return {id:id, name:name};
        })
        .filter(Boolean);
      if(!out.length) out = [{id:DEFAULT_BRANCH, name:"Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ"}];
      localStorage.setItem(BR_LIST_KEY, JSON.stringify(out));
    }catch(_){}
  }

  
  // ===== localStorage scoping (FULL isolation per branch) =====
  (function(){
    try{
      if(!window.localStorage || localStorage.__taifBranchScoped) return;
      var _get = localStorage.getItem.bind(localStorage);
      var _set = localStorage.setItem.bind(localStorage);
      var _rem = localStorage.removeItem.bind(localStorage);

      function isGlobalLSKey(k){
        if(!k) return true;
        if(k === BR_KEY || k === BR_NAME_KEY || k === BR_LIST_KEY) return true;
        if(k === "taif:session" || k === "taif:session_token") return true;
        if(k === "taif:device_id" || k === "taif:app_version") return true;
        if(String(k).startsWith("taif:session/")) return true;
        return false;
      }
      function mapLSKey(k){
        k = String(k||"");
        if(!k.startsWith("taif:")) return k;
        if(isGlobalLSKey(k)) return k;
        var bid = getBranchId();
        return k + "@@" + bid;
      }

      localStorage.getItem = function(k){
        try{
          var mk = mapLSKey(k);
          var v = _get(mk);
          if(v==null){
            // backward-compat: fallback to legacy key once, then migrate
            var legacy = _get(String(k||""));
            if(legacy!=null){
              try{ _set(mk, legacy); }catch(_){}
              return legacy;
            }
          }
          return v;
        }catch(_){ return _get(k); }
      };
      localStorage.setItem = function(k,v){
        try{ return _set(mapLSKey(k), String(v)); }catch(_){ return _set(k, String(v)); }
      };
      localStorage.removeItem = function(k){
        try{ return _rem(mapLSKey(k)); }catch(_){ return _rem(k); }
      };

      localStorage.__taifBranchScoped = true;
    }catch(_){}
  })();

// expose helpers
  window.__taif_branchId = getBranchId;
  window.__taif_setBranch = setBranchId;
  window.__taif_getBranches = getBranches;

  // ===== DB key mapping (branch scoped) =====
  function isGlobalKey(k){
    // global keys: session lock, device, version, branches list
    return (
      k === "taif/branches" ||
      k === "taif:branches" ||
      k.indexOf("taif/session/") === 0 ||
      k.indexOf("taif:session") === 0 ||
      k === "taif:device_id" ||
      k === "taif:app_version"
    );
  }
  function shouldScopeKey(k){
    if(!k || typeof k !== "string") return false;
    if(isGlobalKey(k)) return false;
    if(k === "taif/users" || k.indexOf("taif/users/")===0) return false; // handled separately (prefix usernames)
    if(k === "taif/adminactionslog" || k.indexOf("taif/adminactionslog/")===0) return false; // handled separately (branch field)
    // scope all taif/* keys (slash) by default
    return (k.indexOf("taif/")===0);
  }
  function mapScopedKey(k){
    if(!shouldScopeKey(k)) return k;
    var bid = getBranchId();
    var rest = k.slice("taif/".length);
    return "taif/branch/" + bid + "/" + rest;
  }

  function userStoreName(rawUsername){
    rawUsername = String(rawUsername||"").trim();
    if(!rawUsername) return rawUsername;
    if(rawUsername === "emergency") return rawUsername;
    var bid = getBranchId();
    return bid + "::" + rawUsername;
  }
  function userUnstoreName(storedUsername){
    storedUsername = String(storedUsername||"").trim();
    if(!storedUsername) return storedUsername;
    if(storedUsername === "emergency") return storedUsername;
    var bid = getBranchId() + "::";
    if(storedUsername.indexOf(bid)===0) return storedUsername.slice(bid.length);
    return null; // belongs to another branch
  }

  // Patch $db if present (created before React app)
  function patchDB(){
    try{
      if(!window.$db || window.$db.__branchPatched) return;

      var origRef = window.$db.ref.bind(window.$db);
      var origSet = window.$db.set.bind(window.$db);
      var origOn = window.$db.onValue.bind(window.$db);
      var origOff = window.$db.off.bind(window.$db);

      window.$db.ref = function(k){
        // Keep the "logical" key in objects, but store mapped key for DB
        try{
          if(typeof k !== "string") k = (k && k.key) ? k.key : "";
          var logical = String(k||"");
          var mapped = mapScopedKey(logical);
          // keep logical for later detection but carry mapped under _mapped
          return { key: logical, _mapped: mapped };
        }catch(_){
          return origRef(k);
        }
      };

      window.$db.set = async function(refOrPath, value){
        try{
          var logical = (typeof refOrPath === "string") ? refOrPath : (refOrPath && refOrPath.key);
          var mapped = (refOrPath && refOrPath._mapped) ? refOrPath._mapped : mapScopedKey(logical);

          // Users: store with branch prefix in username
          if(typeof logical === "string" && logical.indexOf("taif/users/")===0){
            var u = logical.split("/")[2] || "";
            var su = userStoreName(u);
            return origSet("taif/users/" + su, value);
          }

          // Sessions (device lock): keep per-branch by mapping username the same way as users
          if(typeof logical === "string" && logical.indexOf("taif/session/")===0){
            var u2 = logical.split("/")[2] || "";
            var su2 = (u2.indexOf("::")>-1 || u2==="emergency") ? u2 : userStoreName(u2);
            return origSet("taif/session/" + su2, value);
          }

          // Admin logs: fully branch-isolated (stored in app_state, NOT adminactionslog table)
          if(typeof logical === "string" && (logical === "taif/adminactionslog" || logical.indexOf("taif/adminactionslog/")===0)){
            try{
              var bid = getBranchId();
              var storeKey = "taif/branch/" + bid + "/adminactionslog";
              // Clear all logs for this branch
              if(logical === "taif/adminactionslog" && (value==null)){
                return origSet(storeKey, null);
              }
              // Insert/update one log entry
              if(logical.indexOf("taif/adminactionslog/")===0){
                var id = logical.split("/")[2] || (Date.now()+"_"+Math.random().toString(36).slice(2));
                // ensure object
                var row = (value && typeof value==="object") ? Object.assign({}, value) : { value: value };
                // stamp branch and time
                try{ row.branch = bid; }catch(_){}
                if(row.at==null) try{ row.at = Date.now(); }catch(_){}
                // transactional merge (read-modify-write) to avoid losing other items
                try{
                  var supa = (window.__TAIF_SUPA__ || window.__TAIF_SUPA__ || (window.supabase && window.supabase.createClient && window.supabase.createClient("https://rzabluqawcyhedcvmyut.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ6YWJsdXFhd2N5aGVkY3ZteXV0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExODMxMTQsImV4cCI6MjA4Njc1OTExNH0.EWbcZ4jliSKtlY3rk303EkcUfNDqJhOKDRAP2kxPCxE")));
                  if(supa && supa.from){
                    return (async function(){
                      var cur = {};
                      try{
                        var res = await supa.from("app_state").select("value").eq("key", storeKey).maybeSingle();
                        if(res && res.data && res.data.value && typeof res.data.value==="object") cur = res.data.value;
                      }catch(_){}
                      cur = (cur && typeof cur==="object") ? cur : {};
                      cur[id] = row;
                      await origSet(storeKey, cur);
                      return;
                    })();
                  }
                }catch(_){}
                // fallback (best-effort): overwrite single key object
                var obj = {}; obj[id]=row;
                return origSet(storeKey, obj);
              }
              // If someone sets the whole log object, just store it per branch
              if(value && typeof value === "object"){
                return origSet(storeKey, value);
              }
              return origSet(storeKey, value);
            }catch(_){
              return origSet(refOrPath, value);
            }
          }

          // App-state scoped keys: pass mapped through
          if(typeof logical === "string" && shouldScopeKey(logical)){
            return origSet(mapped, value);
          }

          // fallback
          return origSet(refOrPath, value);
        }catch(_){
          return origSet(refOrPath, value);
        }
      };

      window.$db.onValue = function(refOrPath, cb){
        var logical = (typeof refOrPath === "string") ? refOrPath : (refOrPath && refOrPath.key);
        var mapped = (refOrPath && refOrPath._mapped) ? refOrPath._mapped : mapScopedKey(logical);

        // Users list: filter to current branch and strip prefix
        if(String(logical)==="taif/users"){
          return origOn("taif/users", function(snap){
            try{
              var all = snap && snap.val ? (snap.val()||{}) : {};
              var out = {};
              Object.keys(all||{}).forEach(function(stored){
                var raw = userUnstoreName(stored);
                if(raw){
                  out[raw] = Object.assign({}, all[stored]||{}, { __stored: stored, username: raw });
                }else if(stored === "emergency"){
                  // Show emergency only if you are emergency
                  try{
                    var ss = JSON.parse(localStorage.getItem("taif:session")||"null");
                    if(ss && ss.username==="emergency") out["emergency"] = Object.assign({}, all[stored]||{}, { __stored: stored, username: "emergency" });
                  }catch(_){}
                }
              });
              cb && cb({ val: function(){ return out; }});
            }catch(_){
              cb && cb(snap);
            }
          });
        }

        // Session lock: map to stored username (branch-aware)
        if(String(logical).indexOf("taif/session/")===0){
          try{
            var u2 = String(logical).split("/")[2] || "";
            var su2 = (u2.indexOf("::")>-1 || u2==="emergency") ? u2 : userStoreName(u2);
            var storeKey = "taif/session/" + su2;
            return origOn(storeKey, cb);
          }catch(_){
            return origOn(refOrPath, cb);
          }
        }

        // Admin logs: fully branch-isolated (stored in app_state)
        if(String(logical).indexOf("taif/adminactionslog")===0){
          try{
            var bid = getBranchId();
            var storeKey = "taif/branch/" + bid + "/adminactionslog";
            return origOn(storeKey, function(snap){
              try{
                var v = snap && snap.val ? snap.val() : null;
                if(v==null) v = {};
                cb && cb({ val: function(){ return (v && typeof v==="object") ? v : {}; } });
              }catch(_){
                cb && cb(snap);
              }
            });
          }catch(_){
            return origOn("taif/adminactionslog", cb);
          }
        }

// Scoped keys
if(shouldScopeKey(String(logical||""))){
  // Smart branch seeding:
  // If branch-scoped key doesn't exist yet, copy template from global taif/<key> once.
  try{
    var bid2 = getBranchId();
    var templateKey = String(logical||"");
    // only for core config keys that exist in your initial DB seed
    var core = (
      templateKey === "taif/data" ||
      templateKey === "taif/banner" ||
      templateKey === "taif/title" ||
      templateKey === "taif/logo" ||
      templateKey === "taif/bannerImg" ||
      templateKey === "taif/datetime" ||
      templateKey === "taif/base" ||
      templateKey === "taif/tradeSettings" ||
      templateKey === "taif/viewMode" ||
      templateKey === "taif/customTheme"
    );
    if(core){
      return origOn(mapped, function(snap){
        try{
          var v = snap && snap.val ? snap.val() : null;
          var empty = (v==null) || (Array.isArray(v) && v.length===0) || (typeof v==="object" && !Array.isArray(v) && Object.keys(v||{}).length===0);
          if(!empty){
            cb && cb(snap);
            return;
          }
        }catch(_){}
        // Branch missing: provide fallback from global seed immediately, then write it to branch in background
        (async function(){
          try{
            var supa2 = window.__TAIF_SUPA__;
            if(!supa2 && window.supabase && window.supabase.createClient){
              supa2 = (window.__TAIF_SUPA__ || (window.__TAIF_SUPA__ = window.supabase.createClient(
                "https://rzabluqawcyhedcvmyut.supabase.co",
                "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ6YWJsdXFhd2N5aGVkY3ZteXV0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExODMxMTQsImV4cCI6MjA4Njc1OTExNH0.EWbcZ4jliSKtlY3rk303EkcUfNDqJhOKDRAP2kxPCxE"
              )));
            }
            var fallback = null;
            // 1) Try global DB seed: taif/<...>
            if(supa2 && supa2.from){
              try{
                var res = await supa2.from("app_state").select("value").eq("key", templateKey).maybeSingle();
                if(res && res.data && ("value" in res.data)) fallback = res.data.value;
              }catch(_){}
            }
            // 2) Try legacy local cache (non-branch) if exists
            if(fallback==null){
              try{
                var legacy = JSON.parse((window.localStorage && window.localStorage.getItem) ? (window.localStorage.getItem("taif:cache")||"null") : "null");
                if(legacy && legacy.data && templateKey==="taif/data") fallback = legacy.data;
                if(legacy && legacy.banner && templateKey==="taif/banner") fallback = legacy.banner;
                if(legacy && legacy.title && templateKey==="taif/title") fallback = legacy.title;
                if(legacy && legacy.logo && templateKey==="taif/logo") fallback = legacy.logo;
                if(legacy && legacy.bannerImg && templateKey==="taif/bannerImg") fallback = legacy.bannerImg;
              }catch(_){}
            }
            // 3) If still null, use built-in default seed (from branch-seed-data-v10)
            if(fallback==null && typeof window.__TAIF_DEFAULT_SEED__==="object" && window.__TAIF_DEFAULT_SEED__){
              try{
                var map = window.__TAIF_DEFAULT_SEED__;
                var k2 = templateKey.replace("taif/","");
                if(k2 in map) fallback = map[k2];
              }catch(_){}
            }

            // Send fallback to UI now
            try{
              cb && cb({ val: function(){ return fallback; }});
            }catch(_){}

            // Write to branch key once (best effort)
            try{
              if(fallback!=null){
                await origSet(mapped, fallback);
              }
            }catch(_){}
          }catch(_){}
        })();
      });
    }
  }catch(_){}
  return origOn(mapped, cb);
}

        return origOn(refOrPath, cb);
      };

      window.$db.off = function(refOrPath){
        try{
          var logical = (typeof refOrPath === "string") ? refOrPath : (refOrPath && refOrPath.key);
          var mapped = (refOrPath && refOrPath._mapped) ? refOrPath._mapped : mapScopedKey(logical);

          // Session lock: unsubscribe using stored username key
          if(String(logical||"").indexOf("taif/session/")===0){
            var u2 = String(logical).split("/")[2] || "";
            var su2 = (u2.indexOf("::")>-1 || u2==="emergency") ? u2 : userStoreName(u2);
            return origOff("taif/session/" + su2);
          }

          if(shouldScopeKey(String(logical||""))) return origOff(mapped);
          return origOff(refOrPath);
        }catch(_){
          return origOff(refOrPath);
        }
      };

      window.$db.__branchPatched = true;
    }catch(_){}
  }

  // ===== Branches sync (from DB, global) =====
  async function syncBranches(){
    try{
      var supa = window.__TAIF_SUPA__;
      if(!supa && window.supabase && window.supabase.createClient){
        try{
          supa = (window.__TAIF_SUPA__ || (window.__TAIF_SUPA__ = window.supabase.createClient(
            "https://rzabluqawcyhedcvmyut.supabase.co",
            "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ6YWJsdXFhd2N5aGVkY3ZteXV0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExODMxMTQsImV4cCI6MjA4Njc1OTExNH0.EWbcZ4jliSKtlY3rk303EkcUfNDqJhOKDRAP2kxPCxE"
          )));
        }catch(_){}
      }
      if(!supa) return;

      var row = await supa.from("app_state").select("value").eq("key","taif:branches").maybeSingle();
      var v = row && row.data && row.data.value;
      if(v && Array.isArray(v)) setBranches(v);
    }catch(_){}
  }

  // ===== Login UI injection (branch selector) =====
  function injectLoginBranchSelector(){
    try{
      var box = document.querySelector('h2');
      if(!box) return;
      if((box.textContent||"").trim() !== "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„") return;
      var form = box.parentElement && box.parentElement.querySelector("form");
      if(!form || form.__branchInjected) return;

      form.__branchInjected = true;

      var labels = form.querySelectorAll("label");
      if(!labels || !labels.length) return;

      var first = labels[0];
      var wrap = document.createElement("label");
      wrap.className = first.className || "";
      wrap.style.display = "grid";
      wrap.style.gap = "0.25rem";

      var span = document.createElement("span");
      span.className = first.querySelector("span") ? first.querySelector("span").className : "text-sm text-gray-600";
      span.textContent = "Ø§Ù„ÙØ±Ø¹";

      var sel = document.createElement("select");
      sel.className = first.querySelector("input") ? first.querySelector("input").className : "fld w-full";
      sel.style.fontWeight = "800";
      sel.dir = "rtl";

      var bid = getBranchId();
      var branches = getBranches();
      // ensure current branch exists
      if(!branches.some(function(b){return b && b.id===bid;})){
        branches.unshift({id:bid, name:(function(){try{return localStorage.getItem(BR_NAME_KEY)||bid}catch(_){return bid}})()});
      }
      sel.innerHTML = branches.map(function(b){
        return '<option value="'+String(b.id).replace(/"/g,'&quot;')+'" '+(b.id===bid?'selected':'')+'>'+String(b.name||b.id).replace(/</g,'&lt;')+'</option>';
      }).join("");

      sel.addEventListener("change", function(){
        var id = sel.value;
        var name = "";
        try{
          var b = getBranches().find(function(x){return x.id===id;});
          name = b ? b.name : "";
        }catch(_){}
        setBranchId(id, name);
        // hard reload is safest because listeners will re-bind to new branch
        try{ location.reload(); }catch(_){}
      });

      wrap.appendChild(span);
      wrap.appendChild(sel);

      // Insert before username label
      form.insertBefore(wrap, first);
    }catch(_){}
  }

  // ===== Drawer button injection (emergency only) =====
  function ensureBranchManagerButton(){
    try{
      var drawer = document.querySelector(".drawer.open .content");
      if(!drawer) return;
      if(drawer.querySelector('[data-branch-btn="1"]')) return;

      var sess=null;
      try{ sess = JSON.parse(localStorage.getItem("taif:session")||"null"); }catch(_){}
      if(!sess || sess.role!=="emergency") return;

      var btn = document.createElement("button");
      btn.type = "button";
      btn.className = "btn-drawer";
      btn.textContent = "ğŸ¢ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙØ±ÙˆØ¹";
      btn.setAttribute("data-branch-btn","1");

      btn.addEventListener("click", function(){
        try{ openBranchManager(); }catch(_){}
      });

      // put it near manageUsers if exists
      var anchor = Array.from(drawer.querySelectorAll(".btn-drawer")).find(function(b){
        return (b.textContent||"").includes("Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†");
      });
      if(anchor && anchor.parentElement){
        anchor.parentElement.insertBefore(btn, anchor.nextSibling);
      }else{
        drawer.appendChild(btn);
      }
    }catch(_){}
  }

  function modal(html){
    var bd = document.createElement("div");
    bd.style.cssText = "position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:2147482000;display:flex;align-items:center;justify-content:center;padding:14px";
    var card = document.createElement("div");
    card.style.cssText = "width:min(760px,94vw);max-height:86vh;overflow:auto;background:#fff;border-radius:18px;box-shadow:0 18px 55px rgba(0,0,0,.28);border:1px solid rgba(15,23,42,.12);padding:14px;direction:rtl;font:900 14px/1.3 system-ui,Segoe UI,Roboto,Tahoma;color:#0f172a";
    card.innerHTML = html;
    bd.appendChild(card);
    function close(){ try{bd.remove()}catch(_){} }
    bd.addEventListener("click", function(e){ if(e.target===bd) close(); });
    card.querySelectorAll("[data-close]").forEach(function(x){ x.addEventListener("click", close); });
        // ensure clickable even if global handlers interfere
    try{ bd.style.pointerEvents = "auto"; }catch(_){}
    try{ box.style.pointerEvents = "auto"; }catch(_){}
    // capture-phase fallback (some screens have global click blockers)
    try{
      var __taifLogoutCapture = function(ev){
        var t = ev && ev.target;
        if(!t) return;
        var el = (t.closest ? t.closest('#taif-logout-cancel,#taif-logout-ok') : null);
        var id = (t.id || (el && el.id) || '');
        if(id === 'taif-logout-cancel'){
          ev.preventDefault(); ev.stopPropagation(); if(ev.stopImmediatePropagation) ev.stopImmediatePropagation();
          close();
        }else if(id === 'taif-logout-ok'){
          ev.preventDefault(); ev.stopPropagation(); if(ev.stopImmediatePropagation) ev.stopImmediatePropagation();
          try{ box.querySelector('#taif-logout-ok').disabled = true; }catch(_){}
          try{ box.querySelector('#taif-logout-cancel').disabled = true; }catch(_){}
          doLogout();
        }
      };
      document.addEventListener('click', __taifLogoutCapture, true);
      var __oldClose = close;
      close = function(){
        try{ document.removeEventListener('click', __taifLogoutCapture, true); }catch(_){}
        return __oldClose();
      };
    }catch(_){}
document.body.appendChild(bd);
    return { el: bd, card: card, close: close };
  }

  async function readAppState(supa, key){
    try{
      var r = await supa.from("app_state").select("value").eq("key", key).maybeSingle();
      return r && r.data ? r.data.value : null;
    }catch(_){ return null; }
  }
  async function writeAppState(supa, key, value){
    try{
      await supa.from("app_state").upsert([{ key:key, value:value }], { onConflict:"key" });
      return true;
    }catch(_){ return false; }
  }

  async function cloneBranchData(supa, fromId, toId){
    // Copy a minimal set of keys as a starting template
    var keys = ["data","banner","title","logo","bannerImg","datetime","base","tradeSettings","customTheme","viewMode"];
    for(var i=0;i<keys.length;i++){
      var k = keys[i];
      var fromKey = "taif/branch/" + fromId + "/" + k;
      var toKey   = "taif/branch/" + toId   + "/" + k;
      var v = await readAppState(supa, fromKey);
      if(v==null){
        // allow empty
        continue;
      }
      await writeAppState(supa, toKey, v);
    }
  }

  function safeIdFromName(name){
    name = String(name||"").trim();
    // create stable-ish id: ascii + random
    var base = name
      .toLowerCase()
      .replace(/\s+/g,"-")
      .replace(/[^a-z0-9\u0600-\u06FF\-]/g,"")
      .slice(0,16);
    if(!base) base = "branch";
    return base + "-" + Math.random().toString(36).slice(2,6);
  }

  function openBranchManager(){
    var branches = getBranches();
    var bid = getBranchId();
    var body = [
      '<div style="display:flex;align-items:center;justify-content:space-between;gap:10px">',
      ' <div style="font:1000 18px/1 system-ui,Segoe UI,Roboto,Tahoma">ğŸ¢ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙØ±ÙˆØ¹</div>',
      ' <button data-close type="button" style="border:0;background:#ef4444;color:#fff;border-radius:12px;padding:8px 12px;font:1000 14px/1 system-ui,Segoe UI,Roboto,Tahoma;cursor:pointer">Ø¥ØºÙ„Ø§Ù‚</button>',
      '</div>',
      '<div style="margin-top:10px;border:1px solid rgba(15,23,42,.12);border-radius:14px;overflow:hidden">',
      branches.map(function(b){
        var active = (b.id===bid);
        return '<div style="display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px 12px;border-bottom:1px solid rgba(15,23,42,.10);'+(active?'background:rgba(34,197,94,.10)':'')+'">'+
               '<div><div style="font:1000 15px/1.2">'+(b.name||b.id)+'</div><div style="opacity:.65;font:800 12px/1.2">ID: '+b.id+'</div></div>'+
               '<div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap;justify-content:flex-start">'+'<button type="button" data-sel="'+b.id+'" style="border:1px solid rgba(15,23,42,.12);background:#fff;border-radius:12px;padding:8px 10px;font:1000 13px/1;cursor:pointer">'+(active?'âœ… Ø§Ù„Ø­Ø§Ù„ÙŠ':'Ø§Ø®ØªÙŠØ§Ø±')+'</button>'+'<button type="button" data-ren="'+b.id+'" style="border:1px solid rgba(59,130,246,.28);background:rgba(59,130,246,.10);color:#1e40af;border-radius:12px;padding:8px 10px;font:1000 13px/1;cursor:pointer">âœï¸ ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø³Ù…</button>'+(!active && b.id!==DEFAULT_BRANCH ? '<button type="button" data-del="'+b.id+'" style="border:1px solid rgba(239,68,68,.28);background:rgba(239,68,68,.10);color:#991b1b;border-radius:12px;padding:8px 10px;font:1000 13px/1;cursor:pointer">ğŸ—‘ Ø­Ø°Ù</button>' : '')+'</div>'+
               '</div>';
      }).join("") +
      '</div>',
      '<div style="margin-top:12px;border:1px dashed rgba(15,23,42,.18);border-radius:14px;padding:12px;background:rgba(248,250,252,.9)">',
      ' <div style="font:1000 15px/1; margin-bottom:10px">â• Ø¥Ù†Ø´Ø§Ø¡ ÙØ±Ø¹ Ø¬Ø¯ÙŠØ¯</div>',
      ' <div style="display:grid;gap:8px">',
      '  <label style="display:grid;gap:6px"><span style="opacity:.75">Ø§Ø³Ù… Ø§Ù„ÙØ±Ø¹</span><input id="br-name" class="fld" placeholder="Ù…Ø«Ø§Ù„: ÙØ±Ø¹ Ø¯Ù…Ø´Ù‚" style="height:46px;border-radius:14px;border:1px solid rgba(15,23,42,.12);padding:0 12px;font:900 15px/1 system-ui,Segoe UI,Roboto,Tahoma"/></label>',
      '  <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-start">',
      '    <button type="button" id="br-create" style="background:#16a34a;color:#fff;border:0;border-radius:14px;padding:12px 16px;font:1000 14px/1;cursor:pointer">Ø¥Ù†Ø´Ø§Ø¡</button>',
      '    <div id="br-msg" style="opacity:.75;display:flex;align-items:center"></div>',
      '  </div>',
      '  <div style="opacity:.75;font:800 12px/1.4">Ù…Ù„Ø§Ø­Ø¸Ø©: Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ÙØ±Ø¹ Ù…Ø³ØªÙ‚Ù„ Ø¨Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ£Ø³Ø¹Ø§Ø± ÙˆÙ…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ù†ÙØµÙ„ÙŠÙ†. Ø³ÙŠØªÙ… Ù†Ø³Ø® Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙƒØ¨Ø¯Ø§ÙŠØ© (Ø«Ù… ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§).</div>',
      ' </div>',
      '</div>'
    ].join("");

    var m = modal(body);

    // select branch
    m.card.querySelectorAll("[data-sel]").forEach(function(btn){
      btn.addEventListener("click", function(){
        var id = btn.getAttribute("data-sel");
        var b = getBranches().find(function(x){return x.id===id;});
        setBranchId(id, b?b.name:"");
        try{ location.reload(); }catch(_){}
      });
    });


    

    // rename branch name
    m.card.querySelectorAll("[data-ren]").forEach(function(btn){
      btn.addEventListener("click", function(){
        try{
          var id = btn.getAttribute("data-ren");
          if(!id) return;
          var list = getBranches();
          var cur = list.find(function(x){ return x && x.id === id; }) || {id:id, name:id};
          var currentName = (cur.name || cur.id || "").trim();

          var box = modal([
            '<div style="display:flex;align-items:center;justify-content:space-between;gap:10px">',
            ' <div style="font:1000 18px/1 system-ui,Segoe UI,Roboto,Tahoma">âœï¸ ØªØºÙŠÙŠØ± Ø§Ø³Ù… Ø§Ù„ÙØ±Ø¹</div>',
            ' <button data-close type="button" style="border:0;background:#ef4444;color:#fff;border-radius:12px;padding:8px 12px;font:1000 14px/1 system-ui,Segoe UI,Roboto,Tahoma;cursor:pointer">Ø¥ØºÙ„Ø§Ù‚</button>',
            '</div>',
            '<div style="margin-top:10px;border:1px solid rgba(15,23,42,.12);border-radius:14px;padding:12px;background:rgba(248,250,252,.92)">',
            ' <div style="font:900 13px/1.4;opacity:.8;margin-bottom:8px">Ù…Ø¹Ø±Ù‘Ù Ø§Ù„ÙØ±Ø¹: <span style="font-weight:1000;direction:ltr;unicode-bidi:isolate">'+String(id)+'</span></div>',
            ' <label style="display:grid;gap:6px">',
            '  <span style="opacity:.75">Ø§Ø³Ù… Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯</span>',
            '  <input id="br-rename" class="fld" value="'+String(currentName).replace(/"/g,'&quot;')+'" style="height:46px;border-radius:14px;border:1px solid rgba(15,23,42,.12);padding:0 12px;font:900 15px/1 system-ui,Segoe UI,Roboto,Tahoma" />',
            ' </label>',
            ' <div id="br-rename-msg" style="margin-top:8px;opacity:.75"></div>',
            ' <div style="display:flex;gap:10px;justify-content:flex-end;flex-wrap:wrap;margin-top:12px">',
            '  <button type="button" id="br-rename-cancel" style="min-width:110px;border:1px solid rgba(15,23,42,.18);background:#fff;border-radius:12px;padding:10px 14px;font:1000 14px/1;cursor:pointer">Ø¥Ù„ØºØ§Ø¡</button>',
            '  <button type="button" id="br-rename-save" style="min-width:110px;border:1px solid rgba(59,130,246,.35);background:linear-gradient(135deg,#2563eb,#60a5fa);color:#fff;border-radius:12px;padding:10px 14px;font:1000 14px/1;cursor:pointer">Ø­ÙØ¸</button>',
            ' </div>',
            '</div>'
          ].join(""));

          var inp = box.card.querySelector("#br-rename");
          var msg = box.card.querySelector("#br-rename-msg");
          var btnSave = box.card.querySelector("#br-rename-save");
          var btnCancel = box.card.querySelector("#br-rename-cancel");

          function setMsg(t){ try{ msg.textContent = t || ""; }catch(_){} }

          btnCancel.addEventListener("click", function(){ try{ box.close(); }catch(_){} });
          btnSave.addEventListener("click", async function(){
            try{
              setMsg("â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...");
              var nm = (inp.value || "").trim();
              if(!nm){ setMsg("âš ï¸ Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„ÙØ±Ø¹"); try{inp.focus()}catch(_){}; return; }

              var supa = window.__TAIF_SUPA__;
              if(!supa){ setMsg("âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"); return; }

              // refresh from DB first (avoid overwriting)
              await syncBranches();
              var curList = getBranches();

              var found = false;
              curList = curList.map(function(b){
                if(b && b.id === id){
                  found = true;
                  return { id: b.id, name: nm };
                }
                return b;
              });
              if(!found){
                curList.push({id:id, name:nm});
              }

              var ok = await writeAppState(supa, "taif:branches", curList);
              if(!ok){ setMsg("âš ï¸ ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ø§Ø³Ù…"); return; }

              // local cache
              setBranches(curList);

              // if current branch renamed, keep branch name in storage
              if(String(id) === String(getBranchId())){
                try{ setBranchId(id, nm); }catch(_){}
              }

              setMsg("âœ… ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø³Ù…");
              setTimeout(function(){
                try{ box.close(); }catch(_){}
                try{ location.reload(); }catch(_){}
              }, 450);
            }catch(_){
              setMsg("âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸");
            }
          });

          try{ setTimeout(function(){ inp && inp.focus && inp.focus(); }, 0); }catch(_){}
        }catch(_){}
      });
    });

// delete branch (non-main, not current)
    m.card.querySelectorAll("[data-del]").forEach(function(btn){
      btn.addEventListener("click", async function(){
        try{
          var id = btn.getAttribute("data-del");
          if(!id) return;
          if(id === DEFAULT_BRANCH){ return; }
          if(id === getBranchId()){
            alert("Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ.");
            return;
          }
          if(!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ÙØ±Ø¹ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§ØªÙ‡ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙˆÙ…Ø³ØªØ®Ø¯Ù…ÙŠÙ†Ù‡ ÙˆØ³Ø¬Ù„ Ø¹Ù…Ù„ÙŠØ§ØªÙ‡ (Ø¥Ù† Ø£Ù…ÙƒÙ†).")) return;

          var supa = window.__TAIF_SUPA__;
          if(!supa){ alert("ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"); return; }

          // refresh branches from DB to avoid overwriting
          await syncBranches();
          var curList = getBranches().filter(function(b){ return b && b.id !== id; });
          if(!curList.length) curList = [{id:DEFAULT_BRANCH, name:"Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ"}];

          // Persist new branches list (GLOBAL)
          var ok = await writeAppState(supa, "taif:branches", curList);
          if(!ok){ alert("ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„ÙØ±Ø¹ (Ø­ÙØ¸ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©)"); return; }

          // Best-effort cleanup
          try{
            // wipe core app_state keys
            var keys = ["data","banner","title","logo","bannerImg","datetime","base","tradeSettings","customTheme","viewMode","adminactionslog"];
            for(var i=0;i<keys.length;i++){
              await writeAppState(supa, "taif/branch/" + id + "/" + keys[i], null);
            }
          }catch(_){}

          try{
            // delete branch users (stored as <branch>::<username>)
            await supa.from("users").delete().like("username", id + "::%");
          }catch(_){}

          try{
            // delete trade transactions for branch (if table exists & permissions allow)
            await supa.from("trade_transactions").delete().eq("branch_id", id);
          }catch(_){}

          // Update local cache & close
          setBranches(curList);
          // If UI shows branch name cache, clear it
          try{ localStorage.removeItem("taif:cache:branch:" + id); }catch(_){}
          alert("ØªÙ… Ø­Ø°Ù Ø§Ù„ÙØ±Ø¹.");
          try{ m.close(); }catch(_){}
        }catch(_){
          alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„ÙØ±Ø¹");
        }
      });
    });

    // create
    var createBtn = m.card.querySelector("#br-create");
    var nameInp = m.card.querySelector("#br-name");
    var msg = m.card.querySelector("#br-msg");

    createBtn.addEventListener("click", async function(){
      try{
        msg.textContent = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...";
        var nm = (nameInp.value||"").trim();
        if(!nm){ msg.textContent="âš ï¸ Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„ÙØ±Ø¹"; return; }

        var supa = window.__TAIF_SUPA__;
        if(!supa){ msg.textContent="âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"; return; }

        // refresh branches from db
        await syncBranches();
        var curList = getBranches();

        // generate id & ensure unique
        var id = safeIdFromName(nm);
        while(curList.some(function(b){return b.id===id;})){
          id = safeIdFromName(nm);
        }

        curList.push({id:id, name:nm});
        // write branches list (GLOBAL)
        var ok = await writeAppState(supa, "taif:branches", curList);
        if(!ok){ msg.textContent="âš ï¸ ÙØ´Ù„ Ø­ÙØ¸ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙˆØ¹"; return; }

        // clone from current branch as template
        try{ await cloneBranchData(supa, getBranchId(), id); }catch(_){}

        setBranches(curList);
        msg.textContent = "âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙØ±Ø¹ Ø¨Ù†Ø¬Ø§Ø­";
        setTimeout(function(){ try{ m.close(); }catch(_){} }, 650);
      }catch(_){
        msg.textContent="âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£";
      }
    });
  }

  // ===== watchers =====
  patchDB();
  // keep trying until db is ready
  window.addEventListener("db-ready", function(){ patchDB(); try{syncBranches()}catch(_){ } });

  // initial branches sync (best effort)
  try{ syncBranches(); }catch(_){}

  // DOM observers
  var obs = new MutationObserver(function(){
    try{ injectLoginBranchSelector(); }catch(_){}
    try{ ensureBranchManagerButton(); }catch(_){}
  });
  try{ obs.observe(document.documentElement, {subtree:true, childList:true}); }catch(_){}

  // run once
  try{ injectLoginBranchSelector(); }catch(_){}
  try{ ensureBranchManagerButton(); }catch(_){}

})();
</script>
<script>!function(){"use strict";function t(){var t=function(t,e){try{return JSON.parse(localStorage.getItem(t)||"null")??e}catch(t){return e}}("taif:session",null),e=t&&(t.name||t.displayName)||null,n=t&&t.username||null;return e||n||"anon"}function e(t){try{if(null==t||""===t)return"";var e=Number(t);return isFinite(e)?e.toLocaleString("ar-EG"):String(t)}catch(e){return String(t)}}function n(t){if(window.$db)try{var e=Date.now()+"_"+Math.random().toString(36).slice(2);window.$db.set(window.$db.ref("taif/adminactionslog/"+e),t)}catch(t){}}window.Log=Object.assign(window.Log||{},{logEvent:function(e,a,o){n({actor:"resetBase"===e?"system":o||t(),action:e,target:a||""})},loginSuccess:function(e){n({actor:e||t(),action:"ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (Ù†Ø¬Ø§Ø­)",target:""})},loginFail:function(e){n({actor:e||t(),action:"ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (ÙØ´Ù„)",target:""})},logout:function(e){n({actor:e||t(),action:"ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬",target:""})}});var a=null,o={},i=null;function r(){if(window.$db&&!window.$db.__logWrappedV2){!function(){try{if(window.$db&&!window.__log_snapshots_bound){window.__log_snapshots_bound=!0;try{window.$db.onValue(window.$db.ref("taif/data"),function(t){a=t&&t.val&&t.val()})}catch(t){}try{window.$db.onValue(window.$db.ref("taif/users"),function(t){o=t&&t.val&&t.val()||{}})}catch(t){}}}catch(t){}}();var r=window.$db.set.bind(window.$db);window.$db.set=async function(l,d){var c="string"==typeof l?l:l&&l.key,u=t(),s=await r(l,d);try{if(!c)return s;if("taif/data"===c&&Array.isArray(d)){var w=function(t,e){var n={changed:[],usd:null};try{var a=Object.create(null),o=Object.create(null);(Array.isArray(t)?t:[]).forEach(function(t){t&&t.code&&(a[t.code]=t)}),(Array.isArray(e)?e:[]).forEach(function(t){t&&t.code&&(o[t.code]=t)});var i=a.USD||{},r=o.USD||{};i.buy===r.buy&&i.sell===r.sell||(n.usd={oldBuy:i.buy,newBuy:r.buy,oldSell:i.sell,newSell:r.sell}),Object.keys(o).forEach(function(t){if("USD"!==t){var e=a[t]||{},i=o[t]||{},r=!1;["ratioBuy","ratioSell","method","buy","sell"].forEach(function(t){e[t]!==i[t]&&(r=!0)}),r&&n.changed.push({code:t,name:i.name||e.name||t,oldBuy:e.buy,newBuy:i.buy,oldSell:e.sell,newSell:i.sell,oldRB:e.ratioBuy,newRB:i.ratioBuy,oldRS:e.ratioSell,newRS:i.ratioSell,oldMethod:e.method||"",newMethod:i.method||""})}})}catch(t){}return n}(a,d);if(w&&w.usd){var g=[];w.usd.oldBuy!==w.usd.newBuy&&g.push("Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ "+e(w.usd.oldBuy)+" â† "+e(w.usd.newBuy)),w.usd.oldSell!==w.usd.newSell&&g.push("Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹ "+e(w.usd.oldSell)+" â† "+e(w.usd.newSell)),n({actor:u,action:"ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±",target:g.join(" | ")})}if(w&&w.changed&&w.changed.length)if(1===w.changed.length){var y=w.changed[0],f="";if(void 0!==y.newBuy&&void 0!==y.oldBuy&&y.oldBuy!==y.newBuy&&(f+="Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ "+e(y.oldBuy)+" â† "+e(y.newBuy)),void 0!==y.newSell&&void 0!==y.oldSell&&y.oldSell!==y.newSell&&(f&&(f+=" | "),f+="Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹ "+e(y.oldSell)+" â† "+e(y.newSell)),f||(f="Ù†ÙØ³ÙØ¨ Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ "+e(y.oldRB)+" â† "+e(y.newRB)+" | Ù†ÙØ³ÙØ¨ Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹ "+e(y.oldRS)+" â† "+e(y.newRS)),y.oldMethod!==y.newMethod)f&&(f+=" | "),f+="Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© "+(("divide"===y.oldMethod?"Ù‚Ø³Ù…Ø©":"multiply"===y.oldMethod?"Ø¶Ø±Ø¨":String(y.oldMethod||""))||"â€”")+" â† "+(("divide"===y.newMethod?"Ù‚Ø³Ù…Ø©":"multiply"===y.newMethod?"Ø¶Ø±Ø¨":String(y.newMethod||""))||"â€”");n({actor:u,action:"ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù…Ù„Ø©",target:y.name+" ("+y.code+") â€” "+f})}else n({actor:u,action:"ØªØ¹Ø¯ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„Ø§Øª",target:"("+w.changed.length+" Ø¹Ù…Ù„Ø§Øª)"}),w.changed.forEach(function(t){var a="";(void 0!==t.oldRB&&void 0!==t.newRB&&(a+="Ù†ÙØ³ÙØ¨ Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ "+e(t.oldRB)+" â† "+e(t.newRB)),void 0!==t.oldRS&&void 0!==t.newRS&&(a&&(a+=" | "),a+="Ù†ÙØ³ÙØ¨ Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹ "+e(t.oldRS)+" â† "+e(t.newRS)),void 0!==t.oldBuy&&void 0!==t.newBuy&&(a&&(a+=" | "),a+="Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ "+e(t.oldBuy)+" â† "+e(t.newBuy)),void 0!==t.oldSell&&void 0!==t.newSell&&(a&&(a+=" | "),a+="Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹ "+e(t.oldSell)+" â† "+e(t.newSell)),t.oldMethod!==t.newMethod)&&(a&&(a+=" | "),a+="Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© "+(("divide"===t.oldMethod?"Ù‚Ø³Ù…Ø©":"multiply"===t.oldMethod?"Ø¶Ø±Ø¨":String(t.oldMethod||""))||"â€”")+" â† "+(("divide"===t.newMethod?"Ù‚Ø³Ù…Ø©":"multiply"===t.newMethod?"Ø¶Ø±Ø¨":String(t.newMethod||""))||"â€”"));n({actor:u,action:"ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù…Ù„Ø©",target:t.name+" ("+(t.code||"")+") â€” "+a})})}else if("taif/banner"===c||"taif:banner:v2"===c)try{for(var h=i&&Array.isArray(i.texts)?i.texts.slice():[],S=d&&Array.isArray(d.texts)?d.texts.slice():[],v=[],b=Math.max(h.length,S.length),m=0;m<b;m++){var B=(h[m]||"").trim(),p=(S[m]||"").trim();B&&!p?v.push("âŒ Ø­Ø°Ù: "+B):!B&&p?v.push("â• Ø¥Ø¶Ø§ÙØ©: "+p):B!==p&&v.push("âœï¸ ØªØ¹Ø¯ÙŠÙ„: "+B+" â† "+p)}f=v.length?v.join(" | "):"Ù„Ù… ÙŠØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ù†ØµÙˆØµ ("+S.length+" Ø¹Ù†ØµØ±)";n({actor:u,action:"Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª",target:f}),i=d}catch(t){var M=d&&Array.isArray(d.texts)?d.texts.length:0;n({actor:u,action:"Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª",target:"("+M+" Ø¹Ù†ØµØ±)"})}else if("taif/base"===c)try{var R=d&&d.date?String(d.date):"",$=0;try{$=d&&d.base?Object.keys(d.base).length:0}catch(t){}n({actor:"system",action:"resetBase",target:(R?"Ø¨ØªØ§Ø±ÙŠØ® "+R+" â€” ":"")+"("+$+" Ø¹Ù…Ù„Ø§Øª)"})}catch(t){}else if("taif/title"===c)n({actor:u,action:"ØªØºÙŠÙŠØ± Ø§Ù„Ù‡ÙˆÙŠØ©",target:"ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¥Ù„Ù‰ â€œ"+String(d||"")+"â€"});else if("taif/logo"===c)n({actor:u,action:"ØªØºÙŠÙŠØ± Ø§Ù„Ù‡ÙˆÙŠØ©",target:"ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ù„ÙˆØºÙˆ"});else if("taif/bannerImg"===c)n({actor:u,action:"ØªØºÙŠÙŠØ± Ø§Ù„Ù‡ÙˆÙŠØ©",target:"ØªÙ… ØªØºÙŠÙŠØ± ØµÙˆØ±Ø© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©"});else if("taif/datetime"===c&&d&&"object"==typeof d){var _=d.time?String(d.time):"";R=d.date?String(d.date):"";n({actor:u,action:"ØªØºÙŠÙŠØ± Ø§Ù„ÙˆÙ‚Øª",target:"Ø¥Ù„Ù‰ "+_+" Ø¨ØªØ§Ø±ÙŠØ® "+R})}else if("taif/adminactionslog"===c&&null==d)n({actor:u,action:"Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„",target:""});else if(String(c).startsWith("taif/users/")){var A=String(c).split("/")[2]||"",E=o&&o[A];if(null==d)n({actor:u,action:"Ø­Ø°Ù Ù…Ø³ØªØ®Ø¯Ù…",target:"("+A+")"});else if(E){var j=d&&(d.name||d.username)||A;n({actor:u,action:"ØªØ¹Ø¯ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù…",target:"("+j+")"})}else{var x=d&&(d.name||d.username)||A;n({actor:u,action:"Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…",target:"("+x+")"})}}}catch(t){}return s},window.$db.__logWrappedV2=!0}}"complete"===document.readyState||"interactive"===document.readyState?r():document.addEventListener("DOMContentLoaded",r),window.addEventListener("db-ready",r)}();</script><script>
(function(){

 function isEditableTarget(t){
  if (!t) return false;
  if (t.closest('input, textarea, select, [contenteditable="true"], .fld')) return true;
  return false;
 }

 function enterFS(el){
  const fn = el.requestFullscreen || el.webkitRequestFullscreen || el.mozRequestFullScreen || el.msRequestFullscreen;
  if (fn) try { fn.call(el); } catch(_){}
 }
 function exitFS(doc){
  const fn = doc.exitFullscreen || doc.webkitExitFullscreen || doc.mozCancelFullScreen || doc.msExitFullscreen;
  if (fn) try { fn.call(doc); } catch(_){}
 }
 function isFS(doc){
  return !!(doc.fullscreenElement || doc.webkitFullscreenElement || doc.mozFullScreenElement || doc.msFullscreenElement);
 }

 document.addEventListener('mousedown', function(e){
  if (e.detail > 1 && !isEditableTarget(e.target)) {
   e.preventDefault();
  }
 }, { capture:true });

 const onDbl = function(e){
  if (isEditableTarget(e.target)) return; // do nothing on inputs/text areas
  e.preventDefault();
  e.stopPropagation();

  document.body.classList.add('no-select');
  setTimeout(()=>document.body.classList.remove('no-select'), 350);

  if (isFS(document)) exitFS(document);
  else enterFS(document.documentElement);
 };

 document.addEventListener('dblclick', onDbl, { capture:true });
})();
</script><script>
const origSetB = window.$db && window.$db.set ? window.$db.set.bind(window.$db) : null;
if (origSetB) {
 window.$db.set = async function(refOrPath, value) {
  try {
   const key = typeof refOrPath === "string" ? refOrPath : (refOrPath && refOrPath.key);

   // Support per-branch base key: taif/branch/<branchId>/base
   let __baseBid = null;
   let __isBaseKey = false;
   if (key === "taif/base") {
     __isBaseKey = true;
     try { __baseBid = (window.__taif_branchId ? window.__taif_branchId() : (localStorage.getItem("taif:branch_id")||"main")); } catch(_) { __baseBid = "main"; }
   } else {
     const m = String(key||"").match(/^taif\/branch\/([^\/]+)\/base$/);
     if (m) { __isBaseKey = true; __baseBid = m[1]; }
   }

   if (__isBaseKey) {
    

    const d = new Date();
    const today = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;

    const supa = (window.__TAIF_SUPA__ || (window.__TAIF_SUPA__ = (window.__TAIF_SUPA__||(window.__TAIF_SUPA__=window.supabase.createClient("https://rzabluqawcyhedcvmyut.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ6YWJsdXFhd2N5aGVkY3ZteXV0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExODMxMTQsImV4cCI6MjA4Njc1OTExNH0.EWbcZ4jliSKtlY3rk303EkcUfNDqJhOKDRAP2kxPCxE")))));
    const lockKey = `locks/${__baseBid||'main'}/base-${today}`;
    try {
     const { data:lockRow } = await supa.from("app_state").select("key").eq("key", lockKey).maybeSingle();
     if (lockRow && lockRow.key) {
      
      try { window.Log && window.Log.logEvent && window.Log.logEvent('resetBase', `Ù…Ø±ÙÙˆØ¶ â€” ØªÙ… Ø§Ù„Ù‚ÙÙ„ Ø¨ØªØ§Ø±ÙŠØ® ${today}`, 'system'); } catch (_) {}
      return;
     }
    } catch (e) { /* ignore and continue */ }

    let list = [];
    try {
     const { data } = await supa.from("app_state").select("value").eq("key", (`taif/branch/${__baseBid||"main"}/data`)).maybeSingle();
     if (data && data.value) list = data.value;
    } catch (e) { /* ignore */ }

    if (!Array.isArray(list) || list.length === 0) {
     try {
      const snap = JSON.parse(localStorage.getItem("taif:cache")||"null");
      if (snap && Array.isArray(snap.data)) list = snap.data;
     } catch(_) {}
    }

    if (!Array.isArray(list) || list.length === 0) {
     // If branch data isn't ready yet (fresh branch / first load), don't block the write.
     // Fallback to the provided value to avoid breaking the app and avoid noisy console errors.
     try { console.warn("â„¹ï¸ SmartGuard v5: branch data not ready â€” using provided snapshot value"); } catch(_) {}
     try { await origSetB(refOrPath, value); } catch(_) {}
     return;
    }

    const toNum = (v)=> +v || 0;
    const usd = list.find(r=>r && r.code==="USD") || { buy:0, sell:0 };
    const usdSell = toNum(usd.sell);
    if (!(usdSell > 0)) {
     console.error("âŒ SmartGuard v5: USD sell is not valid â€” abort");
     return;
    }
    const base = {};
    for (const r of list) {
     if (!r || !r.code) continue;
     if (r.code === "USD") { base[r.code] = Math.round(usdSell); continue; }
     const rs = toNum(r.ratioSell) > 0 ? toNum(r.ratioSell) : 1;
     const method = (r.method === "divide") ? "divide" : "multiply";
     let sell=0;
     if (method === "divide") sell = Math.round(usdSell / rs);
     else sell = Math.round(usdSell * rs);
     base[r.code] = sell;
    }
    const outVal = { date: today, base };

    await origSetB(refOrPath, outVal);
    try { window.Log && window.Log.logEvent && window.Log.logEvent('resetBase', `ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ù„ÙŠÙˆÙ… ${today}`, 'system'); } catch (_) {}

    try {
     await supa.from("app_state").upsert([{ key: lockKey, value: { at: Date.now() } }], { onConflict: "key" });
     
    } catch (e) { }

    try {
     const wrap = document.createElement('div');
     wrap.setAttribute('dir','rtl');
     wrap.style.cssText = "position:fixed;top:14px;left:50%;transform:translateX(-50%);z-index:2147483647";
     const bubble = document.createElement('div');
     bubble.textContent = `ğŸ”’ ØªÙ… Ù‚ÙÙ„ Ø³Ø¹Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ø§Ø³ Ù„Ù„ÙŠÙˆÙ… (${today})`;
     bubble.style.cssText = "background:#0f172acc;color:#fff;border-radius:14px;padding:10px 16px;font:600 14px/1.3 system-ui,Segoe UI,Roboto,Tahoma;box-shadow:0 8px 24px rgba(0,0,0,.25);border:1px solid rgba(255,255,255,.08);";
     wrap.appendChild(bubble); document.body.appendChild(wrap);
     setTimeout(()=>{ bubble.style.opacity="0"; bubble.style.transition="opacity .45s ease"; }, 1400);
    } catch(_) {}

    return; // important: we already wrote the snapshot
   }
  } catch (err) {
   console.error("âŒ SmartGuard v5 error:", err);
  }
  return origSetB(refOrPath, value);
 };
}
</script><script>!function(){function e(){function e(){return e=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},e.apply(null,arguments)}const{useState:t,useEffect:a,useMemo:r,useRef:n,useCallback:l}=React,c={"ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±":"ğŸ’µ","ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù…Ù„Ø©":"âœï¸","ØªØ¹Ø¯ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„Ø§Øª":"ğŸ› ï¸","Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª":"âš¡","ØªØºÙŠÙŠØ± Ø§Ù„Ù‡ÙˆÙŠØ©":"ğŸ–¼ï¸","ØªØºÙŠÙŠØ± Ø§Ù„ÙˆÙ‚Øª":"ğŸ•’","ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (Ù†Ø¬Ø§Ø­)":"âœ…","ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (ÙØ´Ù„)":"âŒ","ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬":"ğŸšª","Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„":"âš ï¸","Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…":"ğŸ‘¤","Ø­Ø°Ù Ù…Ø³ØªØ®Ø¯Ù…":"ğŸ‘¤","ØªØ¹Ø¯ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù…":"ğŸ‘¤"},s="taif:device_id";const o=new Set(["image/png","image/jpeg","image/webp","image/svg+xml","image/gif"]),i=(e,t)=>!!e&&(o.has(e.type)?!(e.size>1048576)||(t?.({text:"âš ï¸ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„ØµÙˆØ±Ø© 1MB",type:"error"}),!1):(t?.({text:"âš ï¸ Ø§Ù„ØµÙŠØº Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø©: PNG, JPEG, WebP ÙÙ‚Ø·",type:"error"}),!1)),m=function(){const e="2.0.0.0-stable-plus";try{return localStorage.getItem("taif:app_version")||e}catch(t){return e}}(),d=Object.freeze({DATA:"taif:data",BANNER:"taif:banner:v2",DT:"taif:datetime",THEME:"taif:customTheme",BASE:"taif:dailyBase",VIEW:"taif:viewMode",LOGO:"taif:logo",TITLE:"taif:title",BANNERIMG:"taif:bannerImage"}),u="taif:cache",g=new Map,p={load:()=>(()=>{try{const e=localStorage.getItem(u);if(!e)return null;const t=JSON.parse(e);return t&&"object"==typeof t?t:null}catch(e){return g.get(u)||null}})(),save:e=>(e=>{try{localStorage.setItem(u,JSON.stringify(e||{}))}catch(t){g.set(u,e||{})}})(e),clear:()=>{try{localStorage.removeItem(u)}catch(e){}try{g.delete(u)}catch(e){}}},f=(e,t,a)=>Math.min(Math.max(+e||0,t),a),b=e=>+e||0,w=e=>String(e).padStart(2,"0"),y=(e,t)=>{try{const a=localStorage.getItem(e);if(!a)return t;const r=JSON.parse(a);return null==r?t:r}catch(e){return t}},x=(e,t)=>{try{localStorage.setItem(e,JSON.stringify(t))}catch(e){}},E=(e,dec)=>{try{const n=Number(b(e));if(!isFinite(n))return String(e??"");dec=parseInt(dec,10);if(!isFinite(dec)||dec<0)dec=0;if(dec>6)dec=6;return new Intl.NumberFormat("en-US",{minimumFractionDigits:dec,maximumFractionDigits:dec}).format(n)}catch(_){return String(e??"")}},v=e=>{const t=(e||"").trim().match(/^(\d{2})-(\d{2})-(\d{4})$/);if(!t)return!1;const a=+t[1],r=+t[2]-1,n=+t[3],l=new Date(n,r,a);return l.getFullYear()===n&&l.getMonth()===r&&l.getDate()===a},R=e=>{if(!v(e))return"";const[t,a,r]=e.split("-");return`${r}-${a}-${t}`},h=[{id:"sunset",name:"ØºØ±ÙˆØ¨",cls:"bg-gradient-to-tr from-rose-200 via-amber-100 to-orange-200 text-gray-900",head:"bg-gradient-to-r from-orange-500 via-pink-500 to-red-500 text-white",banner:"from-orange-100 via-amber-200 to-rose-200"},{id:"mint",name:"Ù†Ø¹Ù†Ø§Ø¹ÙŠ",cls:"bg-gradient-to-tr from-emerald-200 via-white to-teal-200 text-gray-900",head:"bg-gradient-to-r from-emerald-600 via-teal-600 to-green-500 text-white",banner:"from-teal-100 via-green-100 to-emerald-100"},{id:"lav",name:"Ù„Ø§ÙÙ†Ø¯Ø±",cls:"bg-gradient-to-tr from-indigo-200 via-white to-purple-200 text-gray-900",head:"bg-gradient-to-r from-indigo-600 via-purple-600 to-fuchsia-600 text-white",banner:"from-indigo-100 via-purple-100 to-violet-100"},{id:"gold",name:"Ø°Ù‡Ø¨ÙŠ ÙØ§Ø®Ø±",cls:"bg-gradient-to-tr from-yellow-100 via-yellow-200 to-yellow-300 text-gray-900",head:"bg-gradient-to-r from-yellow-600 via-amber-600 to-yellow-700 text-white",banner:"from-yellow-100 via-amber-100 to-yellow-200"},{id:"vipPearl",name:"VIP â€” Pearl Glass",cls:"bg-gradient-to-tr from-blue-100 via-gray-200 to-teal-100 text-gray-900",head:"bg-gradient-to-r from-sky-600 via-cyan-600 to-blue-600 text-white",banner:"from-sky-100 via-cyan-100 to-blue-100"},{id:"vipTaif",name:"VIP â€” Taif Brand",cls:"bg-gradient-to-tr from-indigo-100 via-amber-100 to-violet-100 text-gray-900",head:"bg-gradient-to-r from-yellow-600 via-amber-600 to-yellow-700 text-white",banner:"from-indigo-100 via-amber-100 to-violet-100"}],N=Object.fromEntries(h.map(e=>[e.cls,e])),k=e=>N[e]?.banner||"from-blue-100 via-gray-200 to-teal-100",C=new Set(h.map(e=>e.cls)),$=({toast:e,onClose:t})=>{if(a(()=>{if(!e)return;const a=setTimeout(t,3e3);return()=>clearTimeout(a)},[e]),!e)return null;let r="bg-green-100 border-green-400 text-green-800";return"error"===e.type&&(r="bg-red-100 border-red-400 text-red-800"),"info"===e.type&&(r="bg-blue-100 border-blue-400 text-blue-800"),"warning"===e.type&&(r="bg-yellow-100 border-yellow-400 text-yellow-900"),ReactDOM.createPortal(React.createElement("div",{className:"toast cursor-pointer",role:"status","aria-live":"polite",onClick:t},React.createElement("div",{className:`glass rounded-xl px-5 py-3 border shadow font-semibold ${r}`,"aria-live":"polite"},e.text)),document.body)},D=({className:t="",...a})=>React.createElement("button",e({type:"button",className:`px-3 py-2 rounded-lg font-semibold transition active:scale-[.98] ${t}`},a)),S=({open:e,onClose:t,title:r,children:l})=>{a(()=>{if(!e)return;const a=e=>"Escape"===e.key&&t();return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[e,t]);const c=n(null);var s,o;return a(()=>{if(!s)return;o&&o.current||document;const e=()=>{const e=o?.current||document;return Array.from(e.querySelectorAll('a[href],button,textarea,input,select,[tabindex]:not([tabindex="-1"])')).filter(e=>!e.hasAttribute("disabled"))},t=e();if(t[0])try{t[0].focus()}catch(e){}const a=t=>{if("Tab"!==t.key)return;const a=e();if(!a.length)return;const r=a[0],n=a[a.length-1],l=document.activeElement;t.shiftKey?l!==r&&o?.current?.contains(l)||(t.preventDefault(),n.focus()):l!==n&&o?.current?.contains(l)||(t.preventDefault(),r.focus())};return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[s=e,o=c]),e?ReactDOM.createPortal(React.createElement("div",{className:"backdrop",onClick:void 0},React.createElement("div",{ref:c,tabIndex:-1,className:"glass-strong w-full max-w-[92vw] sm:max-w-lg md:max-w-xl rounded-2xl border border-gray-200 shadow-2xl p-4 sm:p-5 relative max-h-[78vh] overflow-y-auto",role:"dialog","aria-modal":"true","aria-labelledby":"modal-title"},React.createElement("button",{type:"button",onClick:t,className:"absolute top-3 left-3","aria-label":"Ø¥ØºÙ„Ø§Ù‚"},"âŒ"),r&&React.createElement("div",{className:"text-lg font-bold mb-2 sm:mb-3",id:"modal-title"},r),React.createElement("div",{className:"grid gap-3"},l))),document.body):null},j=(e="")=>/^[\uD83C][\uDDE6-\uDDFF][\uD83C][\uDDE6-\uDDFF]$/.test(e),I=({emoji:e})=>{const t=n(null),r="undefined"==typeof navigator||navigator.onLine;return a(()=>{if(!t.current)return;let a="ğŸ³ï¸";if(j(e)&&(a=e),t.current.textContent=a,"ğŸ³ï¸"!==a&&r&&window.twemoji)try{window.twemoji.parse(t.current,{folder:"svg",ext:".svg",base:"https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/",attributes:()=>({loading:"lazy",decoding:"async",referrerpolicy:"no-referrer"})})}catch(e){}},[e,r]),React.createElement("span",{ref:t,className:"flag-slot","aria-hidden":"true"},e||"ğŸ³ï¸")},A=({value:r,onChange:n,allowDecimal:c=!1,min:s,max:o,className:i="",...m})=>{const d=l(e=>{if(null==e)return"";if("number"==typeof e&&0!==e&&Math.abs(e)<1){const t=e.toString();if(/e[-+]/i.test(t)){const[e,a]=t.split("e"),r=parseInt(a,10);if(r<0){let t=e.replace(".","");const a=t.startsWith("-")?"-":"";a&&(t=t.slice(1));return a+"0."+"0".repeat(Math.abs(r)-1)+t}}}return String(e)},[]),[u,g]=t(0===r||r?d(r):"");a(()=>{g(0===r||r?d(r):"")},[r,d]);const p=(e,t)=>{if(null==e)return"";let a=String(e).replace(/[\u0660-\u0669]/g,e=>"0123456789"[e.charCodeAt(0)-1632]).replace(/[\u06F0-\u06F9]/g,e=>"0123456789"[e.charCodeAt(0)-1776]).replace(/\u066B/g,".").replace(/\u066C/g,"").replace(/,|\s/g,"");if(a=a.replace(t?/[^0-9.]/g:/[^0-9]/g,""),t){const e=a.indexOf(".");-1!==e&&(a=a.slice(0,e+1)+a.slice(e+1).replace(/\./g,""))}return a};return React.createElement("input",e({lang:"en",type:"text",inputMode:c?"decimal":"numeric",pattern:c?"[0-9.]*":"[0-9]*",className:`table-numbers text-center ${i}`,value:u,onChange:e=>{let t=e.target.value,a=p(t,c);if(c&&"."===a)return void g("0.");if(g(a),!a)return void n?.(null);let r=c?parseFloat(a):parseInt(a,10);isNaN(r)||(null!=s&&r<s&&(r=s),null!=o&&r>o&&(r=o),n?.(r))},onBlur:()=>{if(""===u||"."===u)return g(""),void n?.(null);let e=p(u,c),t=c?parseFloat(e):parseInt(e,10);if(!isFinite(t))return g(""),void n?.(null);null!=s&&t<s&&(t=s),null!=o&&t>o&&(t=o),n?.(t),g(d(t))}},m))},L=({dir:e="flat"})=>{const t="up"===e?"text-green-600":"down"===e?"text-red-600":"text-blue-600",a="up"===e?"M12 4l6 8H6l6-8z":"down"===e?"M12 20l-6-8h12l-6 8z":"M5 12h14v2H5z";return React.createElement("svg",{className:`${t} w-4 h-4 sm:w-5 sm:h-5`,viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},React.createElement("path",{d:a}))},U=({pct:e,className:t=""})=>{const a=+e,r=a>0,n=a<0,l=r?"up":n?"down":"flat",c=r?"text-green-700 bg-green-100":n?"text-red-700 bg-red-100":"text-blue-700 bg-blue-100";return React.createElement("span",{className:`table-numbers inline-flex items-center gap-1.5 px-2 sm:px-3 py-1.5 rounded-xl font-bold shadow ${c} ${t}`},React.createElement(L,{dir:l}),`${r?"+":n?"âˆ’":""}${Math.abs(a).toFixed(2)}%`)},T=({row:e,showName:t=!0})=>{const a="undefined"!=typeof window&&window.matchMedia&&window.matchMedia("(max-width: 640px)").matches,r=t&&!a;return React.createElement("div",{className:"flex items-center currency-cell-mobile gap-2 sm:gap-3 min-w-0"},React.createElement(I,{emoji:e.flag}),React.createElement("div",{className:"flex items-center gap-2 min-w-0 flex-1"},React.createElement("span",{className:"font-extrabold text-sm sm:text-base md:text-lg"},e.code),r&&React.createElement("div",{className:"name-box"},React.createElement("span",{className:"name-track currency-name"},e.name)),e.icon&&React.createElement("span",{className:"icon-pill-after hidden sm:inline px-2 py-0.5 rounded bg-gray-300 text-gray-800 text-[10px] sm:text-xs align-middle"},e.icon)))},_=({value:e,type:t="buy",className:a="",decimals:d=0})=>{const r="buy"===t?"from-green-500 to-green-700":"from-red-500 to-red-700";return React.createElement("span",{className:`table-numbers inline-flex items-center justify-center min-w-[8ch] sm:min-w-[10ch] px-3 sm:px-5 py-1.5 rounded-xl font-black shadow bg-gradient-to-r ${r} text-white text-sm sm:text-lg md:text-xl ${a}`},E(e,d))},M=(e,t)=>{if("USD"===e.code)return{buy:t.buy,sell:t.sell};const a=b(e.ratioBuy),r=b(e.ratioSell),n=a>0?a:1,l=r>0?r:1;return"divide"===e.method?{buy:+(t.buy/n),sell:+(t.sell/l)}:{buy:+(t.buy*n),sell:+(t.sell*l)}},O=(e,t)=>{const a=e.find(e=>"USD"===e.code)||{buy:5e3,sell:5050};return e.map(e=>{const{buy:r,sell:n}=M(e,a),l=t[e.code];let c=0;"object"==typeof l&&null!==l?c=b(l.sell):null!=l&&(c=b(l));let s=0;return c>0&&(s=(n-c)/c*100,s=Math.round(100*s)/100),{...e,buy:r,sell:n,changePct:s}})},F=e=>e.map(e=>({...e,ratioBuy:e.ratioBuy>0?e.ratioBuy:1,ratioSell:e.ratioSell>0?e.ratioSell:1})),B=({rows:e,onEditUSD:t,canEditUSD:a})=>{const r="undefined"!=typeof window&&window.matchMedia&&window.matchMedia("(max-width: 640px)").matches;return React.createElement("div",{className:"p-1 sm:p-0 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-1 sm:gap-2 md:gap-2"},e.map(e=>React.createElement("div",{key:e.code,className:"view-card hover:shadow-md transition "+("USD"===e.code&&a?"cursor-pointer":""),onClick:()=>"USD"===e.code&&a&&t(e)},React.createElement(T,{row:e,showName:!r}),React.createElement("div",{className:"mt-2 grid grid-cols-3 items-end card-grid-mobile gap-1",dir:"rtl"},React.createElement("div",{className:"text-center"},React.createElement("div",{className:"card-label"},"Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡"),React.createElement(_,{value:e.buy,type:"buy",className:"pill-card w-full text-sm",decimals:e.decimals||0})),React.createElement("div",{className:"text-center"},React.createElement("div",{className:"card-label"},"Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹"),React.createElement(_,{value:e.sell,type:"sell",className:"pill-card w-full text-sm",decimals:e.decimals||0})),React.createElement("div",{className:"text-center"},React.createElement("div",{className:"card-label"},"Ø§Ù„ØªØºÙŠØ± ÙÙŠ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±"),React.createElement(U,{pct:e.changePct,className:"w-full justify-center text-xs pill-card"}))))))},V=({rows:e,head:t,onEditUSD:a,canEditUSD:r})=>{const n="undefined"!=typeof window&&window.matchMedia&&window.matchMedia("(max-width: 640px)").matches;return React.createElement("div",{className:"w-full"},React.createElement("div",{className:`board-head grid grid-cols-[1fr_0.9fr_0.9fr_0.8fr] sm:grid-cols-[1.2fr_1fr_1fr_0.8fr] items-center h-8 sm:h-9 px-2 sm:px-4 ${t}`},React.createElement("div",{className:"font-bold text-[12px] sm:text-base text-right"},"Ø£Ø³Ø¹Ø§Ø± ØµØ±Ù Ø§Ù„Ø¹Ù…Ù„Ø§Øª"),React.createElement("div",{className:"font-bold text-[12px] sm:text-base text-center sm:pl-16"},"Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡"),React.createElement("div",{className:"font-bold text-[12px] sm:text-base text-center"},"Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹"),React.createElement("div",{className:"font-bold text-[12px] sm:text-base text-center"},"Ø§Ù„ØªØºÙŠØ± ÙÙŠ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±")),React.createElement("div",{className:"divide-y divide-gray-200"},e.map(e=>React.createElement("div",{key:e.code,className:"board-row grid grid-cols-[1fr_0.9fr_0.9fr_0.8fr] sm:grid-cols-[1.2fr_1fr_1fr_0.8fr] items-center gap-2 px-2 sm:px-4 py-2.5 sm:py-1.5 "+("USD"===e.code&&r?"cursor-pointer":""),onClick:()=>"USD"===e.code&&r&&a(e)},React.createElement("div",{className:"flex items-center gap-2 sm:gap-3"},React.createElement(T,{row:e,showName:!n})),React.createElement("div",{className:"flex justify-center sm:pl-20"},React.createElement(_,{value:e.buy,type:"buy",className:"pill-buy",decimals:e.decimals||0})),React.createElement("div",{className:"flex justify-center"},React.createElement(_,{value:e.sell,type:"sell",className:"pill-sell",decimals:e.decimals||0})),React.createElement("div",{className:"flex justify-center"},React.createElement(U,{pct:e.changePct,className:"cell-change-mobile change-pill"}))))))},P=({rows:e,action:t="edit",onChoose:a})=>{const r="delete"===t?"Ø­Ø°Ù":"ØªØ­Ø±ÙŠØ±",n="delete"===t?"text-red-600":"text-slate-500";return React.createElement("div",{className:"grid gap-2 pick-list"},e.map(e=>React.createElement("button",{key:e.code,type:"button",onClick:()=>a(e),className:"w-full text-right rounded-2xl border border-white/50 bg-white/30 hover:bg-white/50 backdrop-blur-md shadow-inner px-3 py-3 transition"},React.createElement("div",{className:"flex items-center justify-between gap-3"},React.createElement("span",{className:`text-sm font-semibold ${n}`},r),React.createElement("div",{className:"flex items-center gap-2"},React.createElement("span",{className:"flex items-center gap-2"},React.createElement("span",{className:"font-extrabold text-slate-700"},e.name),React.createElement("span",{className:"mx-1"},"â€”"),React.createElement("span",{className:"inline-flex font-black text-slate-900"},e.code)),React.createElement(I,{emoji:e.flag}))))))};function z({open:e,onClose:r,dt:n,autoTime:l,setDT:c,setAuto:s,setToast:o}){const[i,m]=t({...n}),[d,u]=t(l),[g,p]=t(n.date?R(n.date):"");a(()=>{e&&(m({...n}),u(l),p(n.date?R(n.date):""))},[e,n,l]);return React.createElement(S,{open:e,onClose:r,title:"Ø¶Ø¨Ø· Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®"},React.createElement("div",{className:"flex flex-wrap items-center gap-4"},React.createElement("label",{className:"inline-flex items-center gap-2"},React.createElement("input",{type:"checkbox",checked:d,onChange:e=>u(e.target.checked)}),React.createElement("span",null,"ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ")),React.createElement("label",{className:"inline-flex items-center gap-2"},React.createElement("input",{type:"checkbox",checked:!!i.is12,onChange:e=>m(t=>({...t,is12:e.target.checked}))}),React.createElement("span",null,"ØªÙ†Ø³ÙŠÙ‚ 12 Ø³Ø§Ø¹Ø©"))),!d&&React.createElement("div",{className:"grid sm:grid-cols-2 gap-3"},React.createElement("label",{className:"grid gap-1"},React.createElement("span",{className:"text-sm text-gray-600"},"Ø§Ù„ÙˆÙ‚Øª"),React.createElement("input",{type:"time",className:"fld table-numbers",value:(i.time||"").slice(0,5),onChange:e=>m(t=>({...t,time:e.target.value}))})),React.createElement("label",{className:"grid gap-1"},React.createElement("span",{className:"text-sm text-gray-600"},"Ø§Ù„ØªØ§Ø±ÙŠØ®"),React.createElement("input",{type:"date",className:"fld table-numbers",value:g,onChange:e=>p(e.target.value)}))),React.createElement("div",{className:"btn-row flex justify-end gap-2 pt-2"},React.createElement(D,{className:"text-white bg-red-600 w-32 h-11",onClick:()=>{r(),o({text:"âŒ ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡",type:"error"})}},"Ø¥Ù„ØºØ§Ø¡"),React.createElement(D,{className:"text-white bg-green-600 w-32 h-11",onClick:()=>{if(d)c(e=>({...e,is12:!!i.is12}));else{if(e=i.time||"",!/^([01]\d|2[0-3]):[0-5]\d$/.test((e||"").trim()))return void o({text:"ØµÙŠØºØ© Ø§Ù„ÙˆÙ‚Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø© (HH:MM)",type:"error"});if(!g)return void o({text:"Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ®Ù‹Ø§ ØµØ­ÙŠØ­Ù‹Ø§",type:"error"});const t=(e=>{if(!e||!/^\d{4}-\d{2}-\d{2}$/.test(e))return"";const[t,a,r]=e.split("-");return`${r}-${a}-${t}`})(g);if(!v(t))return void o({text:"ØµÙŠØºØ© Ø§Ù„ØªØ§Ø±ÙŠØ® ØºÙŠØ± ØµØ­ÙŠØ­Ø©",type:"error"});c(e=>({...e,time:i.time,date:t,is12:!!i.is12}))}var e;s(!!d),o({text:"ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙˆÙ‚Øª",type:"success"}),r()}},"Ø­ÙØ¸")))}const H=({data:e,editIdx:a,onCancel:r,onSaved:n,setToast:l})=>{const c=null!=a?e[a]:{flag:"",icon:"",code:"",name:"",ratioBuy:1,ratioSell:1,method:"multiply",decimals:0};const[s,o]=t({...c,decimals:null!=c&&null!=c.decimals?c.decimals:0});if(c&&"USD"===c.code)return React.createElement("div",{className:"form-currency"},React.createElement("div",{className:"grid gap-3"},React.createElement("div",{className:"text-sm text-gray-600 font-bold"},"ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± (USD) ÙÙ‚Ø·"),React.createElement("label",{className:"grid gap-1"},React.createElement("span",{className:"text-sm text-gray-600"},"Ø§Ù„Ø§Ø³Ù…"),React.createElement("input",{className:"fld",value:s.name||"",onChange:e=>o(t=>({...t,name:e.target.value})),placeholder:"Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±"}))),React.createElement("div",{className:"btn-row flex justify-end gap-2 pt-2"},React.createElement(D,{className:"text-white bg-red-600 w-32 h-11",onClick:()=>{r(),l({text:"âŒ ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡",type:"error"})}},"Ø¥Ù„ØºØ§Ø¡"),React.createElement(D,{className:"text-white bg-green-600 w-32 h-11",onClick:()=>{const t=(s.name||"").trim();if(!t)return l({text:"âš ï¸ Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±",type:"error"});const u=[...e];null!=a&&(u[a]={...c,name:t}),n(u),l({text:"âœ… ØªÙ… Ø­ÙØ¸ Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±",type:"success"}),r()}},"Ø­ÙØ¸")));return React.createElement("div",{className:"form-currency"},React.createElement("div",{className:"grid sm:grid-cols-2 gap-3"},React.createElement("label",{className:"grid gap-1"},React.createElement("span",{className:"text-sm text-gray-600"},"Ø§Ù„Ø±Ù…Ø² (ÙƒÙˆØ¯)"),React.createElement("input",{lang:"en",className:"fld table-numbers",value:s.code||"",onChange:e=>o(t=>({...t,code:e.target.value.toUpperCase()})),placeholder:"USD / EUR / SAR ..."})),React.createElement("label",{className:"grid gap-1"},React.createElement("span",{className:"text-sm text-gray-600"},"Ø§Ù„Ø§Ø³Ù…"),React.createElement("input",{className:"fld",value:s.name||"",onChange:e=>o(t=>({...t,name:e.target.value})),placeholder:"Ø§Ø³Ù… Ø£Ø³Ø¹Ø§Ø± ØµØ±Ù Ø§Ù„Ø¹Ù…Ù„Ø§Øª"})),React.createElement("label",{className:"grid gap-1"},React.createElement("span",{className:"text-sm text-gray-600"},"Ø¹Ù„Ù… (Emoji)"),React.createElement("input",{className:"fld",value:s.flag||"",onChange:e=>o(t=>({...t,flag:e.target.value})),placeholder:"ğŸ‡ºğŸ‡¸ Ù…Ø«Ù„Ø§"})),React.createElement("label",{className:"grid gap-1"},React.createElement("span",{className:"text-sm text-gray-600"},"Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù‚ØµÙŠØ±Ø©"),React.createElement("input",{lang:"en",className:"fld table-numbers",value:s.icon||"",onChange:e=>o(t=>({...t,icon:e.target.value})),placeholder:"USD, EUR..."})),React.createElement("label",{className:"grid gap-1"},React.createElement("span",{className:"text-sm text-gray-600"},"Ù†Ø³Ø¨Ø© Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡"),React.createElement(A,{allowDecimal:!0,value:s.ratioBuy??1,onChange:e=>o(t=>({...t,ratioBuy:e})),className:"fld"})),React.createElement("label",{className:"grid gap-1"},React.createElement("span",{className:"text-sm text-gray-600"},"Ù†Ø³Ø¨Ø© Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹"),React.createElement(A,{allowDecimal:!0,value:s.ratioSell??1,onChange:e=>o(t=>({...t,ratioSell:e})),className:"fld"})),React.createElement("div",{className:"grid grid-cols-2 gap-3 sm:col-span-2"},React.createElement("label",{className:"grid gap-1"},React.createElement("span",{className:"text-sm text-gray-600"},"Ø¹Ø¯Ø¯ Ø§Ù„Ø£ØµÙØ§Ø± Ø¨Ø¹Ø¯ Ø§Ù„ÙØ§ØµÙ„Ø©"),React.createElement(A,{allowDecimal:!1,min:0,max:6,value:null!=s.decimals?s.decimals:0,onChange:e=>o(t=>({...t,decimals:e})),className:"fld"})),React.createElement("label",{className:"grid gap-1"},React.createElement("span",{className:"text-sm text-gray-600"},"Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø­Ø³Ø§Ø¨"),React.createElement("select",{className:"fld",value:s.method||"multiply",onChange:e=>o(t=>({...t,method:e.target.value}))},React.createElement("option",{value:"multiply"},"Ø¶Ø±Ø¨"),React.createElement("option",{value:"divide"},"Ù‚Ø³Ù…Ø©"))))),React.createElement("div",{className:"btn-row flex justify-end gap-2 pt-2"},React.createElement(D,{className:"text-white bg-red-600 w-32 h-11",onClick:()=>{r(),l({text:"âŒ ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡",type:"error"})}},"Ø¥Ù„ØºØ§Ø¡"),React.createElement(D,{className:"text-white bg-green-600 w-32 h-11",onClick:()=>{const t=(s.code||"").trim().toUpperCase().slice(0,5),r=(s.name||"").trim(),c=b(s.ratioBuy),o=b(s.ratioSell),i=s.method||"multiply";if(!t||!r)return l({text:"âš ï¸ Ø£ÙƒÙ…Ù„ Ø§Ù„Ø­Ù‚ÙˆÙ„",type:"error"});if(!/^[A-Z]{2,5}$/.test(t))return l({text:"âš ï¸ Ø§Ù„ÙƒÙˆØ¯ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 2â€“5 Ø£Ø­Ø±Ù Ù„Ø§ØªÙŠÙ†ÙŠØ© ÙƒØ¨ÙŠØ±Ø©",type:"error"});if("USD"===t)return l({text:"âš ï¸ ØªØ¹Ø¯ÙŠÙ„/Ø¥Ø¶Ø§ÙØ© USD Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ â€” Ø§Ø³ØªØ®Ø¯Ù… Ø´Ø§Ø´Ø© Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±",type:"error"});if(m=null!=a?a:-1,e.some((e,a)=>e.code===t&&a!==m))return l({text:"âš ï¸ Ø§Ù„ÙƒÙˆØ¯ Ù…Ø³ØªØ®Ø¯Ù…",type:"error"});var m;if(!(c>0&&o>0))return l({text:"âš ï¸ Ø§Ù„Ù†Ù‘ÙØ³Ø¨ ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† 0",type:"error"});if(!j(s.flag||""))return l({text:"âš ï¸ Ø£Ø¯Ø®Ù„ Ø¹Ù„Ù… ØµØ­ÙŠØ­ (Emoji)",type:"error"});const dec=Math.max(0,Math.min(6,parseInt(s.decimals,10)||0));const d={...s,code:t,name:r,ratioBuy:c,ratioSell:o,method:i,decimals:dec,flag:s.flag||"ğŸ³ï¸"},u=[...e];null!=a?u[a]=d:u.push(d),n(u);try{null==a&&window.Log&&window.Log.logEvent&&window.Log.logEvent("Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„Ø©",(s.name||t)+" ("+t+")")}catch(e){}l({text:"âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸",type:"success"})}},"Ø­ÙØ¸")))};ReactDOM.createRoot(document.getElementById("root")).render(React.createElement(function(){const[e,o]=t(null),[u,g]=t(navigator.onLine),v=n(navigator.onLine);a(()=>{v.current!==u&&(!1===v.current&&!0===u&&Et({text:"ğŸ”„ ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ â€” Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©",type:"info"}),v.current=u)},[u]),a(()=>{const e=()=>{g(!0)},t=()=>g(!1);return window.addEventListener("online",e),window.addEventListener("offline",t),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}},[]);const[R,j]=t(()=>{try{const e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return e&&(e.effectiveType||e.type)||""}catch(e){return""}}),I=n(R);a(()=>{const e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(!e)return;const t=()=>{const t=e.effectiveType||e.type||"";j(t)};t();try{e.addEventListener("change",t)}catch(a){e.onchange=t}return()=>{try{e.removeEventListener("change",t)}catch(t){e.onchange=null}}},[]),a(()=>{if(I.current===R)return;const e=R?R.toLowerCase():"";e.includes("cell")||/(2g|3g|4g|5g)/.test(e);I.current=R},[R]),a(()=>{try{const e=p.load();if(e){if(e.version!==m){p.save({version:m}),Et({text:"â„¹ï¸ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©...",type:"info"});const e=window.$db?.onValue(window.$db.ref("taif/data"),t=>{t.val()&&(Et({text:"âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",type:"success"}),e&&window.$db.off(window.$db.ref("taif/data")))})}}else p.save({version:m})}catch(e){console.error("Version check error",e)}},[]),y(d.DATA,null);y(d.BANNER,null);const L=(y(d.DT,null),p.load()||{}),[U,T]=t(""),[_,W]=t("Ù„ÙˆØ­Ø© Ø£Ø³Ø¹Ø§Ø± ØµØ±Ù Ø§Ù„Ø¹Ù…Ù„Ø§Øª"),[J,G]=t("");let Y;try{Y=localStorage.getItem(d.THEME)}catch(e){Y=null}const[q,K]=t(Y||"");a(()=>{const e=document.getElementById("body"),t=N[q],a=q&&C.has(q)?q:"bg-gradient-to-tr from-cyan-200 via-white to-cyan-200 text-gray-900",r=t?`th-${t.id}`:"th-default";e.className=`min-h-screen transition-colors duration-500 ${a} ${r}`;try{const e=document.getElementById("bgfix");e&&(e.className=`bg-fixed-gradient bg-gradient-to-tr ${k(q)}`)}catch(e){}},[q]),a(()=>{try{localStorage.setItem(d.THEME,q)}catch(e){}},[q]);const Z=y(d.DATA,null),[Q,X]=(L&&L.data||Z&&Z.data,t([])),ee={texts:["ğŸ“¢ Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒÙ…","ğŸ’µ Ø£Ø³Ø¹Ø§Ø±Ù†Ø§ ØªÙ†Ø§ÙØ³ÙŠØ© ÙŠÙˆÙ…ÙŠÙ‹Ø§","ğŸŒ ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§"],color:"#000000",moveDur:1.5,stayDur:3},[te,ae]=t(ee),[re,ne]=t({...te});a(()=>{x(d.BANNER,te)},[te]);const[le,ce]=t({date:"",time:"",is12:!1}),[se,oe]=t(!0);a(()=>{x(d.DT,le)},[le]);const[ie,me]=t(()=>{try{const e=localStorage.getItem("taif:session");if(e){const t=JSON.parse(e);if(t)return t}}catch(e){}return null}),[de,ue]=t("");React.useEffect(()=>{if(!ie)return;const e=ie.username,t=localStorage.getItem("taif:device_id"),a=localStorage.getItem("taif:session_token"),r=async()=>{try{await window.$db.set(window.$db.ref(`taif/session/${e}`),{deviceId:t,token:a,ua:navigator.userAgent,lockedAt:Date.now(),lastSeen:Date.now()})}catch(e){}};r();const n=setInterval(r,6e5);return()=>clearInterval(n)},[ie]);const[ge,pe]=t(""),[fe,be]=t(""),[we,ye]=t(!1),[xe,Ee]=t(!1),[ve,Re]=t(!1),[he,Ne]=t({}),[ke,Ce]=t(null),[$e,De]=t(!1),[Se,je]=t([]),Ie=()=>{if(!Gt.current)return void Et({text:"âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",type:"error"});const e=window.$db.ref("taif/adminactionslog"),t=window.$db.onValue(e,a=>{const r=a.val()||{},n=Object.values(r).sort((e,t)=>{const a=e&&e.at?e.at:0;return(t&&t.at?t.at:0)-a});je(n),De(!0),t&&window.$db.off(e)})},Ae=[{key:"tradeBuy",label:"ğŸŸ¢ ØªÙ†ÙÙŠØ° Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡"},{key:"tradeSell",label:"ğŸ”´ ØªÙ†ÙÙŠØ° Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹"},{key:"tradeExchange",label:"ğŸŸ§ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø³ÙˆØ±ÙŠØ© Ø¬Ø¯ÙŠØ¯"},{key:"viewTradeLogs",label:"ğŸ§¾ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¨ÙŠØ¹ ÙˆØ§Ù„Ø´Ø±Ø§Ø¡ ÙˆØ§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„"},{key:"editUSD",label:"ğŸ’µ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±"},{key:"bulkEdit",label:"ğŸ› ï¸ ØªØ¹Ø¯ÙŠÙ„ ÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª"},{key:"addCurrency",label:"â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„Ø©"},{key:"editCurrency",label:"âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù…Ù„Ø©"},{key:"deleteCurrency",label:"ğŸ—‘ï¸ Ø­Ø°Ù Ø¹Ù…Ù„Ø©"},{key:"changeView",label:"ğŸ›ï¸ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¹Ø±Ø¶"},{key:"changeTheme",label:"ğŸ¨ Ø§Ù„Ø«ÙŠÙ…"},{key:"editBanner",label:"âš¡ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª"},{key:"editLogo",label:"ğŸ–¼ï¸ ØªØºÙŠÙŠØ± Ø§Ù„Ù„ÙˆØºÙˆ/Ø§Ù„Ø¹Ù†ÙˆØ§Ù†"},{key:"manageTradeFields",label:"âš™ï¸ Ø­Ù‚ÙˆÙ„ Ù…Ø¨ÙŠØ¹ Ø´Ø±Ø§Ø¡ Ø§Ø³ØªØ¨Ø¯Ø§Ù„"},{key:"manageUsers",label:"ğŸ‘¤ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†"},{key:"viewAdminLogs",label:"ğŸ“œ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©"},{key:"adjustDatetime",label:"ğŸ•’ Ø¶Ø¨Ø· Ø§Ù„ÙˆÙ‚Øª"},{key:"logout",label:"ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬"}],Le=Ae.reduce((e,t)=>(e[t.key]=t.label,e),{}),[Ue,Te]=t({username:"",password:"",name:"",role:"",perms:{}}),[_e,Me]=t(""),Oe=async e=>{if(e&&e.preventDefault(),be(""),de&&ge)try{if(!window.$db)return void be("â³ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±ØŒ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...");if(!Gt.current)return void be("âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");const e=window.$db.ref("taif/users"),t=window.$db.onValue(e,a=>{const r=(a.val()||{})[de];if(t&&window.$db.off(e),!r){be("âš ï¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");try{window.Log&&window.Log.loginFail&&window.Log.loginFail(de)}catch(e){}return}const n=r.password||r.passwordHash||"";try{const e=window.bcrypt||window.dcodeIO&&window.dcodeIO.bcrypt;if(!e)return void be("âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© Ø§Ù„ØªØ­Ù‚Ù‚");e.compare(ge,n,function(e,t){if(e||!t){be("âš ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©");try{window.Log&&window.Log.loginFail&&window.Log.loginFail(de)}catch(e){}return}let a=[];Array.isArray(r.permissions)?a=r.permissions:r.permissions&&"object"==typeof r.permissions&&(a=Object.keys(r.permissions).filter(e=>r.permissions[e]));const n=function(){try{let e=localStorage.getItem(s);if(!e){const t=crypto&&crypto.getRandomValues?crypto.getRandomValues(new Uint32Array(4)):new Uint32Array([4294967295&Date.now(),1e9*Math.random()|0,1e9*Math.random()|0,1e9*Math.random()|0]);e="dev_"+Array.from(t).map(e=>e.toString(16)).join(""),localStorage.setItem(s,e)}return e}catch(e){return"dev_fallback"}}(),l=`taif/session/${de}`,c=window.$db.ref(l),o=window.$db.onValue(c,async e=>{o&&window.$db.off(c);const t=e&&e.val?e.val():null;if(t&&t.deviceId&&t.deviceId!==n){be("â›” Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ù‚ÙÙˆÙ„ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø² Ø¢Ø®Ø±. Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ø£ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹.");try{window.Log&&window.Log.loginFail&&window.Log.loginFail(de)}catch(e){}return}const l=crypto.randomUUID&&crypto.randomUUID()||Date.now()+"_"+Math.random().toString(36).slice(2);try{localStorage.setItem("taif:session_token",l)}catch(e){}await window.$db.set(c,{deviceId:n,token:l,ua:navigator.userAgent,lockedAt:Date.now(),lastSeen:Date.now()});const s={username:de,role:r.role||"",permissions:a};try{localStorage.setItem("taif:session",JSON.stringify(s))}catch(e){}me(s),ye(!1),ue(""),pe(""),be(""),Et({text:"âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­",type:"success"});try{window.Log&&window.Log.loginSuccess&&window.Log.loginSuccess(de)}catch(e){}})})}catch(e){console.error(e),be("âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±")}})}catch(e){console.error(e),be("âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„");try{window.Log&&window.Log.loginFail&&window.Log.loginFail(de)}catch(e){}}else be("âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±")},Fe=async()=>{try{const e=ie&&ie.username;e&&await window.$db.set(window.$db.ref(`taif/session/${e}`),null);try{localStorage.removeItem("taif:session_token")}catch(e){}}catch(e){}try{localStorage.removeItem("taif:session")}catch(e){}me(null),ye(!0);try{window.Log&&window.Log.logout&&window.Log.logout(ie&&ie.username||"")}catch(e){}},Be=l(e=>!!ie&&("superadmin"===ie.role||"emergency"===ie.role||Array.isArray(ie.permissions)&&ie.permissions.includes(e)),[ie]);a(()=>{if(!ie)return;const e=window.$db.ref("taif/users"),t=window.$db.onValue(e,e=>{try{const users=(e.val()||{});const a=users[ie.username];try{window.__taif_users_last_nonempty=(users&&Object.keys(users).length)?Date.now():(window.__taif_users_last_nonempty||0);}catch(_){}if(!a){try{var keys=users?Object.keys(users):[];if((!navigator.onLine)||(keys.length===0)){return;}var st=window.__taif_missing_user_state||{count:0,at:0};var now=Date.now();if(now-st.at>8000)st.count=0;st.at=now;st.count++;window.__taif_missing_user_state=st;if(st.count<3){return;}}catch(_){ }Et({text:"ğŸšª ØªÙ… Ø­Ø°Ù Ø­Ø³Ø§Ø¨Ùƒ â€” ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬",type:"error"});return void Fe();}try{if(window.__taif_missing_user_state)window.__taif_missing_user_state={count:0,at:0};}catch(_){}if(a.banned){Et({text:"â›” Ø­Ø³Ø§Ø¨Ùƒ Ù…ÙˆÙ‚Ù‘Ù â€” ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬",type:"error"});return void Fe();}const r=a.role||"",n=(t=a.permissions,Array.isArray(t)?t:t&&"object"==typeof t?Object.keys(t).filter(e=>t[e]):[]),l=Array.isArray(ie.permissions)?ie.permissions:[],c=(ie.role||"")!==r,s=!((e,t)=>{if(!Array.isArray(e)||!Array.isArray(t))return!1;if(e.length!==t.length)return!1;const a=[...e].sort(),r=[...t].sort();for(let e=0;e<a.length;e++)if(a[e]!==r[e])return!1;return!0})(l,n);if(c||s){const e={...ie,role:r,permissions:n};me(e);try{localStorage.setItem("taif:session",JSON.stringify(e))}catch(e){}Et({text:"ğŸ”„ ØªÙ… ØªØ­Ø¯ÙŠØ« ØµÙ„Ø§Ø­ÙŠØ§ØªÙƒ Ù„Ø­Ø¸ÙŠÙ‹Ø§",type:"info"})}}catch(e){}var t});return()=>{t&&window.$db.off(e)}},[ie?.username]),a(()=>{if(!xe)return;if(!Gt.current)return;const e=window.$db.ref("taif/users"),t=window.$db.onValue(e,e=>{const t=e.val()||{};Ne(t)});return()=>{t&&window.$db.off(e)}},[xe]);const Ve=l(()=>{const e=new Date,t=w(e.getMinutes()),a=w(e.getHours()),r=e.getHours()%12||12,n=e.getHours()>=12?"PM":"AM",l=le.is12?`${r}:${t} ${n}`:`${a}:${t}`,c=`${w(e.getDate())}-${w(e.getMonth()+1)}-${e.getFullYear()}`;return{time:se||!le.time?l:le.time,date:le.date||c}},[le,se]),[Pe,ze]=t(Ve());a(()=>{const e=setInterval(()=>ze(Ve()),1e3);return()=>clearInterval(e)},[Ve]);const He=()=>{const e=new Date;return`${e.getFullYear()}-${w(e.getMonth()+1)}-${w(e.getDate())}`},[We,Je]=t({}),[Ge,Ye]=t(""),qe=n(We);a(()=>{qe.current=We},[We]);const Ke=n(Ge);a(()=>{Ke.current=Ge},[Ge]);const Ze=n(Q);a(()=>{Ze.current=Q},[Q]);const Qe=n(!1),Xe=n(!1),et=n(!1),tt=n(!1),at=n(!1);a(()=>{try{if(!We||0===Object.keys(We).length){const e={};O(Q,{}).forEach(t=>{e[t.code]=t.sell});const t=He();Je(e),Ye(t),Jt({base:e,baseDate:t}),Zt.current.base=!0}}catch(e){}},[Q]),a(()=>{let e;const t=()=>{const a=new Date;let r=new Date(a.getFullYear(),a.getMonth(),a.getDate(),18,0,0);r.getTime()<=a.getTime()&&r.setDate(r.getDate()+1);const n=Math.max(0,r.getTime()-a.getTime());e=setTimeout(()=>{const e={};try{O(Ze.current,{}).forEach(t=>{e[t.code]=t.sell})}catch(e){}Je(e);const a=He();Ye(a),Jt({base:e,baseDate:a}),Zt.current.base=!0;try{window.$db&&u&&(Yt.current.base=!0,window.$db.set(window.$db.ref("taif/base"),{date:a,base:e}))}catch(e){}t()},n)};return t(),()=>clearTimeout(e)},[]);const rt=r(()=>O(Q,We),[Q,We]),nt=n([]);a(()=>{rt&&rt.length&&(nt.current=rt)},[rt]);const lt=r(()=>rt,[rt]),ct=n(null),st=n(null),[ot,it]=t({i:0,snap:!0,x:0}),mt=n(null),dt=()=>{mt.current&&(clearTimeout(mt.current),mt.current=null)},ut=()=>{try{const e=ct.current?.clientWidth||0,t=document.body?.clientWidth||window.innerWidth||0;return Math.max(0,(t-e)/2)}catch(e){return 0}},gt=e=>{const t=ct.current?.clientWidth||0,a=st.current?.clientWidth||0;return t&&a?"right"===e?t/2+a/2+8:"left"===e?-(t/2+a/2)-8:0:0},pt=l(()=>{te.texts.length&&(dt(),it(e=>({...e,snap:!0,x:gt("right")})),requestAnimationFrame(()=>requestAnimationFrame(()=>{it(e=>({...e,snap:!1,x:ut()})),mt.current=setTimeout(()=>{mt.current=setTimeout(()=>{it(e=>({...e,x:gt("left")})),mt.current=setTimeout(()=>{it(e=>({i:(e.i+1)%te.texts.length,snap:!0,x:ut()})),pt()},1e3*te.moveDur)},1e3*te.stayDur)},1e3*te.moveDur)})))},[te.texts,te.moveDur,te.stayDur]);a(()=>(pt(),()=>dt()),[pt]);const[ft,bt]=t(!1);n(null),a(()=>{if(!ft)return;const e=e=>{"Escape"===e.key&&bt(!1)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[ft]);const[wt,yt]=t(null),[xt,Et]=t(null);a(()=>{if(!u){try{bt(!1)}catch(e){}try{yt(null)}catch(e){}}},[u]);const[vt,Rt]=t(null),ht=Q.find(e=>"USD"===e.code)||{buy:5e3,sell:5050},[Nt,kt]=t({buy:ht.buy,sell:ht.sell}),Ct=e=>{u?(kt({buy:e.buy,sell:e.sell}),yt("usd")):Et({text:"âš ï¸ ØºÙŠØ± Ù…ØªØµÙ„ â€” Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù…ØªØ§Ø­ ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„",type:"error"})};let $t;try{$t=localStorage.getItem(d.VIEW)}catch(e){$t=null}const[Dt,St]=t($t||"board"),[jt,It]=t(Dt);a(()=>{try{localStorage.setItem(d.VIEW,Dt)}catch(e){}},[Dt]);const[At,Lt]=t(q);a(()=>{"themes"===wt&&Lt(q)},[wt,q]);const[Ut,Tt]=t([]),[_t,Mt]=t(""),[Ot,Ft]=t(U),[Bt,Vt]=t(_),[Pt,zt]=t(J);a(()=>{"logo"===wt&&(Ft(U),Vt(_),zt(J))},[wt,U,_,J]);const Ht=(e=>N[e]?.head||"bg-gradient-to-r from-purple-700 via-indigo-600 to-blue-600 text-white")(q),Wt=k(q),Jt=(e={})=>{const t={lastSync:(new Date).toISOString(),...e};o(t.lastSync)},Gt=React.useRef(null),Yt=React.useRef({data:!1,banner:!1,theme:!1,title:!1,logo:!1,bannerImg:!1,view:!1,base:!1,datetime:!1}),qt=React.useRef(()=>{}),Kt=()=>{try{if(!Gt.current)return;Gt.current;["taif/data","taif/banner","taif/title","taif/logo","taif/bannerImg","taif/datetime","taif/base","taif/theme","taif/view"].forEach(e=>window.$db.off(window.$db.ref(e)))}catch(e){}},Zt=React.useRef({data:!1,banner:!1,theme:!1,title:!1,logo:!1,bannerImg:!1,view:!1,base:!1,datetime:!1});return React.useEffect(()=>{Gt.current&&Zt.current.datetime&&(Yt.current.datetime?Yt.current.datetime=!1:Gt.current.set(Gt.current.ref("taif/datetime"),{time:le.time,date:le.date,is12:le.is12,autoTime:se}))},[le,se]),React.useEffect(()=>{const e=()=>{qt.current=e;const t=window.$db;t&&(Gt.current=t,window.$db.onValue(window.$db.ref("taif/data"),e=>{Zt.current.data=!0;const t=e.val();t&&Array.isArray(t)?(Yt.current.data=!0,Qe.current=!0,Xe.current=!0,X(t),Jt({data:t}),function(){try{window.__trade_refreshOpenRate&&window.__trade_refreshOpenRate()}catch(e){}}()):(Qe.current=!1,Et({text:"âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© â€” Ø³ÙŠØªÙ… Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©",type:"warning"}))}),window.$db.onValue(window.$db.ref("taif/banner"),e=>{Zt.current.banner=!0;const t=e.val();t&&"object"==typeof t&&(Yt.current.banner=!0,ae(t),ne(t),Jt({banner:t}))}),window.$db.onValue(window.$db.ref("taif/title"),e=>{Zt.current.title=!0;const t=e.val();"string"==typeof t&&t.length>0?et.current=!0:et.current=!1,"string"==typeof t&&t!==_&&(Yt.current.title=!0,W(t),Jt({title:t}))}),window.$db.onValue(window.$db.ref("taif/logo"),e=>{Zt.current.logo=!0;const t=e.val();"string"==typeof t&&t!==U&&(Yt.current.logo=!0,T(t),Jt({logo:t}))}),window.$db.onValue(window.$db.ref("taif/bannerImg"),e=>{Zt.current.bannerImg=!0;const t=e.val();"string"==typeof t&&t!==J&&(Yt.current.bannerImg=!0,G(t),Jt({bannerImg:t}))}),window.$db.onValue(window.$db.ref("taif/datetime"),e=>{Zt.current.datetime=!0;const t=e.val();t&&"object"==typeof t&&(Yt.current.datetime=!0,ce({time:t.time||"",date:t.date||"",is12:!!t.is12}),oe(!!t.autoTime),Jt({datetime:{time:t.time||"",date:t.date||"",is12:!!t.is12,autoTime:!!t.autoTime}}))}),window.$db.onValue(window.$db.ref("taif/base"),e=>{Zt.current.base=!0;const t=e.val();if(!t||!t.date||!t.base){let e,t;at.current=!1;const a=qe.current,r=Ke.current;a&&Object.keys(a).length>0&&r?(e={...a},t=r):(e={},O(Ze.current||Q,{}).forEach(t=>{e[t.code]=t.sell}),t=He()),Yt.current.base=!0,Je(e),Ye(t),Jt({base:e,baseDate:t});try{Yt.current.base=!0,window.$db.set(window.$db.ref("taif/base"),{date:t,base:e})}catch(e){}return}const a={};try{Object.entries(t.base).forEach(([e,t])=>{a[e]=b(t&&"object"==typeof t&&"sell"in t?t.sell:t)})}catch(e){}const r=t.date,n=Ke.current;if(at.current=!0,tt.current=!0,!n||n!==r)return Yt.current.base=!0,Je(a),Ye(r),void Jt({base:a,baseDate:r});const l=qe.current;l&&0!==Object.keys(l).length||(Yt.current.base=!0,Je(a),Ye(r),Jt({base:a,baseDate:r}))}))};if(window.$db)e();else{const t=()=>{e(),window.removeEventListener("db-ready",t)};window.addEventListener("db-ready",t)}},[]),React.useEffect(()=>{if(window.$db)if(u)try{Kt(),"function"==typeof qt.current&&qt.current(),!1===v.current&&!0===u&&Et({text:"ğŸ”„ ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ â€” Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©",type:"info"})}catch(e){}else Kt()},[u]),React.useEffect(()=>{Gt.current&&Zt.current.data&&(Yt.current.data?Yt.current.data=!1:(Qe.current||Xe.current&&Array.isArray(Q)&&Q.length>0)&&Gt.current.set(Gt.current.ref("taif/data"),Q))},[Q]),React.useEffect(()=>{Gt.current&&Zt.current.banner&&(Yt.current.banner?Yt.current.banner=!1:Gt.current.set(Gt.current.ref("taif/banner"),te))},[te]),React.useEffect(()=>{Gt.current&&Zt.current.title&&(Yt.current.title?Yt.current.title=!1:et.current&&Gt.current.set(Gt.current.ref("taif/title"),_))},[_]),React.useEffect(()=>{Gt.current&&Zt.current.logo&&(Yt.current.logo?Yt.current.logo=!1:Gt.current.set(Gt.current.ref("taif/logo"),U||""))},[U]),React.useEffect(()=>{Gt.current&&Zt.current.bannerImg&&(Yt.current.bannerImg?Yt.current.bannerImg=!1:Gt.current.set(Gt.current.ref("taif/bannerImg"),J||""))},[J]),React.useEffect(()=>{if(Gt.current&&Zt.current.base)if(Yt.current.base)Yt.current.base=!1;else if(at.current)try{Yt.current.base=!0,window.$db.set(window.$db.ref("taif/base"),{date:Ge,base:We})}catch(e){}else if(tt.current)try{Yt.current.base=!0,window.$db.set(window.$db.ref("taif/base"),{date:Ge,base:We})}catch(e){}},[We,Ge]),a(()=>{if(!window.$db||!u)return;if(!Array.isArray(Q)||0===Q.length)return;const e=He(),t=Ke.current;if(!t||t!==e){const t={};try{O(Ze.current,{}).forEach(e=>{t[e.code]=e.sell})}catch(e){}Je(t),Ye(e),Jt({base:t,baseDate:e}),Zt.current.base=!0;try{Yt.current.base=!0,window.$db.set(window.$db.ref("taif/base"),{date:e,base:t})}catch(e){}}},[Q,u]),ie?React.createElement("div",{className:"w-full px-2 sm:px-0 lg:px-2 xl:px-2 pb-24"},!u&&React.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm pointer-events-auto"},React.createElement("div",{className:"bg-yellow-200 text-yellow-900 px-6 py-4 rounded-xl shadow-lg text-center font-semibold"},"âš ï¸ ØºÙŠØ± Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª",React.createElement("div",{className:"text-sm font-normal"},"Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„"))),React.createElement("header",{className:"mt-1 mb-1"},React.createElement("div",{className:"hdr grid items-center gap-3 sm:gap-4 h-auto sm:h-40 md:h-44"},React.createElement("div",{className:"glass rounded-2xl border-2 border-gray-300 h-full w-full overflow-hidden bg-white/60 logo-box"},U?React.createElement("img",{src:U,alt:"Ø§Ù„Ø´Ø¹Ø§Ø±",className:"w-full h-full object-fill"}):React.createElement("span",{className:"flex items-center justify-center h-full text-gray-400 text-sm"},"Ø§Ù„Ø´Ø¹Ø§Ø±")),React.createElement("div",{className:"h-full flex items-center justify-center px-3 overflow-hidden title-plain"},React.createElement("h1",{className:"font-black leading-tight text-center whitespace-normal break-words text-[clamp(1.5rem,4vw,2.7rem)]"},_)),React.createElement("div",{className:"glass rounded-2xl border-2 border-gray-300 h-full w-full overflow-hidden bg-white/60 banner-box"},J?React.createElement("img",{src:J,alt:"Ø§Ù„ØµÙˆØ±Ø©",className:"w-full h-full object-fill"}):React.createElement("span",{className:"flex items-center justify-center h-full text-gray-400 text-sm"},"ØµÙˆØ±Ø©")))),ft&&ReactDOM.createPortal(React.createElement(React.Fragment,null,React.createElement("div",{className:"drawer-backdrop",onClick:()=>bt(!1)}),React.createElement("div",{className:"drawer "+(ft?"open":""),role:"dialog","aria-modal":"true","aria-label":"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª",dir:"ltr"},React.createElement("header",null,React.createElement("span",null,"Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª"),React.createElement("button",{className:"px-2 py-1 rounded-lg border",onClick:()=>bt(!1),"aria-label":"Ø¥ØºÙ„Ø§Ù‚"},"âœ–")),React.createElement("div",{className:"content",dir:"ltr"},ie&&React.createElement("div",{className:"p-2 border-b text-center text-gray-700"},React.createElement("div",{className:"font-semibold text-base"},ie.username),React.createElement("div",{className:"text-xs text-gray-500"},"emergency"===ie.role?"Ø§Ù„Ø§Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø©":"superadmin"===ie.role?"Ø§Ø¯Ø§Ø±Ø© Ø§Ù„ÙØ±Ø¹":"admin"===ie.role?"Ù…ÙˆØ¸Ù":ie.role||"")),React.createElement("div",{className:"grid gap-2"},Be("tradeBuy")&&React.createElement("button",{type:"button",className:"btn-drawer",onClick:()=>{bt(!1);try{window.__trade&&window.__trade.buy&&window.__trade.buy()}catch(e){}}},"ğŸŸ¢ ØªÙ†ÙÙŠØ° Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡"),Be("tradeSell")&&React.createElement("button",{type:"button",className:"btn-drawer",onClick:()=>{bt(!1);try{window.__trade&&window.__trade.sell&&window.__trade.sell()}catch(e){}}},"ğŸ”´ ØªÙ†ÙÙŠØ° Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹"),Be("tradeExchange")&&React.createElement("button",{type:"button",className:"btn-drawer",onClick:()=>{bt(!1);try{window.__trade&&window.__trade.exchange&&window.__trade.exchange()}catch(e){}}},"ğŸŸ§ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø³ÙˆØ±ÙŠØ© Ø¬Ø¯ÙŠØ¯"),Be("viewTradeLogs")&&React.createElement("button",{type:"button",className:"btn-drawer",onClick:()=>{bt(!1);try{window.__trade&&window.__trade.logs&&window.__trade.logs()}catch(e){}}},"ğŸ§¾ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¨ÙŠØ¹ ÙˆØ§Ù„Ø´Ø±Ø§Ø¡ ÙˆØ§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„"),Be("editUSD")&&React.createElement("button",{type:"button",className:"btn-drawer",onClick:()=>{bt(!1),Ct(ht)}},"ğŸ’µ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±"),Be("bulkEdit")&&React.createElement("button",{type:"button",className:"btn-drawer",onClick:()=>{bt(!1),Tt(Q.map(e=>({...e}))),Mt(""),yt("bulk")}},"ğŸ› ï¸ ØªØ¹Ø¯ÙŠÙ„ ÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª"),Be("addCurrency")&&React.createElement("button",{type:"button",className:"btn-drawer",onClick:()=>{bt(!1),Rt(null),yt("form")}},"â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„Ø©"),Be("editCurrency")&&React.createElement("button",{type:"button",className:"btn-drawer",onClick:()=>{bt(!1),yt("pick")}},"âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù…Ù„Ø©"),Be("deleteCurrency")&&React.createElement("button",{type:"button",className:"btn-drawer",onClick:()=>{bt(!1),yt("pickDelete")}},"ğŸ—‘ï¸ Ø­Ø°Ù Ø¹Ù…Ù„Ø©"),Be("changeView")&&React.createElement("button",{type:"button",className:"btn-drawer",onClick:()=>{bt(!1),It(Dt),yt("view")}},"ğŸ›ï¸ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¹Ø±Ø¶"),Be("changeTheme")&&React.createElement("button",{type:"button",className:"btn-drawer",onClick:()=>{bt(!1),yt("themes")}},"ğŸ¨ Ø§Ù„Ø«ÙŠÙ…"),Be("editBanner")&&React.createElement("button",{type:"button",className:"btn-drawer",onClick:()=>{bt(!1),ne({...te}),yt("banner")}},"âš¡ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª"),Be("editLogo")&&React.createElement("button",{type:"button",className:"btn-drawer",onClick:()=>{bt(!1),yt("logo")}},"ğŸ–¼ï¸ ØªØºÙŠÙŠØ± Ø§Ù„Ù„ÙˆØºÙˆ/Ø§Ù„Ø¹Ù†ÙˆØ§Ù†"),Be("manageTradeFields")&&React.createElement("button",{type:"button",className:"btn-drawer",onClick:()=>{bt(!1);try{window.__trade&&window.__trade.fields&&window.__trade.fields()}catch(e){}}},"âš™ï¸ Ø­Ù‚ÙˆÙ„ Ù…Ø¨ÙŠØ¹ Ø´Ø±Ø§Ø¡ Ø§Ø³ØªØ¨Ø¯Ø§Ù„"),Be("manageUsers")&&React.createElement("button",{type:"button",className:"btn-drawer",onClick:()=>{bt(!1),Ce(null),Re(!1),Te({username:"",password:"",name:"",role:"",perms:{}}),Ee(!0)}},"ğŸ‘¤ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†"),Be("viewAdminLogs")&&React.createElement("button",{type:"button",className:"btn-drawer",onClick:()=>{bt(!1),Ie()}},"ğŸ“œ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©"),Be("adjustDatetime")&&React.createElement("button",{type:"button",className:"btn-drawer",onClick:()=>{bt(!1),yt("datetime")}},"ğŸ•’ Ø¶Ø¨Ø· Ø§Ù„ÙˆÙ‚Øª"),Be("logout")&&React.createElement("button",{type:"button",className:"btn-drawer",onClick:()=>{bt(!1),Fe()}},"ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬"))),React.createElement("div",{className:"px-3 py-2 text-xs text-gray-500 text-center border-t"},"Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ: ",m,e&&React.createElement("div",{className:"mt-1 opacity-70"},"Ø¢Ø®Ø± Ù…Ø²Ø§Ù…Ù†Ø©: ",new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))))),document.body),u&&!(ft||wt)&&React.createElement("div",{className:"fixed left-3 bottom-1 z-[100] translate-y-1"},React.createElement("button",{type:"button",onClick:()=>bt(e=>!e),"aria-label":"ÙØªØ­ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª",className:"text-gray-800 hover:scale-110 transition-transform text-[22px] sm:text-[26px] lg:text-[30px]",style:{background:"transparent",border:"none"}},"âš™ï¸")),React.createElement("div",{className:`mt-1 rounded-3xl border-2 border-gray-300 shadow overflow-hidden bg-gradient-to-tr ${Wt}`},"cards"===Dt&&React.createElement("div",{className:"cards-view p-2 sm:p-3"},React.createElement(B,{rows:lt,onEditUSD:Ct,canEditUSD:Be("editUSD")})),"board"===Dt&&React.createElement(V,{rows:lt,head:Ht,onEditUSD:Ct,canEditUSD:Be("editUSD")})),React.createElement(S,{open:"usd"===wt,onClose:()=>yt(null),title:"ØªØ¹Ø¯ÙŠÙ„ Ø³Ø¹Ø± Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±"},React.createElement("div",{className:"grid sm:grid-cols-2 gap-3"},React.createElement("label",{className:"grid gap-1"},React.createElement("span",{className:"text-sm text-gray-600"},"Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ (USD)"),React.createElement(A,{allowDecimal:!0,value:Nt.buy,onChange:e=>kt(t=>({...t,buy:e})),className:"fld w-full buy-bg"})),React.createElement("label",{className:"grid gap-1"},React.createElement("span",{className:"text-sm text-gray-600"},"Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹ (USD)"),React.createElement(A,{allowDecimal:!0,value:Nt.sell,onChange:e=>kt(t=>({...t,sell:e})),className:"fld w-full sell-bg"}))),React.createElement("div",{className:"btn-row flex justify-end gap-2 pt-2"},React.createElement(D,{className:"text-white bg-red-600 w-36 h-11",onClick:()=>{yt(null),Et({text:"âŒ ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡",type:"error"})}},"Ø¥Ù„ØºØ§Ø¡"),React.createElement(D,{className:"text-white bg-green-600 w-36 h-11",onClick:()=>{if(!(Nt.buy>0&&Nt.sell>0))return Et({text:"âš ï¸ Ù‚ÙŠÙ… USD ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† 0",type:"error"});X(e=>F(e.map(e=>"USD"===e.code?{...e,buy:b(Nt.buy),sell:b(Nt.sell)}:e))),yt(null),Et({text:"âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±",type:"success"});try{window.__trade_refreshOpenRate&&window.__trade_refreshOpenRate()}catch(e){}}},"Ø­ÙØ¸"))),React.createElement(S,{open:$e,onClose:()=>{De(!1)},title:"Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©"},React.createElement("div",{className:"grid gap-3"},React.createElement("div",{className:"flex justify-end"},React.createElement(D,{className:"text-white bg-red-600 w-36 h-10",onClick:()=>{if(!window.confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø³Ø¬Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ"))return;if(Gt.current)try{window.$db.set(window.$db.ref("taif/adminactionslog"),null),je([]),Et({text:"âœ… ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­",type:"success"})}catch(e){Et({text:"âš ï¸ ØªØ¹Ø°Ø± Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„",type:"error"})}else Et({text:"âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",type:"error"})}},"ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„")),React.createElement("div",{className:"max-h-[60vh] overflow-auto text-sm"},0===Se.length?React.createElement("div",{className:"text-center py-4"},"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª"):React.createElement("div",{className:"space-y-1 max-h-[60vh] overflow-y-auto pr-1"},Se.map((e,t)=>React.createElement("div",{key:t,className:"flex items-start justify-between gap-3 border-b border-gray-600/20 py-1"},React.createElement("div",{className:"text-xs opacity-70 whitespace-nowrap"},(function(e){try{const t=new Date(e);return `${t.getFullYear()}/${w(t.getMonth()+1)}/${w(t.getDate())} - ${w(t.getHours())}:${w(t.getMinutes())}:${w(t.getSeconds())}`}catch(t){return String(e||"")}})(e.at)),React.createElement("div",{className:"text-sm flex-1 text-right"},React.createElement("span",{className:"mr-1"},c[e.action]||"ğŸ“Œ"),React.createElement("span",null,((e={})=>{const t=e.action||"",a=e.target||"";return"ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±"===t?"ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø³Ø¹Ø± Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± "+(a?"â€” "+a:""):"ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù…Ù„Ø©"===t?`ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù…Ù„Ø© ${a}`:"ØªØ¹Ø¯ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„Ø§Øª"===t?`ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„Ø§Øª ${a}`:"Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª"===t?`ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ${a}`:"ØªØºÙŠÙŠØ± Ø§Ù„Ù‡ÙˆÙŠØ©"===t?`${a||"ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ù‡ÙˆÙŠØ©"}`:"ØªØºÙŠÙŠØ± Ø§Ù„ÙˆÙ‚Øª"===t?`ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„ÙˆÙ‚Øª ${a}`:"Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„"===t?"ØªÙ… Ù…Ø³Ø­ Ø³Ø¬Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„":"Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…"===t?`ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${a}`:"Ø­Ø°Ù Ù…Ø³ØªØ®Ø¯Ù…"===t?`ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${a}`:"ØªØ¹Ø¯ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù…"===t?`ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${a}`:"ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (Ù†Ø¬Ø§Ø­)"===t?"ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„":"ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (ÙØ´Ù„)"===t?"ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„":"ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬"===t?"ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬":`${t} ${a}`.trim()})(e)," â€” ",React.createElement("span",{className:"opacity-70"},"Ø¨ÙˆØ§Ø³Ø·Ø© ",e.actor||"â€”"))))))))),React.createElement(S,{open:"bulk"===wt,onClose:()=>yt(null),title:"ØªØ¹Ø¯ÙŠÙ„ ÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª"},React.createElement("div",{className:"flex flex-wrap items-center gap-2"},React.createElement("input",{className:"fld flex-1 min-w-[220px]",placeholder:"ğŸ” Ø¨Ø­Ø« ÙƒÙˆØ¯/Ø§Ø³Ù…",value:_t,onChange:e=>Mt(e.target.value.trim())})),React.createElement("div",{className:"bulk-grid bulk-head text-xs opacity-70 select-none"},React.createElement("div",null,"Ø£Ø³Ø¹Ø§Ø± ØµØ±Ù Ø§Ù„Ø¹Ù…Ù„Ø§Øª"),React.createElement("div",null,"Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©"),React.createElement("div",null,"Ù†Ø³Ø¨Ø© Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡"),React.createElement("div",null,"Ù†Ø³Ø¨Ø© Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹"),React.createElement("div",null,"Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡"),React.createElement("div",null,"Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹")),React.createElement("div",{className:"max-h-[56vh] sm:max-h-[62vh] overflow-auto"},(Ut.length?Ut:Q).filter(e=>!_t||e.code.toLowerCase().includes(_t.toLowerCase())||e.name.includes(_t)).map((e,t)=>{const a=Ut.length?Ut:Q,r=a.find(e=>"USD"===e.code)||{buy:5e3,sell:5050},n="USD"===e.code?{buy:e.buy,sell:e.sell}:M(e,r),l=r=>Tt(n=>(n.length?n:a).map((a,n)=>n===t?{...e,...r}:a));return React.createElement("div",{key:e.code,className:"bulk-grid bulk-row items-center hover:bg-slate-50"},React.createElement("div",{className:"cell-name name-inline"},React.createElement("span",{className:"truncate"},e.name),React.createElement("span",{className:"code-badge"},e.code)),React.createElement("div",{className:"cell-method"},React.createElement("span",{className:"m-label"},"Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©"),"USD"===e.code?React.createElement("div",null):React.createElement("div",{className:"seg"},React.createElement("button",{className:"mul "+("multiply"===e.method?"on":""),onClick:()=>l({method:"multiply"})},"Ø¶Ø±Ø¨"),React.createElement("button",{className:"div "+("divide"===e.method?"on":""),onClick:()=>l({method:"divide"})},"Ù‚Ø³Ù…Ø©"))),React.createElement("div",{className:"cell-rb"},React.createElement("span",{className:"m-label"},"Ù†Ø³Ø¨Ø© Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡"),"USD"===e.code?React.createElement("div",null):React.createElement(A,{allowDecimal:!0,className:"fld w-full",value:e.ratioBuy,onChange:e=>l({ratioBuy:e})})),React.createElement("div",{className:"cell-rs"},React.createElement("span",{className:"m-label"},"Ù†Ø³Ø¨Ø© Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹"),"USD"===e.code?React.createElement("div",null):React.createElement(A,{allowDecimal:!0,className:"fld w-full",value:e.ratioSell,onChange:e=>l({ratioSell:e})})),React.createElement("div",{className:"cell-buy"},React.createElement("span",{className:"m-label"},"Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡"),"USD"===e.code?React.createElement(A,{allowDecimal:!0,className:"fld w-full buy-bg",value:e.buy,onChange:e=>l({buy:b(e)})}):React.createElement("div",{className:"fld table-numbers w-full buy-bg select-none"},E(n.buy,e.decimals||0))),React.createElement("div",{className:"cell-sell"},React.createElement("span",{className:"m-label"},"Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹"),"USD"===e.code?React.createElement(A,{allowDecimal:!0,className:"fld w-full sell-bg",value:e.sell,onChange:e=>l({sell:b(e)})}):React.createElement("div",{className:"fld table-numbers w-full sell-bg select-none"},E(n.sell,e.decimals||0))))})),React.createElement("div",{className:"bulk-foot flex justify-end gap-2"},React.createElement(D,{className:"text-white bg-red-600 w-36 h-11",onClick:()=>{yt(null),Et({text:"âŒ ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡",type:"error"})}},"Ø¥Ù„ØºØ§Ø¡"),React.createElement(D,{className:"text-white bg-green-600 w-36 h-11",onClick:()=>{const e=Ut.length?Ut:Q;for(const t of e)if("USD"===t.code){if(!(t.buy>0&&t.sell>0))return Et({text:"âš ï¸ Ù‚ÙŠÙ… USD ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† 0",type:"error"})}else if(!(t.ratioBuy>0&&t.ratioSell>0))return Et({text:`âš ï¸ Ø§Ù„Ù†Ø³Ø¨ ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† 0 â€” ${t.code}`,type:"error"});X(F(e)),yt(null),Et({text:"âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« ÙƒØ§ÙØ© Ø§Ù„Ø¹Ù…Ù„Ø§Øª",type:"success"})}},"Ø­ÙØ¸ Ø§Ù„ÙƒÙ„"))),React.createElement(S,{open:"pickDelete"===wt,onClose:()=>yt(null),title:"Ø§Ø®ØªØ± Ø£Ø³Ø¹Ø§Ø± ØµØ±Ù Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ù„Ø­Ø°ÙÙ‡Ø§"},React.createElement(P,{rows:rt.filter(e=>"USD"!==e.code),action:"delete",onChoose:e=>{const t=Q.findIndex(t=>t.code===e.code);t>-1&&(Rt(t),yt("confirmDelete"))}}),React.createElement("div",{className:"flex justify-end pt-2"},React.createElement(D,{className:"text-white bg-red-600 w-28 h-11",onClick:()=>{yt(null),Et({text:"âŒ ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡",type:"error"})}},"Ø¥ØºÙ„Ø§Ù‚"))),React.createElement(S,{open:"confirmDelete"===wt,onClose:()=>yt(null),title:"ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù"},React.createElement("div",{className:"text-sm sm:text-base"},"Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ"),React.createElement("div",{className:"flex justify-end gap-2 pt-4"},React.createElement(D,{className:"text-white bg-red-600 w-28 h-11",onClick:()=>{yt(null),Et({text:"âŒ ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡",type:"error"})}},"Ø¥Ù„ØºØ§Ø¡"),React.createElement(D,{className:"text-white bg-green-600 w-28 h-11",onClick:()=>{if(null!=vt){try{var e=Array.isArray(Q)&&Q[vt]||null;e&&e.code&&window.Log&&window.Log.logEvent&&window.Log.logEvent("Ø­Ø°Ù Ø¹Ù…Ù„Ø©",(e.name||e.code)+" ("+e.code+")")}catch(e){}X(e=>e.filter((e,t)=>t!==vt))}yt(null),Et({text:"âœ… ØªÙ… Ø§Ù„Ø­Ø°Ù",type:"success"})}},"ØªØ£ÙƒÙŠØ¯"))),React.createElement(S,{open:"pick"===wt,onClose:()=>yt(null),title:"Ø§Ø®ØªØ± Ø£Ø³Ø¹Ø§Ø± ØµØ±Ù Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ù„ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§"},React.createElement(P,{rows:lt,action:"edit",onChoose:e=>{const t=Q.findIndex(t=>t.code===e.code);t>-1&&(Rt(t),yt("form"))}}),React.createElement("div",{className:"flex justify-end pt-2"},React.createElement(D,{className:"text-white bg-slate-600 w-28 h-11",onClick:()=>{yt(null),Et({text:"âŒ ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡",type:"error"})}},"Ø¥ØºÙ„Ø§Ù‚"))),React.createElement(S,{open:"banner"===wt,onClose:()=>yt(null),title:"Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ÙŠ Ø§Ù„Ø³ÙÙ„ÙŠ"},React.createElement("div",{className:"grid gap-3"},(re.texts||[]).length>0?re.texts.map((e,t)=>React.createElement("div",{key:t,className:"flex gap-2 items-center"},React.createElement("input",{className:"fld flex-1",value:e,onChange:e=>{const a=[...re.texts];a[t]=e.target.value,ne(e=>({...e,texts:a}))},placeholder:`Ø¥Ø¹Ù„Ø§Ù† ${t+1}`}),React.createElement("button",{type:"button",className:"px-3 py-2 bg-red-600 text-white rounded-lg",onClick:()=>{const e=re.texts.filter((e,a)=>a!==t);ne(t=>({...t,texts:e}))}},"âŒ"))):React.createElement("div",{className:"text-sm text-gray-500"},"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹."),React.createElement("button",{type:"button",className:"px-3 py-2 bg-blue-600 text-white rounded-lg w-fit",onClick:()=>{const e=[...re.texts||[],""];ne(t=>({...t,texts:e}))}},"â• Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ù„Ø§Ù†")),React.createElement("div",{className:"grid sm:grid-cols-3 gap-3 mt-4"},React.createElement("label",{className:"grid gap-1"},React.createElement("span",{className:"text-sm text-gray-600"},"Ù„ÙˆÙ† Ø§Ù„Ù†Øµ"),React.createElement("input",{type:"color",className:"fld h-11 p-1",value:re.color,onChange:e=>ne(t=>({...t,color:e.target.value}))})),React.createElement("label",{className:"grid gap-1"},React.createElement("span",{className:"text-sm text-gray-600"},"Ù…Ø¯Ø© Ø§Ù„Ø­Ø±ÙƒØ© (Ø«)"),React.createElement(A,{allowDecimal:!0,className:"fld w-32 sm:w-36",value:re.moveDur,onChange:e=>ne(t=>({...t,moveDur:f(e,.3,20)}))})),React.createElement("label",{className:"grid gap-1"},React.createElement("span",{className:"text-sm text-gray-600"},"Ù…Ø¯Ø© Ø§Ù„ØªÙˆÙ‚Ù (Ø«)"),React.createElement(A,{allowDecimal:!0,className:"fld w-32 sm:w-36",value:re.stayDur,onChange:e=>ne(t=>({...t,stayDur:f(e,.3,60)}))}))),React.createElement("div",{className:"btn-row flex justify-end gap-2 pt-2"},React.createElement(D,{className:"text-white bg-red-600 w-32 h-11",onClick:()=>{yt(null),Et({text:"âŒ ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡",type:"error"})}},"Ø¥Ù„ØºØ§Ø¡"),React.createElement(D,{className:"text-white bg-green-600 w-32 h-11",onClick:()=>{const e=re.texts&&Array.isArray(re.texts)&&re.texts.length>0?re.texts.filter(e=>""!==(e||"").trim()):["ğŸ“¢ Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒÙ…"];const __bn={...re,texts:e.map(e=>String(e).slice(0,140))};ae(__bn);try{if(u&&window.$db&&Gt&&Gt.current&&window.$db.set&&window.$db.ref){window.$db.set(window.$db.ref("taif/banner"),__bn);}}catch(e){}yt(null),Et({text:"âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª",type:"success"})}},"Ø­ÙØ¸"))),React.createElement(z,{open:"datetime"===wt,onClose:()=>yt(null),dt:le,autoTime:se,setDT:ce,setAuto:oe,setToast:Et}),React.createElement(S,{open:"view"===wt,onClose:()=>yt(null),title:"Ø·Ø±ÙŠÙ‚Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±"},React.createElement("div",{className:"grid themes-grid grid-cols-2 sm:grid-cols-2 gap-2 sm:gap-3"},React.createElement("button",{type:"button",className:"view-card "+("cards"===jt?"sel":""),onClick:()=>It("cards")},React.createElement("div",{className:"font-bold mb-1"},"Ø¨Ø·Ø§Ù‚Ø§Øª"),React.createElement("div",{className:"text-sm text-gray-600"},"Ø´Ø¨ÙƒØ© Ù…Ø±Ù†Ø© ÙˆØ³Ø±ÙŠØ¹Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©.")),React.createElement("button",{type:"button",className:"view-card "+("board"===jt?"sel":""),onClick:()=>It("board")},React.createElement("div",{className:"font-bold mb-1"},"Ù„ÙˆØ­Ø© ÙƒØ¨ÙŠØ±Ø©"),React.createElement("div",{className:"text-sm text-gray-600"},"Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø©."))),React.createElement("div",{className:"btn-row flex justify-end gap-2 pt-2"},React.createElement(D,{className:"text-white bg-red-600 w-32 h-11",onClick:()=>{yt(null),Et({text:"âŒ ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡",type:"error"})}},"Ø¥Ù„ØºØ§Ø¡"),React.createElement(D,{className:"text-white bg-green-600 w-32 h-11",onClick:()=>{St(jt),yt(null),Et({text:"âœ… ØªÙ… ØªØºÙŠÙŠØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¹Ø±Ø¶",type:"success"})}},"Ø­ÙØ¸"))),React.createElement(S,{open:"themes"===wt,onClose:()=>yt(null),title:"Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø«ÙŠÙ…"},React.createElement("div",{className:"grid themes-grid grid-cols-2 sm:grid-cols-2 gap-2 sm:gap-3"},h.map(e=>React.createElement("button",{type:"button",key:e.id,onClick:()=>Lt(e.cls),className:"view-card "+(At===e.cls?"sel":"")},React.createElement("div",{className:`h-16 rounded-xl mb-2 bg-gradient-to-tr ${e.cls.replace("bg-gradient-to-tr ","").replace("text-gray-900","").replace("text-gray-100","")}`}),React.createElement("div",{className:"font-bold"},e.name),React.createElement("div",{className:"text-xs text-gray-600 ltr:tracking-wider"},e.id)))),React.createElement("div",{className:"flex justify-end gap-2 pt-4"},React.createElement(D,{className:"text-white bg-red-600 w-28 h-11",onClick:()=>{yt(null),Et({text:"âŒ ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡",type:"error"})}},"Ø¥Ù„ØºØ§Ø¡"),React.createElement(D,{className:"text-white bg-slate-700 w-28 h-11",onClick:()=>{K(""),yt(null),Et({text:"â„¹ï¸ ØªÙ… Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø¥Ù„Ù‰ Ø§Ù„Ø«ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ",type:"info"})}},"Ø§ÙØªØ±Ø§Ø¶ÙŠ"),React.createElement(D,{className:"text-white bg-green-600 w-28 h-11",onClick:()=>{K(At),yt(null),Et({text:"âœ… ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø«ÙŠÙ…",type:"success"})}},"Ø­ÙØ¸"))),React.createElement(S,{open:"logo"===wt,onClose:()=>yt(null),title:"ØªØºÙŠÙŠØ± Ù„ÙˆØºÙˆ Ø§Ù„Ø´Ø±ÙƒØ© / Ø§Ù„Ø¹Ù†ÙˆØ§Ù†"},React.createElement("div",{className:"grid gap-3 logo-modal"},React.createElement("div",{className:"section"},React.createElement("div",{className:"section-title"},"Ø§Ù„Ù„ÙˆØºÙˆ"),React.createElement("div",{className:"row"},React.createElement("div",{className:"preview"},Ot?React.createElement("img",{src:Ot,alt:"Ø§Ù„Ø´Ø¹Ø§Ø±",className:"object-contain w-full h-full"}):React.createElement("span",{className:"text-gray-400 text-xs"},"Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø´Ø¹Ø§Ø±")),React.createElement("div",{className:"grid gap-2"},React.createElement("div",{className:"hint"},"ÙŠÙØ³ØªØ­Ø³Ù† Ø£Ø¨Ø¹Ø§Ø¯ Ø¹Ø±ÙŠØ¶Ø© Ù…Ø«Ù„ 1000Ã—400. Ø³ÙŠØªÙ… ØªÙ…Ø¯ÙŠØ¯ Ø§Ù„ØµÙˆØ±Ø© Ù„Ù…Ù„Ø¡ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚."),React.createElement("input",{type:"file",accept:"image/png,image/jpeg,image/webp",className:"fld w-full",onChange:e=>{const t=e.target.files&&e.target.files[0];if(!t)return;if(!i(t,Et))return;const a=new FileReader;a.onload=e=>Ft(e.target.result),a.readAsDataURL(t)}}),React.createElement("div",{className:"actions"},Ot&&React.createElement(D,{className:"text-white bg-red-600",onClick:()=>Ft("")},"Ù…Ø³Ø­ Ø§Ù„Ù„ÙˆØºÙˆ"))))),React.createElement("div",{className:"section"},React.createElement("div",{className:"section-title"},"Ø§Ù„Ø¹Ù†ÙˆØ§Ù†"),React.createElement("div",{className:"grid gap-2"},React.createElement("input",{className:"fld w-full",value:Bt,onChange:e=>Vt(e.target.value),placeholder:"Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø©"}),React.createElement("div",{className:"hint"},"ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø·ÙˆÙŠÙ„Ø©"))),React.createElement("div",{className:"section"},React.createElement("div",{className:"section-title"},"ØµÙˆØ±Ø© (ÙŠØ³Ø§Ø± Ø§Ù„Ø¹Ù†ÙˆØ§Ù†)"),React.createElement("div",{className:"row"},React.createElement("div",{className:"preview"},Pt?React.createElement("img",{src:Pt,alt:"Ø§Ù„ØµÙˆØ±Ø©",className:"object-contain w-full h-full"}):React.createElement("span",{className:"text-gray-400 text-xs"},"Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±Ø©")),React.createElement("div",{className:"grid gap-2"},React.createElement("div",{className:"hint"},"ÙŠÙØ³ØªØ­Ø³Ù† Ø£Ø¨Ø¹Ø§Ø¯ Ø¹Ø±ÙŠØ¶Ø© Ù…Ø«Ù„ 1000Ã—400. Ø³ÙŠØªÙ… ØªÙ…Ø¯ÙŠØ¯ Ø§Ù„ØµÙˆØ±Ø© Ù„Ù…Ù„Ø¡ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚."),React.createElement("input",{type:"file",accept:"image/png,image/jpeg,image/webp",className:"fld w-full",onChange:e=>{const t=e.target.files&&e.target.files[0];if(!t)return;if(!i(t,Et))return;const a=new FileReader;a.onload=e=>zt(e.target.result),a.readAsDataURL(t)}}),React.createElement("div",{className:"actions"},Pt&&React.createElement(D,{className:"text-white bg-red-600",onClick:()=>zt("")},"Ù…Ø³Ø­ Ø§Ù„ØµÙˆØ±Ø©"))))),React.createElement("div",{className:"sticky-actions flex justify-end gap-2 pt-2"},React.createElement(D,{className:"text-white bg-red-600 w-32 h-11",onClick:()=>{yt(null),Et({text:"âŒ ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡",type:"error"})}},"Ø¥Ù„ØºØ§Ø¡"),React.createElement(D,{className:"text-white bg-green-600 w-32 h-11",onClick:()=>{W(Bt||"Ù„ÙˆØ­Ø© Ø£Ø³Ø¹Ø§Ø± ØµØ±Ù Ø§Ù„Ø¹Ù…Ù„Ø§Øª"),T(Ot),G(Pt);try{if(u&&window.$db&&Gt&&Gt.current&&window.$db.set&&window.$db.ref){window.$db.set(window.$db.ref("taif/title"),Bt||"Ù„ÙˆØ­Ø© Ø£Ø³Ø¹Ø§Ø± ØµØ±Ù Ø§Ù„Ø¹Ù…Ù„Ø§Øª");window.$db.set(window.$db.ref("taif/logo"),Ot||"");window.$db.set(window.$db.ref("taif/bannerImg"),Pt||"");}}catch(e){}yt(null),Et({text:"âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª",type:"success"})}},"Ø­ÙØ¸")))),React.createElement(S,{open:"form"===wt,onClose:()=>yt(null),title:null!=vt?"ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù…Ù„Ø©":"Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„Ø©"},React.createElement(H,{data:Q,editIdx:vt,onCancel:()=>yt(null),onSaved:e=>{X(e),yt(null)},setToast:Et})),React.createElement(S,{open:xe,onClose:()=>{Ee(!1),Ce(null),Re(!1),Te({username:"",password:"",name:"",role:"",perms:{}}),Me("")},title:ke?"ØªØ¹Ø¯ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù…":ve?"Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…":"Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†"},ve||null!=ke?React.createElement("div",{className:"grid gap-3"},null==ke&&React.createElement("label",{className:"grid gap-1"},React.createElement("span",{className:"text-sm text-gray-600"},"Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…"),React.createElement("input",{className:"fld w-full",value:Ue.username,onChange:e=>Te(t=>({...t,username:e.target.value.trim()}))})),React.createElement("label",{className:"grid gap-1"},React.createElement("span",{className:"text-sm text-gray-600"},"Ø§Ø³Ù… Ø§Ù„Ø´Ø®Øµ"),React.createElement("input",{className:"fld w-full",value:Ue.name||"",onChange:e=>Te(t=>({...t,name:e.target.value})),placeholder:"Ø§Ø³Ù… Ø§Ù„Ø´Ø®Øµ"})),React.createElement("label",{className:"grid gap-1"},React.createElement("span",{className:"text-sm text-gray-600"},"ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ",ke?"(Ø§ØªØ±ÙƒÙ‡Ø§ ÙØ§Ø±ØºØ© Ù„Ø¹Ø¯Ù… Ø§Ù„ØªØºÙŠÙŠØ±)":""),React.createElement("input",{type:"password",className:"fld w-full",value:Ue.password,onChange:e=>Te(t=>({...t,password:e.target.value}))})),ie&&("superadmin"===ie.role||"emergency"===ie.role)&&React.createElement("label",{className:"grid gap-1"},React.createElement("span",{className:"text-sm text-gray-600"},"Ø§Ù„Ø¯ÙˆØ±"),React.createElement("select",{className:"fld w-full",value:Ue.role||"",onChange:e=>{const t=e.target.value;
                // Auto-default permissions when creating a NEW user (not editing)
                if(!ke && ve){
                  const all={};
                  try{Ae.forEach(x=>{all[x.key]=!0})}catch(_){ }
                  const emp={logout:!0,changeTheme:!0,changeView:!0};
                  const def=(t==="superadmin"||t==="emergency")?all:emp;
                  Te(e=>({...e,role:t,perms:def}));
                } else {
                  Te(e=>({...e,role:t}));
                }
              },disabled:ke&&ie&&"admin"===ie.role&&ke===ie.username},React.createElement("option",{value:""},"Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙˆØ±"),React.createElement("option",{value:"admin"},"Ù…ÙˆØ¸Ù"),"superadmin"===ie.role&&React.createElement("option",{value:"superadmin"},"Ø§Ø¯Ø§Ø±Ø© Ø§Ù„ÙØ±Ø¹"),"emergency"===ie.role&&React.createElement(React.Fragment,null,React.createElement("option",{value:"superadmin"},"Ø§Ø¯Ø§Ø±Ø© Ø§Ù„ÙØ±Ø¹"),React.createElement("option",{value:"emergency"},"Ø§Ù„Ø§Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø©")))),React.createElement("div",{className:"grid gap-1"},React.createElement("span",{className:"text-sm text-gray-600"},"Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª"),React.createElement("div",{className:"grid gap-1"},Ae.map(e=>React.createElement("label",{key:e.key,className:"inline-flex items-center gap-2"},React.createElement("input",{type:"checkbox",checked:!!Ue.perms[e.key],disabled:ke&&ie&&"admin"===ie.role&&ke===ie.username,onChange:t=>{const a=t.target.checked;Te(t=>({...t,perms:{...t.perms,[e.key]:a}}))}}),React.createElement("span",null,e.label))))),_e&&React.createElement("div",{className:"text-red-600 text-sm"},_e),React.createElement("div",{className:"flex justify-end gap-2 pt-2"},React.createElement(D,{className:"text-white bg-red-600 w-28 h-10",onClick:()=>{Ee(!1),Ce(null),Re(!1),Te({username:"",password:"",name:"",role:"",perms:{}}),Me("")}},"Ø¥Ù„ØºØ§Ø¡"),React.createElement(D,{className:"text-white bg-green-600 w-28 h-10",onClick:async()=>{Me("");const{username:e,password:t,name:a,role:r,perms:n}=Ue;if(e&&(ke||t))try{if(!Gt.current)return void Me("âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");const l=window.bcrypt||window.dcodeIO&&window.dcodeIO.bcrypt;if(!l)return void Me("âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© Ø§Ù„ØªØ´ÙÙŠØ±");const c=ke?he[ke]:null;if(!ke&&ie&&"admin"===ie.role)return void Me("âš ï¸ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯");if(ke&&ie){if("admin"===ie.role&&ke!==ie.username)return void Me("âš ï¸ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…");if("superadmin"===ie.role&&c&&("superadmin"===c.role||"emergency"===c.role))return void Me("âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù‡Ø°Ù‡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª")}if(c&&"emergency"===c.role&&(!ie||"emergency"!==ie.role))return void Me("âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ø¥Ù„Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ø§Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø©");if(!(ke||"emergency"!==r||ie&&"emergency"===ie.role))return void Me("âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ø¥Ù„Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ø§Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø©");if(ke&&"emergency"===r&&(!ie||"emergency"!==ie.role))return void Me("âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ± Ø¯ÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ù„Ù‰ Ø§Ù„Ø§Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ø¥Ù„Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ø§Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø©");const s=c?c.password:null;((e,t)=>{e?l.hash(e,10,function(e,a){t(e,a)}):t(null,s)})(t,(t,l)=>{if(t)return void Me("âš ï¸ ØªØ¹Ø°Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨ØµÙ…Ø©");let s=r;s||(s=ke&&c&&c.role?c.role:"admin");let o=[];n&&"object"==typeof n&&(o=Object.keys(n).filter(e=>n[e])),ke&&ie&&"admin"===ie.role&&ke===ie.username&&c&&(s=c.role,Array.isArray(c.permissions)?o=c.permissions:c.permissions&&"object"==typeof c.permissions&&(o=Object.keys(c.permissions).filter(e=>c.permissions[e])));const i={role:s,permissions:o,password:l,name:a||""},m=ke||e;window.$db.set(window.$db.ref(`taif/users/${m}`),i);try{const e={actor:ie?ie.username:"unknown",action:ke?"updateUser":"addUser",target:m};window.$db.set(window.$db.ref(`taif/adminactionslog/${Date.now()}_${Math.random().toString(36).slice(2)}`),e)}catch(e){}Ee(!1),Ce(null),Re(!1),Te({username:"",password:"",name:"",role:"",perms:{}}),Me("")})}catch(e){console.error(e),Me("âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸")}else Me("âš ï¸ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©")}},"Ø­ÙØ¸"))):React.createElement("div",{className:"grid gap-3"},React.createElement("div",{className:"flex justify-between"},React.createElement(D,{className:"text-white bg-gray-600 w-36 h-10",onClick:Ie},"ğŸ“œ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©"),ie&&("superadmin"===ie.role||"emergency"===ie.role)&&React.createElement(D,{className:"text-white bg-blue-600 w-36 h-10",onClick:()=>{Ce(null),Re(!0),Te({username:"",password:"",name:"",role:"admin",perms:{logout:!0,changeTheme:!0,changeView:!0}}),Ee(!0)}},"â• Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…")),React.createElement("div",{className:"max-h-[60vh] overflow-auto"},Object.entries(he||{}).filter(([e,t])=>!!t&&!!("emergency"!==t.role||ie&&"emergency"===ie.role)).map(([e,t])=>{let a=!1,r=!1;const n=ie?ie.role:"",l=t.role||"";return"emergency"===n?(a=!0,r=!0):"superadmin"===n?"superadmin"!==l&&"emergency"!==l&&(a=!0,r=!0):"admin"===n&&e===(ie?ie.username:"")&&(a=!0),React.createElement("div",{key:e,className:"flex items-center justify-between border-b py-2"},React.createElement("div",{className:"flex flex-col"},React.createElement("span",{className:"font-bold"},e),t.name&&React.createElement("span",{className:"text-sm text-gray-700"},t.name),React.createElement("span",{className:"text-xs text-gray-600"},"Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª: ",(Array.isArray(t?.permissions)?t.permissions.map(e=>Le[e]||e):[]).join(", "))),React.createElement("div",{className:"flex gap-2"},a&&React.createElement(D,{className:"text-white bg-blue-500 w-20 h-8 text-xs",onClick:()=>(e=>{const t=he[e];if(!t)return;let a=!1;const r=ie?ie.role:"";if("emergency"===r?a=!0:"superadmin"===r?"superadmin"!==t.role&&"emergency"!==t.role&&(a=!0):"admin"===r&&e===ie.username&&(a=!0),!a)return void Et({text:"âš ï¸ Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…",type:"error"});Ce(e);const n={};Array.isArray(t.permissions)?t.permissions.forEach(e=>{n[e]=!0}):t.permissions&&"object"==typeof t.permissions&&Object.keys(t.permissions).forEach(e=>{t.permissions[e]&&(n[e]=!0)}),Te({username:e,password:"",name:t.name||"",role:t.role||"",perms:n}),Ee(!0)})(e)},"ØªØ¹Ø¯ÙŠÙ„"),r&&React.createElement(D,{className:"text-white bg-red-600 w-20 h-8 text-xs",onClick:()=>(e=>{const t=he[e];if(!t)return;const a=ie?ie.role:"",r=t.role||"";let n=!1;if("emergency"===a?n=!0:"superadmin"===a?"superadmin"!==r&&"emergency"!==r&&(n=!0):n=!1,n){if(window.confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ"))try{if(!Gt.current)return;window.$db.set(window.$db.ref(`taif/users/${e}`),null);try{const t={actor:ie?ie.username:"unknown",action:"deleteUser",target:e};window.$db.set(window.$db.ref(`taif/adminactionslog/${Date.now()}_${Math.random().toString(36).slice(2)}`),t)}catch(e){}}catch(e){console.error(e)}}else Et({text:"âš ï¸ Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ© Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…",type:"error"})})(e)},"Ø­Ø°Ù")))})))),React.createElement($,{toast:xt,onClose:()=>Et(null)}),React.createElement("div",{className:"fixed left-0 right-0 bottom-0 z-[60] bottom-fixed",dir:"ltr"},React.createElement("div",{className:"grid w-full h-10 sm:h-12 footer-grid grid-cols-[1fr_minmax(200px,22%)]"},React.createElement("div",{ref:ct,className:`ad-wrap bg-gradient-to-r ${Wt}`,dir:"rtl"},React.createElement("div",{ref:st,className:"ad-item "+(ot.snap?"no-trans":""),style:{"--ad-move":`${te.moveDur}s`,color:te.color,transform:`translate(calc(-50% + ${ot.x}px), -50%)`}},React.createElement("span",{className:"px-4 sm:px-6"},te.texts[ot.i]||""))),React.createElement("div",{className:`border-l border-slate-200 flex items-center justify-center gap-3 px-2 sm:px-4 bg-gradient-to-r ${Wt}`},React.createElement("div",{className:"w-3 h-3 sm:w-4 sm:h-4 rounded-full shadow "+(u?"bg-green-500":"bg-red-500"),title:u?"Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª":"ØºÙŠØ± Ù…ØªØµÙ„"}),React.createElement("div",{className:"flex flex-col items-center sm:flex-row sm:items- sm:gap-2 text-slate-900 whitespace-nowrap",dir:"ltr"},React.createElement("span",{className:"table-numbers text-base sm:text-xl md:text-2xl font-black"},Pe.time),React.createElement("span",{className:"hidden sm:inline opacity-50 select-none"},"|"),React.createElement("span",{className:"table-numbers text-xs sm:text-base md:text-lg"},Pe.date)))))):React.createElement("div",{className:"min-h-screen w-full flex items-center justify-center bg-gradient-to-br from-indigo-700 via-purple-600 to-pink-600 p-4"},React.createElement("div",{className:"bg-white/90 backdrop-blur-md rounded-xl shadow-xl w-full max-w-sm p-6 sm:p-8"},React.createElement("h2",{className:"text-2xl font-bold mb-4 text-center text-gray-800"},"ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„"),React.createElement("form",{onSubmit:Oe,className:"grid gap-4"},!window.$db&&React.createElement("div",{className:"text-center text-sm text-gray-600"},"â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª..."),React.createElement("label",{className:"grid gap-1"},React.createElement("span",{className:"text-sm text-gray-600"},"Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…"),React.createElement("input",{className:"fld w-full",value:de,onChange:e=>ue(e.target.value.trim())})),React.createElement("label",{className:"grid gap-1"},React.createElement("span",{className:"text-sm text-gray-600"},"ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"),React.createElement("input",{type:"password",className:"fld w-full",value:ge,onChange:e=>pe(e.target.value)})),fe&&React.createElement("div",{className:"text-red-600 text-sm text-center"},fe),React.createElement("button",{type:"submit",className:"w-full h-11 rounded-lg bg-blue-600 hover:bg-blue-700 transition text-white font-semibold"},"Ø¯Ø®ÙˆÙ„"))))},null))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}();</script><style id="trade-vanilla-css">.trade-fab-wrap{position:fixed;right:14px;bottom:72px;z-index:120000;display:flex;flex-direction:column;gap:10px;direction:rtl}@media(max-width:640px){.trade-fab-wrap{right:10px;bottom:60px;gap:8px}}.trade-fab{min-width:132px;display:flex;align-items:center;justify-content:center;gap:.5rem;padding:.7rem .95rem;border-radius:16px;border:1px solid rgba(15,23,42,.12);background:rgba(255,255,255,.92);backdrop-filter:blur(10px);box-shadow:0 10px 26px rgba(0,0,0,.14);font:900 14px/1.1 system-ui,Segoe UI,Roboto,Tahoma;color:#0f172a;cursor:pointer;user-select:none}.trade-fab:active{transform:scale(.98)}.trade-fab.buy{background:linear-gradient(135deg,rgba(34,197,94,.18),rgba(255,255,255,.92));border-color:rgba(34,197,94,.3)}.trade-fab.sell{background:linear-gradient(135deg,rgba(239,68,68,.18),rgba(255,255,255,.92));border-color:rgba(239,68,68,.3)}.trade-fab.exchange{background:linear-gradient(135deg,rgba(249,115,22,.18),rgba(255,255,255,.92));border-color:rgba(249,115,22,.35)}.trade-fab.logs{background:linear-gradient(135deg,rgba(59,130,246,.18),rgba(255,255,255,.92));border-color:rgba(59,130,246,.3)}.trade-fab.settings{background:linear-gradient(135deg,rgba(148,163,184,.22),rgba(255,255,255,.92));border-color:rgba(148,163,184,.35)}.trade-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:120001;display:none;align-items:center;justify-content:center;padding:14px}.trade-backdrop.open{display:flex}.trade-modal{width:min(760px,94vw);max-height:82vh;overflow:auto;background:#fff;border-radius:22px;box-shadow:0 18px 50px rgba(0,0,0,.22);border:1px solid rgba(15,23,42,.1);padding:18px;direction:rtl}.trade-modal::-webkit-scrollbar{width:10px}.trade-modal::-webkit-scrollbar-track{background:transparent;border-radius:22px}.trade-modal::-webkit-scrollbar-thumb{background:rgba(15,23,42,.25);border-radius:22px}.trade-modal{scrollbar-width:thin;scrollbar-color:rgba(15,23,42,.25) transparent}@media(max-width:640px){.trade-backdrop{padding:14px;align-items:center;justify-content:center}.trade-modal{width:min(760px,94vw);height:auto;max-height:86vh;padding:14px 12px;border-radius:22px;overflow:auto;padding-top:calc(14px + env(safe-area-inset-top));padding-bottom:calc(14px + env(safe-area-inset-bottom))}}.trade-head{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:12px}.trade-backbtn{display:inline-flex;align-items:center;gap:.55rem;background:#eef2f7;border:1px solid #e5e7eb;border-radius:12px;padding:.5rem .85rem;font:900 16px/1 system-ui,Segoe UI,Roboto,Tahoma;color:#111827;cursor:pointer}.trade-backbtn:active{transform:scale(.99)}.trade-headtitle{display:flex;align-items:center;gap:.55rem;font:1000 24px/1 system-ui,Segoe UI,Roboto,Tahoma;color:#111827}.trade-headtitle .ico{font-size:28px}.trade-form{display:grid;gap:12px}.trade-row2{display:grid;grid-template-columns:1fr 1fr;gap:10px}@media(max-width:720px){.trade-row2{grid-template-columns:1fr}}.trade-field{display:grid;gap:8px}.trade-label{font:800 14px/1 system-ui,Segoe UI,Roboto,Tahoma;color:#475569}.trade-in,.trade-sel{height:50px;border-radius:16px;border:1px solid rgba(15,23,42,.12);background:#fff;padding:.45rem .8rem;font:800 16px/1 system-ui,Segoe UI,Roboto,Tahoma;color:#0f172a;width:100%}.trade-in.table-numbers{font-weight:900}.trade-in:focus,.trade-sel:focus{outline:3px solid rgba(59,130,246,.3)}.trade-date{direction:ltr!important;unicode-bidi:isolate!important;text-align:left!important;font-family:Inter,Roboto,Arial,Tahoma,sans-serif}@media(max-width:640px){.trade-date{height:46px!important;font-size:15px!important}}.trade-ratebox{border-radius:16px;border:1px solid rgba(34,197,94,.2);background:rgba(220,252,231,.5);padding:8px 10px;display:grid;gap:6px}.trade-ratehead{display:flex;align-items:center;justify-content:space-between;gap:10px}.trade-ratehead .ttlrow{display:flex;align-items:center;gap:10px}.trade-ratehead .ttl{font:1000 16px/1 system-ui,Segoe UI,Roboto,Tahoma;color:#065f46}.trade-ratehead .auto{display:flex;align-items:center;gap:.45rem;font:900 14px/1 system-ui,Segoe UI,Roboto,Tahoma;color:#065f46}.trade-dot{width:12px;height:12px;border-radius:999px;background:#22c55e;box-shadow:0 0 0 4px rgba(34,197,94,.16) inset}.trade-ratein{height:40px;border-radius:14px;border:1px solid rgba(15,23,42,.1);background:#fff;padding:.25rem .85rem;font:1000 18px/1 system-ui,Segoe UI,Roboto,Tahoma;color:#0f172a;text-align:right}@media(max-width:640px){.trade-headtitle{font-size:20px}.trade-backbtn{font-size:14px;padding:.45rem .75rem}.trade-form{gap:10px}.trade-in,.trade-sel{height:46px;font-size:15px}.trade-ratein{height:40px;border-radius:14px;border:1px solid rgba(15,23,42,.1);background:#fff;padding:.25rem .85rem;font:1000 18px/1 system-ui,Segoe UI,Roboto,Tahoma;color:#0f172a;text-align:right}.trade-actions .btn{height:44px;border-radius:14px;font-size:16px}}.trade-chip{border:1px solid rgba(15,23,42,.12);background:rgba(255,255,255,.65);border-radius:999px;padding:.35rem .7rem;font:900 13px/1 system-ui,Segoe UI,Roboto,Tahoma;color:#0f172a;cursor:pointer}.trade-ratehead #trade-reset{position:relative;top:-4px}@media(max-width:640px){.trade-ratehead #trade-reset{top:-6px}}.trade-modal.trade-mode-sell .trade-ratebox{border:1px solid rgba(239,68,68,.28)!important;background:rgba(254,226,226,.88)!important}.trade-modal.trade-mode-sell .trade-ratehead .auto,.trade-modal.trade-mode-sell .trade-ratehead .ttl{display:flex;align-items:center;gap:.45rem;font:900 14px/1 system-ui,Segoe UI,Roboto,Tahoma;color:#065f46}.trade-modal.trade-mode-sell .trade-dot{width:12px;height:12px;border-radius:999px;background:#22c55e;box-shadow:0 0 0 4px rgba(34,197,94,.16) inset}.trade-chip:active{transform:scale(.99)}.trade-actions{display:flex;align-items:center;justify-content:flex-start;margin-top:8px}.trade-submit{min-width:170px;height:54px;border-radius:14px;border:0;font:1000 20px/1 system-ui,Segoe UI,Roboto,Tahoma;color:#fff;cursor:pointer}.trade-submit.buy{background:#16a34a}.trade-submit.sell{background:#d13a2f}.trade-submit:active{transform:scale(.99)}.trade-logs-list{max-height:62vh;overflow:auto;border:1px solid rgba(15,23,42,.1);border-radius:18px}.trade-log-item{display:flex;justify-content:space-between;gap:12px;padding:10px 12px;border-bottom:1px solid rgba(15,23,42,.08);font:800 14px/1.2 system-ui,Segoe UI,Roboto,Tahoma}.trade-log-item:last-child{border-bottom:0}.trade-log-time{opacity:.65;white-space:nowrap;font:800 12px/1 system-ui,Segoe UI,Roboto,Tahoma}.trade-log-main{flex:1;text-align:right}.trade-muted{opacity:.7}.trade-settings-grid{display:grid;gap:10px}.trade-settings-row{display:flex;align-items:center;justify-content:space-between;gap:10px;border:1px solid rgba(15,23,42,.1);border-radius:16px;padding:10px 12px;background:#fff}.trade-settings-row .left{display:flex;align-items:center;gap:10px}.trade-settings-row input[type=checkbox]{width:18px;height:18px}.trade-del{border:0;background:#fee2e2;color:#991b1b;border-radius:12px;padding:.45rem .7rem;font:900 13px/1 system-ui,Segoe UI,Roboto,Tahoma;cursor:pointer}.trade-addbox{border:1px dashed rgba(15,23,42,.18);border-radius:16px;padding:12px;background:rgba(248,250,252,.9);display:grid;gap:10px}.trade-addbox .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}@media(max-width:720px){.trade-addbox .row{grid-template-columns:1fr}}.trade-save{border:0;border-radius:14px;height:48px;min-width:140px;background:#0f172a;color:#fff;font:1000 16px/1 system-ui,Segoe UI,Roboto,Tahoma;cursor:pointer}.trade-save:active{transform:scale(.99)}.trade-searchbtn{height:40px;border-radius:12px;border:1px solid rgba(15,23,42,.12);background:#2563eb;color:#fff;font:1000 14px/1 system-ui,Segoe UI,Roboto,Tahoma;padding:0 14px;cursor:pointer}.trade-searchbtn:active{transform:scale(.99)}.trade-advbtn{height:40px;border-radius:14px;border:1px solid rgba(2,6,23,.10);background:linear-gradient(180deg,#ffffff,#f1f5f9);color:#0f172a;font:1000 14px/1 system-ui,Segoe UI,Roboto,Tahoma;padding:0 14px;cursor:pointer;box-shadow:0 8px 20px rgba(0,0,0,.06)}.trade-advbtn:active{transform:scale(.99)}.tr-logsearch{display:flex;align-items:center;gap:6px;height:40px;padding:0 10px;border-radius:14px;border:1px solid rgba(2,6,23,.10);background:rgba(255,255,255,.92);box-shadow:0 8px 20px rgba(0,0,0,.05)}.tr-searchinp{border:0;outline:0;background:transparent;min-width:190px;max-width:260px;font:900 14px/1 system-ui,Segoe UI,Roboto,Tahoma;color:#0f172a}.tr-searchinp::placeholder{color:#64748b;font-weight:800}.tr-searchbtn,.tr-clearbtn{width:32px;height:32px;border-radius:10px;border:0;cursor:pointer;display:grid;place-items:center;font:1000 14px/1 system-ui,Segoe UI,Roboto,Tahoma}.tr-searchbtn{background:#2563eb;color:#fff}.tr-clearbtn{background:#ef4444;color:#fff}.trade-advbtn:hover{filter:brightness(.98)}.tr-searchbtn:active,.tr-clearbtn:active,.trade-advbtn:active{transform:scale(.99)}.msel{position:relative}.msel-btn{width:100%;height:56px;border-radius:18px;border:1px solid rgba(15,23,42,.10);background:#fff;display:flex;align-items:center;justify-content:space-between;gap:10px;padding:0 14px;font:1000 18px/1 system-ui,Segoe UI,Roboto,Tahoma;cursor:pointer}.msel-btn .v{color:#0f172a}.msel-btn .chev{opacity:.6;font-size:18px}.msel-menu{position:absolute;top:62px;right:0;left:0;background:#fff;border:1px solid rgba(15,23,42,.10);border-radius:16px;box-shadow:0 18px 40px rgba(0,0,0,.10);padding:10px;max-height:240px;overflow:auto;display:none;z-index:20}.msel.open .msel-menu{display:block}.msel-item{display:flex;align-items:center;gap:10px;padding:10px 8px;border-radius:12px;cursor:pointer}.msel-item:hover{background:rgba(2,6,23,.04)}.msel-item input{width:18px;height:18px}.msel-item .t{font:900 15px/1.2 system-ui,Segoe UI,Roboto,Tahoma;color:#0f172a}.msel-note{font:800 12px/1 system-ui,Segoe UI,Roboto,Tahoma;color:#64748b;margin-top:6px}
.trade-btn-box{background:linear-gradient(180deg,#ffedd5,#fb923c);color:#7c2d12}
.trade-btn-settings{background:linear-gradient(180deg,#ede9fe,#8b5cf6);color:#3b0764}
.trade-btn-box:hover{filter:brightness(.95)}
.trade-btn-settings:hover{filter:brightness(.95)}
@media(max-width:640px){.tr-searchinp{min-width:140px;max-width:180px}}.trade-advbox{border:1px solid rgba(15,23,42,.1);border-radius:18px;padding:12px;background:rgba(248,250,252,.92);display:grid;gap:10px}.trade-adv-title{font:1000 16px/1 system-ui,Segoe UI,Roboto,Tahoma;color:#0f172a;display:flex;align-items:center;justify-content:space-between}.trade-kpi-title{font:1000 14px/1 system-ui,Segoe UI,Roboto,Tahoma;color:#334155;margin-top:2px}.trade-cap{display:inline-flex;border:1px solid rgba(15,23,42,.14);border-radius:999px;overflow:hidden;background:#fff}.trade-cap>button{border:0;background:0 0;padding:.45rem .95rem;font:1000 14px/1 system-ui,Segoe UI,Roboto,Tahoma;color:#0f172a;cursor:pointer}.trade-cap>button.on{background:#0f172a;color:#fff}.trade-cap>button.buy.on{background:#16a34a}.trade-cap>button.sell.on{background:#d13a2f}.trade-pillrow{display:flex;gap:8px;flex-wrap:wrap}.trade-pill{border:1px solid rgba(15,23,42,.12);background:#fff;border-radius:999px;padding:.45rem .8rem;font:900 13px/1 system-ui,Segoe UI,Roboto,Tahoma;color:#0f172a;cursor:pointer}.trade-pill.on{background:#0f172a;color:#fff;border-color:rgba(15,23,42,.3)}.trade-advbox{background:#fff!important;border:1px solid rgba(15,23,42,.1)!important;border-radius:22px!important;padding:14px!important}.trade-adv-grid{display:grid;gap:12px}.trade-adv-toprow{display:flex;align-items:center;justify-content:flex-end}.trade-adv-hint{font:900 14px/1 system-ui,Segoe UI,Roboto,Tahoma;color:#475569}.trade-advbox .trade-label{font-weight:900}.trade-advbox .trade-in,.trade-advbox .trade-sel{background:#fff!important;border:1px solid rgba(15,23,42,.1)!important;border-radius:16px!important}@media(max-width:640px){.trade-advbox{border-radius:18px!important;padding:12px!important}}.tr-logwrap{margin-top:12px;max-height:none;overflow:visible;padding:0;background:0 0;border:0}.tr-loglist{display:grid;gap:12px}.tr-card{position:relative;background:rgba(255,255,255,.78);border:1px solid rgba(15,23,42,.1);border-radius:18px;padding:12px 14px;box-shadow:0 10px 26px rgba(0,0,0,.06)}.tr-card.buy{border-left:6px solid #22c55e;border-right:6px solid #22c55e}.tr-card.sell{border-left:6px solid #ef4444;border-right:6px solid #ef4444}.tr-card.exchange{border-left:6px solid #f59e0b;border-right:6px solid #f59e0b}.tr-head{width:100%;display:block;direction:rtl;text-align:right}.tr-card .tr-head .tr-client{width:100%;display:flex;flex-direction:row-reverse;justify-content:flex-start;align-items:center;gap:10px;flex-wrap:wrap;direction:ltr;text-align:right}.tr-card .tr-head .tr-extras,.tr-card .tr-head .tr-name{direction:rtl;unicode-bidi:plaintext;text-align:right}.tr-left{display:flex;flex-direction:row;align-items:center;justify-content:flex-start;gap:10px;min-width:0;direction:ltr}.tr-seq{font:1000 14px/1 system-ui,Segoe UI,Roboto,Tahoma;color:#0f172a;opacity:.85;direction:ltr;white-space:nowrap}.tr-dt{font:900 12.5px/1 system-ui,Segoe UI,Roboto,Tahoma;color:#64748b;direction:ltr;white-space:nowrap}.tr-client{display:flex;flex-direction:row;align-items:center;justify-content:flex-start;gap:10px;min-width:0;direction:rtl}.tr-name{font:1000 16px/1.1 system-ui,Segoe UI,Roboto,Tahoma;color:#0f172a;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:52vw}.tr-phone{font:900 13px/1 system-ui,Segoe UI,Roboto,Tahoma;color:#475569;opacity:.9;direction:ltr;white-space:nowrap}.tr-extras{font:900 12.5px/1.15 system-ui,Segoe UI,Roboto,Tahoma;color:#334155;opacity:.92;white-space:nowrap}.tr-client{flex-wrap:wrap}.tr-client .tr-extras{direction:rtl}@media(max-width:640px){.tr-extras{white-space:normal}}.tr-mid{margin-top:10px;padding:10px 12px;border-radius:14px;background:rgba(248,250,252,.95);border:1px dashed rgba(15,23,42,.12);font:950 14px/1.3 system-ui,Segoe UI,Roboto,Tahoma;color:#0f172a}.tr-mid .who{font-weight:1000}.tr-mid .act{font-weight:1000}.tr-mid.buy .act{color:#065f46}.tr-mid.sell .act{color:#991b1b}.tr-mid.exchange .act{color:#b45309}.tr-bottom{margin-top:10px;font:950 14px/1.4 system-ui,Segoe UI,Roboto,Tahoma;color:#0f172a;text-align:right}.tr-bottom .k{color:#64748b;font-weight:900}.tr-note{margin-top:10px;padding:10px 12px;border-radius:14px;background:rgba(255,255,255,.7);border:1px solid rgba(15,23,42,.1);font:900 13px/1.35 system-ui,Segoe UI,Roboto,Tahoma;color:#334155}.tr-actions{margin-top:10px;display:none;gap:8px;flex-wrap:wrap;justify-content:flex-start}.tr-card.open .tr-actions{display:flex}.tr-btn{height:38px;padding:0 12px;border-radius:12px;border:1px solid rgba(15,23,42,.12);background:rgba(255,255,255,.9);font:900 13px/1 system-ui,Segoe UI,Roboto,Tahoma;color:#0f172a;cursor:pointer;box-shadow:0 4px 12px rgba(0,0,0,.06)}.tr-btn:active{transform:scale(.99)}.tr-btn.edit{background:rgba(37,99,235,.1);border-color:rgba(37,99,235,.25);color:#1e40af}.tr-btn.del{background:rgba(239,68,68,.1);border-color:rgba(239,68,68,.25);color:#991b1b}.tr-btn.print{background:rgba(15,23,42,.06)}.tr-btn.pdf{background:rgba(15,23,42,.06)}.tr-btn.xls{background:rgba(16,185,129,.1);border-color:rgba(16,185,129,.25);color:#065f46}.tr-hist{margin-top:10px;padding:10px 12px;border-radius:14px;background:rgba(255,255,255,.72);border:1px dashed rgba(15,23,42,.12);font:900 13px/1.35 system-ui,Segoe UI,Roboto,Tahoma;color:#334155}.tr-hist .t{font-weight:1000;color:#0f172a}.tr-empty{padding:10px 12px;font:900 14px/1.3 system-ui,Segoe UI,Roboto,Tahoma;color:#0f172a;opacity:.75;text-align:center}@media(max-width:640px){.tr-card{padding:12px}.tr-name{max-width:62vw;font-size:15px}.tr-left{min-width:96px}}.trade-ratebox{position:relative}.trade-ratehead{justify-content:center!important}.trade-ratehead .ttlrow{width:100%;justify-content:center!important}.trade-ratehead .ttl{margin:0 auto!important;text-align:center!important}.trade-ratehead .trade-chip{position:absolute;right:10px;top:8px}.trade-ratehead .auto{position:absolute;left:10px;top:10px}.trade-ratein{text-align:center!important}.trade-modal.trade-mode-sell .trade-ratehead .auto,.trade-modal.trade-mode-sell .trade-ratehead .ttl{color:#991b1b!important}.trade-modal.trade-mode-sell .trade-dot{background:#ef4444!important;box-shadow:0 0 0 4px rgba(239,68,68,.16) inset!important}.tr-card.canceled{opacity:.65;filter:grayscale(.15)}.tr-card.deleted{opacity:.55;filter:grayscale(.35);border-style:dashed}
.tr-card.draft{opacity:.82}.trade-row3{display:grid;grid-template-columns:1.2fr .45fr 1.2fr;gap:10px}.trade-rate-mini{display:flex;flex-direction:column;justify-content:center}.trade-rate-mini-wrap{position:relative;display:flex;align-items:center}.trade-rate-mini-input{height:46px;border-radius:14px;border:1px solid rgba(15,23,42,.12);background:#fff;width:100%;padding-right:36px;font:900 15px/1 system-ui,Segoe UI,Roboto,Tahoma;color:#0f172a;text-align:center}.trade-rate-mini-input:focus{outline:3px solid rgba(59,130,246,.3)}.trade-rate-mini-reset{position:absolute;right:6px;height:34px;width:34px;border-radius:10px;border:0;background:#e2e8f0;color:#0f172a;font-weight:900;cursor:pointer;opacity:0;pointer-events:none;transform:scale(.96);transition:opacity .15s ease,transform .15s ease}.trade-rate-mini-wrap:hover .trade-rate-mini-reset{opacity:1;pointer-events:auto;transform:scale(1)}.trade-modal.rate-manual .trade-rate-mini-reset{opacity:1;pointer-events:auto;transform:scale(1)}.trade-modal.trade-mode-buy .trade-rate-mini-input{background:rgba(34,197,94,.08);border:1px solid rgba(34,197,94,.35);color:#065f46}.trade-modal.trade-mode-sell .trade-rate-mini-input{background:rgba(239,68,68,.08);border:1px solid rgba(239,68,68,.35);color:#991b1b}.trade-modal.trade-mode-buy .trade-rate-mini-reset{background:rgba(34,197,94,.18)}.trade-modal.trade-mode-sell .trade-rate-mini-reset{background:rgba(239,68,68,.18)}.trade-rate-mini-reset:active{transform:scale(.95)}@media(max-width:720px){.trade-row3{grid-template-columns:1fr}}@media(max-width:640px){.trade-rate-mini-input{height:46px;font-size:15px;border-radius:14px;padding-right:38px}.trade-rate-mini-reset{height:34px;width:32px;border-radius:10px}}.trade-modal{background:#fff!important;border-radius:22px!important;border:1px solid rgba(15,23,42,.10)!important;box-shadow:0 18px 50px rgba(0,0,0,.22)!important}@media(max-width:640px){.trade-modal{border-radius:22px!important}}.trade-head{position:relative!important;justify-content:center!important;margin-bottom:14px!important;padding-top:6px!important}.trade-headtitle{justify-content:center!important;width:100%!important;text-align:center!important;font-weight:1000!important}.trade-headtitle .ico{font-size:26px!important}.trade-backbtn{position:absolute!important;left:10px!important;top:6px!important;width:46px!important;height:46px!important;padding:0!important;border-radius:12px!important;border:2px solid rgba(15,23,42,.85)!important;background:#fff!important;box-shadow:0 6px 16px rgba(0,0,0,.12)!important;display:flex!important;align-items:center!important;justify-content:center!important}.trade-backbtn span{display:none!important}.trade-backbtn::before{content:"âœ–"!important;font-weight:1000!important;font-size:22px!important;line-height:1!important;color:#111827!important}.trade-label{font-weight:900!important;color:#334155!important}.trade-in,.trade-sel{height:52px!important;border-radius:16px!important;border:1px solid rgba(15,23,42,.12)!important;background:#fff!important;font-weight:900!important}@media(max-width:640px){.trade-in,.trade-sel{height:48px!important;border-radius:14px!important}}.trade-submit{height:52px!important;border-radius:14px!important;font-size:20px!important;font-weight:1000!important;box-shadow:0 10px 22px rgba(0,0,0,.16)!important}@media(max-width:640px){.trade-submit{height:48px!important;font-size:18px!important}}.trade-modal.trade-mode-buy .trade-submit{background:#16a34a!important}.trade-modal.trade-mode-sell .trade-submit{background:#d13a2f!important}.trade-modal{background:#fff!important;border-radius:22px!important;border:1px solid rgba(15,23,42,.10)!important;box-shadow:0 18px 50px rgba(0,0,0,.22)!important}@media(max-width:640px){.trade-modal{border-radius:22px!important}}.trade-head{position:relative!important;justify-content:center!important;margin-bottom:14px!important;padding-top:6px!important}.trade-headtitle{justify-content:center!important;width:100%!important;text-align:center!important;font-weight:1000!important}.trade-headtitle .ico{font-size:26px!important}.trade-backbtn{position:absolute!important;left:10px!important;top:6px!important;width:46px!important;height:46px!important;padding:0!important;border-radius:12px!important;border:2px solid rgba(15,23,42,.85)!important;background:#fff!important;box-shadow:0 6px 16px rgba(0,0,0,.12)!important;display:flex!important;align-items:center!important;justify-content:center!important}.trade-backbtn span{display:none!important}.trade-backbtn::before{content:"âœ–"!important;font-weight:1000!important;font-size:22px!important;line-height:1!important;color:#111827!important}.trade-label{font-weight:900!important;color:#334155!important}.trade-in,.trade-sel{height:52px!important;border-radius:16px!important;border:1px solid rgba(15,23,42,.12)!important;background:#fff!important;font-weight:900!important}@media(max-width:640px){.trade-in,.trade-sel{height:48px!important;border-radius:14px!important}}.trade-submit{height:52px!important;border-radius:14px!important;font-size:20px!important;font-weight:1000!important;box-shadow:0 10px 22px rgba(0,0,0,.16)!important}@media(max-width:640px){.trade-submit{height:48px!important;font-size:18px!important}}.trade-modal.trade-mode-buy .trade-submit{background:#16a34a!important}.trade-modal.trade-mode-sell .trade-submit{background:#d13a2f!important}.trade-modal.trade-mode-buy{background:#ecfdf5 !important;border-color:#a7f3d0 !important}.trade-modal.trade-mode-sell{background:#fef2f2 !important;border-color:#fecaca !important}.trade-modal.trade-mode-exchange{background:#fff7ed !important;border-color:#fdba74 !important}#tr-from,#tr-to{color:transparent !important}#tr-from::-webkit-datetime-edit,#tr-to::-webkit-datetime-edit{color:transparent !important}#tr-from::-webkit-datetime-edit-text,#tr-to::-webkit-datetime-edit-text{color:transparent !important}#tr-from::-webkit-datetime-edit-month-field,#tr-to::-webkit-datetime-edit-month-field{color:transparent !important}#tr-from::-webkit-datetime-edit-day-field,#tr-to::-webkit-datetime-edit-day-field{color:transparent !important}#tr-from::-webkit-datetime-edit-year-field,#tr-to::-webkit-datetime-edit-year-field{color:transparent !important}#tr-from::-webkit-calendar-picker-indicator,#tr-to::-webkit-calendar-picker-indicator{opacity:1;cursor:pointer}#tr-from-show,#tr-to-show{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none;font:1000 22px/1 system-ui,Segoe UI,Roboto,Tahoma;color:#0f172a}

/* ADVANCED SETTINGS facelift (no logic changes) */
.trade-advbox{
  background:rgba(255,255,255,.72)!important;
  backdrop-filter:blur(10px);
  -webkit-backdrop-filter:blur(10px);
  border:1px solid rgba(15,23,42,.10)!important;
  box-shadow:0 14px 34px rgba(0,0,0,.10);
  position:relative;
  overflow:hidden;
}
.trade-advbox::before{
  content:"";
  position:absolute;
  inset:-2px;
  background:linear-gradient(135deg,rgba(59,130,246,.18),rgba(34,197,94,.12),rgba(249,115,22,.10),rgba(255,255,255,0));
  pointer-events:none;
  opacity:.9;
  filter:blur(14px);
}
.trade-adv-grid{position:relative;z-index:1;gap:14px!important}
.trade-adv-toprow{justify-content:flex-start!important}
.trade-adv-hint{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:8px 12px;
  border-radius:999px;
  background:rgba(15,23,42,.06);
  border:1px solid rgba(15,23,42,.10);
  color:#0f172a;
}
.trade-adv-hint::before{content:"âš™ï¸";font-size:16px;line-height:1}
.trade-advbox .trade-label{color:#334155!important;letter-spacing:.1px}
.trade-advbox .trade-in,.trade-advbox .trade-sel,.trade-advbox .msel-btn{
  background:rgba(255,255,255,.92)!important;
  border:1px solid rgba(15,23,42,.12)!important;
  box-shadow:0 10px 22px rgba(0,0,0,.06);
}
.trade-advbox .trade-in:focus,.trade-advbox .trade-sel:focus,.trade-advbox .msel-btn:focus{outline:3px solid rgba(59,130,246,.28)!important}
.trade-advbox .msel-menu{
  background:rgba(255,255,255,.92)!important;
  backdrop-filter:blur(10px);
  -webkit-backdrop-filter:blur(10px);
  box-shadow:0 22px 46px rgba(0,0,0,.14)!important;
}
@media(max-width:640px){
  .trade-advbox{box-shadow:0 12px 26px rgba(0,0,0,.10)}
  .trade-advbox .msel-btn{height:52px!important;border-radius:16px!important;font-size:17px!important}
}
</style>
<style id="kpi-log-unified-panel">
.tr-unified-panel{
  margin-top:12px;
  border:2px solid rgba(15,23,42,.10);
  border-radius:22px;
  padding:12px;
  background:rgba(255,255,255,.90);
  box-shadow:0 14px 36px rgba(0,0,0,.08);
}
.tr-panel-sep{
  height:1px;
  background:rgba(15,23,42,.10);
  margin:10px 0 12px 0;
}
.tr-logwrap{margin-top:0 !important; padding-top:0 !important;}
.tr-loglist{margin-top:0 !important;}
@media(max-width:640px){
  .tr-unified-panel{margin-top:10px;border-radius:18px;padding:10px}
  .tr-panel-sep{margin:8px 0 10px 0}
}
</style>
<script id="trade-vanilla-js">!function(){"use strict";const t=(sel,root=document)=>{try{return (root||document).querySelector(sel)}catch(_){return null}},e=(sel,root=document)=>{try{return Array.from((root||document).querySelectorAll(sel))}catch(_){return []}},n=t=>{const e=Number(t);return isFinite(e)?e:0},a=t=>{try{return new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(Math.round(n(t)))}catch(e){return String(t)}};
// --- decimal formatting for foreign currencies (fix cents loss) ---
const __decForCurrency = (code)=>{code=String(code||"").toUpperCase();return (code==="SYP"||code==="SYP_BASE"||code==="SYP_NEW")?0:2;};
const af=(code,v)=>{try{const num=Number(v);if(!isFinite(num))return "";const dec=__decForCurrency(code);return new Intl.NumberFormat("en-US",{minimumFractionDigits:dec,maximumFractionDigits:dec}).format(num);}catch(_){return String(v??"");}};

// --- LIVE thousand separators while typing (professional caret-safe) ---
function __cleanNumericInput(v){
  return String(v==null?"":v)
    .replace(/[\u0660-\u0669]/g, d=>"0123456789"[d.charCodeAt(0)-1632])
    .replace(/[\u06F0-\u06F9]/g, d=>"0123456789"[d.charCodeAt(0)-1776])
    .replace(/\u066B/g,".")
    .replace(/\u066C/g,"")
    .replace(/,|\s/g,"")
    .replace(/[^0-9.]/g,"")
    .replace(/(\..*)\./g,"$1");
}
function __groupInt(intPart){
  intPart = String(intPart||"").replace(/^0+(?=\d)/,"0"); // keep one leading zero if needed
  return intPart.replace(/\B(?=(\d{3})+(?!\d))/g,",");
}
function __formatDuringTyping(clean, dec){
  if(!clean) return "";
  const parts = String(clean).split(".");
  let intPart = parts[0] || "0";
  let frac = parts[1] || "";
  if(dec<=0){ frac=""; }
  else { frac = frac.slice(0, dec); }
  return __groupInt(intPart) + (frac!=="" ? "."+frac : (String(clean).includes(".") ? "." : ""));
}
function __setCaretByCleanCount(el, cleanCount){
  try{
    const v = el.value;
    let pos = 0, seen = 0;
    for(pos=0; pos<=v.length; pos++){
      const sub = v.slice(0,pos);
      const c = __cleanNumericInput(sub).length;
      if(c >= cleanCount){ break; }
    }
    el.setSelectionRange(pos,pos);
  }catch(_){}
}
function __attachLiveGrouping(el, getCode, onClean){
  if(!el || el.__liveGrouped) return;
  el.__liveGrouped = true;
  el.addEventListener("input", function(){
    const code = (typeof getCode==="function") ? getCode() : getCode;
    const dec = __decForCurrency(code);
    const caret = el.selectionStart||0;
    const cleanBefore = __cleanNumericInput(el.value.slice(0, caret));
    const cleanAll = __cleanNumericInput(el.value);
    // limit decimals while typing
    let clean = cleanAll;
    if(dec>0 && clean.includes(".")){
      const [a,b] = clean.split(".");
      clean = a + "." + (b||"").slice(0,dec);
    } else if(dec<=0){
      clean = clean.split(".")[0];
    }
    // update underlying numeric string
    try{ onClean && onClean(clean); }catch(_){}
    // format with commas for display (keep dot if user typed it)
    el.value = __formatDuringTyping(clean, dec);
    __setCaretByCleanCount(el, cleanBefore.length);
  });
  el.addEventListener("blur", function(){
    const code = (typeof getCode==="function") ? getCode() : getCode;
    const dec = __decForCurrency(code);
    const clean = __cleanNumericInput(el.value);
    const num = Number(clean);
    el.value = (isFinite(num) && clean!=="") ? af(code, (dec>0 ? +num.toFixed(dec) : Math.round(num))) : "";
    try{ onClean && onClean(clean); }catch(_){}
  });
}
try{window.buildInvoiceDocFromTrade=function(t,e){const n=t||{},a="archive"===e||"thermal"===e?e:n._printMode||n.printMode||"thermal";let r="",i="";try{r=localStorage.getItem("taif:logo")||""}catch(t){}try{i=localStorage.getItem("taif:invoice_brand_title")||localStorage.getItem("taif:title")||"Ø´Ø±ÙƒØ© Ø·ÙŠÙ Ù„Ù„ØµØ±Ø§ÙØ© ÙˆØ§Ù„Ø­ÙˆØ§Ù„Ø§Øª"}catch(t){}i="Ø´Ø±ÙƒØ© Ø·ÙŠÙ Ù„Ù„ØµØ±Ø§ÙØ© ÙˆØ§Ù„Ø­ÙˆØ§Ù„Ø§Øª";const s="ÙØ§ØªÙˆØ±Ø© "+("sell"===n.mode||"sell"===n.trade_type||"sell"===String(n.type||"").toLowerCase()?"Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹":"Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡"),d=null!=n.seq?n.seq:null!=n.invoiceNo?n.invoiceNo:"â€”";let o="";try{if(n.at){const t=new Date(n.at);o=`${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")} - ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}`}else if(n.created_at){const t=new Date(n.created_at);o=`${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")} - ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}`}else if(n.trade_day)o=String(n.trade_day);else{const t=new Date;o=`${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")} - ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`}}catch(t){o=""}let c="";try{const t=function(){try{return JSON.parse(localStorage.getItem("taif:session")||"null")}catch(t){return null}}();c=n.actor_username||n.actor_name||t&&(t.username||t.name)||"â€”"}catch(t){c=n.actor_username||n.actor_name||"â€”"}const p=n.extra&&"object"==typeof n.extra?n.extra:{},v=n.fields&&"object"==typeof n.fields?n.fields:p.fields&&"object"==typeof p.fields?p.fields:n.dyn&&"object"==typeof n.dyn?n.dyn:{},m=null!=n.note?String(n.note||""):v.note||v["Ù…Ù„Ø§Ø­Ø¸Ø©"]||"",g=n.get||n.currency_code||n.currency||"",b=n.pay||n.pay_currency_code||n.payCurrency||"",f=null!=n.amountGet?n.amountGet:n.amount_get,y=null!=n.amountPay?n.amountPay:n.amount_pay,h=null!=n.rate?n.rate:"",x=(val,code)=>{try{const num=Number(val||0);if(!isFinite(num))return String(val||"");const dec=__decForCurrency(code);return new Intl.NumberFormat("en-US",{minimumFractionDigits:dec,maximumFractionDigits:dec}).format(dec?+num.toFixed(dec):Math.round(num));}catch(_){return String(val||"")}},w=t=>String(null==t?"":t).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[t]));let _="";try{const t=u(l).fields||[],e=new Set(["name","phone","note","Ø§Ù„Ø§Ø³Ù…","Ø§Ù„Ø±Ù‚Ù…","Ø±Ù‚Ù…","Ù…Ù„Ø§Ø­Ø¸Ø©"]),n=[];for(const a of t||[]){if(!a||!1===a.enabled)continue;const t=String(a.key||"").trim();if(!t||"name"===t||"phone"===t||"note"===t)continue;const r=String(a.label||t).trim(),i=v[t]??v[r]??"",s=String(i||"").trim();s&&(e.add(t),e.add(r),n.push(`<div class="row"><div class="k">${w(r)}</div><div class="v">${w(s)}</div></div>`))}Object.keys(v||{}).forEach(t=>{if(!t||e.has(t)||"name"===t||"phone"===t||"note"===t)return;const a=String(v[t]||"").trim();a&&n.push(`<div class="row"><div class="k">${w(t)}</div><div class="v">${w(a)}</div></div>`)}),_=n.join("")}catch(t){_=""}const S=v.name||v["Ø§Ù„Ø§Ø³Ù…"]||"â€”",$=v.phone||v["Ø§Ù„Ø±Ù‚Ù…"]||v["Ø±Ù‚Ù…"]||"â€”",k="archive"===a?"archive":"thermal";return`<!doctype html><html lang="ar" dir="rtl"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>\n<title>${w(s)}</title>\n<style>\n:root{--ink:#0f172a;--muted:#64748b;--b:#e5e7eb;--bg:#fff}\n*{box-sizing:border-box}\nbody{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,Segoe UI,Roboto,Tahoma}\n.inv{padding:16px}\n.card{border:1px solid rgba(15,23,42,.12);border-radius:16px;padding:14px}\n.hdr{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}\n.brand{display:flex;align-items:center;gap:10px;min-width:0}\n.logo{width:56px;height:56px;border-radius:14px;border:1px solid rgba(15,23,42,.12);object-fit:contain;background:#fff}\n.ttl{font-weight:1000;font-size:18px;line-height:1.1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:60vw}\n.badge{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;font-weight:1000;border:1px solid rgba(15,23,42,.12)}\n.badge.buy{background:rgba(34,197,94,.12);color:#065f46;border-color:rgba(34,197,94,.25)}\n.badge.sell{background:rgba(239,68,68,.10);color:#991b1b;border-color:rgba(239,68,68,.25)}\n.hr{height:1px;background:rgba(15,23,42,.10);margin:10px 0}\n.row{display:flex;justify-content:space-between;gap:12px;margin:6px 0}\n.k{color:var(--muted);font-weight:900}\n.v{font-weight:1000;text-align:left;direction:ltr;unicode-bidi:isolate}\n.v.rtl{direction:rtl;text-align:right}\n.block{padding-top:2px}\n.small{font-size:12px}\n\n.invttl{margin-top:6px;font-weight:1000;font-size:16px;text-align:center;white-space:nowrap}\n.v.left{direction:rtl !important;text-align:left !important;unicode-bidi:isolate!important}\n.v.nowrap{white-space:nowrap !important}\n\n.note{margin-top:8px;padding:10px 12px;border-radius:14px;border:1px dashed rgba(15,23,42,.12);background:rgba(248,250,252,.95);font-weight:900;line-height:1.5}\n.mode-thermal .inv{padding:0}\n.mode-thermal .card{border:0;border-radius:0;padding:6mm}\n.mode-thermal .ttl{font-size:14px;max-width:52mm}\n.mode-thermal .logo{width:44px;height:44px;border-radius:12px}\n.mode-thermal .row{margin:4px 0}\n.mode-thermal .k{font-size:11px}\n.mode-thermal .v{font-size:12px}\n.mode-thermal .note{font-size:12px;padding:8px 10px;border-radius:12px}\n.mode-archive .inv{max-width:720px;margin:0 auto}\n@page{margin:12mm}\n@media print{\n .mode-thermal{}\n .mode-archive{}\n}\n</style>\n<style>\n\n@page{\n size:${"archive"===a?"A4":"80mm auto"};\n margin:${"archive"===a?"12mm":"3mm"};\n}\n</style>\n


<style id="rate-align-adjust">
.trade-rate-mini-input{
    text-align: center !important;
    padding-right: 18px !important; /* slight push to the right */
}
</style>

</head><body class="mode-${k}">\n<div class="inv">\n <div class="card">\n  <div class="hdr">\n   <div class="brand">\n    ${r?`<img class="logo" src="${w(r)}" alt="logo"/>`:'<div class="logo" aria-hidden="true"></div>'}\n   </div>\n   \n  </div>\n\n  <div class="hr"></div>\n\n  <div class="row"><div class="k">Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</div><div class="v">#${w(d)}</div></div>\n  <div class="row"><div class="k">Ø§Ù„ØªØ§Ø±ÙŠØ®</div><div class="v rtl nowrap">${w(o)}</div></div>\n  <div class="row"><div class="k">Ø§Ù„Ù…Ù†ÙØ°</div><div class="v rtl">${w(c)}</div></div>\n  <div class="invttl">${w(s)}</div>\n\n  <div class="hr"></div>\n\n  <div class="row"><div class="k">Ø§Ù„Ø§Ø³Ù…</div><div class="v rtl left">${w(S)}</div></div>\n  <div class="row"><div class="k">Ø§Ù„Ø±Ù‚Ù…</div><div class="v">${w($)}</div></div>\n\n  ${_?`<div class="hr"></div>${_}`:""}\n\n  <div class="hr"></div>\n\n  <div class="row"><div class="k">Ø£Ø³Ø¹Ø§Ø± ØµØ±Ù Ø§Ù„Ø¹Ù…Ù„Ø§Øª</div><div class="v rtl">${w(g)}</div></div>\n  <div class="row"><div class="k">Ø¹Ù…Ù„Ø© Ø§Ù„Ø¯ÙØ¹</div><div class="v rtl">${w(b)}</div></div>\n  <div class="row"><div class="k">Ø³Ø¹Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„</div><div class="v">${w(x(h,"SYP"===b||"SYP_BASE"===b?0:6))}</div></div>\n  <div class="row"><div class="k">Ø§Ù„Ù…Ø¨Ù„Øº</div><div class="v">${w(x(f))} <span class="small">${w(g)}</span></div></div>\n  <div class="row"><div class="k">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div><div class="v">${w(x(y))} <span class="small">${w(b)}</span></div></div>\n\n  ${m&&String(m).trim()?`<div class="hr"></div><div class="note"><span class="k">Ù…Ù„Ø§Ø­Ø¸Ø©:</span> <span class="v rtl">${w(String(m).trim())}</span></div>`:""}\n </div>\n</div>\n
<style id="force-cancel-red-final">#inv-cancel,#trade-cancel{background:#dc2626 !important;color:#ffffff !important}</style>

<style id="removed-old-next-right-style">.trade-actions{display:flex !important;justify-content:flex-end !important;gap:14px !important}#trade-submit{order:2 !important}#trade-cancel{order:1 !important}</style>

<style id="trade-summary-rtl-fix">.trade-addbox,.trade-addbox .trade-muted,.trade-addbox div{text-align:right !important;direction:rtl !important}</style>


<style id="kpi-holdings-align-css">
/* Align currency/amount lines in KPI boxes 4/5/6 */
.kpi-holdings-line .table-numbers,
.kpi-holdings-lines .table-numbers{
  text-align:left !important;
  min-width:6ch;
}
</style>


<style id="unified-scroll-kpi-log-v1">
  /* Make KPI + log list scroll together inside the same modal */
  #trade-backdrop .tr-logwrap{max-height:none !important; overflow:visible !important;}
  #trade-backdrop .trade-modal{overflow:auto !important;}
</style>

</body></html>`}}catch(t){}function r(t){try{window.__tradeToast&&window.__tradeToast.remove()}catch(t){}const e=document.createElement("div");e.dir="rtl",e.style.cssText="position:fixed;top:14px;left:50%;transform:translateX(-50%);z-index:2147483647";const n=document.createElement("div");n.textContent=t,n.style.cssText="background:rgba(17,24,39,.95);color:#fff;border-radius:14px;padding:10px 16px;font:800 14px/1.2 system-ui,Segoe UI,Roboto,Tahoma;box-shadow:0 10px 26px rgba(0,0,0,.25);border:1px solid rgba(255,255,255,.08);max-width:92vw;text-align:center;white-space:nowrap",e.appendChild(n),document.body.appendChild(e),window.__tradeToast=e,setTimeout(()=>{try{n.style.opacity="0",n.style.transition="opacity .45s ease"}catch(t){}},1300),setTimeout(()=>{try{e.remove()}catch(t){}},2100)}function i(){try{return((t,e)=>{try{return JSON.parse(t)}catch(t){return e}})(localStorage.getItem("taif:session")||"null",null)}catch(t){return null}}function s(t){const e=i();return!!e&&("superadmin"===e.role||"emergency"===e.role||Array.isArray(e.permissions)&&e.permissions.includes(t))}function d(){return s("manageTradeFields")||function(){const t=i();return!(!t||"superadmin"!==t.role&&"emergency"!==t.role)}()}
let o=null,l=null,c=Object.create(null);
const __TRADE_FIELD_ORDER__ = [
 "name",
 "father_name",
 "mother_name",
 "birth_date",
 "ratio",
 "amanah",
 "qayd",
 "residence",
 "card_number",
 "national_number",
 "phone"
];
function __sortTradeFields__(arr){
 try{
  const rank = new Map(__TRADE_FIELD_ORDER__.map((k,i)=>[k,i]));
  return (Array.isArray(arr)?arr:[]).slice().sort((a,b)=>{
   const ra = rank.has(a.key)?rank.get(a.key):9999;
   const rb = rank.has(b.key)?rank.get(b.key):9999;
   if(ra!==rb) return ra-rb;
   // keep stable-ish by label/key
   return String(a.label||a.key||"").localeCompare(String(b.label||b.key||""),"ar");
  });
 }catch(_){ return arr; }
}

const p = [
 { key:"name", label:"Ø§Ù„Ø§Ø³Ù…", type:"text", enabled:true, system:true },
 { key:"phone", label:"Ø§Ù„Ø±Ù‚Ù…", type:"text", enabled:true, system:true },

 { key:"ratio", label:"Ø§Ù„Ù†Ø³Ø¨Ø©", type:"number", enabled:true, system:true },
 { key:"father_name", label:"Ø§Ø³Ù… Ø§Ù„Ø§Ø¨", type:"text", enabled:true, system:true },
 { key:"mother_name", label:"Ø§Ø³Ù… Ø§Ù„Ø§Ù…", type:"text", enabled:true, system:true },
 { key:"birth_date", label:"ØªØ§Ø±ÙŠØ® Ø§Ù„ÙˆÙ„Ø§Ø¯Ø©", type:"text", enabled:true, system:true },
 { key:"amanah", label:"Ø§Ù„Ø§Ù…Ø§Ù†Ø©", type:"text", enabled:true, system:true },
 { key:"qayd", label:"Ø§Ù„Ù‚ÙŠØ¯", type:"text", enabled:true, system:true },
 { key:"residence", label:"Ø§Ù„Ø§Ù‚Ø§Ù…Ø©", type:"text", enabled:true, system:true },
 { key:"card_number", label:"Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©", type:"text", enabled:true, system:true },
 { key:"national_number", label:"Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ·Ù†ÙŠ", type:"text", enabled:true, system:true },
];
function u(t){
 const e=t&&"object"==typeof t?{...t}:{};
 // If no saved fields list exists, default to ALL disabled (user must enable from UI)
 let n=Array.isArray(e.fields)?e.fields:null;
 if(!n){
  n=(Array.isArray(p)?p:[]).map(f=>({
    key:String(f.key||"").trim(),
    label:String(f.label||f.key||"").trim(),
    type:("number"===f.type?"number":"text"),
    enabled:false,
    system:!!f.system || f.key==="name" || f.key==="phone"
  }));
 }
 const seen=new Set();
 n=n.filter(f=>f&&f.key&&f.label&&f.key!=="mobile_number").map(f=>({
   key:String(f.key).trim(),
   label:String(f.label).trim(),
   type:("number"===f.type?"number":"text"),
   enabled:!!f.enabled, // strict
   system:!!f.system || f.key==="name" || f.key==="phone"
 })).filter(f=>!!f.key && (!seen.has(f.key) && (seen.add(f.key),true)));

 try{
  // ensure defaults exist, but NEVER auto-enable them
  n=n.filter(f=>f.key!=="mobile_number");
  const m=new Map(n.map(f=>[f.key,f]));
  for(const d of (Array.isArray(p)?p:[])){
   if(!d||!d.key) continue;
   const k=String(d.key).trim();
   if(!k || k==="mobile_number") continue;
   if(!m.has(k)){
    const add={
      key:k,
      label:String(d.label||k),
      type:("number"===d.type?"number":"text"),
      enabled:false,
      system:true
    };
    n.push(add); m.set(k,add);
   }else{
    const cur=m.get(k);
    cur.system=true;
    if(!cur.label && d.label) cur.label=String(d.label);
    if(d.type) cur.type=("number"===d.type?"number":"text");
    // keep cur.enabled as-is
   }
  }
 }catch(_){}

 // Always keep 'name' in list (still can be disabled)
 if(!n.some(f=>f.key==="name")) n.unshift({key:"name",label:"Ø§Ù„Ø§Ø³Ù…",type:"text",enabled:false,system:true});
 // Remove legacy field
 n=n.filter(f=>f.key!=="mobile_number");
 // Sort by preferred order
 n=__sortTradeFields__(n);
 e.fields=n;
 return e
}const v=()=>!!(window.$db&&window.$db.onValue&&window.$db.ref&&window.$db.set);function m(){try{if(window.__TAIF_SUPA__)return window.__TAIF_SUPA__;if(!window.supabase||!window.supabase.createClient)return null;const t="https://rzabluqawcyhedcvmyut.supabase.co",e="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ6YWJsdXFhd2N5aGVkY3ZteXV0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExODMxMTQsImV4cCI6MjA4Njc1OTExNH0.EWbcZ4jliSKtlY3rk303EkcUfNDqJhOKDRAP2kxPCxE";return (window.__TAIF_SUPA__||(window.__TAIF_SUPA__=window.supabase.createClient(t,e,{realtime:{params:{eventsPerSecond:3}}})))}catch(t){return null}}function g(){const t=new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}function __bid(){try{return (window.__taif_branchId?window.__taif_branchId():(localStorage.getItem("taif:branch_id")||"main"));}catch(_){return "main";}}async function b(t){const e=m();if(!e)return r("âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"),{ok:!1};const a=await async function(t,e){const a=i()||{},r=a.username||a.name||"anon",s=a.name||"",d=t&&("sell"===t.mode?"sell":"buy"),l=w(t&&t.get),c=w(t&&t.pay),p="SYP_BASE"===c?"SYP":c;let u=l;try{const t=(Array.isArray(o)?o:[]).find(t=>t&&t.code===l);t&&t.name&&(u=t.name)}catch(t){}const v=n(t&&t.amountGet),m=n(t&&t.amountPay),b=n(t&&t.rate),f=Object.assign({},t&&t.extra?t.extra:{},t||{});try{f.branch=__bid()}catch(_){ }"exchange"===t.mode&&(f.kind="exchange",f.exchange_fixed_rate=100,f.exchange_op="divide");return f.status=e||"draft",f.status_ar="confirmed"===f.status?"Ù…Ø¤ÙƒØ¯":"canceled"===f.status?"Ù…Ù„ØºÙ‰":"Ù…Ø³ÙˆØ¯Ø©",f.updated_at=Date.now(),"draft"===f.status&&(f.draft_created_at=f.draft_created_at||Date.now(),f.draft_expires_at=f.draft_expires_at||Date.now()+6e5),"confirmed"===f.status&&(f.confirmed_at=Date.now()),"canceled"===f.status&&(f.canceled_at=Date.now()),{trade_day:g(),trade_type:d,currency_code:l,currency_name:u,pay_currency_code:p||null,amount_get:v,amount_pay:m,rate:b,actor_username:r,actor_name:s||null,note:t&&t.fields&&(t.fields.note||t.fields["Ù…Ù„Ø§Ø­Ø¸Ø©"])?t.fields.note||t.fields["Ù…Ù„Ø§Ø­Ø¸Ø©"]:null,branch_id:__bid(),extra:f}}(t,"draft");if(t&&t.seq)try{const{data:n,error:i}=await e.from("trade_transactions").select("seq,extra,created_at").eq("seq",t.seq).maybeSingle();if(i)throw i;const s=Object.assign({},n&&n.extra?n.extra:{},a.extra);a.extra=s;const{data:d,error:o}=await e.from("trade_transactions").update({trade_day:a.trade_day,trade_type:a.trade_type,currency_code:a.currency_code,currency_name:a.currency_name,pay_currency_code:a.pay_currency_code,amount_get:a.amount_get,amount_pay:a.amount_pay,rate:a.rate,actor_username:a.actor_username,actor_name:a.actor_name,note:a.note,branch_id:a.branch_id,extra:a.extra}).eq("seq",t.seq).select("seq,created_at").single();return o||!d?(r("âš ï¸ ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ÙˆØ¯Ø©"),{ok:!1}):{ok:!0,seq:d.seq,created_at:d.created_at}}catch(t){return r("âš ï¸ ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ÙˆØ¯Ø©"),{ok:!1}}try{const{data:t,error:n}=await e.from("trade_transactions").insert([a]).select("seq,created_at").single();return n||!t?(r("âš ï¸ ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ÙˆØ¯Ø©"),{ok:!1}):{ok:!0,seq:t.seq,created_at:t.created_at}}catch(t){return r("âš ï¸ ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ÙˆØ¯Ø©"),{ok:!1}}}async function f(t,e){const n=m();if(!n)return r("âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"),{ok:!1};try{const{data:a,error:i}=await n.from("trade_transactions").select("seq,extra").eq("seq",t).maybeSingle();try{var br=(a&&a.extra&&a.extra.branch)||null;if(br&&String(br)!==String(__bid()))return r("âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© Ù„ÙØ±Ø¹ Ø¢Ø®Ø±"),{ok:!1};if(!br&&String(__bid())!=="main")return r("âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© Ù‚Ø¯ÙŠÙ…Ø© Ù„ÙØ±Ø¹ Ø¢Ø®Ø±"),{ok:!1};}catch(_){ }if(i)throw i;const s=Object.assign({},a&&a.extra?a.extra:{});s.status=e,s.status_ar="confirmed"===e?"Ù…Ø¤ÙƒØ¯":"canceled"===e?"Ù…Ù„ØºÙ‰":"Ù…Ø³ÙˆØ¯Ø©",s.updated_at=Date.now(),"confirmed"===e&&(s.confirmed_at=Date.now()),"canceled"===e&&(s.canceled_at=Date.now());const{data:d,error:o}=await n.from("trade_transactions").update({extra:s}).eq("seq",t).select("seq").single();return o||!d?(r("âš ï¸ ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©"),{ok:!1}):{ok:!0,seq:d.seq}}catch(t){return r("âš ï¸ ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©"),{ok:!1}}}async function y(){const t=m();if(t){try{const t="taif:trade_draft_cleanup_at",e=Number(localStorage.getItem(t)||"0")||0,n=Date.now();if(n-e<12e4)return;localStorage.setItem(t,String(n))}catch(t){}try{const{data:e,error:n}=await t.from("trade_transactions").select("seq,created_at,extra,branch_id,deleted_at").is("deleted_at",null).order("created_at",{ascending:!1}).limit(500);if(n)return;const a=Date.now(),r=(e||[]).filter(t=>{const e=t&&t.extra?t.extra:{};if("draft"!==(e&&e.status?e.status:"confirmed"))return!1;let n=Number(e.draft_expires_at||0);if(!n)try{n=new Date(t.created_at).getTime()+6e5}catch(t){n=0}return n&&a>n}).map(t=>t.seq);if(!r.length)return;const i=(t,e)=>t.reduce((n,a,r)=>r%e?n:n.concat([t.slice(r,r+e)]),[]);for(const e of i(r,25))try{await t.from("trade_transactions").delete().in("seq",e)}catch(t){}}catch(t){}}}try{y(),setInterval(y,18e4)}catch(t){}function h(){let e=t("#trade-backdrop");return e||(e=document.createElement("div"),e.id="trade-backdrop",e.className="trade-backdrop",e.innerHTML='<div class="trade-modal" role="dialog" aria-modal="true"></div>',document.body.appendChild(e),e)}function x(){const e=h();e.classList.remove("open");const n=t(".trade-modal",e);if(n){n.innerHTML="";try{n.classList.remove("trade-mode-sell","trade-mode-buy","trade-mode-exchange")}catch(t){}}try{window.__trade_refreshOpenRate&&(window.__trade_refreshOpenRate=null)}catch(t){}}function w(t){return"SYP_BASE"===t?"SYP":"SYP_NEW"===t?"SYP*":t}function _(t){try{if("SYP_BASE"===t)return"ğŸ‡¸ğŸ‡¾";if("SYP_NEW"===t)return"ğŸ‡¸ğŸ‡¾";const e=c&&c[t],n=e&&(e.flag||e.emoji||e.iconEmoji);if(n&&"string"==typeof n&&n.trim())return n.trim();const a=String(t||"").slice(0,2).toUpperCase();if(2===a.length&&a[0]>="A"&&a[0]<="Z"&&a[1]>="A"&&a[1]<="Z"){const t=a.charCodeAt(0)-65+127462,e=a.charCodeAt(1)-65+127462;return String.fromCodePoint(t,e)}}catch(t){}return""}function S(t){
  if("SYP_BASE"===t) return c.SYP_BASE||{code:"SYP",name:"Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ø³ÙˆØ±ÙŠØ©",buy:1,sell:1};
  var o=c[t]||null;
  try{
    var code=String(t||"").toUpperCase();
    function __num(x){
      x=String(x||"")
        .replace(/[\u0660-\u0669]/g,function(ch){return "0123456789"[ch.charCodeAt(0)-1632];})
        .replace(/[\u06F0-\u06F9]/g,function(ch){return "0123456789"[ch.charCodeAt(0)-1776];})
        .replace(/\u066B/g,".").replace(/\u066C/g,"")
        .replace(/,/g,"").replace(/\s/g,"")
        .replace(/[^0-9.]/g,"");
      var n=Number(x);
      return isFinite(n)?n:0;
    }
    var live=(function(code){
      var list=[];
      try{ list=list.concat([].slice.call(document.querySelectorAll(".view-card,.board-row"))); }catch(_){}
      for(var i=0;i<list.length;i++){
        var el=list[i]; if(!el) continue;
        var txt=(el.textContent||"");
        if(txt.indexOf(code)===-1) continue;

        // Mobile card layout
        try{
          var labels=el.querySelectorAll(".card-label");
          if(labels && labels.length){
            var buy=0,sell=0;
            labels.forEach(function(lab){
              var t=(lab.textContent||"").trim();
              var wrap=lab.parentElement;
              var pill=wrap && wrap.querySelector(".pill-card,.pill-buy,.pill-sell");
              if(!pill) return;
              var v=__num(pill.textContent||pill.value||"");
              if(t==="Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡") buy=v;
              else if(t==="Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹") sell=v;
            });
            if(buy>0||sell>0) return {buy:buy,sell:sell};
          }
        }catch(_){}

        // Board row layout
        try{
          var pb=el.querySelector(".pill-buy,.cell-buy");
          var ps=el.querySelector(".pill-sell,.cell-sell");
          var buyv=__num(pb?pb.textContent:"");
          var sellv=__num(ps?ps.textContent:"");
          if(buyv>0||sellv>0) return {buy:buyv,sell:sellv};
        }catch(_){}
      }
      return null;
    })(code);

    if(live && (live.buy>0 || live.sell>0)){
      o=o?Object.assign({},o,live):Object.assign({code:code},live);
    }
  }catch(_){}
  return o;
}function $(t){if("SYP_BASE"===t)return"Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ø³ÙˆØ±ÙŠØ© â€” SYP";if("SYP_NEW"===t)return"Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ø³ÙˆØ±ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ø­Ø°Ù ØµÙØ±ÙŠÙ†) â€” SYP*";const e=c[t];return`${e&&e.name||t} â€” ${w(t)}`}function k(t){const e=Object.keys(c||{}),n=Array.from(new Set(e.map(t=>String(t||"").toUpperCase()).filter(t=>t&&"SYP_BASE"!==t&&"SYP_NEW"!==t&&"SYP"!==t))).sort((t,e)=>"USD"===t?-1:"USD"===e?1:t.localeCompare(e));let a=t;return a&&n.includes(a)||(a=n.includes("USD")?"USD":n[0]||"USD"),n.map(t=>`<option value="${t}" ${t===a?"selected":""}>${$(t)}</option>`).join("")}function E(t,e){const n=(t||[]).filter(t=>t.enabled);return n.length?n.map(t=>{const n=e&&e[t.key]?String(e[t.key]):"",a=(t.type,"text"),r="number"===t.type?"numeric":"text",i=t.label;return`\n    <div class="trade-field" data-field="${t.key}"><div class="trade-label">${t.label}</div><input class="trade-in" data-dyn="${t.key}" type="${a}" inputmode="${r}" placeholder="${("birth_date"===t.key?"DD/MM/YYYY":i)}" inputmode="${"birth_date"===t.key?"numeric":r}" autocomplete="off" value="${n.replace(/"/g,"&quot;")}" /></div>\n   `}).join(""):""}
function setupTradeEnterNav(modal){
 try{
  if(!modal||modal.__enterNav)return;
  modal.__enterNav=!0;
  const isVisible=(el)=>!!(el&&(el.offsetWidth||el.offsetHeight||el.getClientRects().length));
  const buildOrder=()=>{
   const dyn=[...modal.querySelectorAll('#trade-dyn-fields input,#trade-dyn-fields select,#trade-dyn-fields textarea')].filter(isVisible);
   const amountGet=modal.querySelector('#trade-amount-get');
   const amountPay=modal.querySelector('#trade-amount-pay');
   const submit=modal.querySelector('#trade-submit');
   const order=[...dyn];
   if(amountGet&&isVisible(amountGet))order.push(amountGet);
   if(amountPay&&isVisible(amountPay))order.push(amountPay);
   if(submit&&isVisible(submit))order.push(submit);
   for(let i=0;i<order.length;i++){
    const el=order[i];
    if(!el||!el.setAttribute)continue;
    if(el.id==='trade-submit')continue;
    const hint=(submit && i===order.length-2)?'done':'next';
    el.setAttribute('enterkeyhint',hint);
   }
   return order;
  };
  modal.addEventListener('keydown',function(ev){
   if(ev.key!=='Enter')return;
   const t=ev.target;
   if(!t)return;
   if(t.tagName==='TEXTAREA')return;
   if(t.tagName==='BUTTON')return;
   // Ø¥Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¯Ø§Ø®Ù„ select Ù†Ø®Ù„ÙŠÙ‡ Ù…Ø«Ù„ input ÙˆÙŠØªÙ‚Ø¯Ù…
   ev.preventDefault();
   const order=buildOrder();
   if(!order.length)return;
   const idx=order.indexOf(t);
   if(idx>=0 && idx<order.length-1){
    order[idx+1].focus();
    return;
   }
   const submit=modal.querySelector('#trade-submit');
   if(submit) submit.focus();
  },!0);
 }catch(_){}
}
function L(s,d){if(!c||!Object.keys(c).length)return void r("âš ï¸ Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø¨Ø¹Ø¯");
if("exchange"===s){
 const g=d&&"object"==typeof d?d:{},y=g.fields&&"object"==typeof g.fields?g.fields:g.dyn&&"object"==typeof g.dyn?g.dyn:{};
 let A={mode:"exchange",seq:g&&g.seq?g.seq:null,get:"SYP_BASE",pay:"SYP_NEW",autoRate:!1,rate:100,amountGet:null!=g.amountGet?String(g.amountGet):"",amountPay:null!=g.amountPay?String(g.amountPay):"",dyn:Object.assign({},y)};
 const q=h(),modal=t(".trade-modal",q);
 try{modal.classList.add("trade-mode-exchange");modal.classList.remove("trade-mode-buy","trade-mode-sell");}catch(_){ }

 modal.innerHTML=`
  <div class="trade-head"><button class="trade-backbtn" type="button"><span style="font-size:20px">â¬…</span><span>Ø±Ø¬ÙˆØ¹</span></button>
   <div class="trade-headtitle"><span>Ø³Ù†Ø¯ ÙØ§ØªÙˆØ±Ø© Ø§Ø³ØªØ¨Ø¯Ø§Ù„</span></div>
  </div>
  <div class="trade-form">
   <div class="trade-row2" id="trade-dyn-fields">${E(u(l).fields||p,A.dyn)}</div>

   <div class="trade-row2">
    <div class="trade-field">
     <div class="trade-label">Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ø³ÙˆØ±ÙŠØ© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©</div>
     <div class="trade-in" style="display:flex;align-items:center;justify-content:center;gap:10px;background:#fff">
      <span style="font-weight:1000">SYP â€” Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ø³ÙˆØ±ÙŠØ©</span>
     </div>
    </div>
    <div class="trade-field">
     <div class="trade-label">Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ø³ÙˆØ±ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</div>
     <div class="trade-in" style="display:flex;align-items:center;justify-content:center;gap:10px;background:#fff">
      <span style="font-weight:1000">SYP* â€” Ø§Ù„Ø³ÙˆØ±ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯</span>
     </div>
    </div>
   </div>

   <input type="hidden" id="trade-rate" value="100"/>
   <div class="trade-row2">
    <div class="trade-field"><div class="trade-label">Ù…Ø¨Ù„Øº Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ø³ÙˆØ±ÙŠØ© (SYP)</div><input class="trade-in table-numbers" id="trade-amount-get" inputmode="decimal" placeholder="0" /></div>
    <div class="trade-field"><div class="trade-label">Ù…Ø¨Ù„Øº Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ø³ÙˆØ±ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯ (SYP*)</div><input class="trade-in table-numbers" id="trade-amount-pay" inputmode="decimal" placeholder="0" /></div>
   </div>

   

<div class="trade-actions" style="display:flex;flex-direction:row-reverse;justify-content:flex-start;gap:14px;margin-top:20px">
  <button type="button" id="trade-submit"
    style="background:#16a34a;color:#fff;border:none;padding:14px 32px;
    border-radius:14px;font-weight:700;cursor:pointer">
    Ø§Ù„ØªØ§Ù„ÙŠ (ÙØ§ØªÙˆØ±Ø©)
  </button>

  <button type="button" id="trade-cancel"
    style="background:#dc2626;color:#fff;border:none;padding:14px 32px;
    border-radius:14px;font-weight:700;cursor:pointer">
    Ø¥Ù„ØºØ§Ø¡
  </button>
</div>

  </div>
 `;
 setupTradeEnterNav(modal);
 q.classList.add("open");
 t(".trade-backbtn",modal).addEventListener("click",x);

 const U=t("#trade-rate",modal),B=t("#trade-amount-get",modal),F=t("#trade-amount-pay",modal),O=t("#trade-submit",modal),cancelBtn=t("#trade-cancel",modal);
 cancelBtn&&cancelBtn.addEventListener("click",x);
 U.value="100";
 const G=t=>String(null==t?"":t).replace(/[\u0660-\u0669]/g,t=>"0123456789"[t.charCodeAt(0)-1632]).replace(/[\u06F0-\u06F9]/g,t=>"0123456789"[t.charCodeAt(0)-1776]).replace(/\u066B/g,".").replace(/\u066C/g,"").replace(/,|\s/g,"").replace(/[^0-9.]/g,"").replace(/(\..*)\./g,"$1");
 function fmt(v){try{const n=Number(String(v||"").replace(/,/g,""));return isFinite(n)?new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(Math.round(n)):""}catch(_){return String(v||"")}}
 function calcFromTop(){const n=Number(String(A.amountGet||"").replace(/,/g,""))||0;if(!(n>0)){A.amountPay="";F.value="";return;}const raw=n/100;const val=Math.round(raw);A.amountPay=String(val);F.value=af(A.pay,val)}
 function calcFromBottom(){const n=Number(String(A.amountPay||"").replace(/,/g,""))||0;if(!(n>0)){A.amountGet="";B.value="";return;}const raw=n*100;const val=Math.round(raw);A.amountGet=String(val);B.value=af(A.get,val)}
 if(A.amountGet){B.value=af(A.get,Number(String(A.amountGet||0).replace(/,/g,""))||0);calcFromTop()}
 if(A.amountPay&&!A.amountGet){F.value=af(A.pay,Number(String(A.amountPay||0).replace(/,/g,""))||0);calcFromBottom()}
 __attachLiveGrouping(B, ()=>A.get, (clean)=>{A.amountGet=clean;});
 __attachLiveGrouping(F, ()=>A.pay, (clean)=>{A.amountPay=clean;});
 B.addEventListener("input",()=>{calcFromTop();});
 F.addEventListener("input",()=>{calcFromBottom();});



 O.addEventListener("click",async()=>{const dyn=function(t){const n={};try{e("[data-dyn]",t).forEach(t=>{n[t.getAttribute("data-dyn")]=(t.value||"").trim()})}catch(_){ }return n}(t("#trade-dyn-fields",modal));
  const i=Number(String(A.amountGet||"").replace(/,/g,""))||0;
  const amtPay=Number(String(A.amountPay||"").replace(/,/g,""))||0;
  const req=(u(l).fields||p).filter(t=>t&&t.enabled);
  for(const f of req){if(!(dyn[f.key]||"").trim()){r(`âš ï¸ Ø£Ø¯Ø®Ù„ ${f.label}`);const el=t(`[data-dyn="${f.key}"]`,modal);try{el&&el.focus()}catch(_){ }return;}}
  if(!(i>0&&amtPay>0))return void r("âš ï¸ Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­");
  try{O.disabled=!0,O.style.opacity="0.75"}catch(_){}
  r("â³ Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙØ§ØªÙˆØ±Ø©...");
  const c={mode:"exchange",at:Date.now(),iso:(new Date).toISOString(),get:"SYP_BASE",pay:"SYP_NEW",rate:100,amountGet:i,amountPay:amtPay,autoRate:!1,fields:dyn};
  A.seq&&(c.seq=A.seq);
  const pRes=await b(c);
  try{O.disabled=!1,O.style.opacity=""}catch(_){}
  pRes&&pRes.ok?(c.seq=pRes.seq,A.seq=pRes.seq,c.extra=c.extra||{},c.extra.status="draft",renderInvoice(modal,c)):r("âš ï¸ ØªØ¹Ø°Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙØ§ØªÙˆØ±Ø©");
});
 return;
}
const o=u(l).fields||p,v=c.USD?"USD":Object.keys(c)[0],m="SYP_BASE",g=d&&"object"==typeof d?d:{},y=g.fields&&"object"==typeof g.fields?g.fields:g.dyn&&"object"==typeof g.dyn?g.dyn:{};let A={mode:s,seq:g&&g.seq?g.seq:null,get:g.get?String(g.get).toUpperCase():v,pay:g.pay?String(g.pay).toUpperCase():v===m?"USD":m,autoRate:!1!==g.autoRate,rate:n(g.rate),amountGet:null!=g.amountGet?String(g.amountGet):"",amountPay:null!=g.amountPay?String(g.amountPay):"",dyn:Object.assign({},y)};A.pay&&A.pay!==A.get||(A.pay="SYP_BASE");if(g&&g.__freeze){A.autoRate=!1;}const q=h(),modal=t(".trade-modal",q);function C(t){return String(t||"").replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[t]))}function D(t){try{const e=i()||{},n=e.username||e.name||"â€”",a="exchange"===t.mode?"Ø§Ø³ØªØ¨Ø¯Ø§Ù„":"sell"===t.mode?"Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹":"Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡",r=new Date(t.at||Date.now()),s=`${r.getFullYear()}/${String(r.getMonth()+1).padStart(2,"0")}/${String(r.getDate()).padStart(2,"0")} - ${String(r.getHours()).padStart(2,"0")}:${String(r.getMinutes()).padStart(2,"0")}`,d=[];d.push(`ÙØ§ØªÙˆØ±Ø© ${a}`),d.push("Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: "+(t&&t.seq?"#"+t.seq:"â€”")),d.push(`Ø§Ù„ØªØ§Ø±ÙŠØ®: ${s}`),d.push(`Ø§Ù„Ù…Ù†ÙØ°: ${n}`);try{const e=t.fields&&(t.fields.name||t.fields["Ø§Ù„Ø§Ø³Ù…"])?t.fields.name||t.fields["Ø§Ù„Ø§Ø³Ù…"]:"",n=t.fields&&(t.fields.phone||t.fields["Ø§Ù„Ø±Ù‚Ù…"]||t.fields["Ø±Ù‚Ù…"])?t.fields.phone||t.fields["Ø§Ù„Ø±Ù‚Ù…"]||t.fields["Ø±Ù‚Ù…"]:"";e&&d.push(`Ø§Ù„Ø§Ø³Ù…: ${e}`),n&&d.push(`Ø§Ù„Ø±Ù‚Ù…: ${n}`)}catch(t){}try{const e=t.fields&&(t.fields.note||t.fields["Ù…Ù„Ø§Ø­Ø¸Ø©"])?t.fields.note||t.fields["Ù…Ù„Ø§Ø­Ø¸Ø©"]:"";e&&d.push(`Ù…Ù„Ø§Ø­Ø¸Ø©: ${e}`)}catch(t){}try{const e=new Set(["name","phone","note","Ø§Ù„Ø§Ø³Ù…","Ø§Ù„Ø±Ù‚Ù…","Ø±Ù‚Ù…","Ù…Ù„Ø§Ø­Ø¸Ø©"]),n=(u(l).fields||p).filter(t=>t&&!1!==t.enabled);for(const a of n){if(!a||!1===a.enabled)continue;const n=String(a.key||"").trim(),r=String(a.label||n).trim();if(!n||"name"===n||"phone"===n||"note"===n)continue;const i=(t.fields&&(t.fields[n]??t.fields[r]))??"",s=String(i||"").trim();s&&(e.add(n),e.add(r),d.push(`${r}: ${s}`))}Object.keys(t.fields||{}).forEach(n=>{if(!n||e.has(n)||"name"===n||"phone"===n||"note"===n)return;const a=String(t.fields[n]||"").trim();a&&d.push(`${n}: ${a}`)})}catch(t){}return d.push("----------------------------"),d.push(`Ø£Ø³Ø¹Ø§Ø± ØµØ±Ù Ø§Ù„Ø¹Ù…Ù„Ø§Øª: ${t.get}`),d.push(`Ø¹Ù…Ù„Ø© Ø§Ù„Ø¯ÙØ¹: ${t.pay}`),d.push(`Ø³Ø¹Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„: ${t.rate}`),d.push(`Ø§Ù„Ù…Ø¨Ù„Øº: ${Number(t.amountGet).toLocaleString("en-US")} ${t.get}`),d.push(`Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${Number(t.amountPay).toLocaleString("en-US")} ${t.pay}`),d.join("\n")}catch(t){return""}}function renderInvoice(modalEl,e){const kind=("exchange"===e.mode)?"Ø§Ø³ØªØ¨Ø¯Ø§Ù„":("sell"===e.mode?"Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹":"Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡");modalEl.innerHTML=`\n    <div class="trade-head">\n     <button class="trade-backbtn" type="button"><span style="font-size:20px">â¬…</span><span>Ø±Ø¬ÙˆØ¹</span></button>\n     <div class="trade-headtitle"><span>Ø³Ù†Ø¯ ÙØ§ØªÙˆØ±Ø© ${kind}</span></div>\n    </div>\n\n    <div class="trade-addbox" style="background:rgba(255,255,255,.95);border-style:solid;border-color:rgba(15,23,42,.10)">\n     <div style="font:1000 16px/1 system-ui,Segoe UI,Roboto,Tahoma;color:#0f172a;margin-bottom:8px">Ù…Ù„Ø®Øµ</div>\n     <div class="trade-muted" style="font-weight:900;line-height:1.7;white-space:pre-wrap">${C(D(e))}</div>\n    </div>\n\n    
\n    <div class="tr-actions" style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-start">
     <button class="tr-btn edit" type="button" id="inv-edit">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
     <button class="tr-btn" type="button" id="inv-copy">ğŸ“‹ Ù†Ø³Ø®</button>
     <button class="tr-btn print" type="button" id="inv-print">ğŸ§¾ Ø·Ø¨Ø§Ø¹Ø©</button>
     <button class="tr-btn del" type="button" id="inv-cancel">âœ– Ø¥Ù„ØºØ§Ø¡</button>
    </div>\n
<div style="margin-top:12px">\n     <button class="trade-submit ${"sell"===e.mode?"sell":"buy"}" type="button" id="inv-exec" style="width:100%;min-width:0">âœ… ØªÙ†ÙÙŠØ°</button>\n    </div>\n   `,t(".trade-backbtn",modalEl).addEventListener("click",()=>{try{L(e.mode,Object.assign({},e,{autoRate:false,__freeze:true}))}catch(_){}}),t("#inv-edit",modalEl).addEventListener("click",()=>{try{L(e.mode,Object.assign({},e,{autoRate:false,__freeze:true}))}catch(_){}}),t("#inv-copy",modalEl).addEventListener("click",()=>function(t){const e=(t||"").trim();if(!e)return r("âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Øµ Ù„Ù†Ø³Ø®Ù‡");const n=()=>r("âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙØ§ØªÙˆØ±Ø©"),a=()=>r("âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ù†Ø³Ø® â€” Ø§Ù†Ø³Ø® ÙŠØ¯ÙˆÙŠÙ‹Ø§");try{if(navigator.clipboard&&window.isSecureContext)return void navigator.clipboard.writeText(e).then(n).catch(()=>{try{const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",t.style.left="-9999px",document.body.appendChild(t),t.select(),document.execCommand("copy"),t.remove(),n()}catch(t){a()}})}catch(t){}try{const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",t.style.left="-9999px",document.body.appendChild(t),t.select(),document.execCommand("copy"),t.remove(),n()}catch(t){a()}}(D(e))),t("#inv-print",modalEl).addEventListener("click",()=>function(t){try{// mobile-safe print (no new tab)
// use hidden iframe so the browser opens the print dialog without navigating
let e=document.getElementById("tr-print-frame");e||(e=document.createElement("iframe"),e.id="tr-print-frame",e.style.position="fixed",e.style.right="0",e.style.bottom="0",e.style.width="0",e.style.height="0",e.style.border="0",e.style.opacity="0",e.style.pointerEvents="none",e.style.visibility="hidden",document.body.appendChild(e));const n=String(Date.now())+Math.random().toString(16).slice(2);e.dataset.printToken=n;const a=e.contentWindow.document;a.open(),a.write(t),a.close();let r=!1;const i=()=>{try{if(r)return;if(e.dataset.printToken!==n)return;r=!0,e.contentWindow.focus(),e.contentWindow.print()}catch(t){}};e.onload=i,setTimeout(i,550)}catch(t){r("âš ï¸ ØªØ¹Ø°Ø± ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©")}}(function(t){const e=i()||{},n=e.username||e.name||"â€”",a="sell"===t.mode,r=new Date(t.at||Date.now()),s=`${r.getFullYear()}/${String(r.getMonth()+1).padStart(2,"0")}/${String(r.getDate()).padStart(2,"0")} ${String(r.getHours()).padStart(2,"0")}:${String(r.getMinutes()).padStart(2,"0")}:${String(r.getSeconds()).padStart(2,"0")}`;let d="",o="";try{d=localStorage.getItem("taif:logo")||""}catch(t){}try{o="Ø´Ø±ÙƒØ© Ø·ÙŠÙ Ù„Ù„ØµØ±Ø§ÙØ© ÙˆØ§Ù„Ø­ÙˆØ§Ù„Ø§Øª"}catch(t){}o="Ø´Ø±ÙƒØ© Ø·ÙŠÙ Ù„Ù„ØµØ±Ø§ÙØ© ÙˆØ§Ù„Ø­ÙˆØ§Ù„Ø§Øª";const c="ÙØ§ØªÙˆØ±Ø© "+("exchange"===t.mode?"Ø§Ø³ØªØ¨Ø¯Ø§Ù„":(a?"Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹":"Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡")),v=(u(l).fields||p).filter(t=>t&&!1!==t.enabled),m=[];try{const e=new Set(["name","phone","note","Ù…Ù„Ø§Ø­Ø¸Ø©","Ø§Ù„Ø§Ø³Ù…","Ø§Ù„Ø±Ù‚Ù…","Ø±Ù‚Ù…"]);for(const n of v){if(!n||!1===n.enabled)continue;const a=String(n.key||"").trim(),r=String(n.label||a).trim();if(!a||"name"===a||"phone"===a||"note"===a)continue;const i=(t.fields&&(t.fields[a]??t.fields[r]))??"",s=String(i||"").trim();s&&(e.add(a),e.add(r),m.push(`<div class="row"><div class="k">${C(r)}</div><div class="v rtl">${C(s)}</div></div>`))}Object.keys(t.fields||{}).forEach(n=>{if(!n||e.has(n)||"name"===n||"phone"===n||"note"===n)return;const a=String(t.fields[n]||"").trim();a&&m.push(`<div class="row"><div class="k">${C(n)}</div><div class="v rtl">${C(a)}</div></div>`)})}catch(t){}const g=t.fields&&(t.fields.name||t.fields["Ø§Ù„Ø§Ø³Ù…"])?t.fields.name||t.fields["Ø§Ù„Ø§Ø³Ù…"]:"",b=t.fields&&(t.fields.phone||t.fields["Ø§Ù„Ø±Ù‚Ù…"]||t.fields["Ø±Ù‚Ù…"])?t.fields.phone||t.fields["Ø§Ù„Ø±Ù‚Ù…"]||t.fields["Ø±Ù‚Ù…"]:"",f=t.fields&&(t.fields.note||t.fields["Ù…Ù„Ø§Ø­Ø¸Ø©"])?t.fields.note||t.fields["Ù…Ù„Ø§Ø­Ø¸Ø©"]:"",y={seq:t&&t.seq?t.seq:"",currency_code:t.get||"",pay_currency_code:t.pay||"",rate:t.rate,amount_get:t.amountGet,amount_pay:t.amountPay,note:f},h=t=>{try{if(null==t||""===t)return"";const e=Number(String(t).replace(/,/g,""));return isFinite(e)?e.toLocaleString("en-US"):String(t)}catch(e){return String(t||"")}};const __enClient=(function(){try{const s=u(l);const arr=Array.isArray(s.fields)?s.fields:(Array.isArray(p)?p:[]);return (arr||[]).filter(f=>f&&f.enabled!==false);}catch(_){return []}})();const __showClient=__enClient.some(f=>{const k=String(f.key||"").trim();return k&&k!=="note"});const __showName=__enClient.some(f=>String(f.key||"").trim()==="name");const __showPhone=__enClient.some(f=>String(f.key||"").trim()==="phone");const __clientSec=(__showClient&&(__showName||__showPhone||m.length))?("\n\n   <div class=\"hr\"></div>\n   <div class=\"sec\">\n    <div class=\"h\">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</div>\n    <div class=\"clientbox\">"+(__showName?("\n    <div class=\"row\"><div class=\"k\">Ø§Ù„Ø§Ø³Ù…</div><div class=\"v rtl\">"+C((g||"").trim()||"â€”")+"</div></div>"):"")+(__showPhone?("\n    <div class=\"row\"><div class=\"k\">Ø§Ù„Ø±Ù‚Ù…</div><div class=\"v rtl\">"+C((b||"").trim()||"â€”")+"</div></div>"):"")+(m.length?("\n    "+m.join("")):"")+"\n   </div>\n\n    </div>"):"";return`<!doctype html><html lang="ar" dir="rtl"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>${C(c)}</title>\n<style>\n:root{\n \n --paper:80mm;\n --w:72mm;\n --pad:2.2mm;\n\n --ink:#0b1220;\n --muted:#0f172a;\n --muted2:#475569;\n\n --g:rgba(34,197,94,.13);\n --r:rgba(239,68,68,.11);\n}\n*{box-sizing:border-box}\nhtml,body{\n margin:0;padding:0;background:#fff;color:var(--ink);\n font-family:Tahoma,system-ui,Segoe UI,Roboto,Arial;\n -webkit-print-color-adjust:exact;print-color-adjust:exact;\n}\n.paper{width:var(--w);margin:0 auto;padding:var(--pad)}\n.card{\n border:1px solid rgba(15,23,42,.14);\n border-radius:14px;\n padding:10px 10px;\n}\n.head{\n display:flex;\n align-items:center;\n justify-content:center;\n gap:8px;\n\n padding:8px 8px;\n border:1px solid rgba(15,23,42,.06);\n border-radius:12px;\n background:rgba(15,23,42,.02);\n}\n.brand{display:flex;align-items:center;justify-content:center;gap:8px;min-width:0;width:100%;flex-direction:column}\n\n.brand img{\n width:34px;height:34px;border-radius:10px;object-fit:contain;\n border:1px solid rgba(15,23,42,.10);background:#fff;\n}\n.brand .t{\n font-weight:1000;\n font-size:18px;\n line-height:1.15;\n white-space:normal;\n overflow:visible;\n text-overflow:clip;\n max-width:100%;\n text-align:center;\n direction:rtl;\n unicode-bidi:plaintext;\n}\n\n.sec{margin-top:8px}\n.h{\n font-weight:1000;\n font-size:11px;\n color:var(--muted2);\n margin:0 0 4px 0;\n display:flex;align-items:center;justify-content:space-between;\n}\n.hr{height:1px;background:rgba(15,23,42,.10);margin:7px 0}\n\n.row{\n display:grid;\n grid-template-columns:1fr 1.15fr;\n gap:8px;\n padding:4.5px 0;\n border-bottom:1px solid rgba(15,23,42,.07);\n align-items:start;\n}\n.row:last-child{border-bottom:0}\n\n.k{\n font-weight:1000;\n color:var(--muted);\n font-size:12px;\n line-height:1.2;\n text-align:right;\n direction:rtl;\n unicode-bidi:plaintext;\n overflow-wrap:anywhere;\n}\n.v{\n font-weight:1000;\n font-size:12.3px;\n line-height:1.2;\n text-align:left;\n direction:ltr;\n unicode-bidi:isolate;\n overflow-wrap:anywhere;\n}\n.v.rtl{direction:rtl;text-align:right;unicode-bidi:plaintext}\n.v.nowrap{white-space:nowrap !important}\n.big .v{font-size:13.2px}\n\n.totals{\n border:1px dashed rgba(15,23,42,.18);\n border-radius:12px;\n padding:7px 8px;\n background:rgba(15,23,42,.015);\n}\n.totals .row{border-bottom:1px dashed rgba(15,23,42,.12)}\n.totals .row:last-child{border-bottom:0}\n.totals .row.big{padding-top:5px;padding-bottom:5px}\n.totals .row.big .k{font-size:12.2px}\n.totals .row.big .v{font-size:13.6px}\n\n\n.clientbox{border:1px solid rgba(15,23,42,.28);border-radius:12px;overflow:hidden;background:#fff}\n.clientbox .row{border-bottom:1px solid rgba(15,23,42,.22);padding:0;margin:0;grid-template-columns:44% 56%}\n.clientbox .row:last-child{border-bottom:0}\n.clientbox .k{padding:7px 8px;border-left:1px solid rgba(15,23,42,.22);background:rgba(15,23,42,.03)}\n.clientbox .v{padding:7px 8px}\n\n\n.clientbox{border:1px solid rgba(15,23,42,.25);border-radius:12px;overflow:hidden}\n.clientbox .row{border-bottom:1px solid rgba(15,23,42,.20);padding:6px 8px;margin:0}\n.clientbox .row:last-child{border-bottom:0}\n.clientbox .k{border-left:1px solid rgba(15,23,42,.18);padding-left:8px}\n.clientbox .v{padding-right:8px}\n@media print{.clientbox{border-color:rgba(0,0,0,.45)}.clientbox .row{border-bottom-color:rgba(0,0,0,.35)}.clientbox .k{border-left-color:rgba(0,0,0,.35)}}\n\n.footnote{\n margin-top:7px;\n font-size:10.5px;\n color:#374151;\n text-align:center;\n}\n\n@page{size:80mm auto;margin:0mm}\n@media print{\n html,body{width:var(--paper);max-width:var(--paper)}\n .paper{width:var(--w);margin:0;padding:2mm}\n .card{border:0;border-radius:0;padding:0}\n .head{border:0;border-radius:0;padding:0 0 6px 0;background:transparent}\n .footnote{display:none}\n}\n</style>


<style id="rate-align-adjust">
.trade-rate-mini-input{
    text-align: center !important;
    padding-right: 18px !important; /* slight push to the right */
}
</style>

</head>\n<body>\n <div class="paper">\n  <div class="card">\n   <div class="head">\n    <div class="brand">\n     ${d?`<img src="${d}" alt="logo"/>`:""}\n     ${o?`<div class="t">${C(o)}</div>`:""}\n    </div>\n   </div>\n\n   <div class="sec">\n    <div class="h" style="justify-content:center;font-size:13px;color:#0f172a">${C(c)}</div>\n    <div class="row big"><div class="k">Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</div><div class="v">#${C(y.seq||"â€”")}</div></div>\n    <div class="row"><div class="k">Ø§Ù„ØªØ§Ø±ÙŠØ®</div><div class="v nowrap">${C(s)}</div></div>\n    <div class="row"><div class="k">Ø§Ù„Ù…Ù†ÙØ°</div><div class="v rtl">${C(n)}</div></div>\n   </div>${__clientSec}\n\n   <div class="hr"></div>\n   <div class="sec totals">\n    <div class="h">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</div>\n    <div class="row"><div class="k">Ø£Ø³Ø¹Ø§Ø± ØµØ±Ù Ø§Ù„Ø¹Ù…Ù„Ø§Øª</div><div class="v">${C(y.currency_code||"")}</div></div>\n    <div class="row"><div class="k">Ø¹Ù…Ù„Ø© Ø§Ù„Ø¯ÙØ¹</div><div class="v">${C(y.pay_currency_code||"")}</div></div>\n    <div class="row"><div class="k">Ø³Ø¹Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„</div><div class="v">${h(y.rate)}</div></div>\n    <div class="row"><div class="k">Ø§Ù„Ù…Ø¨Ù„Øº</div><div class="v">${h(y.amount_get)} ${C(y.currency_code||"")}</div></div>\n    <div class="row big"><div class="k">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div><div class="v">${h(y.amount_pay)} ${C(y.pay_currency_code||"")}</div></div>\n   </div>\n\n   ${y.note&&String(y.note).trim()?`<div class="hr"></div><div class="sec"><div class="h">Ù…Ù„Ø§Ø­Ø¸Ø©</div><div class="row"><div class="k">ğŸ“</div><div class="v rtl" style="max-width:70%">${C(y.note)}</div></div></div>`:""}\n\n   <div class="footnote">Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ¹Ø§Ù…Ù„ÙƒÙ… Ù…Ø¹Ù†Ø§</div>\n  </div>\n </div>\n
<style id="force-cancel-red-final">#inv-cancel,#trade-cancel{background:#dc2626 !important;color:#ffffff !important}</style>

<style id="removed-old-next-right-style">.trade-actions{display:flex !important;justify-content:flex-end !important;gap:14px !important}#trade-submit{order:2 !important}#trade-cancel{order:1 !important}</style>

<style id="trade-summary-rtl-fix">.trade-addbox,.trade-addbox .trade-muted,.trade-addbox div{text-align:right !important;direction:rtl !important}</style>


<style id="kpi-holdings-align-css">
/* Align currency/amount lines in KPI boxes 4/5/6 */
.kpi-holdings-line .table-numbers,
.kpi-holdings-lines .table-numbers{
  text-align:left !important;
  min-width:6ch;
}
</style>


<style id="unified-scroll-kpi-log-v1">
  /* Make KPI + log list scroll together inside the same modal */
  #trade-backdrop .tr-logwrap{max-height:none !important; overflow:visible !important;}
  #trade-backdrop .trade-modal{overflow:auto !important;}
</style>

</body></html>`}(e))),t("#inv-exec",modalEl).addEventListener("click",async()=>{if(!e||!e.seq)return void r("âš ï¸ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© ØºÙŠØ± Ù…ØªÙˆÙØ±");const t=await f(e.seq,"confirmed");t&&t.ok&&(e.extra=e.extra||{},e.extra.status="confirmed",r(`âœ… ØªÙ… ØªÙ†ÙÙŠØ° Ø§Ù„Ù‚ÙŠØ¯ â€” Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© #${e.seq}`),x(),setTimeout(()=>{try{L(s)}catch(t){}},60))}),t("#inv-cancel",modalEl).addEventListener("click",async()=>{if(!e||!e.seq)return void r("âš ï¸ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© ØºÙŠØ± Ù…ØªÙˆÙØ±");const t=await f(e.seq,"canceled");t&&t.ok&&(e.extra=e.extra||{},e.extra.status="canceled",r(`âŒ ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù‚ÙŠØ¯ â€” Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© #${e.seq}`),x())})}try{modal.classList.toggle("trade-mode-sell","sell"===s),modal.classList.toggle("trade-mode-buy","buy"===s),modal.classList.remove("trade-mode-exchange")}catch(t){}const P="buy"===s?"Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡":"Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹";
const topLabel = "buy"===s ? "Ø£Ø³Ø¹Ø§Ø± ØµØ±Ù Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø´ØªØ±Ø§Ø© Ù…Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„" : "Ø£Ø³Ø¹Ø§Ø± ØµØ±Ù Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø¹Ø© Ù„Ù„Ø¹Ù…ÙŠÙ„";
const bottomLabel = "buy"===s ? "Ø£Ø³Ø¹Ø§Ø± ØµØ±Ù Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø¹Ø© Ù„Ù„Ø¹Ù…ÙŠÙ„" : "Ø£Ø³Ø¹Ø§Ø± ØµØ±Ù Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø´ØªØ±Ø§Ø© Ù…Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„";
modal.innerHTML=`\n   <div class="trade-head"><button class="trade-backbtn" type="button"><span style="font-size:20px">â¬…</span><span>Ø±Ø¬ÙˆØ¹</span></button><div class="trade-headtitle"><span>Ø³Ù†Ø¯ ÙØ§ØªÙˆØ±Ø© ${P}</span></div></div>\n   <div class="trade-form">\n    <div class="trade-row2" id="trade-dyn-fields">${E(o,A.dyn)}</div>\n    <div class="trade-row3">\n     <div class="trade-field"><div class="trade-label">${topLabel}</div>\n      <div class="trade-selwrap"><select class="trade-sel" id="trade-get">${k(A.get)}</select><span class="trade-flag" id="trade-flag-get" aria-hidden="true"></span></div>\n     </div>\n\n     <div class="trade-field trade-rate-mini"><div class="trade-label">Ø³Ø¹Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„</div>\n      <div class="trade-rate-mini-wrap">\n       <input class="trade-rate-mini-input table-numbers" id="trade-rate" inputmode="decimal" />\n       <button class="trade-rate-mini-reset" type="button" id="trade-reset" title="Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ">âŸ³</button>\n      </div>\n     </div>\n     <div class="trade-field"><div class="trade-label">${bottomLabel}</div>\n<div class="trade-selwrap"><select class="trade-sel" id="trade-pay">${function(get,pay){get=String(get||"").toUpperCase();var opts=(get==="USD")?["SYP_BASE"]:["SYP_BASE","USD"];var sel=opts.indexOf(pay)>=0?pay:opts[0];return opts.map(v=>`<option value="${v}" ${v===sel?"selected":""}>${$(v)}</option>`).join("")}(A.get,A.pay)}</select><span class="trade-flag" id="trade-flag-pay" aria-hidden="true"></span></div>\n     </div>\n    </div>\n\n    <div class="trade-row2">\n     <div class="trade-field"><div class="trade-label">Ù…Ø¨Ù„Øº (${w(A.get)})</div><input class="trade-in table-numbers" id="trade-amount-get" inputmode="decimal" placeholder="0" /></div>\n     <div class="trade-field"><div class="trade-label">Ù…Ø¨Ù„Øº (${w(A.pay)})</div><input class="trade-in table-numbers" id="trade-amount-pay" inputmode="decimal" placeholder="0" /></div>\n    </div>\n\n    

<div class="trade-actions" style="display:flex;flex-direction:row-reverse;justify-content:flex-start;gap:14px;margin-top:20px">
  <button type="button" id="trade-submit"
    style="background:#16a34a;color:#fff;border:none;padding:14px 32px;
    border-radius:14px;font-weight:700;cursor:pointer">
    Ø§Ù„ØªØ§Ù„ÙŠ (ÙØ§ØªÙˆØ±Ø©)
  </button>

  <button type="button" id="trade-cancel"
    style="background:#dc2626;color:#fff;border:none;padding:14px 32px;
    border-radius:14px;font-weight:700;cursor:pointer">
    Ø¥Ù„ØºØ§Ø¡
  </button>
</div>

\n   </div>\n  `,setupTradeEnterNav(modal),q.classList.add("open"),t(".trade-backbtn",modal).addEventListener("click",x);const T=t("#trade-get",modal),I=t("#trade-pay",modal),U=t("#trade-rate",modal),Y=t("#trade-reset",modal),B=t("#trade-amount-get",modal),F=t("#trade-amount-pay",modal),O=t("#trade-submit",modal),cancelBtn=t("#trade-cancel",modal),N=t("#trade-flag-get",modal),W=t("#trade-flag-pay",modal);
 cancelBtn&&cancelBtn.addEventListener("click",x);function X(t,e){t&&(t.textContent=_(e)||"",function(t){try{window.twemoji&&t&&window.twemoji.parse(t,{folder:"svg",ext:".svg",base:"https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/",attributes:()=>({loading:"lazy",decoding:"async",referrerpolicy:"no-referrer"})})}catch(t){}}(t))}function H(){X(N,T.value),X(W,I.value)}H();const G=t=>null==t?"":String(t).replace(/[\u0660-\u0669]/g,t=>"0123456789"[t.charCodeAt(0)-1632]).replace(/[\u06F0-\u06F9]/g,t=>"0123456789"[t.charCodeAt(0)-1776]).replace(/\u066B/g,".").replace(/\u066C/g,"").replace(/,|\s/g,"").replace(/[^0-9.]/g,"").replace(/(\..*)\./g,"$1");function J(t){A.autoRate=!!t;try{modal.classList.toggle('rate-manual',!A.autoRate)}catch(_){}}function V(){
 try{
  function pretty(code){
   code = String(code||"").toUpperCase();
   var disp = w(code);
   var name = "";
   if(code==="SYP_BASE") name = "Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ø³ÙˆØ±ÙŠØ©";
   else if(code==="SYP_NEW") name = "Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ø³ÙˆØ±ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯";
   else if(c && c[code] && c[code].name) name = String(c[code].name);
   else name = code;

   // fallbacks for common ones if name missing
   if(code==="USD" && (!name || name==="USD")) name = "Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠ";
   return { name:name, code:disp };
  }
  var top = pretty(A.get);
  var bot = pretty(A.pay);
  t(".trade-label", B.parentElement).textContent = `Ù…Ø¨Ù„Øº ${top.name} (${top.code})`;
  t(".trade-label", F.parentElement).textContent = `Ù…Ø¨Ù„Øº ${bot.name} (${bot.code})`;
 }catch(_){
  t(".trade-label", B.parentElement).textContent = `Ù…Ø¨Ù„Øº (${w(A.get)})`;
  t(".trade-label", F.parentElement).textContent = `Ù…Ø¨Ù„Øº (${w(A.pay)})`;
 }
}function Z(t,e){A.rate=n(t),A.rate<=0&&(A.rate=0);let a="";if(A.rate){const t="SYP_BASE"===A.pay?0:6;a=String(+A.rate.toFixed(t)).replace(/\.0+$/,"").replace(/(\.\d+?)0+$/,"$1")}U.value=a,J(e)}function Q(){const t=function(t,e,a){const r=S(e),i=S(a);if(!r||!i)return 0;if("USD"===String(a).toUpperCase()){if("USD"===String(e).toUpperCase())return 1;const a="divide"===r._m||"multiply"===r._m?r._m:"multiply",i=n(r._rb)>0?n(r._rb):1,s=n(r._rs)>0?n(r._rs):1,d="buy"===t?i:s;return"divide"===a?+d:1/d}const s=n(r.buy),d=n(r.sell),o=n(i.buy),l=n(i.sell);return s>0&&d>0&&o>0&&l>0?"buy"===t?+s/l:+d/o:0}(A.mode,A.get,A.pay);Z(t,!0)}var __lastAmtSide="get";function K(){
 const t=n(A.amountGet);
 if(!(t>0&&A.rate>0)) { A.amountPay=""; F.value=""; return; }
 const dec=__decForCurrency(A.pay);
 const raw = ("USD"===String(A.pay).toUpperCase()) ? (t/A.rate) : (t*A.rate);
 const val = dec>0 ? +raw.toFixed(dec) : Math.round(raw);
 A.amountPay=val;
 F.value=af(A.pay,val);
}
function K2(){
 const t=n(A.amountPay);
 if(!(t>0&&A.rate>0)) { A.amountGet=""; B.value=""; return; }
 const decGet=__decForCurrency(A.get);
 // reverse using raw then clamp to decimals of GET currency (usually 0 for SYP)
 const raw = ("USD"===String(A.pay).toUpperCase()) ? (t*A.rate) : (t/A.rate);
 const val = decGet>0 ? +raw.toFixed(decGet) : Math.round(raw);
 A.amountGet=val;
 B.value = (decGet>0 ? af(A.get,val) : a(val));
}window.__trade_refreshOpenRate=function(){try{if(!q||!q.classList||!q.classList.contains("open"))return; if(A&&A.autoRate){Q();(__lastAmtSide==="pay"?K2():K());}}catch(e){}};function tt(){
 // Lock bottom currency when top is USD (prevent USDâ†”USD)
 try{
  var top=String(A.get||"").toUpperCase();
  var opts=(top==="USD")?["SYP_BASE"]:["SYP_BASE","USD"];
  if(I && I.__lastTop!==top){
   I.innerHTML=opts.map(function(v){return `<option value="${v}" ${v===A.pay?"selected":""}>${$(v)}</option>`}).join("");
   I.__lastTop=top;
  }
  if(top==="USD"){
   A.pay="SYP_BASE";
   if(I){ I.value="SYP_BASE"; I.disabled=true; I.style.opacity="0.85"; }
  } else {
   if(I){ I.disabled=false; I.style.opacity=""; }
   if(!opts.includes(A.pay)) A.pay=opts[0];
   if(String(A.pay).toUpperCase()===top) A.pay="SYP_BASE";
   if(I) I.value=A.pay;
  }
 }catch(_){ }
 V();
 A.autoRate&&Q();
 (__lastAmtSide==="pay"?K2():K());
}if((g&&g.__freeze)?(Z(A.rate,!1),V(),J(!1),A.amountGet):(A.rate>0?Z(A.rate,A.autoRate):Q(),V(),J(A.autoRate),A.amountGet)){const t=n(A.amountGet);B.value=t>0?a(t):"",A.amountGet=B.value?String(t):""}if(A.amountPay){__lastAmtSide="pay";const t=n(A.amountPay);F.value=t>0?af(A.pay,t):"",A.amountPay=F.value?String(t):""}else A.amountGet&&(__lastAmtSide="get",K());try{window.__trade_refreshOpenRate=function(){try{const t=document.getElementById("trade-backdrop");if(!t||!t.classList.contains("open"))return;if(!A.autoRate)return;Q(),(__lastAmtSide==="pay"?K2():K())}catch(t){}}}catch(t){}try{if(!(g&&g.__freeze))if(!window.__trade_rate_watch){window.__trade_rate_watch=setInterval(function(){try{const b=document.getElementById('trade-backdrop');if(!b||!b.classList.contains('open')){clearInterval(window.__trade_rate_watch);window.__trade_rate_watch=null;return;}if(window.__trade_refreshOpenRate)window.__trade_refreshOpenRate();}catch(_e){}},350);}}catch(_e){}T.addEventListener("change",()=>{H(),A.get=T.value,tt()}),I.addEventListener("change",()=>{H(),A.pay=I.value,tt()}),Y.addEventListener("click",()=>{Q(),(__lastAmtSide==="pay"?K2():K()),r("âœ… ØªÙ… Ø¶Ø¨Ø· Ø§Ù„Ø³Ø¹Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„ÙŠ")}),U.addEventListener("input",()=>{const t=G(U.value);t!==U.value&&(U.value=t),Z(n(t),!1),(__lastAmtSide==="pay"?K2():K())}),__attachLiveGrouping(B, ()=>A.get, (clean)=>{__lastAmtSide="get";A.amountGet=clean;});
 __attachLiveGrouping(F, ()=>A.pay, (clean)=>{__lastAmtSide="pay";A.amountPay=clean;});
 // recompute after typing
 B.addEventListener("input",()=>{K();});
 F.addEventListener("input",()=>{K2();});
O.addEventListener("click",async()=>{const a=function(t){const n={};return e("[data-dyn]",t).forEach(t=>{n[t.getAttribute("data-dyn")]=(t.value||"").trim()}),n}(t("#trade-dyn-fields",modal)),i=n(A.amountGet),s=n(A.amountPay),d=n(A.rate),l=o.filter(t=>t.enabled);for(const e of l){if(!(a[e.key]||"").trim()){r(`âš ï¸ Ø£Ø¯Ø®Ù„ ${e.label}`);const n=t(`[data-dyn="${e.key}"]`,modal);try{n&&n.focus()}catch(t){}return}}if(!A.get||!A.pay||A.get===A.pay)return void r("âš ï¸ Ø§Ø®ØªØ± Ø¹Ù…Ù„ØªÙŠÙ† Ù…Ø®ØªÙ„ÙØªÙŠÙ†");if(!(d>0))return void r("âš ï¸ Ø³Ø¹Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„ ØºÙŠØ± ØµØ­ÙŠØ­");if(!(i>0&&s>0))return void r("âš ï¸ Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­");try{O.disabled=!0,O.style.opacity="0.75"}catch(t){}r("â³ Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙØ§ØªÙˆØ±Ø©...");const c={mode:A.mode,at:Date.now(),iso:(new Date).toISOString(),get:w(A.get),pay:w(A.pay),rate:d,amountGet:i,amountPay:s,autoRate:A.autoRate,fields:a};A.seq&&(c.seq=A.seq);const p=await b(c);try{O.disabled=!1,O.style.opacity=""}catch(t){}p&&p.ok?(c.seq=p.seq,A.seq=p.seq,c.extra=c.extra||{},c.extra.status="draft",renderInvoice(modal,c)):r("âš ï¸ ØªØ¹Ø°Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙØ§ØªÙˆØ±Ø©")})}function A(){const e=h(),n=t(".trade-modal",e),a=m();if(!a)return void r("âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");const s=g();let d={from:s,to:s,type:"all",currency:"all",users:[],q:"",advOpen:!1};function o(t){return String(t||"").replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[t]))}function c(t){if(d.advOpen){d.advOpen=!1;$(d.__itemsCache&&Array.isArray(d.__itemsCache)?d.__itemsCache:t&&Array.isArray(t)?t:[])}else x()}function v(t){try{return new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(Math.round(Number(t||0)))}catch(e){return String(t||0)}}function b(t){try{// mobile-safe print (no new tab)
// use hidden iframe so the browser opens the print dialog without navigating
let e=document.getElementById("tr-print-frame");e||(e=document.createElement("iframe"),e.id="tr-print-frame",e.style.position="fixed",e.style.right="0",e.style.bottom="0",e.style.width="0",e.style.height="0",e.style.border="0",e.style.opacity="0",e.style.pointerEvents="none",e.style.visibility="hidden",document.body.appendChild(e));const n=String(Date.now())+Math.random().toString(16).slice(2);e.dataset.printToken=n;const a=e.contentWindow.document;a.open(),a.write(t),a.close();let r=!1;const i=()=>{try{if(r)return;if(e.dataset.printToken!==n)return;r=!0,e.contentWindow.focus(),e.contentWindow.print()}catch(t){}};e.onload=i,setTimeout(i,550)}catch(t){r("âš ï¸ ØªØ¹Ø°Ø± ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©/PDF")}}function f(t,e,n){try{const a=t=>String(null==t?"":t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"),r=`<Row>${(e||[]).map(t=>`<Cell ss:StyleID="hdr"><Data ss:Type="String">${a(t)}</Data></Cell>`).join("")}</Row>`,i=`<?xml version="1.0" encoding="UTF-8"?><?mso-application progid="Excel.Sheet"?><Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet"\n xmlns:o="urn:schemas-microsoft-com:office:office"\n xmlns:x="urn:schemas-microsoft-com:office:excel"\n xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet"\n xmlns:html="http://www.w3.org/TR/REC-html40"><Styles><Style ss:ID="hdr"><Font ss:Bold="1"/><Interior ss:Color="#F3F4F6" ss:Pattern="Solid"/><Alignment ss:Horizontal="Center" ss:Vertical="Center"/><Borders><Border ss:Position="Bottom" ss:LineStyle="Continuous" ss:Weight="1"/><Border ss:Position="Left" ss:LineStyle="Continuous" ss:Weight="1"/><Border ss:Position="Right" ss:LineStyle="Continuous" ss:Weight="1"/><Border ss:Position="Top" ss:LineStyle="Continuous" ss:Weight="1"/></Borders></Style><Style ss:ID="cell"><Alignment ss:Horizontal="Right" ss:Vertical="Center"/><Borders><Border ss:Position="Bottom" ss:LineStyle="Continuous" ss:Weight="1"/><Border ss:Position="Left" ss:LineStyle="Continuous" ss:Weight="1"/><Border ss:Position="Right" ss:LineStyle="Continuous" ss:Weight="1"/><Border ss:Position="Top" ss:LineStyle="Continuous" ss:Weight="1"/></Borders></Style></Styles><Worksheet ss:Name="Ø§Ù„Ø³Ø¬Ù„Ø§Øª"><Table>${r}${(n||[]).map(t=>`<Row>${(t||[]).map(t=>`<Cell ss:StyleID="cell"><Data ss:Type="String">${a(t)}</Data></Cell>`).join("")}</Row>`).join("")}</Table><WorksheetOptions xmlns="urn:schemas-microsoft-com:office:excel"><DisplayRightToLeft/></WorksheetOptions></Worksheet></Workbook>`,s=new Blob(["\ufeff",i],{type:"application/vnd.ms-excel;charset=utf-8;"}),d=document.createElement("a");d.href=URL.createObjectURL(s),d.download=t||"export.xml",document.body.appendChild(d),d.click(),setTimeout(()=>{try{URL.revokeObjectURL(d.href)}catch(t){}try{d.remove()}catch(t){}},0)}catch(t){r("âš ï¸ ØªØ¹Ø°Ø± ØªØµØ¯ÙŠØ± Ù…Ù„Ù Excel")}}function y(t){const e=function(){try{const t=u(l);return(Array.isArray(t.fields)?t.fields:Array.isArray(p)?p:[]).filter(t=>t&&!1!==t.enabled)}catch(t){return(Array.isArray(p)?p:[]).filter(t=>t&&!1!==t.enabled)}}(),n=[];for(const t of e){const e=String(t.key||"").trim();if(!e||"name"===e||"phone"===e||"note"===e)continue;const a=String(t.label||e).trim();a&&!n.includes(a)&&n.push(a)}const a=(t||[]).map(t=>{const K=(t&&t.extra&&(t.extra.kind||t.extra.mode||t.extra.__kind))||t.trade_type,n="sell"===K?"Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹":"buy"===K?"Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡":"exchange"===K?"Ø§Ø³ØªØ¨Ø¯Ø§Ù„":K,a=t.extra&&t.extra.fields?t.extra.fields:{},r=[t.seq??"",t.trade_day||"",n||"",t.currency_code||"",t.amount_get??"",t.rate??"",t.amount_pay??"",t.pay_currency_code||"",t.actor_username||"",t.note||"",a.name||"",a.phone||""];for(const t of e){const e=String(t.key||"").trim();if(!e||"name"===e||"phone"===e||"note"===e)continue;const n=String(t.label||e).trim();r.push(a[e]??a[n]??"")}return r});return{headers:["Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ©","Ø§Ù„ØªØ§Ø±ÙŠØ®","Ø§Ù„Ù†ÙˆØ¹","Ø£Ø³Ø¹Ø§Ø± ØµØ±Ù Ø§Ù„Ø¹Ù…Ù„Ø§Øª","Ø§Ù„Ù…Ø¨Ù„Øº","Ø³Ø¹Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ","Ø¹Ù…Ù„Ø© Ø§Ù„Ø¯ÙØ¹","Ø§Ù„Ù…Ù†ÙØ°","Ù…Ù„Ø§Ø­Ø¸Ø©","Ø§Ù„Ø§Ø³Ù…","Ø§Ù„Ø±Ù‚Ù…"].concat(n),rows:a}}function w(t){const e=y(t);!function(t,e,n){try{if(!window.XLSX)return f(String(t||"export.xlsx").replace(/\.xlsx$/i,".xml"),e,n);const a=[e].concat(n||[]),r=XLSX.utils.aoa_to_sheet(a),i=(e||[]).length,s=[];for(let t=0;t<i;t++){let a=String(e[t]??"").length;for(let e=0;e<Math.min((n||[]).length,80);e++){const r=n[e]&&null!=n[e][t]?String(n[e][t]):"";r.length>a&&(a=r.length)}s.push({wch:Math.min(Math.max(a+2,10),42)})}r["!cols"]=s;const d=XLSX.utils.book_new();d.Workbook={Views:[{RTL:!0}]},XLSX.utils.book_append_sheet(d,r,"Ø§Ù„Ø³Ø¬Ù„");const o=String(t||"Ø³Ø¬Ù„_Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹_ÙˆØ§Ù„Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡.xlsx").replace(/\.(xls|xml)$/i,"").replace(/\s+/g,"_")+".xlsx";XLSX.writeFile(d,o,{compression:!0})}catch(t){r("âš ï¸ ØªØ¹Ø°Ø± ØªØµØ¯ÙŠØ± Ù…Ù„Ù Excel")}}(`Ø³Ø¬Ù„_Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹_ÙˆØ§Ù„Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡_${d.from||s}_Ø§Ù„Ù‰_${d.to||s}.xlsx`,e.headers,e.rows),r("âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ù…Ù„Ù Excel")}function _(t){const e=t=>String(null==t?"":t).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[t])),n=t=>{try{if(null==t||""===t)return"";const e=Number(String(t).replace(/,/g,""));return isFinite(e)?e.toLocaleString("en-US"):String(t)}catch(e){return String(t||"")}};let a="",r="";try{a=localStorage.getItem("taif:logo")||""}catch(t){}try{r="Ø´Ø±ÙƒØ© Ø·ÙŠÙ Ù„Ù„ØµØ±Ø§ÙØ© ÙˆØ§Ù„Ø­ÙˆØ§Ù„Ø§Øª"}catch(t){}const i=function(){try{const t=u(l);return(Array.isArray(t.fields)?t.fields:Array.isArray(p)?p:[]).filter(t=>t&&!1!==t.enabled)}catch(t){return(Array.isArray(p)?p:[]).filter(t=>t&&!1!==t.enabled)}}();return`<!doctype html><html lang="ar" dir="rtl"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>\n<title>PDF</title>\n<style>\n:root{\n --paper:80mm;\n --w:72mm;\n --pad:2.2mm;\n --ink:#0b1220;\n --muted:#0f172a;\n --muted2:#475569;\n}\n*{box-sizing:border-box}\nhtml,body{margin:0;padding:0;background:#fff;color:var(--ink);font-family:Tahoma,system-ui,Segoe UI,Roboto,Arial;-webkit-print-color-adjust:exact;print-color-adjust:exact}\n.paper{width:var(--w);margin:0 auto;padding:var(--pad);page-break-after:always}\n.paper:last-child{page-break-after:auto}\n.card{border:1px solid rgba(15,23,42,.14);border-radius:14px;padding:10px 10px}\n.head{\n display:flex;\n align-items:center;\n justify-content:center;\n gap:8px;\npadding:8px 8px;border:1px solid rgba(15,23,42,.06);border-radius:12px;background:rgba(15,23,42,.02)}\n.brand{display:flex;align-items:center;justify-content:center;gap:8px;min-width:0;width:100%;flex-direction:column}\n\n.brand img{width:34px;height:34px;border-radius:10px;object-fit:contain;border:1px solid rgba(15,23,42,.10);background:#fff}\n.brand .t{\n font-weight:1000;\n font-size:18px;\n line-height:1.15;\n white-space:normal;\n overflow:visible;\n text-overflow:clip;\n max-width:100%;\n text-align:center;\n direction:rtl;\n unicode-bidi:plaintext;\n}\n\n.sec{margin-top:8px}\n.h{font-weight:1000;font-size:11px;color:var(--muted2);margin:0 0 4px 0;display:flex;align-items:center;justify-content:space-between}\n.hr{height:1px;background:rgba(15,23,42,.10);margin:7px 0}\n.row{display:grid;grid-template-columns:1fr 1.15fr;gap:8px;padding:4.5px 0;border-bottom:1px solid rgba(15,23,42,.07);align-items:start}\n.row:last-child{border-bottom:0}\n.k{font-weight:1000;color:var(--muted);font-size:12px;line-height:1.2;text-align:right;direction:rtl;unicode-bidi:plaintext;overflow-wrap:anywhere}\n.v{font-weight:1000;font-size:12.3px;line-height:1.2;text-align:left;direction:ltr;unicode-bidi:isolate;overflow-wrap:anywhere}\n.v.rtl{direction:rtl;text-align:right;unicode-bidi:plaintext}\n.v.nowrap{white-space:nowrap !important}\n.big .v{font-size:13.2px}\n.totals{border:1px dashed rgba(15,23,42,.18);border-radius:12px;padding:7px 8px;background:rgba(15,23,42,.015)}\n.totals .row{border-bottom:1px dashed rgba(15,23,42,.12)}\n.totals .row:last-child{border-bottom:0}\n.totals .row.big{padding-top:5px;padding-bottom:5px}\n.totals .row.big .k{font-size:12.2px}\n.totals .row.big .v{font-size:13.6px}\n\n\n.clientbox{border:1px solid rgba(15,23,42,.28);border-radius:12px;overflow:hidden;background:#fff}\n.clientbox .row{border-bottom:1px solid rgba(15,23,42,.22);padding:0;margin:0;grid-template-columns:44% 56%}\n.clientbox .row:last-child{border-bottom:0}\n.clientbox .k{padding:7px 8px;border-left:1px solid rgba(15,23,42,.22);background:rgba(15,23,42,.03)}\n.clientbox .v{padding:7px 8px}\n\n@page{size:A5;margin:10mm}@media print{html,body{margin:0;padding:0;width:auto;max-width:none}.paper{width:100%;max-width:none;margin:0;padding:0;page-break-after:always}.paper:last-child{page-break-after:auto}.card{border:0;border-radius:0;padding:0}.head{border:0;border-radius:0;padding:0 0 6px 0;background:transparent}}\n</style>


<style id="rate-align-adjust">
.trade-rate-mini-input{
    text-align: center !important;
    padding-right: 18px !important; /* slight push to the right */
}
</style>

</head><body>\n${(t||[]).map(function(t){const s=t&&t.extra?t.extra:{},d=s&&s.fields?s.fields:{},K=(t&&t.extra&&(t.extra.kind||t.extra.mode||t.extra.__kind))||t.trade_type,o="ÙØ§ØªÙˆØ±Ø© "+("exchange"===K?"Ø§Ø³ØªØ¨Ø¯Ø§Ù„":("sell"===K?"Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹":"Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡")),l=t.created_at?new Date(t.created_at):null,c=l?`${l.getFullYear()}/${String(l.getMonth()+1).padStart(2,"0")}/${String(l.getDate()).padStart(2,"0")} ${String(l.getHours()).padStart(2,"0")}:${String(l.getMinutes()).padStart(2,"0")}:${String(l.getSeconds()).padStart(2,"0")}`:t.trade_day||"",p=t.actor_name||t.actor_username||"â€”",u=(d.name||d["Ø§Ù„Ø§Ø³Ù…"]||"").trim()||"â€”",v=(d.phone||d["Ø§Ù„Ø±Ù‚Ù…"]||d["Ø±Ù‚Ù…"]||"").trim()||"â€”",m=(t.note||"").trim();return`\n <div class="paper">\n  <div class="card">\n   <div class="head">\n    <div class="brand">\n     ${a?`<img src="${e(a)}" alt="logo"/>`:""}\n     ${r?`<div class="t">${e(r)}</div>`:""}\n    </div>\n   </div>\n\n   <div class="sec">\n    <div class="h" style="justify-content:center;font-size:13px;color:#0f172a">${e(o)}</div>\n    <div class="row big"><div class="k">Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</div><div class="v">#${e(t.seq||"â€”")}</div></div>\n    <div class="row"><div class="k">Ø§Ù„ØªØ§Ø±ÙŠØ®</div><div class="v nowrap">${e(c)}</div></div>\n    <div class="row"><div class="k">Ø§Ù„Ù…Ù†ÙØ°</div><div class="v rtl">${e(p)}</div></div>\n   </div>\n\n   <div class="hr"></div>\n   <div class="sec">\n    <div class="h">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</div>\n    <div class="clientbox">\n    <div class="row"><div class="k">Ø§Ù„Ø§Ø³Ù…</div><div class="v rtl">${e(u)}</div></div>\n    <div class="row"><div class="k">Ø§Ù„Ø±Ù‚Ù…</div><div class="v rtl">${e(v)}</div></div>\n    ${function(t){const n=[];try{const a=new Set(["name","phone","note","Ù…Ù„Ø§Ø­Ø¸Ø©","Ø§Ù„Ø§Ø³Ù…","Ø§Ù„Ø±Ù‚Ù…","Ø±Ù‚Ù…"]);for(const r of i){if(!r||!1===r.enabled)continue;const i=String(r.key||"").trim();if(!i||"name"===i||"phone"===i||"note"===i)continue;const s=String(r.label||i).trim(),d=(t&&(t[i]??t[s]))??"",o=String(d||"").trim();o&&(a.add(i),a.add(s),n.push(`<div class="row"><div class="k">${e(s)}</div><div class="v rtl">${e(o)}</div></div>`))}Object.keys(t||{}).forEach(r=>{if(!r||a.has(r)||"name"===r||"phone"===r||"note"===r)return;const i=String(t[r]||"").trim();i&&n.push(`<div class="row"><div class="k">${e(r)}</div><div class="v rtl">${e(i)}</div></div>`)})}catch(t){}return n.join("")}(d)}\n   </div>\n\n    </div>\n\n   <div class="hr"></div>\n   <div class="sec totals">\n    <div class="h">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</div>\n    <div class="row"><div class="k">Ø£Ø³Ø¹Ø§Ø± ØµØ±Ù Ø§Ù„Ø¹Ù…Ù„Ø§Øª</div><div class="v">${e(t.currency_code||"")}</div></div>\n    <div class="row"><div class="k">Ø¹Ù…Ù„Ø© Ø§Ù„Ø¯ÙØ¹</div><div class="v">${e(t.pay_currency_code||"")}</div></div>\n    <div class="row"><div class="k">Ø³Ø¹Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„</div><div class="v">${n(t.rate)}</div></div>\n    <div class="row"><div class="k">Ø§Ù„Ù…Ø¨Ù„Øº</div><div class="v">${n(t.amount_get)} ${e(t.currency_code||"")}</div></div>\n    <div class="row big"><div class="k">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div><div class="v">${n(t.amount_pay)} ${e(t.pay_currency_code||"")}</div></div>\n   </div>\n\n   ${m?`<div class="hr"></div><div class="sec"><div class="h">Ù…Ù„Ø§Ø­Ø¸Ø©</div><div class="row"><div class="k">ğŸ“</div><div class="v rtl" style="max-width:70%">${e(m)}</div></div></div>`:""}\n  </div>\n </div>`}).join("")}\n
<style id="force-cancel-red-final">#inv-cancel,#trade-cancel{background:#dc2626 !important;color:#ffffff !important}</style>

<style id="removed-old-next-right-style">.trade-actions{display:flex !important;justify-content:flex-end !important;gap:14px !important}#trade-submit{order:2 !important}#trade-cancel{order:1 !important}</style>

<style id="trade-summary-rtl-fix">.trade-addbox,.trade-addbox .trade-muted,.trade-addbox div{text-align:right !important;direction:rtl !important}</style>


<style id="kpi-holdings-align-css">
/* Align currency/amount lines in KPI boxes 4/5/6 */
.kpi-holdings-line .table-numbers,
.kpi-holdings-lines .table-numbers{
  text-align:left !important;
  min-width:6ch;
}
</style>


<style id="unified-scroll-kpi-log-v1">
  /* Make KPI + log list scroll together inside the same modal */
  #trade-backdrop .tr-logwrap{max-height:none !important; overflow:visible !important;}
  #trade-backdrop .trade-modal{overflow:auto !important;}
</style>

</body></html>`}function S(t){b(_(t)),r("â„¹ï¸ Ø§Ø®ØªØ± â€œSave as PDFâ€ Ù…Ù† Ù†Ø§ÙØ°Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©")}function $(m){try{d.__itemsCache=Array.isArray(m)?m:d.__itemsCache||[]}catch(q){}const g=function(t){
 const conf=(t||[]).filter(t=>{try{return"confirmed"===(t&&t.extra&&t.extra.status?t.extra.status:"confirmed")}catch(t){return!0}});
 const kindOf=t=>((t&&t.extra&&(t.extra.kind||t.extra.mode||t.extra.__kind))||t.trade_type);
 const norm=t=>String(t||"").toUpperCase();
 const isUsdSyp=t=>("USD"===norm(t.currency_code))&&("SYP"===norm(t.pay_currency_code)||"SYP_BASE"===norm(t.pay_currency_code));
 const sumPay=t=>t.reduce((t,e)=>t+Number(e.amount_pay||0),0);
 const sumGet=t=>t.reduce((t,e)=>t+Number(e.amount_get||0),0);

 const sellAll=conf.filter(t=>"sell"===kindOf(t));
 const buyAll=conf.filter(t=>"buy"===kindOf(t));
 const exch=conf.filter(t=>"exchange"===kindOf(t));

 const sellUsd=sellAll.filter(isUsdSyp);
 const buyUsd=buyAll.filter(isUsdSyp);

 const sellTotal=sumPay(sellUsd);
 const buyTotal=sumPay(buyUsd);


 const sellUsdGet=sumGet(sellUsd);
 const buyUsdGet=sumGet(buyUsd);
 const sellAvgRate=sellUsdGet>0?(sellTotal/sellUsdGet):0;
 const buyAvgRate=buyUsdGet>0?(buyTotal/buyUsdGet):0;

 const exchangeOldTotal=sumGet(exch);
 const exchangeNewTotal=sumPay(exch);

 const sellAllTotal=sumPay(sellAll);
 const buyAllTotal=sumPay(buyAll);
 const exchangeTotal=exchangeOldTotal;
 const net=sellAllTotal+exchangeOldTotal-buyAllTotal;

 // === KPI v3: Holdings summary (foreign currencies) ===
 const isForeignCode=(code)=>{
  code=norm(code);
  return !!code && !["USD","SYP","SYP_BASE","SYP_NEW"].includes(code);
 };
 const isLocalOrUsdPay=(row)=>{
  const p=norm(row && row.pay_currency_code);
  return (p==="SYP"||p==="SYP_BASE"||p==="USD");
 };
 const nameByCode=Object.create(null);
 for(const row of conf){
  const c=norm(row && row.currency_code);
  if(!c) continue;
  nameByCode[c]=row.currency_name||nameByCode[c]||c;
 }

 const buyHold=Object.create(null);
 for(const row of buyAll){
  if(!isLocalOrUsdPay(row)) continue;
  const c=norm(row.currency_code);
  if(!isForeignCode(c)) continue;
  buyHold[c]=(buyHold[c]||0)+Number(row.amount_get||0);
 }

 const sellHold=Object.create(null);
 for(const row of sellAll){
  const p=norm(row && row.pay_currency_code);
  if(!(p==="SYP"||p==="SYP_BASE"||p==="USD")) continue;
  const c=norm(row.currency_code);
  if(!isForeignCode(c)) continue;
  sellHold[c]=(sellHold[c]||0)+Number(row.amount_get||0);
 }

 const buyHoldList=Object.entries(buyHold).map(([code,amt])=>({code,amt})).sort((a,b)=>b.amt-a.amt);
 const sellHoldList=Object.entries(sellHold).map(([code,amt])=>({code,amt})).sort((a,b)=>b.amt-a.amt);

 const netHold=Object.create(null);
 for(const it of buyHoldList) netHold[it.code]=(netHold[it.code]||0)+it.amt;
 for(const it of sellHoldList) netHold[it.code]=(netHold[it.code]||0)-it.amt;
 const netHoldList=Object.entries(netHold).map(([code,amt])=>({code,amt})).filter(it=>Math.abs(it.amt)>0).sort((a,b)=>Math.abs(b.amt)-Math.abs(a.amt));
 // === end KPI v3 ===


 const o={};
 for(const e of conf){
  const t=e.currency_code||"â€”";
  o[t]||(o[t]={code:t,name:e.currency_name||t,sell:0,buy:0,count:0});
  o[t].count+=1;
  "sell"===e.trade_type?o[t].sell+=Number(e.amount_pay||0):o[t].buy+=Number(e.amount_pay||0)
 }
 const l=Object.values(o).sort((t,e)=>e.sell+e.buy-(t.sell+t.buy));
 return{sellTotal:sellTotal,buyTotal:buyTotal,exchangeTotal:exchangeTotal,exchangeNewTotal:exchangeNewTotal,net:net,count:conf.length,totalCount:(t||[]).length,byCurrency:l,sellAllTotal:sellAllTotal,buyAllTotal:buyAllTotal,exchangeOldTotal:exchangeOldTotal,sellAvgRate:sellAvgRate,buyAvgRate:buyAvgRate,buyHoldList:buyHoldList,sellHoldList:sellHoldList,netHoldList:netHoldList,nameByCode:nameByCode}
}(m),y=(Math.max(1,...g.byCurrency.map(t=>t.sell+t.buy)),Array.from(new Set(m.map(t=>t.actor_username).filter(Boolean))).sort()),x=Array.from(new Set(m.map(t=>t.currency_code).filter(Boolean))).sort(),q=(d.logQuery||"").trim().toLowerCase(),mf=q?m.filter(t=>{try{const a=t&&t.extra&&t.extra.fields?t.extra.fields:{};const base=JSON.stringify(t);const f=(a.name||a["Ø§Ù„Ø§Ø³Ù…"]||"")+" "+(a.phone||a["Ø§Ù„Ø±Ù‚Ù…"]||a["Ø±Ù‚Ù…"]||"");const ex=(t.extra?JSON.stringify(t.extra):"");return (base+" "+f+" "+ex).toLowerCase().includes(q)}catch(e){return false}}):m,_=d.advOpen?"":"display:none";n.innerHTML=`\n    <div class="trade-head"><div style="display:flex;gap:10px;align-items:center"><button class="trade-backbtn" type="button"><span style="font-size:20px">â¬…</span><span>Ø±Ø¬ÙˆØ¹</span></button></div><div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center"><div class="tr-logsearch"><button class="tr-searchbtn" type="button" id="tr-log-go" title="Ø¨Ø­Ø«">ğŸ”</button><input class="tr-searchinp" id="tr-log-search" type="text" inputmode="search" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø³Ø¬Ù„..." value="${d.logQuery||""}"><button class="tr-clearbtn" type="button" id="tr-log-clear" title="Ù…Ø³Ø­" style="${(d.logQuery&&String(d.logQuery).trim())?"" :"visibility:hidden"}">âœ•</button></div><button class="trade-advbtn trade-btn-settings" type="button" id="tr-adv-top">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©</button><button class="trade-advbtn trade-btn-box" type="button" id="tr-kpi-toggle">Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚</button></div></div><div class="trade-form" style="gap:12px"><div class="trade-advbox" id="tr-adv-box" style="${_}"><div class="trade-adv-grid"><div class="trade-row2"><div class="trade-field"><div class="trade-label">Ù…Ù†</div><div style="position:relative"><input class="trade-in trade-date" id="tr-from" type="date" lang="en" dir="ltr" value="${o(d.from)}" /><span id="tr-from-show"></span></div></div><div class="trade-field"><div class="trade-label">Ø¥Ù„Ù‰</div><div style="position:relative"><input class="trade-in trade-date" id="tr-to" type="date" lang="en" dir="ltr" value="${o(d.to)}" /><span id="tr-to-show"></span></div></div></div><div class="trade-row2"><div class="trade-field"><div class="trade-label">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</div><div class="msel" id="tr-users-m"><button class="msel-btn" type="button"><span class="v" id="tr-users-v">${(d.users||[]).length?`${(d.users||[]).length} Ù…Ø­Ø¯Ø¯`:"ÙƒÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†"}</span><span class="chev">â–¾</span></button><div class="msel-menu">${[`<label class="msel-item"><input type="checkbox" data-all="1" ${!(d.users||[]).length?"checked":""}><span class="t">ÙƒÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</span></label>`,...y.map(u=>`<label class="msel-item"><input type="checkbox" data-u="${o(u)}" ${(d.users||[]).includes(u)?"checked":""}><span class="t">${o(u)}</span></label>`)].join("")}</div></div></div><div class="trade-field"><div class="trade-label">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</div><div class="msel" id="tr-type-m"><button class="msel-btn" type="button"><span class="v" id="tr-type-v">${(d.types||[]).length?`${(d.types||[]).length} Ù…Ø­Ø¯Ø¯`:"Ø§Ù„ÙƒÙ„"}</span><span class="chev">â–¾</span></button><div class="msel-menu">${(()=>{const M={buy:"Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡",sell:"Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹",exchange:"Ø§Ø³ØªØ¨Ø¯Ø§Ù„",transfer:"ØªØ­ÙˆÙŠÙ„"};const kindOf=t=>((t&&t.extra&&(t.extra.kind||t.extra.mode||t.extra.__kind))||t.trade_type);
const list=Array.from(new Set((m||[]).map(t=>kindOf(t)).filter(Boolean))).sort();return [`<label class="msel-item"><input type="checkbox" data-all="1" ${!(d.types||[]).length?"checked":""}><span class="t">Ø§Ù„ÙƒÙ„</span></label>`,...list.map(tp=>`<label class="msel-item"><input type="checkbox" data-t="${o(tp)}" ${(d.types||[]).includes(tp)?"checked":""}><span class="t">${o(M[tp]||tp)}</span></label>`)].join("")})()}</div></div></div></div><div class="trade-field"><div class="trade-label">Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹</div><input class="trade-in" id="tr-q" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ© / Ø¹Ù…Ù„Ø© / Ù…Ø³ØªØ®Ø¯Ù… / Ù…Ù„Ø§Ø­Ø¸Ø©" value="${o(d.q)}"/></div><div class="trade-row2" style="align-items:end"><div class="trade-field" style="flex:1"><div class="trade-label">Ø§Ù„Ø¹Ù…Ù„Ø§Øª</div><div class="msel" id="tr-currency-m"><button class="msel-btn" type="button"><span class="v" id="tr-cur-v">${(d.curs||[]).length?`${(d.curs||[]).length} Ù…Ø­Ø¯Ø¯`:"ÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª"}</span><span class="chev">â–¾</span></button><div class="msel-menu">${[`<label class="msel-item"><input type="checkbox" data-all="1" ${!(d.curs||[]).length?"checked":""}><span class="t">ÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª</span></label>`,...x.map(cc=>`<label class="msel-item"><input type="checkbox" data-c="${o(cc)}" ${(d.curs||[]).includes(cc)?"checked":""}><span class="t">${o(cc)}</span></label>`)].join("")}</div></div></div><div class="trade-field" style="max-width:100%"><div class="trade-label" style="opacity:0">Ø¨Ø­Ø«</div><div style="display:flex;gap:8px;align-items:center;justify-content:flex-start;flex-wrap:nowrap"><button class="trade-searchbtn" type="button" id="tr-search-top" style="flex:1;min-width:90px;height:40px;border-radius:12px;font-size:14px">Ø¨Ø­Ø«</button><button class="trade-searchbtn" type="button" id="tr-export-xls" style="width:72px;height:40px;border-radius:12px;background:#0ea5e9;color:#fff;font-weight:900;font-size:14px">Excel</button><button class="trade-searchbtn" type="button" id="tr-export-pdf" style="width:72px;height:40px;border-radius:12px;background:#334155;color:#fff;font-weight:900;font-size:14px">PDF</button></div></div></div></div></div><div class="tr-unified-panel" id="tr-unified-panel"><div class="trade-kpi-title" id="tr-kpi-title" style="display:none"></div><div id="tr-kpi-grid" style="display:none;grid-template-columns:1fr;gap:10px"><div class="trade-addbox" style="background:rgba(254,242,242,.95);border-color:rgba(239,68,68,.25)"><div class="trade-muted" style="font-weight:900;color:#991b1b">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹</div><div style="font:1000 22px/1.1 system-ui,Segoe UI,Roboto,Tahoma;color:#7f1d1d">${v(g.sellTotal)} <span style="font-size:12px;opacity:.75">SYP</span></div><div style="margin-top:6px;font:900 12px/1.2 system-ui,Segoe UI,Roboto,Tahoma;color:#7f1d1d;opacity:.85">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙˆØ³Ø·ÙŠ: ${v(g.sellAvgRate||0)}</div></div><div class="trade-addbox" style="background:rgba(236,253,245,.95);border-color:rgba(34,197,94,.25)"><div class="trade-muted" style="font-weight:900;color:#065f46">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡</div><div style="font:1000 22px/1.1 system-ui,Segoe UI,Roboto,Tahoma;color:#064e3b">${v(g.buyTotal)} <span style="font-size:12px;opacity:.75">SYP</span></div><div style="margin-top:6px;font:900 12px/1.2 system-ui,Segoe UI,Roboto,Tahoma;color:#064e3b;opacity:.85">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙˆØ³Ø·ÙŠ: ${v(g.buyAvgRate||0)}</div></div><div class="trade-addbox" style="background:rgba(255,247,237,.96);border-color:rgba(245,158,11,.35)"><div class="trade-muted" style="font-weight:900;color:#b45309">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„</div><div style="display:grid;gap:4px"><div style="font:1000 18px/1.1 system-ui,Segoe UI,Roboto,Tahoma;color:#065f46">+ ${v(g.exchangeTotal||0)} <span style="font-size:12px;opacity:.75">Ù„ÙŠØ±Ø© Ø³ÙˆØ±ÙŠØ© Ù‚Ø¯ÙŠÙ…Ø©</span></div><div style="font:1000 18px/1.1 system-ui,Segoe UI,Roboto,Tahoma;color:#991b1b">âˆ’ ${v(g.exchangeNewTotal||0)} <span style="font-size:12px;opacity:.75">Ù„ÙŠØ±Ø© Ø³ÙˆØ±ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©</span></div></div></div><div class="trade-addbox" style="background:rgba(236,253,245,.95);border-color:rgba(34,197,94,.25)"><div class="trade-muted" style="font-weight:900;color:#065f46">Ø±ØµÙŠØ¯ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ (Ø¹Ù…Ù„Ø§Øª)</div><div style="margin-top:6px;display:grid;gap:4px;font:900 13px/1.35 system-ui,Segoe UI,Roboto,Tahoma;color:#064e3b">${g.buyHoldList&&g.buyHoldList.length?g.buyHoldList.slice(0,8).map(it=>`<div style="display:flex;flex-direction:row-reverse;justify-content:flex-end;gap:14px"><span style="font-weight:900">${(g.nameByCode&&g.nameByCode[it.code])?g.nameByCode[it.code]:it.code} (${it.code})</span><span class="table-numbers">${v(it.amt)}</span></div>`).join(""):`<div style="opacity:.7">â€”</div>`}</div><div style="margin-top:6px;font:800 11px/1.2 system-ui,Segoe UI,Roboto,Tahoma;color:#064e3b;opacity:.75">* Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙƒÙ…ÙŠØ§Øª Ù…Ø´ØªØ±Ø§Ø© </div></div><div class="trade-addbox" style="background:rgba(254,242,242,.95);border-color:rgba(239,68,68,.25)"><div class="trade-muted" style="font-weight:900;color:#991b1b">Ø±ØµÙŠØ¯ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹ (Ø¹Ù…Ù„Ø§Øª)</div><div style="margin-top:6px;display:grid;gap:4px;font:900 13px/1.35 system-ui,Segoe UI,Roboto,Tahoma;color:#7f1d1d">${g.sellHoldList&&g.sellHoldList.length?g.sellHoldList.slice(0,8).map(it=>`<div style="display:flex;flex-direction:row-reverse;justify-content:flex-end;gap:14px"><span style="font-weight:900">${(g.nameByCode&&g.nameByCode[it.code])?g.nameByCode[it.code]:it.code} (${it.code})</span><span class="table-numbers">${v(it.amt)}</span></div>`).join(""):`<div style="opacity:.7">â€”</div>`}</div><div style="margin-top:6px;font:800 11px/1.2 system-ui,Segoe UI,Roboto,Tahoma;color:#7f1d1d;opacity:.75">* Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙƒÙ…ÙŠØ§Øª Ù…Ø¨Ø§Ø¹Ø© </div></div><div class="trade-addbox" style="background:rgba(239,246,255,.95);border-color:rgba(59,130,246,.25)"><div class="trade-muted" style="font-weight:900;color:#1e40af">Ø§Ù„ØµØ§ÙÙŠ (Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ âˆ’ Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹)</div><div style="margin-top:6px;display:grid;gap:4px;font:900 13px/1.35 system-ui,Segoe UI,Roboto,Tahoma;color:#0f172a">${g.netHoldList&&g.netHoldList.length?g.netHoldList.slice(0,8).map(it=>`<div style="display:flex;flex-direction:row-reverse;justify-content:flex-end;gap:14px"><span style="font-weight:900">${(g.nameByCode&&g.nameByCode[it.code])?g.nameByCode[it.code]:it.code} (${it.code})</span><span class="table-numbers" style="color:${it.amt>=0?'#065f46':'#991b1b'}">${it.amt>=0?'+':'âˆ’'} ${v(Math.abs(it.amt))}</span></div>`).join(""):`<div style="opacity:.7">â€”</div>`}</div><div style="margin-top:8px;display:flex;flex-direction:row-reverse;justify-content:flex-end;gap:14px;font:900 12px/1.2 system-ui,Segoe UI,Roboto,Tahoma;color:#334155;opacity:.9"><span>Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø­Ø±ÙƒØ§Øª</span><span class="table-numbers">${v(g.count)}</span></div></div></div><div class="tr-panel-sep"></div><div class="tr-logwrap" aria-label="Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª"><div class="tr-loglist">\n       ${mf.length?mf.slice(0,250).map(t=>{const k=(t&&t.extra&&(t.extra.kind||t.extra.mode||t.extra.__kind))||t.trade_type,e="sell"===k,ex="exchange"===k,n=t&&t.extra?t.extra:{},a=n&&n.fields?n.fields:{},r=(a.name||a["Ø§Ù„Ø§Ø³Ù…"]||"").trim(),i=(a.phone||a["Ø§Ù„Ø±Ù‚Ù…"]||a["Ø±Ù‚Ù…"]||"").trim(),s=t.created_at?new Date(t.created_at):null,d=s?`${s.getFullYear()}/${String(s.getMonth()+1).padStart(2,"0")}/${String(s.getDate()).padStart(2,"0")} - ${String(s.getHours()).padStart(2,"0")}:${String(s.getMinutes()).padStart(2,"0")}:${String(s.getSeconds()).padStart(2,"0")}`:"",c=ex?"Ø§Ø³ØªØ¨Ø¯Ø§Ù„":(e?"Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹":"Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡"),m=t&&t.extra&&t.extra.status?t.extra.status:"confirmed",g="deleted"===m?"Ø¹Ù…Ù„ÙŠØ© Ù…Ø­Ø°ÙˆÙØ©":"canceled"===m?"Ù‚ÙŠØ¯ Ù…Ù„ØºÙ‰":"draft"===m?"Ù…Ø³ÙˆØ¯Ø©":"",b=ex?"exchange":(e?"sell":"buy"),f=t.actor_name||t.actor_username||"â€”",y=ex?"Ø³Ø¹Ø± Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„":(e?"Ø³Ø¹Ø± Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹":"Ø³Ø¹Ø± Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡"),h=u(l),x=Array.isArray(h.fields)?h.fields:Array.isArray(p)?p:[];function w(t,e){try{if(!a)return"";const n=a[t];if(null!=n&&""!==String(n).trim())return String(n).trim();if(e){const t=a[e];if(null!=t&&""!==String(t).trim())return String(t).trim()}}catch(t){}return""}const _=function(){const t=[],e=new Set(["name","phone","note","Ù…Ù„Ø§Ø­Ø¸Ø©","Ø§Ù„Ø§Ø³Ù…","Ø§Ù„Ø±Ù‚Ù…","Ø±Ù‚Ù…"]);for(const n of x){if(!n||!1===n.enabled)continue;const a=String(n.key||"").trim();if(!a||"name"===a||"phone"===a||"note"===a)continue;const r=String(n.label||a).trim(),i=w(a,r);i&&(e.add(a),e.add(r),t.push(`<span class="muted">${o(r)}:</span><span class="num">${o(i)}</span>`))}try{Object.keys(a||{}).forEach(n=>{if(!n)return;if(e.has(n))return;if("name"===n||"phone"===n||"note"===n)return;const r=a[n];if(null==r)return;const i=String(r).trim();i&&(e.add(n),t.push(`<span class="muted" dir="rtl" style="unicode-bidi:isolate">${o(function(t){try{let e=String(t||"").trim();const n=e.match(/^f_(.+)_([a-z0-9]{4})$/i);return n&&n[1]&&(e=n[1]),e=e.replace(/_/g," ").trim(),e||String(t||"").trim()}catch(e){return String(t||"").trim()}}(n))}:</span><span class="num" dir="ltr" style="unicode-bidi:isolate">${o(i)}</span>`))})}catch(t){}return t.join(" - ")}(),S=`${g?"["+g+"] ":""}Ø§Ù„Ù…Ø¨Ù„Øº <span class="num">${v(t.amount_get)}</span><span class="num">${o(t.currency_code)}</span> - ${y} <span class="num">${v(t.rate)}</span> - Ø§Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº <span class="num">${v(t.amount_pay)}</span><span class="num">${o(t.pay_currency_code||"")||""}</span>`;return`\n         <div class="tr-card ${b}${"deleted"===m?" deleted":"canceled"===m?" canceled":"draft"===m?" draft":""}" data-seq="${o(t.seq)}"><div class="tr-head"><div class="tr-client"><div class="tr-name">${o(r||"Ø¹Ù…ÙŠÙ„")}</div>\n            ${i?`<div class="tr-phone">${o(i)}</div>`:""}\n            ${_?`<div class="tr-extras">${_}</div>`:""}\n           </div></div><div class="tr-mid ${b}"><span class="who">${o(f)}</span> Ù‚Ø§Ù… Ø¨Ø¹Ù…Ù„ÙŠØ© <span class="act">${o(c)}</span> ${S}</div><div class="tr-meta-bottom"><div class="tr-seq">#${o(t.seq)}</div><div class="tr-dt">${o(d)}</div></div>\n          ${t.note?`<div class="tr-note">ğŸ“ ${o(t.note)}</div>`:""}\n\n          ${Array.isArray(n.edit_history)&&n.edit_history.length?`\n           <div class="tr-hist"><span class="t">âœï¸ ØªØ¹Ø¯ÙŠÙ„:</span> ${o(String(n.edit_history[n.edit_history.length-1]||""))}</div>\n          `:""}\n\n          <div class="tr-actions" aria-label="Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ©"><button class="tr-btn edit" type="button" data-act="edit">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button><button class="tr-btn del" type="button" data-act="delete">ğŸ—‘ Ø­Ø°Ù</button><button class="tr-btn print" type="button" data-act="print">ğŸ§¾ Ø·Ø¨Ø§Ø¹Ø©</button><button class="tr-btn pdf" type="button" data-act="pdf">ğŸ“„ PDF</button><button class="tr-btn xls" type="button" data-act="excel">ğŸ“Š Excel</button></div></div>\n        `}).join(""):'<div class="tr-card"><div class="tr-empty">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª Ø¶Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©</div></div>'}\n      </div></div></div>\n   `,t(".trade-backbtn",n).addEventListener("click",()=>c());const E=t("#tr-search-top",n);E&&E.addEventListener("click",k);const L=t("#tr-export-xls",n);L&&L.addEventListener("click",()=>{w((d.__itemsCache&&Array.isArray(d.__itemsCache)?d.__itemsCache:m)||[])});const A=t("#tr-export-pdf",n);A&&A.addEventListener("click",()=>{S((d.__itemsCache&&Array.isArray(d.__itemsCache)?d.__itemsCache:m)||[])}),t("#tr-adv-top",n).addEventListener("click",()=>{d.advOpen=!d.advOpen,$(m)});const s=t("#tr-log-search",n),go=t("#tr-log-go",n),clr=t("#tr-log-clear",n);if(s&&!s.__bound){s.__bound=true;const apply=()=>{d.logQuery=s.value||"";$(m)};s.addEventListener("input",()=>{if(clr)clr.style.visibility=(String(s.value||"").trim()?"" :"hidden");});s.addEventListener("keydown",(e)=>{if(e.key==="Enter"){e.preventDefault();apply();}else if(e.key==="Escape"){e.preventDefault();s.value="";if(clr)clr.style.visibility="hidden";d.logQuery="";$(m);}});if(clr)clr.style.visibility=(String(s.value||"").trim()?"" :"hidden");}if(go&&!go.__bound){go.__bound=true;go.addEventListener("click",()=>{if(s){d.logQuery=s.value||"";$(m);}});}if(clr&&!clr.__bound){clr.__bound=true;clr.addEventListener("click",()=>{if(s){s.value="";clr.style.visibility="hidden";d.logQuery="";$(m);try{s.focus()}catch(_){}}});}
;const kpiBtn=t("#tr-kpi-toggle",n);
if(kpiBtn && !kpiBtn.__bound){
  kpiBtn.__bound=true;
  kpiBtn.addEventListener("click",()=>{
    try{
      const title=t("#tr-kpi-title",n);
      const grid=t("#tr-kpi-grid",n);
      const isHidden = !grid || (grid.style.display==="none");
      if(title) title.style.display = isHidden ? "" : "none";
      if(grid) grid.style.display = isHidden ? "grid" : "none";
      kpiBtn.textContent = isHidden ? "Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚" : "Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚";
    }catch(_){}
  });
  // default: hidden on first open â€” keep label consistent
  try{
    const grid=t("#tr-kpi-grid",n);
    const isHidden = !grid || (grid.style.display==="none");
    kpiBtn.textContent = isHidden ? "Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚" : "Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚";
  }catch(_){}
}
if(t("#tr-adv-box",n)){const j=t("#tr-from",n),C=t("#tr-to",n),D=t("#tr-q",n);try{const a=document.getElementById("tr-from-show");if(a){const v=(j&&j.value)||d.from||"";a.textContent=(v?(()=>{const p=v.split("-");return p.length===3?(p[2]+"/"+p[1]+"/"+p[0]):v})():"")}}catch(_){ }try{const a=document.getElementById("tr-to-show");if(a){const v=(C&&C.value)||d.to||"";a.textContent=(v?(()=>{const p=v.split("-");return p.length===3?(p[2]+"/"+p[1]+"/"+p[0]):v})():"")}}catch(_){ }j&&j.addEventListener("change",t=>{d.from=t.target.value||s;try{const v=t.target.value||"";const a=document.getElementById("tr-from-show");if(a)a.textContent=(v?(()=>{const p=v.split("-");return p.length===3?(p[2]+"/"+p[1]+"/"+p[0]):v})():"")}catch(_){}}),C&&C.addEventListener("change",t=>{d.to=t.target.value||s;try{const v=t.target.value||"";const a=document.getElementById("tr-to-show");if(a)a.textContent=(v?(()=>{const p=v.split("-");return p.length===3?(p[2]+"/"+p[1]+"/"+p[0]):v})():"")}catch(_){}}),D&&D.addEventListener("input",t=>{d.q=t.target.value||""});const closeAll=()=>{[t("#tr-users-m",n),t("#tr-type-m",n),t("#tr-currency-m",n)].forEach(b=>{try{b&&b.classList.remove("open")}catch(_){}})};document.addEventListener("click",(e)=>{const a=e.target;const box=a&&a.closest?a.closest(".msel"):null;if(!box)closeAll();});const bindMsel=(id,key,labelId)=>{const box=t(id,n);if(!box||box.__b)return;box.__b=1;const btn=box.querySelector(".msel-btn");btn&&btn.addEventListener("click",(e)=>{e.preventDefault();e.stopPropagation();const is=box.classList.toggle("open");if(is){[t("#tr-users-m",n),t("#tr-type-m",n),t("#tr-currency-m",n)].forEach(b=>{if(b&&b!==box)try{b.classList.remove("open")}catch(_){}})}});box.addEventListener("change",(e)=>{const inp=e.target;if(!inp||inp.type!=="checkbox")return;const isAll=inp.getAttribute("data-all")==="1";const arr=(d[key]&&Array.isArray(d[key]))?d[key]:[];if(isAll){d[key]=[];}else{const v=inp.getAttribute("data-u")||inp.getAttribute("data-t")||inp.getAttribute("data-c")||"";let next=arr.slice();if(inp.checked){if(v&&!next.includes(v))next.push(v)}else{next=next.filter(x=>x!==v)}d[key]=next;}try{const all=box.querySelector('input[data-all="1"]');if(all)all.checked=!(d[key]||[]).length}catch(_){ }try{const span=t(labelId,n);if(span)span.textContent=(d[key]||[]).length?((d[key]||[]).length+" Ù…Ø­Ø¯Ø¯"):(key==="curs"?"ÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª":key==="users"?"ÙƒÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†":"Ø§Ù„ÙƒÙ„")}catch(_){}})};bindMsel("#tr-users-m","users","#tr-users-v");bindMsel("#tr-type-m","types","#tr-type-v");bindMsel("#tr-currency-m","curs","#tr-cur-v");const H=()=>{const q=String(d.q||"").trim().toLowerCase();const from=String(d.from||"");const to=String(d.to||"");const us=(d.users||[]);const ts=(d.types||[]);const cs=(d.curs||[]);const inRange=(dt)=>{try{if(!dt)return true;const ds=String(dt).slice(0,10);if(from && ds<from) return false; if(to && ds>to) return false; return true}catch(_){return true}};const out=(m||[]).filter(it=>{try{if(!inRange(it.created_at))return false;if(us.length && !us.includes(String(it.actor_username||"")))return false;const K=((it&&it.extra&&(it.extra.kind||it.extra.mode||it.extra.__kind))||it.trade_type);
if(ts.length && !ts.includes(String(K||"")))return false;if(cs.length && !cs.includes(String(it.currency_code||"")))return false;if(q){return JSON.stringify(it).toLowerCase().includes(q)}return true}catch(_){return true}});d.__itemsCache=out;$(out);closeAll();};const btn=t("#tr-search-top",n);if(btn&&!btn.__h){btn.__h=1;btn.addEventListener("click",(e)=>{e.preventDefault();e.stopPropagation();H();},!0);}D&&D.addEventListener("keydown",t=>{"Enter"===t.key&&H()});const z=t("#tr-type",n),P=t("#tr-users",n),T=t("#tr-currency",n);z&&z.addEventListener("change",t=>{d.type=t.target.value||"all"}),P&&P.addEventListener("change",t=>{const e=t.target.value||"all";d.users=e&&"all"!==e?[e]:[]}),T&&T.addEventListener("change",t=>{d.currency=t.target.value||"all"})}try{const I=n.querySelector(".tr-loglist"),U=new Map((m||[]).map(t=>[String(t.seq),t]));function M(t){const e=t&&t.closest&&t.closest(".tr-card");if(!e)return null;const n=e.getAttribute("data-seq")||"";return U.get(String(n))||null}I&&!I.__bound&&(I.__bound=!0,I.addEventListener("click",async e=>{const s=e.target.closest&&e.target.closest("button[data-act]"),o=e.target.closest&&e.target.closest(".tr-card");if(o){if(s){e.preventDefault(),e.stopPropagation();const c=s.getAttribute("data-act")||"",g=M(s);if(!g)return;if("delete"===c){
  try{var br=(g&&g.extra&&g.extra.branch)||null;if(br&&String(br)!==String(__bid())){ r("âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø¹Ù…Ù„ÙŠØ© Ù„ÙØ±Ø¹ Ø¢Ø®Ø±"); return; } if(!br&&String(__bid())!=="main"){ r("âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø¹Ù…Ù„ÙŠØ© Ù‚Ø¯ÙŠÙ…Ø© Ù„ÙØ±Ø¹ Ø¢Ø®Ø±"); return; }}catch(_){ }
  if(((g&&g.extra&&g.extra.status)||"")==="deleted"){ r("â„¹ï¸ Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ù…Ø­Ø°ÙˆÙØ© Ø¨Ø§Ù„ÙØ¹Ù„"); return; }
  if(!window.confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©ØŸ"))return;
  try{
    const ss=i()||{};
    const deleter=(ss.username||ss.name||g.actor_username||"anon");
    const extra=Object.assign({},(g&&g.extra)?g.extra:{});
    const hist=Array.isArray(extra.edit_history)?extra.edit_history.slice():[];
    let when=""; try{ when=new Date().toLocaleString("ar-EG"); }catch(_){ when=String(Date.now()); }
    hist.push(`Ù‚Ø§Ù… ${deleter} Ø¨Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨ØªØ§Ø±ÙŠØ® ${when}`);
    extra.edit_history=hist;
    extra.status="deleted";
    extra.status_ar="Ù…Ø­Ø°ÙˆÙ";
    extra.deleted_at=Date.now();
    extra.deleted_by=deleter;
    extra.updated_at=Date.now();
    const {error:j}=await a.from("trade_transactions").update({extra}).eq("seq",g.seq);
    if(j)throw j;
    r("âœ… ØªÙ… ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¥Ù„Ù‰ (Ù…Ø­Ø°ÙˆÙ)");
    k();
  }catch(C){
    r("âš ï¸ ØªØ¹Ø°Ø± Ø­Ø°Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ©");
  }
  return
}const y=t=>String(t||"").replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[t])),x=g&&g.extra?g.extra:{},w=x&&x.fields?x.fields:{},_=(w.name||w["Ø§Ù„Ø§Ø³Ù…"]||"").trim()||"Ø¹Ù…ÙŠÙ„",S=(w.phone||w["Ø§Ù„Ø±Ù‚Ù…"]||w["Ø±Ù‚Ù…"]||"").trim(),E=g.actor_name||g.actor_username||"â€”";g.trade_type,g&&g.extra&&g.extra.status&&g.extra.status;function L(t){let e="",n="";try{e=localStorage.getItem("taif:logo")||""}catch(t){}try{n="Ø´Ø±ÙƒØ© Ø·ÙŠÙ Ù„Ù„ØµØ±Ø§ÙØ© ÙˆØ§Ù„Ø­ÙˆØ§Ù„Ø§Øª"}catch(t){}n="Ø´Ø±ÙƒØ© Ø·ÙŠÙ Ù„Ù„ØµØ±Ø§ÙØ© ÙˆØ§Ù„Ø­ÙˆØ§Ù„Ø§Øª";const a=g.created_at?new Date(g.created_at):null,r=a?`${a.getFullYear()}/${String(a.getMonth()+1).padStart(2,"0")}/${String(a.getDate()).padStart(2,"0")} ${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}:${String(a.getSeconds()).padStart(2,"0")}`:g.trade_day||"",K=(g&&g.extra&&(g.extra.kind||g.extra.mode||g.extra.__kind))||g.trade_type,i="ÙØ§ØªÙˆØ±Ø© "+("exchange"===K?"Ø§Ø³ØªØ¨Ø¯Ø§Ù„":("sell"===K?"Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹":"Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡")),s=u(l),d=Array.isArray(s.fields)?s.fields:Array.isArray(p)?p:[],o=[];try{const t=new Set(["name","phone","note","Ù…Ù„Ø§Ø­Ø¸Ø©","Ø§Ù„Ø§Ø³Ù…","Ø§Ù„Ø±Ù‚Ù…","Ø±Ù‚Ù…"]);for(const e of d){if(!e||!1===e.enabled)continue;const n=String(e.key||"").trim();if(!n||"name"===n||"phone"===n||"note"===n)continue;const a=String(e.label||n).trim(),r=(w&&(w[n]??w[a]))??"",i=String(r||"").trim();i&&(t.add(n),t.add(a),o.push(`<div class="row"><div class="k">${y(a)}</div><div class="v rtl">${y(i)}</div></div>`))}Object.keys(w||{}).forEach(e=>{if(!e||t.has(e)||"name"===e||"phone"===e||"note"===e)return;const n=String(w[e]||"").trim();n&&o.push(`<div class="row"><div class="k">${y(e)}</div><div class="v rtl">${y(n)}</div></div>`)})}catch(t){}return`<!doctype html><html lang="ar" dir="rtl"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>\n<title>${y(t||"ÙØ§ØªÙˆØ±Ø©")}</title>\n<style>:root{--paper:80mm;--w:72mm;--pad:2.2mm;--ink:#0b1220;--muted:#0f172a;--muted2:#475569;--line:rgba(15,23,42,.14);--dash:rgba(15,23,42,.18);--soft:rgba(15,23,42,.06);--g:rgba(34,197,94,.13);--r:rgba(239,68,68,.11)}*{box-sizing:border-box}body,html{margin:0;padding:0;background:#fff;color:var(--ink);font-family:Tahoma,system-ui,Segoe UI,Roboto,Arial;-webkit-print-color-adjust:exact;print-color-adjust:exact}.paper{width:var(--w);margin:0 auto;padding:var(--pad)}.card{border:1px solid var(--line);border-radius:14px;padding:10px 10px}.head{display:flex;align-items:center;justify-content:center;gap:8px;padding:8px 8px;border:1px solid var(--soft);border-radius:12px;background:rgba(15,23,42,.02)}.brand{display:flex;align-items:center;justify-content:center;gap:8px;min-width:0;width:100%;flex-direction:column}.brand img{width:34px;height:34px;border-radius:10px;object-fit:contain;border:1px solid rgba(15,23,42,.1);background:#fff}.brand .t{font-weight:1000;font-size:18px;line-height:1.15;white-space:normal;overflow:visible;text-overflow:clip;max-width:100%;text-align:center;direction:rtl;unicode-bidi:plaintext}.badge{display:inline-flex;align-items:center;gap:6px;padding:5px 8px;border-radius:999px;font-weight:1000;font-size:11px;white-space:nowrap;border:1px solid rgba(15,23,42,.14)}.badge.buy{background:var(--g);color:#065f46;border-color:rgba(34,197,94,.35)}.badge.sell{background:var(--r);color:#991b1b;border-color:rgba(239,68,68,.35)}.sec{margin-top:8px}.h{font-weight:1000;font-size:11px;color:var(--muted2);margin:0 0 4px 0;display:flex;align-items:center;justify-content:space-between}.hr{height:1px;background:rgba(15,23,42,.1);margin:7px 0}.row{display:grid;grid-template-columns:1fr 1.15fr;gap:8px;padding:4.5px 0;border-bottom:1px solid rgba(15,23,42,.07);align-items:start}.row:last-child{border-bottom:0}.k{font-weight:1000;color:var(--muted);font-size:12px;line-height:1.2;text-align:right;direction:rtl;unicode-bidi:plaintext;overflow-wrap:anywhere}.v{font-weight:1000;font-size:12.3px;line-height:1.2;text-align:left;direction:ltr;unicode-bidi:isolate;overflow-wrap:anywhere}.v.rtl{direction:rtl;text-align:right;unicode-bidi:plaintext}.v.left{direction:rtl!important;text-align:left!important;unicode-bidi:isolate!important}.v.nowrap{white-space:nowrap!important}.big .v{font-size:13.2px}.totals{border:1px dashed rgba(15,23,42,.18);border-radius:12px;padding:7px 8px;background:rgba(15,23,42,.015)}.totals .row{border-bottom:1px dashed rgba(15,23,42,.12)}.totals .row:last-child{border-bottom:0}.totals .row.big{padding-top:5px;padding-bottom:5px}.totals .row.big .k{font-size:12.2px}.totals .row.big .v{font-size:13.6px}.clientbox{border:1px solid rgba(15,23,42,.28);border-radius:12px;overflow:hidden;background:#fff}.clientbox .row{border-bottom:1px solid rgba(15,23,42,.22);padding:0;margin:0;grid-template-columns:44% 56%}.clientbox .row:last-child{border-bottom:0}.clientbox .k{padding:7px 8px;border-left:1px solid rgba(15,23,42,.22);background:rgba(15,23,42,.03)}.clientbox .v{padding:7px 8px}.clientbox{border:1px solid rgba(15,23,42,.25);border-radius:12px;overflow:hidden}.clientbox .row{border-bottom:1px solid rgba(15,23,42,.2);padding:6px 8px;margin:0}.clientbox .row:last-child{border-bottom:0}.clientbox .k{border-left:1px solid rgba(15,23,42,.18);padding-left:8px}.clientbox .v{padding-right:8px}@media print{.clientbox{border-color:rgba(0,0,0,.45)}.clientbox .row{border-bottom-color:rgba(0,0,0,.35)}.clientbox .k{border-left-color:rgba(0,0,0,.35)}}.footnote{margin-top:7px;font-size:10.5px;color:#374151;text-align:center}@page{size:80mm auto;margin:0}@media print{body,html{width:var(--paper);max-width:var(--paper)}.paper{width:var(--w);margin:0;padding:2mm}.card{border:0;border-radius:0;padding:0}.head{border:0;border-radius:0;padding:0 0 6px 0;background:0 0}.footnote{display:none}}</style>


<style id="rate-align-adjust">
.trade-rate-mini-input{
    text-align: center !important;
    padding-right: 18px !important; /* slight push to the right */
}
</style>

</head>\n<body>\n <div class="paper">\n  <div class="card">\n   <div class="head">\n    <div class="brand">\n     ${e?`<img src="${e}" alt="logo"/>`:""}\n     ${n?`<div class="t">${y(n)}</div>`:""}\n    </div>\n    \n   </div>\n   <div class="sec">\n    <div class="h" style="justify-content:center;font-size:13px;color:#0f172a">${y(i)}</div>\n\n    <div class="row big"><div class="k">Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</div><div class="v">#${y(g.seq)}</div></div>\n    <div class="row"><div class="k">Ø§Ù„ØªØ§Ø±ÙŠØ®</div><div class="v nowrap">${y(r)}</div></div>\n    <div class="row"><div class="k">Ø§Ù„Ù…Ù†ÙØ°</div><div class="v rtl">${y(E)}</div></div>\n   </div>\n\n   <div class="hr"></div>\n   <div class="sec">\n\n    <div class="h">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</div>\n    <div class="clientbox">\n    <div class="row"><div class="k">Ø§Ù„Ø§Ø³Ù…</div><div class="v rtl">${y(_)}</div></div>\n    <div class="row"><div class="k">Ø§Ù„Ø±Ù‚Ù…</div><div class="v rtl">${y(S||"â€”")}</div></div>\n    ${o.length?`${o.join("")}`:""}\n   </div>\n\n    </div>\n\n   <div class="hr"></div>\n   <div class="sec totals">\n    <div class="h">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</div>\n    <div class="row"><div class="k">Ø£Ø³Ø¹Ø§Ø± ØµØ±Ù Ø§Ù„Ø¹Ù…Ù„Ø§Øª</div><div class="v">${y(g.currency_code||"")}</div></div>\n    <div class="row"><div class="k">Ø¹Ù…Ù„Ø© Ø§Ù„Ø¯ÙØ¹</div><div class="v">${y(g.pay_currency_code||"")}</div></div>\n    <div class="row"><div class="k">Ø³Ø¹Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„</div><div class="v">${v(g.rate)}</div></div>\n    <div class="row"><div class="k">Ø§Ù„Ù…Ø¨Ù„Øº</div><div class="v">${v(g.amount_get)} ${y(g.currency_code||"")}</div></div>\n    <div class="row big"><div class="k">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div><div class="v">${v(g.amount_pay)} ${y(g.pay_currency_code||"")}</div></div>\n   </div>\n\n   ${g.note?`<div class="hr"></div><div class="sec"><div class="h">Ù…Ù„Ø§Ø­Ø¸Ø©</div><div class="row"><div class="k">ğŸ“</div><div class="v rtl" style="max-width:70%">${y(g.note)}</div></div></div>`:""}\n\n   <div class="footnote">Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ¹Ø§Ù…Ù„ÙƒÙ… Ù…Ø¹Ù†Ø§</div>\n  </div>\n </div>\n
<style id="force-cancel-red-final">#inv-cancel,#trade-cancel{background:#dc2626 !important;color:#ffffff !important}</style>

<style id="removed-old-next-right-style">.trade-actions{display:flex !important;justify-content:flex-end !important;gap:14px !important}#trade-submit{order:2 !important}#trade-cancel{order:1 !important}</style>

<style id="trade-summary-rtl-fix">.trade-addbox,.trade-addbox .trade-muted,.trade-addbox div{text-align:right !important;direction:rtl !important}</style>


<style id="kpi-holdings-align-css">
/* Align currency/amount lines in KPI boxes 4/5/6 */
.kpi-holdings-line .table-numbers,
.kpi-holdings-lines .table-numbers{
  text-align:left !important;
  min-width:6ch;
}
</style>


<style id="unified-scroll-kpi-log-v1">
  /* Make KPI + log list scroll together inside the same modal */
  #trade-backdrop .tr-logwrap{max-height:none !important; overflow:visible !important;}
  #trade-backdrop .trade-modal{overflow:auto !important;}
</style>

</body></html>`}function A(t){b(L(t))}function q(t,e,n){try{if(!window.XLSX){return f(String(t||"export.xlsx").replace(/\.xlsx$/i,".xml"),e,n)}const a=[e].concat(n||[]),r=XLSX.utils.aoa_to_sheet(a),i=e.length,s=[];for(let t=0;t<i;t++){let a=String(e[t]??"").length;for(let e=0;e<Math.min((n||[]).length,80);e++){const r=n[e]&&null!=n[e][t]?String(n[e][t]):"";r.length>a&&(a=r.length)}s.push({wch:Math.min(Math.max(a+2,10),42)})}r["!cols"]=s;const d=XLSX.utils.book_new();d.Workbook={Views:[{RTL:!0}]},XLSX.utils.book_append_sheet(d,r,"Ø§Ù„Ø³Ø¬Ù„");const o=String(t||"Ø³Ø¬Ù„_Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹_ÙˆØ§Ù„Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡.xlsx").replace(/\.(xls|xml)$/i,"").replace(/\s+/g,"_")+".xlsx";XLSX.writeFile(d,o,{compression:!0})}catch(t){r("âš ï¸ ØªØ¹Ø°Ø± ØªØµØ¯ÙŠØ± Ù…Ù„Ù Excel")}}if("print"===c)return void A("ÙØ§ØªÙˆØ±Ø©");if("pdf"===c)return A("PDF"),void r("â„¹ï¸ Ø§Ø®ØªØ± â€œSave as PDFâ€ Ù…Ù† Ù†Ø§ÙØ°Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©");if("excel"===c){(function(){try{const t=u(l),e=Array.isArray(t.fields)?t.fields:Array.isArray(p)?p:[],n=new Set(["name","phone","note","Ù…Ù„Ø§Ø­Ø¸Ø©","Ø§Ù„Ø§Ø³Ù…","Ø§Ù„Ø±Ù‚Ù…","Ø±Ù‚Ù…"]),a=[];for(const t of e){if(!t||!1===t.enabled||t.key==="mobile_number")continue;const e=String(t.key||"").trim();if(!e||"name"===e||"phone"===e||"note"===e)continue;const r=String(t.label||e).trim(),i=(w&&(w[e]??w[r]))??"",s=String(i||"").trim();s&&(n.add(e),n.add(r),a.push(`${r}: ${s}`))}return Object.keys(w||{}).forEach(t=>{if(!t||n.has(t)||"name"===t||"phone"===t||"note"===t)return;const e=String(w[t]||"").trim();e&&(n.add(t),a.push(`${t}: ${e}`))}),a.join(" | ")}catch(t){return""}})();const D=u(l),z=Array.isArray(D.fields)?D.fields:Array.isArray(p)?p:[],P=["Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ©","Ø§Ù„ØªØ§Ø±ÙŠØ®","Ø§Ù„Ù†ÙˆØ¹","Ø£Ø³Ø¹Ø§Ø± ØµØ±Ù Ø§Ù„Ø¹Ù…Ù„Ø§Øª","Ø§Ù„Ù…Ø¨Ù„Øº","Ø³Ø¹Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ","Ø¹Ù…Ù„Ø© Ø§Ù„Ø¯ÙØ¹","Ø§Ù„Ù…Ù†ÙØ°","Ù…Ù„Ø§Ø­Ø¸Ø©","Ø§Ù„Ø§Ø³Ù…","Ø§Ù„Ø±Ù‚Ù…"],T=[];for(const Y of z){if(!Y||!1===Y.enabled)continue;const B=String(Y.key||"").trim();if(!B||"name"===B||"phone"===B||"note"===B)continue;const F=String(Y.label||B).trim();T.includes(F)||T.push(F)}const I="sell"===g.trade_type?"Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹":"buy"===g.trade_type?"Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡":g.trade_type,U=g.extra&&g.extra.fields?g.extra.fields:{},R=[g.seq,g.trade_day||"",I,g.currency_code||"",g.amount_get??"",g.rate??"",g.amount_pay??"",g.pay_currency_code||"",g.actor_username||"",g.note||"",U.name||"",U.phone||""];for(const O of z){if(!O||!1===O.enabled)continue;const N=String(O.key||"").trim();if(!N||"name"===N||"phone"===N||"note"===N)continue;const W=String(O.label||N).trim();R.push(U[N]??U[W]??"")}return q(`Ø¹Ù…Ù„ÙŠØ©_${g.seq}.xml`,P.concat(T),[R]),void r("âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ù…Ù„Ù Excel")}if("edit"===c){const X=M(s);if(!X)return;try{var br=(X&&X.extra&&X.extra.branch)||null;if(br&&String(br)!==String(__bid())){ r("âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© Ù„ÙØ±Ø¹ Ø¢Ø®Ø±"); return; } if(!br&&String(__bid())!=="main"){ r("âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© Ù‚Ø¯ÙŠÙ…Ø© Ù„ÙØ±Ø¹ Ø¢Ø®Ø±"); return; }}catch(_){ }
const H=d&&Array.isArray(d.__itemsCache)?d.__itemsCache:m&&Array.isArray(m)?m:[],G=n&&"number"==typeof n.scrollTop?n.scrollTop:0,J=h(),V=t(".trade-modal",J),Z="sell"===X.trade_type,Q=Z?"Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹":"Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡";return V.innerHTML=`\n         <div class="trade-head"><button class="trade-backbtn" type="button"><span style="font-size:20px">â¬…</span><span>Ø¥Ù„ØºØ§Ø¡</span></button><div class="trade-headtitle"><span class="ico">âœï¸</span><span>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© #${y(X.seq)} (${y(Q)})</span></div></div><div class="trade-form"><div class="trade-row2"><div class="trade-field"><div class="trade-label">Ø§Ù„Ù…Ø¨Ù„Øº (${y(X.currency_code)})</div><input class="trade-in table-numbers" id="ed-amount" inputmode="decimal" value="${y(X.amount_get)}" /></div><div class="trade-field"><div class="trade-label">Ø§Ù„Ø³Ø¹Ø±</div><input class="trade-in table-numbers" id="ed-rate" inputmode="decimal" value="${y(X.rate)}" /></div></div><div class="trade-row2"><div class="trade-field"><div class="trade-label">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (${y(X.pay_currency_code||"")})</div><input class="trade-in table-numbers" id="ed-total" inputmode="decimal" value="${y(X.amount_pay)}" /></div><div class="trade-field"><div class="trade-label">Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</div><input class="trade-in" id="ed-note" value="${y(X.note||"")}" /></div></div>

<div class="trade-actions" style="display:flex;flex-direction:row-reverse;justify-content:flex-start;gap:14px;margin-top:20px">
  <button type="button" id="trade-submit"
    style="background:#16a34a;color:#fff;border:none;padding:14px 32px;
    border-radius:14px;font-weight:700;cursor:pointer">
    Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
  </button>

  <button type="button" id="trade-cancel"
    style="background:#dc2626;color:#fff;border:none;padding:14px 32px;
    border-radius:14px;font-weight:700;cursor:pointer">
    Ø¥Ù„ØºØ§Ø¡
  </button>
</div>

</div>\n        `,J.classList.add("open"),t(".trade-backbtn",V).addEventListener("click",()=>{try{$(H)}catch(t){}setTimeout(()=>{try{n.scrollTop=G}catch(t){}},0)}),t("#trade-cancel",V).addEventListener("click",()=>{try{$(H)}catch(t){}setTimeout(()=>{try{n.scrollTop=G}catch(t){}},0)}),function(){const e=t("#ed-amount",V),n=t("#ed-rate",V),a=t("#ed-total",V);if(!e||!n||!a)return;const getCode=X.currency_code||"SYP",payCode=X.pay_currency_code||getCode;try{e.value=af(getCode,Number(String(e.value||"").replace(/,/g,"")))}catch(_){}try{a.value=af(payCode,Number(String(a.value||"").replace(/,/g,"")))}catch(_){}try{__attachLiveGrouping(e,()=>getCode,()=>{})}catch(_){}try{__attachLiveGrouping(a,()=>payCode,()=>{})}catch(_){}const r=t=>{const e=String(t||"").replace(/,/g,"").trim(),n=Number(e);return Number.isFinite(n)?n:0};let s="amountRate";const d=()=>{const t=r(e.value),s=r(n.value);t>0&&s>0&&(a.value=af(payCode,t*s))},o=()=>{const t=r(a.value),s=r(n.value);t>0&&s>0&&(e.value=af(getCode,t/s))};e.addEventListener("input",()=>{s="amountRate",d()}),n.addEventListener("input",()=>{"total"===s?o():d()}),a.addEventListener("input",()=>{s="total",o()}),d()}(),void t("#trade-submit",V).addEventListener("click",async()=>{const e=Number(String(t("#ed-amount",V).value||"").replace(/,/g,""))||0,s=Number(String(t("#ed-rate",V).value||"").replace(/,/g,""))||0;let d=Number(String(t("#ed-total",V).value||"").replace(/,/g,""))||0;const o=String(t("#ed-note",V).value||"").trim();if(!(e>0&&s>0))return void r("âš ï¸ Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº ÙˆØ§Ù„Ø³Ø¹Ø± Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­");if(d>0||(d=e*s),!(d>0))return void r("âš ï¸ ØªØ¹Ø°Ø± Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ");const l=`Ø§Ù„Ù…Ø¨Ù„Øº ${v(X.amount_get)} ${X.currency_code} | Ø§Ù„Ø³Ø¹Ø± ${v(X.rate)} | Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ${v(X.amount_pay)} ${X.pay_currency_code||""}`,c=`Ø§Ù„Ù…Ø¨Ù„Øº ${v(e)} ${X.currency_code} | Ø§Ù„Ø³Ø¹Ø± ${v(s)} | Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ${v(d)} ${X.pay_currency_code||""}`,p=`Ù‚Ø§Ù… ${i()&&(i().username||i().name)||X.actor_username||""} Ø¨ØªØ¹Ø¯ÙŠÙ„: (${l}) â‡¢ (${c})`,u=Object.assign({},X.extra||{}),m=Array.isArray(u.edit_history)?u.edit_history.slice():[];m.push(p),u.edit_history=m;try{const{error:t}=await a.from("trade_transactions").update({amount_get:e,rate:s,amount_pay:d,note:o||null,extra:u}).eq("seq",X.seq);if(t)throw t;r("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„");try{$(H)}catch(t){}k().then(()=>{setTimeout(()=>{try{n.scrollTop=G}catch(t){}},0)})}catch(t){r("âš ï¸ ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„")}})}return}o&&o.classList.toggle("open")}}))}catch(R){}e.classList.add("open")}async function k(){n.innerHTML='\n    <div class="trade-head"><div style="display:flex;gap:10px;align-items:center"><button class="trade-backbtn" type="button"><span style="font-size:20px">â¬…</span><span>Ø±Ø¬ÙˆØ¹</span></button></div><div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center"><button class="trade-advbtn" type="button" id="tr-adv-top">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©</button><button class="trade-advbtn" type="button" id="tr-kpi-toggle">Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚</button></div></div><div class="trade-addbox" style="margin:14px"><div class="trade-muted" style="font-weight:900">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±â€¦</div></div>\n   ',t(".trade-backbtn",n).addEventListener("click",()=>c());const e=t("#tr-search-top",n);e&&e.addEventListener("click",k);const i=t("#tr-export-xls",n);i&&i.addEventListener("click",()=>{w((d.__itemsCache&&Array.isArray(d.__itemsCache)?d.__itemsCache:items)||[])});const o=t("#tr-export-pdf",n);o&&o.addEventListener("click",()=>{S((d.__itemsCache&&Array.isArray(d.__itemsCache)?d.__itemsCache:items)||[])});try{if(d.from&&d.to&&d.from>d.to){const t=d.from;d.from=d.to,d.to=t}$(await async function(){let t=a.from("trade_transactions").select("seq,trade_day,trade_type,currency_code,currency_name,pay_currency_code,amount_get,amount_pay,rate,actor_username,actor_name,note,extra,created_at").gte("trade_day",d.from||s).lte("trade_day",d.to||s).eq("branch_id",__bid()).is("deleted_at",null).order("created_at",{ascending:!1}).limit(1e3);"all"!==d.type&&(t=t.eq("trade_type",d.type)),"all"!==d.currency&&(t=t.eq("currency_code",d.currency)),Array.isArray(d.users)&&d.users.length&&(t=t.in("actor_username",d.users));const{data:e,error:n}=await t;if(n)throw n;let r=Array.isArray(e)?e:[];if(d.q){const t=d.q.toLowerCase();r=r.filter(e=>[e.seq,e.currency_code,e.currency_name,e.actor_username,e.actor_name,e.note,e.trade_type,e.trade_day].join(" ").toLowerCase().includes(t))}return r}())}catch(t){r("âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„"),x()}}e.classList.add("open"),n.innerHTML='\n   <div class="trade-head"><div style="display:flex;gap:10px;align-items:center"><button class="trade-backbtn" type="button"><span style="font-size:20px">â¬…</span><span>Ø±Ø¬ÙˆØ¹</span></button></div><div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center"><button class="trade-advbtn" type="button" id="tr-adv-top">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©</button><button class="trade-advbtn" type="button" id="tr-kpi-toggle">Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚</button></div></div><div class="trade-addbox" style="margin:14px"><div class="trade-muted" style="font-weight:900">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±â€¦</div></div>\n  ',t(".trade-backbtn",n).addEventListener("click",()=>c()),k()}function q(){if(!d())return void r("âš ï¸ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ©");const n=u(l);let a=n.fields.map(t=>({...t}));const i=h(),s=t(".trade-modal",i),o=()=>{s.innerHTML=`\n    <div class="trade-head"><button class="trade-backbtn" type="button"><span style="font-size:20px">â¬…</span><span>Ø±Ø¬ÙˆØ¹</span></button><div class="trade-headtitle"><span class="ico">âš™ï¸</span><span>Ø¥Ø¯Ø§Ø±Ø© Ø­Ù‚ÙˆÙ„ Ù…Ø¨ÙŠØ¹ Ø´Ø±Ø§Ø¡ Ø§Ø³ØªØ¨Ø¯Ø§Ù„</span></div></div><div class="trade-settings-grid" id="ts-list">\n     ${a.map(t=>`\n      <div class="trade-settings-row" data-k="${t.key}"><div class="left"><input type="checkbox" ${t.enabled?"checked":""} data-en="${t.key}"/><div><div style="font:900 16px/1 system-ui,Segoe UI,Roboto,Tahoma;color:#0f172a">${t.label}</div><div style="font:800 12px/1 system-ui,Segoe UI,Roboto,Tahoma;color:#64748b">${t.key}${t.system?" (Ø£Ø³Ø§Ø³ÙŠ)":""}</div></div></div>\n       ${t.system?"":`<button class="trade-del" type="button" data-del="${t.key}">Ø­Ø°Ù</button>`}\n      </div>\n     `).join("")}\n    </div><div class="trade-addbox"><div style="font:1000 16px/1 system-ui,Segoe UI,Roboto,Tahoma;color:#0f172a">Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ Ø¬Ø¯ÙŠØ¯</div><div class="row"><input class="trade-in" id="ts-label" placeholder="Ø§Ø³Ù… Ø§Ù„Ø­Ù‚Ù„ (Ù…Ø«Ø§Ù„: Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©)" /><select class="trade-sel" id="ts-type"><option value="text">Ù†Øµ</option><option value="number">Ø±Ù‚Ù…</option></select></div><div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:flex-start"><button class="trade-save" type="button" id="ts-add">Ø¥Ø¶Ø§ÙØ©</button><button class="trade-save" type="button" id="ts-save" style="background:#16a34a">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button></div></div>\n   `,t(".trade-backbtn",s).addEventListener("click",x),e("[data-en]",s).forEach(t=>{t.addEventListener("change",()=>{const e=t.getAttribute("data-en"),n=a.find(t=>t.key===e);n&&(n.enabled=t.checked)})}),e("[data-del]",s).forEach(t=>{t.addEventListener("click",()=>{const e=t.getAttribute("data-del");a=a.filter(t=>t.key!==e),o()})}),t("#ts-add",s).addEventListener("click",()=>{const e=(t("#ts-label",s).value||"").trim(),n=t("#ts-type",s).value||"text";if(!e)return r("âš ï¸ Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø­Ù‚Ù„");const i="f_"+e.replace(/\s+/g,"_").replace(/[^\u0600-\u06FFa-zA-Z0-9_]/g,"").slice(0,24)+"_"+Math.random().toString(36).slice(2,6);a.push({key:i,label:e,type:"number"===n?"number":"text",enabled:!0,system:!1}),t("#ts-label",s).value="",o()}),t("#ts-save",s).addEventListener("click",async()=>{const t=u({...n,fields:a});await async function(t,e){if(v())try{await window.$db.set(window.$db.ref(t),e)}catch(t){}}("taif/tradeSettings",t),l=t,r("âœ… ØªÙ… Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ù‚ÙˆÙ„"),x()})};o(),i.classList.add("open")}function j(){let t=null;if(v()){try{window.$db.onValue(window.$db.ref("taif/data"),e=>{const a=e&&e.val&&e.val();if(Array.isArray(a)&&a.length){const e=JSON.stringify(a);if(e===t)return;t=e,o=a,c=function(t){const e=Object.create(null);if(e.SYP_BASE={buy:1,sell:1,name:"Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ø³ÙˆØ±ÙŠØ©",__base:!0,_m:"base",_rb:1,_rs:1},!Array.isArray(t)||!t.length)return e;const a=t.find(t=>t&&"USD"===t.code)||null,r=a?n(a.buy):0,i=a?n(a.sell):0;if(!(r>0&&i>0))return e;for(const a of t){if(!a||!a.code)continue;const t=String(a.code).toUpperCase();if("SYP"===t){const t=n(a.ratioBuy)>0?n(a.ratioBuy):1,s=n(a.ratioSell)>0?n(a.ratioSell):1,d="divide"===a.method?"divide":"multiply";let o=0,l=0;"divide"===d?(o=+r/t,l=+i/s):(o=+r*t,l=+i*s),e.SYP_NEW={buy:o,sell:l,name:a.name||"Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ø³ÙˆØ±ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯",__aliasOf:"SYP",_m:d,_rb:t,_rs:s};continue}if("USD"===t){e[t]={buy:r,sell:i,name:a.name||"USD",_m:"base",_rb:1,_rs:1};continue}const s=n(a.ratioBuy)>0?n(a.ratioBuy):1,d=n(a.ratioSell)>0?n(a.ratioSell):1,o="divide"===a.method?"divide":"multiply";let l=0,c=0;"divide"===o?(l=+r/s,c=+i/d):(l=+r*s,c=+i*d),e[t]={buy:l,sell:c,name:a.name||t,_m:o,_rb:s,_rs:d}}return e}(a),function(){try{const t=document.getElementById("trade-backdrop");if(!t||!t.classList.contains("open"))return;const e=t.querySelector(".trade-modal");if(!e)return;const n=e.querySelector("#trade-get");if(!n)return;const a=n.value;n.innerHTML=k(a);try{const t=e.querySelector("#trade-flag-get");t&&(t.textContent=_(n.value)||"",window.twemoji&&window.twemoji.parse(t,{folder:"svg",ext:".svg",base:"https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/",attributes:()=>({loading:"lazy",decoding:"async",referrerpolicy:"no-referrer"})}))}catch(t){}if(n.value!==a){const t=new Event("change",{bubbles:!0});n.dispatchEvent(t)}}catch(t){}}();try{window.dispatchEvent(new Event('taif:data-updated'))}catch(_e){}try{window.__trade_refreshOpenRate&&window.__trade_refreshOpenRate()}catch(t){}try{setTimeout(function(){try{window.__trade_refreshOpenRate&&window.__trade_refreshOpenRate()}catch(_e){}},60)}catch(_e){}}})}catch(t){}try{window.$db.onValue(window.$db.ref("taif/tradeSettings"),t=>{const e=t&&t.val&&t.val();l=u(e);try{ if(!window.__trade_fields_migrated){  const merged=u(e);  const before=JSON.stringify((e&&e.fields)||[]);  const after=JSON.stringify((merged&&merged.fields)||[]);  if(before!==after){   window.__trade_fields_migrated=!0;   try{window.$db.set(window.$db.ref("taif/tradeSettings"),merged)}catch(_){ }  } else { window.__trade_fields_migrated=!0; } }}catch(_){ }(function(){try{const t=document.getElementById("trade-backdrop");if(!t||!t.classList.contains("open"))return;const e=t.querySelector(".trade-modal");if(!e)return;const n=e.querySelector("#trade-dyn-fields");if(!n)return;const a=u(l).fields||p,r={};n.querySelectorAll("[data-dyn]").forEach(t=>{r[t.getAttribute("data-dyn")]=t.value||""}),n.innerHTML=E(a,r)}catch(t){}})()})}catch(t){}}}function C(){try{window.__trade={buy:()=>L("buy"),sell:()=>L("sell"),exchange:()=>L("exchange"),logs:()=>A(),fields:()=>q()};try{if(!window.__trade_data_listener){window.__trade_data_listener=!0;window.addEventListener('taif:data-updated',function(){try{window.__trade_refreshOpenRate&&window.__trade_refreshOpenRate()}catch(_e){}});}}catch(_e){}}catch(t){}j()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",C):C()}();</script>
<script id="birthdate-mask">
(function(){
 function formatDDMMYYYY(raw){
  var v = String(raw||"").replace(/[^0-9]/g, "");
  if(v.length > 8) v = v.slice(0,8);
  if(v.length > 4) return v.slice(0,2) + "/" + v.slice(2,4) + "/" + v.slice(4);
  if(v.length > 2) return v.slice(0,2) + "/" + v.slice(2);
  return v;
 }

 document.addEventListener("input", function(e){
  var el = e && e.target;
  if(!el) return;
  if(el.getAttribute && el.getAttribute("data-dyn")==="birth_date"){
   var nv = formatDDMMYYYY(el.value);
   if(el.value !== nv) el.value = nv;
  }
 }, true);

 document.addEventListener("blur", function(e){
  var el = e && e.target;
  if(!el) return;
  if(el.getAttribute && el.getAttribute("data-dyn")==="birth_date"){
   el.value = formatDDMMYYYY(el.value);
  }
 }, true);
})();
</script>
<style id="force-cancel-red-final">#inv-cancel,#trade-cancel{background:#dc2626 !important;color:#ffffff !important}</style>
<style id="removed-old-next-right-style">.trade-actions{display:flex !important;justify-content:flex-end !important;gap:14px !important}#trade-submit{order:2 !important}#trade-cancel{order:1 !important}</style>
<style id="trade-summary-rtl-fix">.trade-addbox,.trade-addbox .trade-muted,.trade-addbox div{text-align:right !important;direction:rtl !important}</style>
<style id="force-inv-exec-green-final">#inv-exec{background:#16a34a !important;color:#ffffff !important}</style>
<style id="kpi-holdings-align-css">
/* Align currency/amount lines in KPI boxes 4/5/6 */
.kpi-holdings-line .table-numbers,
.kpi-holdings-lines .table-numbers{
  text-align:left !important;
  min-width:6ch;
}
</style>
<style id="unified-scroll-kpi-log-v1">
  /* Make KPI + log list scroll together inside the same modal */
  #trade-backdrop .tr-logwrap{max-height:none !important; overflow:visible !important;}
  #trade-backdrop .trade-modal{overflow:auto !important;}
</style>

<script>
(function(){
  "use strict";
  function getSessionObj(){
    try{ return JSON.parse(localStorage.getItem("taif:session")||"null"); }catch(_){ return null; }
  }
  async function clearServerSession(username){
    try{
      if(!username) return;
      if(!window.$db || !window.$db.set || !window.$db.ref) return;
      await window.$db.set(window.$db.ref("taif/session/"+username), null);
    }catch(_){}
  }
  async function doLogout(){
    const s = getSessionObj()||{};
    const username = s.username || s.name || s.user || "";
    try{
      // Clear server session first (so other devices can login)
      await clearServerSession(username);
    }catch(_){}
    try{ localStorage.removeItem("taif:session"); }catch(_){}
    try{ localStorage.removeItem("taif:session_token"); }catch(_){}
    try{ if(window.Log && window.Log.logout) window.Log.logout(username||undefined); }catch(_){}
    try{ location.reload(); }catch(_){}
  }

  function ensureModal(){
    if(document.getElementById("taif-logout-confirm-backdrop")) return;
    const bd = document.createElement("div");
    bd.id = "taif-logout-confirm-backdrop";
    bd.style.cssText = "position:fixed;inset:0;background:rgba(0,0,0,.35);backdrop-filter:blur(3px);z-index:999999;display:flex;align-items:center;justify-content:center;padding:18px";
    const box = document.createElement("div");
    box.dir = "rtl";
    box.style.cssText = "width:min(520px,92vw);background:rgba(255,255,255,.92);border:1px solid rgba(255,255,255,.55);border-radius:18px;box-shadow:0 24px 60px rgba(0,0,0,.28);padding:18px 18px 14px;font-family:system-ui,Segoe UI,Tahoma,Arial";
    box.innerHTML =
      '<div style="font-weight:900;font-size:20px;display:flex;gap:10px;align-items:center;justify-content:flex-start;margin-bottom:8px">' +
        '<span style="font-size:22px">ğŸšª</span>' +
        '<span>ØªØ£ÙƒÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span>' +
      '</div>' +
      '<div style="color:#334155;font-weight:700;line-height:1.6;margin:6px 0 14px">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ</div>' +
      '<div style="display:flex;gap:10px;justify-content:flex-end;align-items:center">' +
        '<button type="button" id="taif-logout-cancel" style="min-width:110px;padding:10px 14px;border-radius:12px;border:1px solid rgba(15,23,42,.18);background:#fff;font-weight:900;cursor:pointer;touch-action:manipulation">Ø¥Ù„ØºØ§Ø¡</button>' +
        '<button type="button" id="taif-logout-ok" style="min-width:110px;padding:10px 14px;border-radius:12px;border:1px solid rgba(16,185,129,.35);background:linear-gradient(135deg,#16a34a,#22c55e);color:#fff;font-weight:900;cursor:pointer;touch-action:manipulation">Ù…ÙˆØ§ÙÙ‚</button>' +
      '</div>';
    bd.appendChild(box);
    bd.addEventListener("pointerdown", function(ev){
      if(ev.target === bd){ try{ev.preventDefault();}catch(_){} close(); }
    }, {passive:false});
    bd.addEventListener("touchstart", function(ev){
      if(ev.target === bd){ try{ev.preventDefault();}catch(_){} close(); }
    }, {passive:false});
    function close(){
      try{ bd.remove(); }catch(_){}
    }
    var __cancelBtn = box.querySelector("#taif-logout-cancel");
    var __okBtn = box.querySelector("#taif-logout-ok");
    function __cancel(ev){ try{ev&&ev.preventDefault&&ev.preventDefault();}catch(_){} try{ev&&ev.stopPropagation&&ev.stopPropagation();}catch(_){} close(); }
    function __ok(ev){ try{ev&&ev.preventDefault&&ev.preventDefault();}catch(_){} try{ev&&ev.stopPropagation&&ev.stopPropagation();}catch(_){}
      try{ __okBtn.disabled = true; }catch(_){}
      try{ __cancelBtn.disabled = true; }catch(_){}
      doLogout();
    }
    __cancelBtn.addEventListener("pointerdown", __cancel, {passive:false});
    __cancelBtn.addEventListener("touchstart", __cancel, {passive:false});
    __cancelBtn.addEventListener("click", __cancel);
    __okBtn.addEventListener("pointerdown", __ok, {passive:false});
    __okBtn.addEventListener("touchstart", __ok, {passive:false});
    __okBtn.addEventListener("click", __ok);
    
    document.body.appendChild(bd);
    // focus
    try{ box.querySelector("#taif-logout-ok").focus(); }catch(_){}
  }

  function isLogoutTarget(el){
    if(!el) return false;

    // 1) Prefer explicit markers (most reliable)
    try{
      const marked = el.closest && el.closest('[data-action="logout"],[data-key="logout"],[data-id="logout"],[aria-label*="Ø®Ø±ÙˆØ¬" i],#logout,[id*="logout" i],[class*="logout" i]');
      if(marked){
        // If it's a very large container, ignore (prevents matching whole drawers)
        const r = marked.getBoundingClientRect ? marked.getBoundingClientRect() : null;
        if(!r || (r.width*r.height) < 200000) return true; // ~ < 450x450
      }
    }catch(_){}

    // 2) Fallback: match ONLY the actual logout item text on the clickable node itself
    let node = null;
    try{ node = el.closest ? el.closest('button,a,[role="button"],li,div') : el; }catch(_){ node = el; }
    if(!node) node = el;

    const t = ((node.textContent || '')+'').replace(/\s+/g,' ').trim();
    if(!t) return false;

    // Must be short & exact/near-exact to avoid matching parent containers that include many items
    if(t.length > 30) return false;

    const normalized = t.replace(/^ğŸšª\s*/,'').trim();
    if(normalized === 'ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬' || normalized === 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬') return true;

    return false;
  }

  
  // Remote logout enforcement: if session key is deleted/changed in DB, log this device out automatically.
  (function bindRemoteLogoutWatcher(){
    try{
      const s = getSessionObj();
      if(!s) return;
      const username = s.username || s.name || s.user || "";
      if(!username) return;
      if(!window.$db || !window.$db.onValue || !window.$db.ref) return;
      const localTok = (function(){ try{return localStorage.getItem("taif:session_token")||"";}catch(_){return"";} })();
      window.$db.onValue(window.$db.ref("taif/session/"+username), function(snap){
        try{
          const v = snap && snap.val ? snap.val() : null;
          // if session removed => force logout
          if(!v){
            try{ localStorage.removeItem("taif:session"); }catch(_){}
            try{ localStorage.removeItem("taif:session_token"); }catch(_){}
            try{ alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬Ùƒ Ù„Ø£Ù† Ø§Ù„Ø¬Ù„Ø³Ø© Ø£ÙØºÙ„Ù‚Øª Ù…Ù† Ø¬Ù‡Ø§Ø² Ø¢Ø®Ø±."); }catch(_){}
            try{ location.reload(); }catch(_){}
            return;
          }
          // if token mismatch => someone logged in elsewhere
          if(localTok && v && v.token && String(v.token)!==String(localTok)){
            try{ localStorage.removeItem("taif:session"); }catch(_){}
            try{ localStorage.removeItem("taif:session_token"); }catch(_){}
            try{ alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø² Ø¢Ø®Ø±. Ø³ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬Ùƒ Ø§Ù„Ø¢Ù†."); }catch(_){}
            try{ location.reload(); }catch(_){}
          }
        }catch(_){}
      });
    }catch(_){}
  })();

document.addEventListener("click", function(ev){
    try{
      if(ev.defaultPrevented) return;
      if(!isLogoutTarget(ev.target)) return;
      ev.preventDefault();
      ev.stopPropagation();
      ensureModal();
    }catch(_){}
  }, true);
})();
</script>


<style id="adminlog-cards-css">
/* Admin Logs â€” card style (closer to Trade Logs) */
.adminlog-modal .adminlog-list{display:grid;gap:10px;padding:0 12px;box-sizing:border-box}

/* Card: fixed width (no horizontal overflow) */
.adminlog-modal .adminlog-card{
  position:relative;
  display:flex;
  flex-direction:column; /* main (top-right) then time (bottom-left) */
  gap:8px;
  width:100%;max-width:100%;box-sizing:border-box;
  padding:12px 14px;
  border-radius:18px;
  border:2px solid rgba(15,23,42,.10);
  background:rgba(255,255,255,.92);
  box-shadow:0 10px 24px rgba(0,0,0,.08);
  overflow:hidden; /* guarantee no spill */
}

/* Main text â€” top/right */
.adminlog-modal .adminlog-card .adminlog-main{
  min-width:0;
  max-width:100%;
  text-align:right;
  overflow-wrap:anywhere;
  word-break:break-word;
}

/* Time/date â€” bottom/left */
.adminlog-modal .adminlog-card .adminlog-time{
  align-self:flex-start;
  text-align:left;
  direction:ltr;
  unicode-bidi:isolate;
  max-width:100%;
  white-space:normal;
  overflow-wrap:anywhere;
  opacity:.7;
  font:800 12px/1 system-ui,Segoe UI,Roboto,Tahoma;
}

.adminlog-modal .adminlog-card[data-kind="success"]{border-color:rgba(34,197,94,.60);box-shadow:0 12px 26px rgba(34,197,94,.12)}
.adminlog-modal .adminlog-card[data-kind="danger"]{border-color:rgba(239,68,68,.55);box-shadow:0 12px 26px rgba(239,68,68,.10)}
.adminlog-modal .adminlog-card[data-kind="warning"]{border-color:rgba(245,158,11,.55);box-shadow:0 12px 26px rgba(245,158,11,.10)}
.adminlog-modal .adminlog-card[data-kind="neutral"]{border-color:rgba(100,116,139,.40)}
.adminlog-modal .adminlog-card[data-kind="info"]{border-color:rgba(59,130,246,.45)}

/* Force time alignment even before enhancer runs */
.adminlog-modal .text-xs.opacity-70.whitespace-nowrap{
  text-align:left !important;
  direction:ltr !important;
  unicode-bidi:isolate !important;
}
</style>

<script id="adminlog-cards-enhancer">
(function(){
  function norm(s){return String(s||"").replace(/\s+/g," ").trim();}
  function detectKind(text){
    if(!text) return "neutral";
    if(text.includes("ÙØ´Ù„")||text.includes("âŒ")) return "danger";
    if(text.includes("Ù†Ø¬Ø§Ø­")||text.includes("âœ…")) return "success";
    if(text.includes("Ù…Ø³Ø­")||text.includes("âš ï¸")) return "warning";
    if(text.includes("ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬")||text.includes("ğŸšª")) return "neutral";
    return "info";
  }
  function looksLikeTime(s){
    s = norm(s);
    if(!s) return false;
    return (/\d{4}\/\d{1,2}\/\d{1,2}/.test(s) || /\d{1,2}:\d{2}/.test(s));
  }

  function enhance(modal){
    try{
      if(!modal || modal.__adminLogEnhanced) return;
      const ttl = modal.querySelector("#modal-title");
      if(!ttl || norm(ttl.textContent)!=="Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©") return;

      modal.classList.add("adminlog-modal");

      // Find the scroll container that contains the rows (best-effort)
      let list = null;
      const divs = Array.from(modal.querySelectorAll("div"));
      const candidates = divs.filter(d=>{
        const cls = String(d.className||"");
        return (cls.includes("overflow") || cls.includes("max-h")) && d.children && d.children.length>2;
      });
      list = candidates.find(d=>norm(d.textContent).includes("Ø¨ÙˆØ§Ø³Ø·Ø©")) || candidates[0] || null;
      if(!list) return;

      list.classList.add("adminlog-list");

      const rows = Array.from(list.children).filter(el=>el && el.nodeType===1);
      rows.forEach(row=>{
        const tx = norm(row.textContent);
        if(!tx || tx.length<3) return;
        // skip the header/control area if any
        if(row.querySelector("button") && tx.includes("Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„")) return;

        row.classList.add("adminlog-card");
        row.dataset.kind = detectKind(tx);
        try{ row.style.borderBottom = "0"; }catch(_){}

        // Restructure: main (top/right) + time (bottom/left)
        if(row.__adminLogCardified) return;
        const children = Array.from(row.children).filter(n=>n && n.nodeType===1);

        let timeEl = null;
        if(children.length){
          // prefer an element that looks like date/time
          timeEl = children.find(ch=>looksLikeTime(ch.textContent)) || null;
          // common case: last child is time
          if(!timeEl && children.length>=2 && looksLikeTime(children[children.length-1].textContent)) timeEl = children[children.length-1];
        }

        // Create wrappers
        const main = document.createElement("div");
        main.className = "adminlog-main";
        const time = document.createElement("div");
        time.className = "adminlog-time";

        if(timeEl){
          // Move everything except timeEl into main
          children.forEach(ch=>{
            if(ch === timeEl) return;
            main.appendChild(ch);
          });
          // Move timeEl into time wrapper
          time.appendChild(timeEl);
        }else{
          // Fallback: extract date/time substring from text
          const raw = norm(row.textContent);
          const m = raw.match(/(\d{4}\/\d{1,2}\/\d{1,2}.*?)(?:$)/);
          if(m && m[1]){
            time.textContent = m[1];
            const mainText = norm(raw.replace(m[1], ""));
            main.textContent = mainText;
          }else{
            main.textContent = raw;
          }
          // remove old content
          while(row.firstChild) row.removeChild(row.firstChild);
          row.appendChild(main);
          row.appendChild(time);
          row.__adminLogCardified = true;
          return;
        }

        // Clear row then append wrappers
        while(row.firstChild) row.removeChild(row.firstChild);
        row.appendChild(main);
        row.appendChild(time);

        row.__adminLogCardified = true;
      });

      modal.__adminLogEnhanced = true;
    }catch(_){}
  }

  const run = ()=> {
    try{
      const dialogs = Array.from(document.querySelectorAll(".backdrop [role='dialog']"));
      dialogs.forEach(enhance);
    }catch(_){}
  };

  const obs = new MutationObserver(run);
  try{ obs.observe(document.body, {childList:true, subtree:true}); }catch(_){}
  run();
})();
</script>


<style id="bulk-edit-modal-wide-css">
/* Bulk Edit (ØªØ¹Ø¯ÙŠÙ„ ÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª) modal â€” responsive width (mobile wider, desktop slightly narrower) */
.bulk-edit-wide-modal{
  /* default (tablet/desktop fallback) */
  width: min(1040px, 78vw) !important;
  max-width: min(1040px, 78vw) !important;
}

/* Mobile: make it wider (no narrow 70vw) */
@media (max-width: 640px){
  .bulk-edit-wide-modal{
    width: 94vw !important;
    max-width: 94vw !important;
  }
}

/* Medium screens: comfortable wide */
@media (min-width: 641px) and (max-width: 1023px){
  .bulk-edit-wide-modal{
    width: min(1100px, 90vw) !important;
    max-width: min(1100px, 90vw) !important;
  }
}

/* Large desktop: reduce a bit vs previous (avoid too wide) */
@media (min-width: 1024px){
  .bulk-edit-wide-modal{
    width: min(1020px, 74vw) !important;
    max-width: min(1020px, 74vw) !important;
  }
}

</style>

<script id="bulk-edit-modal-wide-enhancer">
(function(){
  function norm(s){return String(s||"").replace(/\s+/g," ").trim();}
  function apply(){
    try{
      var dialogs = Array.from(document.querySelectorAll('.backdrop [role="dialog"]'));
      dialogs.forEach(function(dlg){
        try{
          var ttl = dlg.querySelector("#modal-title");
          if(!ttl) return;
          if(norm(ttl.textContent) !== "ØªØ¹Ø¯ÙŠÙ„ ÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª") return;
          dlg.classList.add("bulk-edit-wide-modal");
        }catch(_){}
      });
    }catch(_){}
  }
  try{
    var obs = new MutationObserver(apply);
    obs.observe(document.body, {childList:true, subtree:true});
  }catch(_){}
  if(document.readyState === "loading") document.addEventListener("DOMContentLoaded", apply);
  else apply();
})();
</script>


<script id="taif-back-stack-v1">
(function(){
  "use strict";

  // ===== Back stack for mobile/browser back button =====
  var ROOT_TAG = "taif-root";
  var OVERLAY_TAG = "taif-ov";
  var inPop = false;

  function safeParseZ(z){
    var n = parseInt(z, 10);
    return isFinite(n) ? n : 0;
  }

  function overlayCandidates(){
    var out = [];

    // Logout confirm (custom)
    var lo = document.getElementById("taif-logout-confirm-backdrop");
    if(lo) out.push(lo);

    // Trade overlay
    var tr = document.getElementById("trade-backdrop");
    if(tr && tr.classList && tr.classList.contains("open")) out.push(tr);

    // Drawer overlay
    var db = document.querySelector(".drawer-backdrop");
    var dr = document.querySelector(".drawer.open");
    if(db) out.push(db);
    if(dr) out.push(dr);

    // React modals (generic)
    document.querySelectorAll(".backdrop").forEach(function(bd){
      // ignore if it's not visible
      try{
        var st = window.getComputedStyle(bd);
        if(st && st.display === "none") return;
      }catch(_){}
      out.push(bd);
    });

    // Custom modals created by branch manager and others (best-effort):
    // Fixed full-screen backdrops with very high z-index and a close button.
    document.querySelectorAll("div").forEach(function(el){
      try{
        var st = window.getComputedStyle(el);
        if(!st) return;
        if(st.position !== "fixed") return;
        if(st.inset !== "0px") return;
        var zi = safeParseZ(st.zIndex);
        if(zi < 5000) return;
        if(el.id === "trade-backdrop" || el.id === "taif-logout-confirm-backdrop") return;
        // Must look like a backdrop: semi-transparent background and contains a close control
        var bg = (st.backgroundColor || "") + " " + (st.background || "");
        var hasClose = !!(el.querySelector && el.querySelector("[data-close],#taif-logout-cancel,.trade-backbtn,[aria-label='Ø¥ØºÙ„Ø§Ù‚']"));
        if(!hasClose && !(bg && bg.indexOf("rgba") !== -1)) return;
        out.push(el);
      }catch(_){}
    });

    // Deduplicate while preserving order
    var seen = new Set();
    return out.filter(function(x){
      if(!x) return false;
      if(seen.has(x)) return false;
      seen.add(x);
      return true;
    });
  }

  function topOverlay(){
    var c = overlayCandidates();
    if(!c.length) return null;

    // choose highest z-index; tie-breaker by DOM order (later = top)
    var best = null, bestZ = -1, bestIdx = -1;
    for(var i=0;i<c.length;i++){
      var el = c[i];
      var zi = 0;
      try{ zi = safeParseZ(window.getComputedStyle(el).zIndex); }catch(_){}
      if(zi > bestZ || (zi === bestZ && i > bestIdx)){
        bestZ = zi; bestIdx = i; best = el;
      }
    }
    return best;
  }

  function closeOverlay(el){
    if(!el) return false;

    // 1) Logout confirm
    if(el.id === "taif-logout-confirm-backdrop"){
      var cancel = el.querySelector("#taif-logout-cancel");
      if(cancel){ try{ cancel.click(); return true; }catch(_){ } }
      try{ el.remove(); return true; }catch(_){ }
      return true;
    }

    // 2) Trade modal
    if(el.id === "trade-backdrop"){
      try{
        var btn = el.querySelector(".trade-backbtn");
        if(btn){ btn.click(); return true; }
      }catch(_){}
      try{ el.classList.remove("open"); return true; }catch(_){}
      return true;
    }

    // 3) Drawer
    if(el.classList && el.classList.contains("drawer-backdrop")){
      try{ el.click(); return true; }catch(_){}
      return true;
    }
    if(el.classList && el.classList.contains("drawer")){
      try{
        var bd = document.querySelector(".drawer-backdrop");
        if(bd){ bd.click(); return true; }
      }catch(_){}
      return true;
    }

    // 4) React backdrop modal(s)
    if(el.classList && el.classList.contains("backdrop")){
      try{
        // Prefer explicit close button inside dialog (âŒ)
        var closeBtn = el.querySelector('[aria-label="Ø¥ØºÙ„Ø§Ù‚"], button[aria-label="Ø¥ØºÙ„Ø§Ù‚"], button.absolute.top-3.left-3');
        if(closeBtn){ closeBtn.click(); return true; }
      }catch(_){}
      // Fallback: press Escape
      try{
        var ev = new KeyboardEvent("keydown", { key:"Escape", bubbles:true });
        document.dispatchEvent(ev);
        return true;
      }catch(_){}
      try{ el.click(); return true; }catch(_){}
      return true;
    }

    // 5) Generic custom modal/backdrop
    try{
      var dc = el.querySelector("[data-close]");
      if(dc){ dc.click(); return true; }
    }catch(_){}
    try{
      var close2 = el.querySelector('[aria-label="Ø¥ØºÙ„Ø§Ù‚"]');
      if(close2){ close2.click(); return true; }
    }catch(_){}
    try{ el.remove(); return true; }catch(_){}
    return false;
  }

  function overlayOpenCount(){
    return overlayCandidates().length;
  }

  function currentState(){
    try{ return history.state || null; }catch(_){ return null; }
  }

  function isOvState(st){
    return !!(st && st.__taif === OVERLAY_TAG);
  }

  function pushOvState(){
    try{
      history.pushState({ __taif: OVERLAY_TAG, t: Date.now() }, "");
      return true;
    }catch(_){ return false; }
  }

  function ensureRootBuffer(){
    // Keep one "buffer" entry so first back on home doesn't exit instantly.
    try{
      var st = currentState();
      if(st && st.__taif === ROOT_TAG) return;
      history.replaceState({ __taif: ROOT_TAG, t: Date.now() }, "");
      // add one extra root buffer; second back exits app
      history.pushState({ __taif: ROOT_TAG, t: Date.now()+1, b: 1 }, "");
    }catch(_){}
  }

  // Observe overlays opening to push history state.
  var lastCount = 0;
  function tick(){
    if(inPop) { lastCount = overlayOpenCount(); return; }
    var cnt = overlayOpenCount();
    if(cnt > lastCount){
      // overlay opened (possibly nested): push one state per delta
      var delta = cnt - lastCount;
      for(var i=0;i<delta;i++) pushOvState();
    }
    lastCount = cnt;
  }

  function onPop(ev){
    try{
      var st = (ev && ev.state) ? ev.state : null;
      // If we're popping an overlay state: close top overlay and keep user inside app
      if(isOvState(st)){
        inPop = true;
        var top = topOverlay();
        closeOverlay(top);
        // allow DOM to settle
        setTimeout(function(){ inPop = false; tick(); }, 40);
        return;
      }

      // If no overlay state but overlays are open, still close one (safety)
      if(overlayOpenCount() > 0){
        inPop = true;
        closeOverlay(topOverlay());
        setTimeout(function(){ inPop = false; tick(); }, 40);
        // keep a root buffer so next back continues in-app
        ensureRootBuffer();
        return;
      }

      // At home with no overlays: first back goes to root buffer; second exits.
      // ensure buffer exists while staying in app
      ensureRootBuffer();
    }catch(_){}
  }

  function bindCloseSync(){
    // When user closes overlay by clicking buttons/backdrops, consume a history entry
    document.addEventListener("click", function(e){
      try{
        if(inPop) return;
        var t = e && e.target;
        if(!t) return;

        // Close actions
        var isClose =
          (t.id === "taif-logout-cancel") ||
          (t.closest && t.closest("#taif-logout-cancel")) ||
          (t.classList && t.classList.contains("trade-backbtn")) ||
          (t.closest && t.closest(".trade-backbtn")) ||
          (t.closest && t.closest("[data-close]")) ||
          (t.getAttribute && t.getAttribute("aria-label")==="Ø¥ØºÙ„Ø§Ù‚") ||
          (t.closest && t.closest('[aria-label="Ø¥ØºÙ„Ø§Ù‚"]')) ||
          (t.classList && t.classList.contains("drawer-backdrop")) ||
          (t.closest && t.closest(".drawer-backdrop")) ||
          (t.id === "trade-cancel" || (t.closest && t.closest("#trade-cancel"))) ||
          (t.id === "inv-cancel" || (t.closest && t.closest("#inv-cancel")));

        if(!isClose) return;

        // If top of history is overlay, go back one step to keep stack clean.
        var st = currentState();
        if(isOvState(st)){
          inPop = true;
          history.back();
          setTimeout(function(){ inPop = false; }, 60);
        }
      }catch(_){}
    }, true);

    // ESC closes modals; keep history in sync
    document.addEventListener("keydown", function(e){
      try{
        if(inPop) return;
        if(!e || e.key !== "Escape") return;
        var st = currentState();
        if(isOvState(st)){
          inPop = true;
          history.back();
          setTimeout(function(){ inPop = false; }, 60);
        }
      }catch(_){}
    }, true);
  }

  // Init
  ensureRootBuffer();
  bindCloseSync();
  window.addEventListener("popstate", onPop);

  // Observe DOM changes that open/close modals
  try{
    var obs = new MutationObserver(function(){ tick(); });
    obs.observe(document.documentElement, { subtree:true, childList:true, attributes:true, attributeFilter:["class","style"] });
  }catch(_){}
  // periodic safety tick
  try{ setInterval(tick, 350); }catch(_){}
  // initial
  setTimeout(function(){ lastCount = overlayOpenCount(); }, 80);
})();
</script>

</body></html>
